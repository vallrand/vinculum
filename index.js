!function(e){var t={};function r(i){if(t[i])return t[i].exports;var n=t[i]={i:i,l:!1,exports:{}};return e[i].call(n.exports,n,n.exports,r),n.l=!0,n.exports}r.m=e,r.c=t,r.d=function(e,t,i){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:i})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var i=Object.create(null);if(r.r(i),Object.defineProperty(i,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var n in e)r.d(i,n,function(t){return e[t]}.bind(null,n));return i},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="./",r(r.s=96)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.snapToGrid=t.vec2=void 0,t.vec2=function(e,r){return void 0===e&&(e=0),void 0===r&&(r=e),t.vec2.fromValues(e,r,new Float32Array(2))},t.vec2.cross=function(e,t){return e[0]*t[1]-e[1]*t[0]},t.vec2.rotate=function(e,t,r){var i=Math.cos(t),n=Math.sin(t),a=e[0],o=e[1];return r[0]=i*a-n*o,r[1]=n*a+i*o,r},t.vec2.rotate90cw=function(e,t){var r=-e[0];return t[0]=e[1],t[1]=r,t},t.vec2.rotate90ccw=function(e,t){var r=-e[1];return t[1]=e[0],t[0]=r,t},t.vec2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t},t.vec2.fromValues=function(e,t,r){return r[0]=e,r[1]=t,r},t.vec2.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r},t.vec2.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r},t.vec2.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r},t.vec2.divide=function(e,t,r){return r[0]=e[0]/t[0],r[1]=e[1]/t[1],r},t.vec2.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r},t.vec2.distanceSquared=function(e,t){var r=t[0]-e[0],i=t[1]-e[1];return r*r+i*i},t.vec2.distance=function(e,r){return Math.sqrt(t.vec2.distanceSquared(e,r))},t.vec2.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]},t.vec2.magnitude=function(e){return Math.sqrt(t.vec2.magnitudeSquared(e))},t.vec2.normalize=function(e,t){var r=e[0],i=e[1],n=r*r+i*i,a=n&&1/Math.sqrt(n);return t[0]=r*a,t[1]=i*a,t},t.vec2.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]},t.vec2.lerp=function(e,t,r,i){return i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i},t.vec2.reflect=function(e,t,r){var i=e[0]*t[0]+e[1]*t[1];return r[0]=e[0]-2*t[0]*i,r[1]=e[1]-2*t[1]*i,r},t.vec2.angle=function(e,r){return Math.acos(t.vec2.dot(e,r))},t.vec2.rotation=function(e){return Math.atan2(e[1],e[0])},t.snapToGrid=function(e,t,r){return r[0]=t*Math.round(e[0]/t),r[1]=t*Math.round(e[1]/t),r},t.vec2.ZERO=t.vec2(0,0),t.vec2.AXIS_Y=t.vec2(0,1),t.vec2.AXIS_X=t.vec2(1,0),t.vec2.temp=t.vec2()},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)},o=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)"default"!==r&&Object.hasOwnProperty.call(e,r)&&i(t,e,r);return n(t,e),t};Object.defineProperty(t,"__esModule",{value:!0}),a(r(5),t),a(r(0),t),a(r(42),t),a(r(16),t),a(r(62),t),a(r(6),t),a(r(43),t),a(r(98),t),a(r(99),t),a(r(100),t),a(r(14),t),a(r(9),t),a(r(20),t),a(r(44),t),a(r(45),t),t.ease=o(r(63))},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(48),t),n(r(22),t),n(r(106),t),n(r(69),t),n(r(107),t),n(r(108),t),n(r(109),t),n(r(110),t),n(r(15),t),n(r(23),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(64),t),n(r(101),t),n(r(102),t),n(r(103),t),n(r(17),t),n(r(32),t),n(r(66),t),n(r(67),t),n(r(68),t),n(r(104),t),n(r(65),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(51),t),n(r(160),t),n(r(36),t),n(r(53),t),n(r(166),t),n(r(35),t),n(r(38),t),n(r(167),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hashString=t.int32pow2Floor=t.int32pow2Ceil=t.int32pow2=t.leastCommonMultiple=t.greatestCommonDivisor=t.transpose=t.shuffle=t.range=t.linearRemap=t.linearGradient=t.smoothstep=t.lerpAngle=t.shortestAngle=t.randomInt=t.randomFloat=t.mod=t.clamp=t.step=t.lerp=void 0,t.lerp=function(e,t,r){return e+(t-e)*r},t.step=function(e,t,r){return r>.5?t:e},t.clamp=function(e,t,r){return Math.min(r,Math.max(t,e))},t.mod=function(e,t){return(e%t+t)%t},t.randomFloat=function(e,t,r){return r()*(t-e)+e},t.randomInt=function(e,t,r){return Math.floor(r()*(t-e+1))+e},t.shortestAngle=function(e,t){var r=(t-e)%(2*Math.PI);return 2*r%(2*Math.PI)-r},t.lerpAngle=function(e,r,i){return e+t.shortestAngle(e,r)*i},t.smoothstep=function(e,r,i){return e===r?i<e?0:1:(i=t.clamp((i-e)/(r-e),0,1))*i*(3-2*i)},t.linearGradient=function(e){return function(r){return function(i,n){var a=t.clamp(i,0,1)*(r.length-1),o=0|a,s=a%1,c=r[o++],l=o<r.length?r[o]:c;return e(c,l,s,n)}}},t.linearRemap=function(e,t,r){return t[0]+(t[1]-t[0])*(r-e[0])/(e[1]-e[0])},t.range=function(e,t,r){void 0===r&&(r=[]),null==t&&(t=e,e=0);for(var i=e,n=0;i<t;i++,n++)r[n]=i;return r},t.shuffle=function(e,t){for(var r=e.length-1;r>0;r--){var i=t()*(r+1)|0,n=e[r];e[r]=e[i],e[i]=n}return e},t.transpose=function(e){for(var t=[],r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)(t[i]=t[i]||[])[r]=e[r][i];return t},t.greatestCommonDivisor=function(e,r){return r?t.greatestCommonDivisor(r,e%r):e},t.leastCommonMultiple=function(e,r){return e*r/t.greatestCommonDivisor(e,r)},t.int32pow2=function(e){return!(e&e-1||!e)},t.int32pow2Ceil=function(e){return e+=+(0===e),--e,e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)+1},t.int32pow2Floor=function(e){return e|=e>>>1,e|=e>>>2,e|=e>>>4,e|=e>>>8,(e|=e>>>16)-(e>>>1)},t.hashString=function(e){for(var t=0,r=e.length,i=0;i<r;i++){t=(t<<5)-t+e.charCodeAt(i),t|=0}return t}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3x2=void 0,t.mat3x2=function(){return t.mat3x2.identity(new Float32Array(6))},t.mat3x2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e[4]=0,e[5]=0,e},t.mat3x2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t},t.mat3x2.rotate=function(e,t,r){var i=Math.cos(t),n=Math.sin(t),a=e[0],o=e[1],s=e[2],c=e[3],l=e[4],u=e[5];return r[0]=a*i-o*n,r[1]=a*n+o*i,r[2]=s*i-c*n,r[3]=s*n+c*i,r[4]=l*i-u*n,r[5]=l*n+u*i,r},t.mat3x2.scale=function(e,t,r){var i=t[0],n=t[1];return r[0]=e[0]*i,r[1]=e[1]*n,r[2]=e[2]*i,r[3]=e[3]*n,r[4]=e[4]*i,r[5]=e[5]*n,r},t.mat3x2.translate=function(e,t,r){return e!==r&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3]),r[4]=e[4]+t[0],r[5]=e[5]+t[1],r},t.mat3x2.multiply=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=t[0],u=t[1],p=t[2],h=t[3],f=t[4],d=t[5];return r[0]=i*l+a*u,r[1]=n*l+o*u,r[2]=i*p+a*h,r[3]=n*p+o*h,r[4]=i*f+a*d+s,r[5]=n*f+o*d+c,r},t.mat3x2.fromTransform=function(e,t,r,i,n,a,o,s,c,l){return l[0]=Math.cos(o+c)*n,l[1]=Math.sin(o+c)*n,l[2]=-Math.sin(o-s)*a,l[3]=Math.cos(o-s)*a,l[4]=e-r*l[0]-i*l[2],l[5]=t-r*l[1]-i*l[3],l},t.mat3x2.transform=function(e,t,r){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n+t[4],r[1]=t[1]*i+t[3]*n+t[5],r},t.mat3x2.invert=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],c=r*a-i*n,l=c&&1/c;return t[0]=a*l,t[1]=-i*l,t[2]=-n*l,t[3]=r*l,t[4]=(n*s-a*o)*l,t[5]=(i*o-r*s)*l,t},t.mat3x2.orthogonal=function(e,t,r,i,n){var a=1/(e-t),o=1/(r-i);return n[0]=-2*a,n[1]=0,n[2]=0,n[3]=-2*o,n[4]=(e+t)*a,n[5]=(i+r)*o,n},t.mat3x2.IDENTITY=t.mat3x2()},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),t.rng=void 0,n(r(179),t),n(r(180),t);var a=r(44);t.rng=a.LCG(1)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(90),t),n(r(169),t),n(r(170),t),n(r(173),t),n(r(174),t),n(r(39),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AABB=void 0;var i=r(16);t.AABB=function(e,r,i,n){return void 0===e&&(e=1/0),void 0===r&&(r=1/0),void 0===i&&(i=-1/0),void 0===n&&(n=-1/0),t.AABB.fromValues(e,r,i,n,new Float32Array(4))},t.AABB.copy=i.vec4.copy,t.AABB.fromValues=i.vec4.fromValues,t.AABB.overlap=function(e,t){return e[0]<=t[2]&&e[1]<=t[3]&&e[2]>=t[0]&&e[3]>=t[1]},t.AABB.contains=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[2]&&e[3]>=t[3]},t.AABB.includes=function(e,t){return e[0]<=t[0]&&e[1]<=t[1]&&e[2]>=t[0]&&e[3]>=t[1]},t.AABB.merge=function(e,t,r){return r[0]=Math.min(e[0],t[0]),r[1]=Math.min(e[1],t[1]),r[2]=Math.max(e[2],t[2]),r[3]=Math.max(e[3],t[3]),r},t.AABB.padding=function(e,t,r){return r[0]=e[0]-t,r[1]=e[1]-t,r[2]=e[2]+t,r[3]=e[3]+t,r},t.AABB.perimeter=function(e){return 2*(e[2]-e[0]+e[3]-e[1])}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(60),t),n(r(231),t),n(r(232),t)},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.DetectType=t.DATA_TYPE_REGEX=t.DATA_TYPE=void 0,t.DATA_TYPE={JSON:"json",IMAGE:"image",AUDIO:"audio",VIDEO:"video",XML:"xml",TEXT:"text",STYLE:"style",SCRIPT:"script"},t.DATA_TYPE_REGEX=((i={})[t.DATA_TYPE.JSON]=/\.json$/,i[t.DATA_TYPE.IMAGE]=/\.(png|jpg)$/,i[t.DATA_TYPE.AUDIO]=/\.(mp3|wav)$/,i[t.DATA_TYPE.VIDEO]=/\.(mp4|avi)$/,i[t.DATA_TYPE.XML]=/\.(fnt|xml)$/,i[t.DATA_TYPE.SCRIPT]=/\.js$/,i[t.DATA_TYPE.STYLE]=/\.css$/,i),t.DetectType=function(e){return void 0===e&&(e=t.DATA_TYPE_REGEX),function(t){if(!t.type)for(var r in e)if(e[r].test(t.url)){t.type=r;break}}}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(191),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(61),t),n(r(105),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.rgba=t.rgb=void 0;var i=r(42),n=r(16);t.rgb=function(e,t,r){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),i.vec3.fromValues(e,t,r,new Uint8ClampedArray(3))},t.rgb.uint8Hex=function(e,t){return t*e[0]|t*e[1]<<8|t*e[2]<<16},t.rgb.copy=i.vec3.copy,t.rgb.lerp=i.vec3.lerp,t.rgba=function(e,t,r,i){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===r&&(r=0),void 0===i&&(i=0),n.vec4.fromValues(e,t,r,i,new Uint8ClampedArray(4))},t.rgba.copy=n.vec4.copy,t.rgba.lerp=n.vec4.lerp,t.rgba.multiply=function(e,t,r){return r[0]=e[0]*t[0]/255,r[1]=e[1]*t[1]/255,r[2]=e[2]*t[2]/255,r[3]=e[3]*t[3]/255,r},t.rgba.uint8Hex=function(e,t){return t*e[0]|t*e[1]<<8|t*e[2]<<16|e[3]<<24},t.rgba.floatHex=function(e){return 255&255*e[0]<<0|65280&255*e[1]<<8|16711680&255*e[2]<<16|4278190080&255*e[3]<<24},t.rgba.TRANSPARENT=t.rgba(0,0,0,0),t.rgba.WHITE=t.rgba(255,255,255,255),t.rgb.WHITE=t.rgb(255,255,255),t.rgb.BLACK=t.rgb(0,0,0)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(111),t),n(r(112),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec4=void 0,t.vec4=function(e,r,i,n){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),void 0===n&&(n=1),t.vec4.fromValues(e,r,i,n,new Float32Array(4))},t.vec4.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.vec4.fromValues=function(e,t,r,i,n){return n[0]=e,n[1]=t,n[2]=r,n[3]=i,n},t.vec4.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]+e[3]*t[3]},t.vec4.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r[3]=e[3]*t,r},t.vec4.normalize=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=r*r+i*i+n*n+a*a,s=o&&1/Math.sqrt(o);return t[0]=r*s,t[1]=i*s,t[2]=n*s,t[3]=a*s,t},t.vec4.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r[3]=e[3]*t[3],r},t.vec4.lerp=function(e,t,r,i){return i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i[2]=e[2]+r*(t[2]-e[2]),i[3]=e[3]+r*(t[3]-e[3]),i},t.vec4.temp=t.vec4(),t.vec4.ZERO=t.vec4(0,0,0,0)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ReusableComponent=void 0;var i=r(21),n=function(){function e(){}return e.create=function(e,t,r,n){var a=this;Object.hasOwnProperty.call(this,"$pool")||(this.$pool=new i.ObjectPool((function(e){return new a})));var o=this.$pool.aquire();return this.setup(o,t,r,n),o.setup(e,n),o},e.delete=function(e){e.reset(),this.reset(e),e.constructor.$pool.recycle(e)},e.setup=function(e,t,r,i){e.entity=t,e.timeframe=r},e.reset=function(e){e.entity=0},e}();t.ReusableComponent=n},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.Deferred=void 0,function(e){e[e.PENDING=0]="PENDING",e[e.RESOLVED=1]="RESOLVED",e[e.REJECTED=2]="REJECTED"}(i||(i={}));var n=function(){function e(){this.state=i.PENDING,this.listeners=[]}return e.prototype.drain=function(){if(this.state!==i.PENDING)for(;this.listeners.length;)this.listeners.pop().call(this)},e.prototype.from=function(e){try{var t="function"==typeof e;if(t&&e.length>0)e.call(this,this.resolve.bind(this),this.reject.bind(this));else{var r=t?e.call(this):e;r&&"function"==typeof r.then?r.then(this.resolve.bind(this),this.reject.bind(this)):this.resolve(r)}}catch(e){this.reject(e)}return this},e.prototype.unwrap=function(){if(this.state===i.RESOLVED)return this.value;if(this.state===i.REJECTED)throw this.value},e.prototype.resolve=function(e){return this.state!==i.PENDING||(this.state=i.RESOLVED,this.value=e,this.drain()),this},e.prototype.reject=function(e){return this.state!==i.PENDING||(this.state=i.REJECTED,this.value=e,this.drain()),this},e.prototype.then=function(t,r){var n=this,a=new e;return this.listeners.push(a.from.bind(a,(function(){if(n.state===i.RESOLVED&&t)return t(n.value);if(n.state===i.REJECTED){if(r)return r(n.value);throw n.value}return n.value}))),this.drain(),a},e.join=function(t){var r=new e,n=t.length;if(!n)return r.resolve([]);function a(){this.state===i.REJECTED?r.reject(this.value):this.state!==i.RESOLVED||--n||r.resolve(t.map((function(e){return e.unwrap()})))}return t.forEach((function(e){e.listeners.push(a),e.drain()})),r},e.VOID=(new e).resolve(),e}();t.Deferred=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Geometry2D=void 0;var a=r(9),o=r(17),s=r(32),c=function(e,t){return e.order-t.order},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.order=0,t.lastRenderFrame=-1,t.aabb=a.AABB(),t}return n(t,e),t.allocate=function(){var e=s.OrderedDataArray.allocate();return e.comparator=c,e},t.prototype.recalculateBoundingBox=function(){for(var e=1/0,t=1/0,r=-1/0,i=-1/0,n=this.vertices.length-1;n>0;n-=2)e=Math.min(e,this.vertices[n-1]),r=Math.max(r,this.vertices[n-1]),t=Math.min(t,this.vertices[n]),i=Math.max(i,this.vertices[n]);a.AABB.fromValues(e,t,r,i,this.aabb)},t.prototype.recalculateVertices=function(e,t,r,i){void 0===i&&(i=0);for(var n=t[0],a=t[1],o=t[2],s=t[3],c=t[4],l=t[5],u=e.length-1;u>0;u-=2){var p=e[u-1],h=e[u];r[i+u-1]=n*p+o*h+c,r[i+u]=a*p+s*h+l}},t.prototype.recalculateUVs=function(e,t,r,i){void 0===i&&(i=0);for(var n=t[0],a=t[1],o=t[2],s=t[3],c=t[4],l=t[5],u=e.length-1;u>0;u-=2){var p=e[u-1],h=e[u],f=n*p+o*h+c,d=a*p+s*h+l;r[i+(u>>>1)]=65535*d<<16|65535&(65535*f|0)}},t.delegate=t,t}(o.ReusableComponent);t.Geometry2D=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.signedPolygonArea=t.triangulate=t.measureAngle=t.triangleArea=t.lineIntersection=t.lineIntersectionFraction=void 0;var i=r(5);t.lineIntersectionFraction=function(e,t,r,i){var n=t[0]-e[0],a=t[1]-e[1],o=i[0]-r[0],s=i[1]-r[1],c=o*a-n*s;if(!c)return-1;var l=r[0]-e[0],u=r[1]-e[1],p=(n*u-a*l)/c,h=(o*u-s*l)/c;return h<0||h>1||p<0||p>1?-1:h},t.lineIntersection=function(e,t,r,i,n){var a=t[0]-e[0],o=t[1]-e[1],s=i[0]-r[0],c=i[1]-r[1],l=o*e[0]-a*e[1],u=c*r[0]-s*r[1],p=c*a-o*s,h=p&&1/p;return n[0]=(a*u-s*l)*h,n[1]=(o*u-c*l)*h,n};var n=function(e,t,r,i,n,a){return(r-e)*(a-t)-(n-e)*(i-t)};t.triangleArea=function(e,t,r){return n(e[0],e[1],t[0],t[1],r[0],r[1])},t.measureAngle=function(e,t,r){var i=t[0]-e[0],n=t[1]-e[1],a=r[0]-t[0],o=r[1]-t[1],s=i*a+n*o,c=i*i+n*n,l=a*a+o*o;return Math.acos(s/Math.sqrt(c*l))};t.triangulate=function(e,t,r,a,o){void 0===t&&(t=0),void 0===r&&(r=e.length),void 0===o&&(o=[]);var s=r-t;if(s<3)return o;for(var c,l,u,p,h,f,d,v,m,y,g,b,_,P,S,x,A,O,w=i.range(s),M=0,T=s;T>3;){var E=w[(M+0)%T]+t,C=w[(M+1)%T]+t,B=w[(M+2)%T]+t,I=e[E][0],j=e[E][1],D=e[C][0],q=e[C][1],F=e[B][0],R=e[B][1],k=!a==n(I,j,D,q,F,R)>=0;if(k)for(var V=0;V<T;V++){var L=w[V]+t;if(L!==E&&L!==C&&L!==B&&(c=e[L][0],l=e[L][1],h=void 0,f=void 0,d=void 0,v=void 0,m=void 0,y=void 0,g=void 0,b=void 0,_=void 0,P=void 0,S=void 0,x=void 0,A=void 0,O=void 0,O=((g=(h=F-(u=I))*h+(f=R-(p=j))*f)*(S=(d=D-u)*(m=c-u)+(v=q-p)*(y=l-p))-(b=h*d+f*v)*(_=h*m+f*y))*(x=1/(g*(P=d*d+v*v)-b*b)),(A=(P*_-b*S)*x)>=0&&O>=0&&A+O<1)){k=!1;break}}if(k)o.push(E,C,B),w.splice((M+1)%T,1),T--,M=0;else if(3*T<M++)break}return o.push(w[0],w[1],w[2]),o},t.signedPolygonArea=function(e,t,r){void 0===t&&(t=0),void 0===r&&(r=e.length);for(var i=0,n=t,a=r-1;n<r;a=n++)i+=(e[a][0]-e[n][0])*(e[a][1]+e[n][1]);return-.5*i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ObjectPool=void 0;var i=function(){function e(e){this.factory=e,this.items=[],this.index=0}return e.prototype.recycle=function(e){-1==this.items.indexOf(e)&&this.items.push(e)},e.prototype.aquire=function(){return this.items.length?this.items.pop():this.factory(++this.index)},e}();t.ObjectPool=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Transform2D=void 0;var a=r(0),o=r(6),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.localPosition=a.vec2(0,0),t.localScale=a.vec2(1,1),t.localRotation=0,t.globalTransform=o.mat3x2(),t}return n(t,e),t.prototype.setup=function(e){this.lastFrame=-1,this.parent=e.parent||0,this.localRotation=e.rotation||0,a.vec2.copy(e.position||a.vec2.ZERO,this.localPosition),a.vec2.copy(e.scale||[1,1],this.localScale)},t.prototype.reset=function(){},t.prototype.calculateTransform=function(e,t){if(e&&e.lastFrame>this.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame){this.lastFrame=t;var r=this.localPosition,i=this.localRotation,n=this.localScale,a=this.globalTransform;o.mat3x2.fromTransform(r[0],r[1],0,0,n[0],n[1],i,0,0,a),e&&o.mat3x2.multiply(e.globalTransform,a,a)}},t}(r(48).Transform);t.Transform2D=s},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(113),t),n(r(114),t),n(r(70),t),n(r(115),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(72),t),n(r(74),t),n(r(76),t),n(r(78),t),n(r(79),t),n(r(134),t),n(r(29),t),n(r(80),t),n(r(135),t),n(r(139),t),n(r(140),t),n(r(81),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shape=void 0;var i=r(0),n=function(){function e(e,t,r){void 0===e&&(e=i.vec2()),void 0===t&&(t=0),this.position=e,this.angle=t,this.inertia=0,this.boundingRadius=0,this.area=0,this.material=0,this.collisionGroup=1,this.collisionMask=1,this.collisionResponse=!0,this.sensor=!1,Object.assign(this,r)}return e.prototype.recalculateStaticProperties=function(){return this.inertia=this.computeMomentOfInertia(),this.area=this.computeArea(),this.boundingRadius=this.computeBoundingRadius(),this},e}();t.Shape=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioChannel=void 0;var a=r(17),o=r(39),s=r(40),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(e,t){this.context=t.resolveSystem(o.AudioSystem).context,this.options=e,this.gain=this.context.createGain(),this.volume=e.volume,this.output&&this.output.connect(this.resolveDestination(t))},t.prototype.resolveDestination=function(e){return this.options.channel?e.aquireComponent(this.options.channel,t,this.timeframe).input:this.context.destination},Object.defineProperty(t.prototype,"output",{get:function(){return this.gain},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this.gain},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"volume",{get:function(){return this.options.volume},set:function(e){s.scheduleAudioParameter(this.context,this.gain.gain,this.options.volume=e)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.gain.disconnect(),this.gain=null,this.context=this.options=null},t.delegate=t,t}(a.ReusableComponent);t.AudioChannel=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Value=t.One=t.Zero=t.Void=t.False=t.True=void 0,t.True=function(){return!0},t.False=function(){return!1},t.Void=function(){},t.Zero=function(){return 0},t.One=function(){return 1},t.Value=function(e){return e}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(117),t),n(r(71),t),n(r(148),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ForceGenerator=void 0;var i=function(){};t.ForceGenerator=i},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(149),t),n(r(150),t),n(r(151),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Stream=void 0;var i=function(){function e(){this.subscribers=[],this.iterator=[]}return e.prototype.subscribe=function(e,t){return~this.subscribers.indexOf(e)||(Object.assign(e,t),this.subscribers.push(e)),this},e.prototype.unsubscribe=function(e){var t=this.subscribers.indexOf(e);if(!~t)return this;this.subscribers.splice(t,1);for(var r=this.iterator.length-1;r>=0;r--)t<this.iterator[r]&&this.iterator[r]--;return this},e.prototype.dispatch=function(e){var t=this.iterator.length;for(this.iterator[t]=this.subscribers.length-1;this.iterator[t]>=0;this.iterator[t]--){var r=this.subscribers[this.iterator[t]];r.single&&this.unsubscribe(r),r.apply(this,arguments)}return this.iterator.length--,this},e}();t.Stream=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.OrderedDataArray=t.DataArray=void 0;var a=r(47),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.allocate=function(){return Object.setPrototypeOf([],this.prototype)},t.prototype.get=function(e){return this[--e]},t.prototype.insert=function(e){return this.push(e)},t.prototype.remove=function(e,t,r,i){if(e===this.length)return this.pop();var n=this[--e];return this[e]=this.pop(),this.updatePointer(this.length,e,t,i),n},t.prototype.updatePointer=function(e,t,r,i){var n=this[t++].entity;if(n)i.pointers[r+i.segments*--n]=t;else for(var a=i.units-1;a>=0;a--){var o=r+i.segments*a;i.pointers[o]===e+1&&(i.pointers[o]=t)}},t}(Array);t.DataArray=o;var s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.allocate=function(){return Object.setPrototypeOf([],this.prototype)},t.prototype.get=function(e){return this[--e]},t.prototype.insert=function(e,t,r,i){var n=a.sortedLastIndex(this,e,this.comparator);return this.splice(n,0,e),this.shiftPointers(++n,1,t,i),n},t.prototype.remove=function(e,t,r,i){var n=this.splice(--e,1)[0];return this.shiftPointers(e,-1,t,i),n},t.prototype.shiftPointers=function(e,t,r,i){for(var n=this.length;e<n;e++){var a=this[e].entity;if(!a)break;i.pointers[r+i.segments*--a]+=t}if(e<this.length)for(var o=i.units-1;o>=0;o--){var s=r+i.segments*o;i.pointers[s]>e&&(i.pointers[s]+=t)}},t.prototype.update=function(e,t){a.insertionSort(this,this.comparator);for(var r=this.length-1;r>=0;r--){var i=this[r].entity;i&&(t.pointers[e+t.segments*--i]=r+1)}},t}(Array);t.OrderedDataArray=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Display=void 0;var i=r(83),n=function(){function e(e,t){var r=this,n=t.width,a=t.height;this.manager=e,this.handleResize=function(){if(r.viewport=r.canvas.getBoundingClientRect(),!(r.viewport.top>=0)){var e=getComputedStyle(r.canvas),t=e.top,i=e.left,n=e.width,a=e.height;r.viewport={top:parseFloat(t)||0,left:parseFloat(i)||0,width:parseFloat(n)||0,height:parseFloat(a)||0}}},this.canvas=document.createElement("canvas"),this.canvas.width=n,this.canvas.height=a,document.body.appendChild(this.canvas),window.addEventListener("resize",i.debounce(this.handleResize,0)),this.handleResize()}return Object.defineProperty(e.prototype,"width",{get:function(){return this.canvas.clientWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.canvas.clientHeight},enumerable:!1,configurable:!0}),e}();t.Display=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Texture=void 0;var i=function(e){return 0==(e&--e)},n=function(){function e(e,t){void 0===t&&(t=6408),this.gl=e,this.internalFormat=t,this.width=0,this.height=0,this.premultiply=!1,this.mipmaps=!1,this.texture=e.createTexture()}return e.DepthTexture=function(t,r,i){var n=new e(t,6402);return n.upload(null,{width:r,height:i,format:6402,type:5123,wrap:33071,minFilter:9728,magFilter:9728}),n},e.ColorTexture=function(t,r,i){var n=new e(t,6408);return n.upload(null,{width:r,height:i,format:6408,type:5121,wrap:33071,minFilter:9729,magFilter:9729}),n},e.prototype.bind=function(e){void 0===e&&(e=0),this.gl.activeTexture(33984+e),this.gl.bindTexture(3553,this.texture)},e.prototype.upload=function(e,t,r,n){this.bind();var a=this.gl,o=this.internalFormat,s=t.flipY,c=void 0!==s&&s,l=t.premultiplyAlpha,u=void 0!==l&&l,p=t.format,h=void 0===p?6408:p,f=t.type,d=void 0===f?5121:f,v=e&&(e.videoWidth||e.width),m=e&&(e.videoHeight||e.height);if(null==r&&null==n){a.pixelStorei(37440,c),a.pixelStorei(37441,this.premultiply=u),null!=v||null!=m?a.texImage2D(3553,0,o,h,d,e):a.texImage2D(3553,0,o,v=t.width,m=t.height,0,h,d,e),this.width=v,this.height=m;var y=i(this.width)&&i(this.height),g=t.wrap,b=void 0===g?10497:g,_=t.minFilter,P=void 0===_?9985:_,S=t.magFilter,x=void 0===S?9729:S;switch(this.mipmaps=!1,P){case 9987:case 9985:if(!y){P=9729;break}case 9986:case 9984:if(!y){P=9728;break}this.mipmaps=!0}a.texParameteri(3553,10242,b),a.texParameteri(3553,10243,b),a.texParameteri(3553,10240,x),a.texParameteri(3553,10241,P),this.mipmaps&&a.generateMipmap(3553)}else null!=v||null!=m?a.texSubImage2D(3553,0,r,n,h,d,e):a.texSubImage2D(3553,0,r,n,t.width,t.height,h,d,e)},e.prototype.delete=function(){this.gl.deleteTexture(this.texture)},e}();t.Texture=n},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.applyBlendMode=void 0,t.applyBlendMode=((i={})[0]=function(e){e.disable(3042)},i[1]=function(e,t){e.enable(3042),e.blendEquation(32774),t?e.blendFunc(1,771):e.blendFuncSeparate(770,771,1,771)},i[2]=function(e,t){e.enable(3042),e.blendEquation(32774),t?e.blendFunc(1,1):e.blendFuncSeparate(770,1,1,1)},i[3]=function(e,t){e.enable(3042),e.blendEquation(32774),t?e.blendFuncSeparate(1,769,1,771):e.blendFuncSeparate(770,769,1,771)},i[4]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFuncSeparate(774,771,1,771)},i[5]=function(e){e.enable(3042),e.blendEquationSeparate(32779,32774),e.blendFuncSeparate(1,1,1,1)},i[6]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(772,0)},i[7]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(773,0)},i[8]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(772,771)},i[9]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(773,1)},i[10]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(0,770)},i[11]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(0,771)},i[12]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(773,770)},i[13]=function(e){e.enable(3042),e.blendEquation(32774),e.blendFunc(773,771)},i)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Material=void 0;var a=r(17),o=r(37),s=r(14),c=r(38),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.color=s.rgba(),t.tint=s.rgb(),t.blend=0,t}return n(t,e),Object.defineProperty(t.prototype,"alpha",{get:function(){return this.premultiply?this.color[3]/255:1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"premultiply",{get:function(){var e;return null===(e=this.diffuse.texture)||void 0===e?void 0:e.premultiply},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"renderable",{get:function(){return 0!=this.color[3]},enumerable:!1,configurable:!0}),t.prototype.setup=function(e,t){this.program=e.program||0,this.diffuse=e.texture?t.resolveSystem(o.Store).requestSync(e.texture):c.DefaultTextureResource,this.blend=e.blend||0,s.rgba.copy(e.color||s.rgba.WHITE,this.color),s.rgb.copy(e.tint||s.rgb.BLACK,this.tint)},t.prototype.reset=function(){this.diffuse=null},t.delegate=t,t}(a.ReusableComponent);t.Material=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Store=void 0;var i=r(18),n=function(){function e(e,t){this.manager=e,this.middleware=t,this.resources=Object.create(null)}return e.prototype.requestSync=function(e){return this.resources[e].unwrap().data},e.prototype.request=function(e){return this.resources[e]||(this.resources[e]=new i.Deferred),this.resources[e]},e.prototype.load=function(t,r){var n=this,a=new Uint32Array(t.length),o=0;function s(t,i){var n=Math.max(0,Math.round(i*e.PRECISION)-a[t]);a[t]+=n,o+=n,r&&r(o/e.PRECISION/a.length)}return i.Deferred.join(t.map((function(e){return"string"==typeof e?{url:e}:e})).map((function(t,r){var a=n.request(t.url);return a[e.FLAG_PROPERTY]||(a[e.FLAG_PROPERTY]=!0,a.from((function(){return n.middleware.map((function(e){return e.bind(n,t,s.bind(n,r))})).reduce((function(e,t){return e.then(t)}),i.Deferred.VOID).then((function(){return s(r,1),t}))}))),a})))},e.PRECISION=1e3,e.FLAG_PROPERTY="loading",e}();t.Store=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UploadTexture=t.DefaultTextureResource=t.DefaultTexture=void 0;var i=r(11),n=r(34),a=r(16),o=r(6),s=r(51);t.DefaultTexture=function(e){var t=new n.Texture(e);return t.upload(new Uint8Array([255,255,255,255]),{width:1,height:1,wrap:33071,minFilter:9728,magFilter:9728}),t},t.DefaultTextureResource={index:0,texture:null,uvTransform:o.mat3x2.IDENTITY,frame:a.vec4(0,0,1,1),width:1,height:1},t.UploadTexture=function(e){if(e.type===i.DATA_TYPE.IMAGE){e.type="texture";var r=this.manager.resolveSystem(s.Renderer2DSystem).gl,c=new n.Texture(r);c.upload(e.data,{flipY:!1,premultiplyAlpha:!0,wrap:10497,minFilter:9729,magFilter:9729}),e.data={index:++t.UploadTexture.index,texture:c,uvTransform:o.mat3x2.IDENTITY,frame:a.vec4(0,0,c.width,c.height),width:c.width,height:c.height}}},t.UploadTexture.index=0},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioSystem=void 0;var a=r(3),o=r(91),s=r(92),c=r(168),l=function(e){function t(t){var r=e.call(this,t)||this;return r.sources=r.manager.aquireDataView(o.SpatialAudio),r.context=new AudioContext,r.listener=new s.ListenerTransform(r.context),r}return n(t,e),t.prototype.unlock=function(){return c.unlockAudio(this.context)},t.prototype.execute=function(e){-1===this.listener.lastFrame&&(this.listener.lastFrame=e.frame);for(var t=this.sources.data,r=t.length-1;r>=0;r--){t[r].update(this.manager,this,e.frame)}},t}(a.ProcedureSystem);t.AudioSystem=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.scheduleAudioParameter=void 0;var i=r(5);t.scheduleAudioParameter=function(e,t,r,n,a,o){switch(void 0===r&&(r=t.defaultValue),void 0===n&&(n=0),o&&t.cancelScheduledValues(0),r=i.clamp(r,t.minValue,t.maxValue),a){case"linear":t.linearRampToValueAtTime(r,e.currentTime+n);break;case"exponential":t.exponentialRampToValueAtTime(r,e.currentTime+n);break;case"step":default:t.setValueAtTime(r,e.currentTime+n)}}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(190),t),n(r(194),t),n(r(196),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.vec3=void 0,t.vec3=function(e,r,i){return void 0===e&&(e=0),void 0===r&&(r=0),void 0===i&&(i=0),t.vec3.fromValues(e,r,i,new Float32Array(3))},t.vec3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t},t.vec3.fromValues=function(e,t,r,i){return i[0]=e,i[1]=t,i[2]=r,i},t.vec3.dot=function(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]},t.vec3.subtract=function(e,t,r){return r[0]=e[0]-t[0],r[1]=e[1]-t[1],r[2]=e[2]-t[2],r},t.vec3.add=function(e,t,r){return r[0]=e[0]+t[0],r[1]=e[1]+t[1],r[2]=e[2]+t[2],r},t.vec3.cross=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=t[0],s=t[1],c=t[2];return r[0]=n*c-a*s,r[1]=a*o-i*c,r[2]=i*s-n*o,r},t.vec3.magnitudeSquared=function(e){return e[0]*e[0]+e[1]*e[1]+e[2]*e[2]},t.vec3.magnitude=function(e){return Math.sqrt(t.vec3.magnitudeSquared(e))},t.vec3.normalize=function(e,t){var r=e[0],i=e[1],n=e[2],a=r*r+i*i+n*n,o=a&&1/Math.sqrt(a);return t[0]=r*o,t[1]=i*o,t[2]=n*o,t},t.vec3.scale=function(e,t,r){return r[0]=e[0]*t,r[1]=e[1]*t,r[2]=e[2]*t,r},t.vec3.multiply=function(e,t,r){return r[0]=e[0]*t[0],r[1]=e[1]*t[1],r[2]=e[2]*t[2],r},t.vec3.lerp=function(e,t,r,i){return i[0]=e[0]+r*(t[0]-e[0]),i[1]=e[1]+r*(t[1]-e[1]),i[2]=e[2]+r*(t[2]-e[2]),i},t.vec3.ZERO=t.vec3(0,0,0),t.vec3.AXIS_X=t.vec3(1,0,0),t.vec3.AXIS_Y=t.vec3(0,1,0),t.vec3.AXIS_Z=t.vec3(0,0,1)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat3=void 0,t.mat3=function(){return t.mat3.identity(new Float32Array(9))},t.mat3.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t},t.mat3.fromMat3x2=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=0,t[3]=e[2],t[4]=e[3],t[5]=0,t[6]=e[4],t[7]=e[5],t[8]=1,t},t.mat3.transpose=function(e,t){var r=e[1],i=e[2],n=e[5];return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=r,t[4]=e[4],t[5]=e[7],t[6]=i,t[7]=n,t[8]=e[8],t},t.mat3.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=1,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},t.mat3.multiply=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],u=e[7],p=e[8],h=t[0],f=t[1],d=t[2];return r[0]=h*i+f*o+d*l,r[1]=h*n+f*s+d*u,r[2]=h*a+f*c+d*p,h=t[3],f=t[4],d=t[5],r[3]=h*i+f*o+d*l,r[4]=h*n+f*s+d*u,r[5]=h*a+f*c+d*p,h=t[6],f=t[7],d=t[8],r[6]=h*i+f*o+d*l,r[7]=h*n+f*s+d*u,r[8]=h*a+f*c+d*p,r},t.mat3.invert=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],p=u*o-s*l,h=s*c-u*a,f=l*a-o*c,d=r*p+i*h+n*f,v=d?1/d:0;return t[0]=v*p,t[1]=v*(n*l-u*i),t[2]=v*(s*i-n*o),t[3]=v*h,t[4]=v*(u*r-n*c),t[5]=v*(n*a-s*r),t[6]=v*f,t[7]=v*(i*c-l*r),t[8]=v*(o*r-i*a),t},t.mat3.fromQuat=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=2*r,s=2*i,c=2*n,l=r*o,u=i*s,p=n*c,h=r*s,f=r*c,d=i*c,v=a*o,m=a*s,y=a*c;return t[0]=1-u-p,t[1]=h+y,t[2]=f-m,t[3]=h-y,t[4]=1-l-p,t[5]=d+v,t[6]=f+m,t[7]=d-v,t[8]=1-l-u,t},t.mat3.IDENTITY=t.mat3()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LCG=void 0,t.LCG=function(e){var t=2147483648;return function(){return(e=(1103515245*e+12345)%t)/t}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.cubicInterpolation=t.quadraticBezier=t.cubicBezier=t.cubicBezierLength=t.quadraticBezierLength=void 0,t.quadraticBezierLength=function(e,t,r,i,n,a){var o=e-2*r+n,s=t-2*i+a,c=2*r-2*e,l=2*i-2*t,u=4*(o*o+s*s),p=4*(o*c+s*l),h=c*c+l*l,f=2*Math.sqrt(u+p+h),d=Math.sqrt(u),v=2*u*d,m=2*Math.sqrt(h),y=p/d;return(v*f+d*p*(f-m)+(4*h*u-p*p)*Math.log((2*d+y+f)/(y+m)))/(4*v)},t.cubicBezierLength=function(e,t,r,i,n,a,o,s){for(var c=0,l=0,u=0,p=0,h=0,f=0,d=0,v=0,m=0,y=0,g=0,b=e,_=t,P=1;P<=10;++P)y=b-(v=(d=(f=(h=1-(l=P/10))*h)*h)*e+3*f*l*r+3*h*(u=l*l)*n+(p=u*l)*o),g=_-(m=d*t+3*f*l*i+3*h*u*a+p*s),b=v,_=m,c+=Math.sqrt(y*y+g*g);return c},t.cubicBezier=function(e,t,r,i,n,a,o,s,c,l){var u=1-c,p=u*u*u,h=3*c*u*u,f=3*c*c*u,d=c*c*c;return l[0]=p*e+h*r+f*n+d*o,l[1]=p*t+h*i+f*a+d*s,l},t.quadraticBezier=function(e,t,r,i,n,a,o,s){var c=1-o,l=c*c,u=2*c*o,p=o*o;return s[0]=l*e+u*r+p*n,s[1]=l*t+u*i+p*a,s},t.cubicInterpolation=function(e,t,r,i,n,a,o){void 0===a&&(a=1);var s=n*n,c=n*s,l=2*c-3*s+1,u=.5*a*(c-2*s+n),p=-2*c+3*s,h=.5*a*(c-s);return o[0]=l*t[0]+u*(r[0]-e[0])+p*r[0]+h*(i[0]-t[0]),o[1]=l*t[1]+u*(r[1]-e[1])+p*r[1]+h*(i[1]-t[1]),o}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.addVisibilityEventListener=void 0,t.addVisibilityEventListener=function(e){var t=["","moz","ms","webkit"].map((function(e){return e+(e?"H":"h")+"idden"})).find((function(e){return e in document}));if(null!=t&&document.addEventListener){var r=t.slice(0,-6)+"visibilitychange";document.addEventListener(r,(function(r){return e(!document[t])}),!1)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.sortedLastIndex=t.sortedIndex=t.insertionSort=void 0,t.insertionSort=function(e,t){for(var r=e.length,i=1;i<r;i++){var n=void 0,a=e[i];for(n=i-1;n>=0&&!(t(e[n],a)<=0);n--)e[n+1]=e[n];e[n+1]=a}return e},t.sortedIndex=function(e,t,r){for(var i=0,n=e.length;i<n;){var a=i+n>>>1;r(e[a],t)<0?i=a+1:n=a}return i},t.sortedLastIndex=function(e,t,r){for(var i=0,n=e.length;i<n;){var a=i+n>>>1;r(e[a],t)<=0?i=a+1:n=a}return n}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Transform=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.parent=0,t.lastFrame=-1,t}return n(t,e),t.delegate=t,t}(r(3).ReusableComponent);t.Transform=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Int16TupleMap=void 0;var i=function(){function e(){this.values=Object.create(null),this.keys=[]}return e.prototype.combineKey=function(e,t){return e<=t?e<<16|65535&t:t<<16|65535&e},e.prototype.get=function(e,t){return this.values[this.combineKey(e,t)]},e.prototype.set=function(e,t,r){var i=this.combineKey(e,t);void 0===this.values[i]&&this.keys.push(i),this.values[i]=r},e.prototype.clear=function(e){if(e)for(var t=this.keys.length-1;t>=0;t--){var r=this.keys[t];(65535&r)!==e&&r>>>16!==e||(this.keys.splice(t,1),this.values[r]=void 0)}else{for(t=this.keys.length-1;t>=0;t--)this.values[this.keys[t]]=void 0;this.keys.length=0}},e}();t.Int16TupleMap=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Convex=void 0;var a=r(0),o=r(9),s=r(20),c=function(e){function t(t,r,i,n,o){void 0===n&&(n=!0);var c=e.call(this,t,r,o)||this;c.vertices=[],c.normals=[],c.center=a.vec2(),c.indices=[];for(var l=new Float32Array(2*i.length),u=0;u<i.length;u++){var p=l.subarray(2*u,2*u+2);a.vec2.copy(i[u],p),c.vertices.push(p),c.normals.push(a.vec2())}var h=0;for(u=c.vertices.length-1;u>=0;h=u--){var f=c.vertices[h],d=c.vertices[u],v=c.normals[u];a.vec2.subtract(f,d,v),a.vec2.rotate90cw(v,v),a.vec2.normalize(v,v)}return s.triangulate(c.vertices,0,c.vertices.length,!n,c.indices),c}return n(t,e),t.prototype.computeMomentOfInertia=function(){for(var e=0,t=0,r=0,i=this.vertices.length-1;i>=0;r=i--){var n=this.vertices[i],o=this.vertices[r],s=Math.abs(a.vec2.cross(n,o));e+=s*(a.vec2.dot(o,o)+a.vec2.dot(o,n)+a.vec2.dot(n,n)),t+=s}return 1/6*(e/t)},t.prototype.computeBoundingRadius=function(){for(var e=0,t=this.vertices.length-1;t>=0;t--){var r=a.vec2.magnitudeSquared(this.vertices[t]);e<r&&(e=r)}return Math.sqrt(e)},t.prototype.computeArea=function(){a.vec2.copy(a.vec2.ZERO,this.center);for(var e=0,r=2;r<this.indices.length;r+=3){var i=this.vertices[this.indices[r-2]],n=this.vertices[this.indices[r-1]],o=this.vertices[this.indices[r-0]];t.temp0[0]=(i[0]+n[0]+o[0])/3,t.temp0[1]=(i[1]+n[1]+o[1])/3;var c=.5*s.triangleArea(i,n,o);e+=c,a.vec2.scale(t.temp0,c,t.temp0),a.vec2.add(t.temp0,this.center,this.center)}return a.vec2.scale(this.center,1/e,this.center),e},t.prototype.computeAABB=function(e,t,r){for(var i=Math.cos(t),n=Math.sin(t),a=1/0,s=1/0,c=-1/0,l=-1/0,u=this.vertices.length-1;u>=0;u--){var p=this.vertices[u],h=i*p[0]-n*p[1],f=n*p[0]+i*p[1];a=Math.min(a,h),s=Math.min(s,f),c=Math.max(c,h),l=Math.max(l,f)}return o.AABB.fromValues(a+e[0],s+e[1],c+e[0],l+e[1],r)},t.temp0=a.vec2(),t.temp1=a.vec2(),t}(r(25).Shape);t.Convex=c,c.prototype.type=16},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Renderer2DSystem=void 0;var a=r(43),o=r(3),s=r(33),c=r(30),l=r(84),u=r(152),p=r(38),h=r(22),f=r(69),d=r(19),v=r(36),m=function(e){function t(t,r){var i=e.call(this,t)||this;i.programs=r,i.globalUniforms={defaultTexture:null,defaultRenderTarget:null,renderTarget:null,invViewMatrix:a.mat3()};var n=t.resolveSystem(s.Display);i.gl=c.GLContext.createContext(n.canvas),i.cameras=t.aquireDataView(f.Camera2D),i.geometries=t.aquireDataView(d.Geometry2D),i.renderTargetPool=new l.RenderTargetPool(i.gl),i.filterProgram=new u.FilterProgram(i.manager,i.gl),i.globalUniforms.defaultTexture=p.DefaultTexture(i.gl),i.globalUniforms.defaultRenderTarget=new l.RenderTarget(i.gl,null);for(var o=void 0,h=0;o=i.programs[h];h++)o.initialize(i.gl);return i}return n(t,e),t.prototype.execute=function(e){this.gl.disable(2884);for(var t=this.cameras.data,r=void 0,i=0;r=t[i];i++){var n=this.manager.aquireComponent(r.entity,h.Transform2D);r.renderTarget||(r.renderTarget=this.globalUniforms.defaultRenderTarget),r.calculateViewMatrix(n,e.frame),this.globalUniforms.viewMatrix=r.viewMatrix,a.mat3.fromMat3x2(r.invViewMatrix,this.globalUniforms.invViewMatrix),this.globalUniforms.renderTarget=r.renderTarget;var o=r.renderTarget,s=r.postEffects;s.length&&(o=this.renderTargetPool.aquire(r.renderTarget.viewport[2],r.renderTarget.viewport[3],!0)).viewbox(0,0,r.renderTarget.viewport[2],r.renderTarget.viewport[3]),o.bind(),o.clear(e.frame),this.geometries.update(e.frame);for(var c=this.geometries.data,l=null,u=void 0,p=0;u=c[p];p++)if(!(u.order<r.range[0])){if(u.order>r.range[1])break;var f=this.manager.aquireComponent(u.entity,h.Transform2D);(d=this.manager.aquireComponent(u.entity,v.Material))&&d.renderable&&(u.calculateVertexData(f,d,e.frame),r.cull(u.aabb)&&(u.lastRenderFrame=e.frame,l&&l!==this.programs[d.program]&&l.flush(this.globalUniforms),(l=this.programs[d.program]).render(this.globalUniforms,u,d)))}if(l&&l.flush(this.globalUniforms),s.length)for(p=s.length-1;p>=0;p--){var d=this.manager.aquireComponent(s[p],v.Material,r.timeframe),m=o,y=p?this.renderTargetPool.aquire(m.viewport[2],m.viewport[3],!0):r.renderTarget;this.filterProgram.applyFilter(d,this.globalUniforms,e,m,o=y),this.renderTargetPool.recycle(m),d||s.splice(p,1)}}this.globalUniforms.renderTarget=null},t}(o.ProcedureSystem);t.Renderer2DSystem=m},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(153),t),n(r(154),t),n(r(155),t),n(r(156),t),n(r(86),t),n(r(85),t),n(r(88),t),n(r(34),t),n(r(84),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderMaterial=t.ShaderAttributes=void 0;var a=r(5),o=r(36),s=r(88),c=r(51),l=function(){function e(e){this.attributes=e}return e.prototype.synchronize=function(e){},e}();t.ShaderAttributes=l;var u=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.synchronize=function(e,t){for(var r in e)t.uao[r]=e[r]},t.prototype.setup=function(r,i){e.prototype.setup.call(this,r,i);var n=r.vertexSource,o=void 0===n?t.vertexSource:n,l=r.fragmentSource,u=void 0===l?t.fragmentSource:l,p=a.hashString(o+u);this.shader=t.cachedShaders[p]||(t.cachedShaders[p]=new s.Shader(i.resolveSystem(c.Renderer2DSystem).gl,o,u,{aPosition:0,aUV:1,aColor:2})),this.attributes=r.attributes},t.prototype.reset=function(){e.prototype.reset.call(this),this.shader=null},t.vertexSource=r(158),t.fragmentSource=r(159),t.cachedShaders=Object.create(null),t}(o.Material);t.ShaderMaterial=u},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(177),t),n(r(178),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(182),t),n(r(183),t),n(r(58),t),n(r(57),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(185),t),n(r(94),t),n(r(186),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PuzzleKnot=void 0;var a=r(2),o=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(e,t){this.type=e,this.state=-1},t.prototype.setState=function(e,t){if(void 0===t&&(t=0),this.state!==e){for(var r=this.manager.aquireComponent(this.entity,a.AnimationMixer),i=r.tracks.length-1;i>=0;i--)r.tracks[i].end(t+.2,.2);switch(e){case-1:(n=r.createAnimation("close")).start(t,.2),n.end(t+n.duration,.2);break;case 1:(n=r.createAnimation("open")).start(t,.2),n.end(t+n.duration,.2),r.createAnimation("opened").start(t+n.duration-.2,.2);break;case 0:var n;(n=r.createAnimation("enable")).start(t,.2),n.end(t+n.duration,.2),r.createAnimation("enabled").start(t+n.duration-.2,.2)}this.state=e}},t.prototype.reset=function(){},t}(a.GroupComponent);t.PuzzleKnot=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PuzzleWire=void 0;var a=r(1),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.pair=[0,0],t.indices=[0,0],t.path=[a.vec2(),a.vec2()],t.normal=a.vec2(),t.tangent=a.vec2(),t.timeElapsed=0,t.amplitude=0,t.tension=1,t.lastFrame=-1,t}return n(t,e),t.prototype.setup=function(e,t){var r=e.entities,i=e.indices,n=r[1]>r[0]?0:1;a.vec2.fromValues(r[n],r[1-n],this.pair),a.vec2.fromValues(i[n],i[1-n],this.indices),this.lastFrame=-1,this.path.length=2,this.amplitude=0,this.tension=1,this.timeElapsed=a.randomFloat(0,2*Math.PI,Math.random)},t.prototype.reset=function(){},t.prototype.updatePath=function(e,t,r){var i=this.normal,n=this.tangent,o=this.path,s=o[0],c=o[o.length-1];s[0]=e[4],s[1]=e[5],c[0]=t[4],c[1]=t[5],a.vec2.subtract(c,s,i);var l=a.vec2.magnitude(i);i[0]<0?a.vec2.rotate90ccw(i,n):a.vec2.rotate90cw(i,n),a.vec2.scale(n,l&&1/l,n);var u=o.length-1;o.length=Math.max(2,l/r|0);for(var p=o.length-2;p>=u;p--)o[p]=a.vec2();return o[o.length-1]=c,l},t.prototype.animatePath=function(e){var r=this.normal,i=this.tangent,n=this.path,o=n[0],s=n[n.length-1],c=this.timeElapsed+=e,l=t.controlA,u=t.controlB,p=this.amplitude*this.tension*.06*Math.abs(r[0])*Math.sin(2*c);l[0]=p+a.lerp(o[0],s[0],.2),u[0]=p+a.lerp(s[0],o[0],.2);var h=this.amplitude*this.tension*.36*.5*Math.max(0,Math.abs(r[0])-Math.abs(r[1]));l[1]=u[1]=Math.max(o[1],s[1])+h;for(var f=n.length-1,d=1;d<f;d++){var v=n[d],m=d/f;a.cubicBezier(o[0],o[1],l[0],l[1],u[0],u[1],s[0],s[1],m,v);var y=this.amplitude*a.ease.fade(m)*(.5+.5*Math.cos(2*c+.5*m*Math.PI+.5*Math.PI))*8*Math.cos(10*c+4*m*Math.PI);v[0]+=i[0]*y,v[1]+=i[1]*y}return n},t.prototype.update=function(){},t.controlA=a.vec2(),t.controlB=a.vec2(),t}(r(3).ReusableComponent);t.PuzzleWire=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SoulEater=void 0;var a=r(1),o=r(2),s=r(4),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.previousTarget=a.vec2(),t}return n(t,e),t.prototype.setup=function(e,t){this.options=e,this.path=a.range(e.segments).map((function(e){return a.vec2(e,0)})),this.angles=Array(e.segments).fill(0),this.attract=0,this.lastFrame=-1,this.pathGradient=a.linearGradient(a.vec2.lerp)(this.path),this.angleGradient=a.linearGradient(a.lerp)(this.angles)},t.prototype.update=function(e,t){if(-1==this.lastFrame||this.attract){this.lastFrame=e.frame;var r=t.aquireComponent(this.entity,o.TargetComponent),i=r?r.calculatePosition():a.vec2.ZERO;a.vec2.lerp(this.previousTarget,i,1-Math.pow(.9,30*e.deltaTime),this.previousTarget);for(var n=a.vec2.magnitude(this.previousTarget)/this.path.length,c=.6*n*this.attract,l=0,u=0,p=.5*Math.PI,h=0;h<this.path.length;h++){this.path[h][0]=l,this.path[h][1]=u,this.angles[h]=p;var f=h/(this.path.length-1);c+=this.attract*a.lerp(.02*n,0,f)*Math.sin(2*e.elapsedTime+a.lerp(0,2*Math.PI,f)),p+=this.attract*a.ease.fade(f)*.36*Math.cos(2*e.elapsedTime+a.lerp(0,2*Math.PI,f));var d=Math.atan2(this.previousTarget[1]-u,this.previousTarget[0]-l),v=a.ease.cubicOut(1-Math.abs(a.shortestAngle(p,d))/Math.PI);p=a.lerpAngle(p,d,v*f*a.ease.cubicIn(this.attract)),l+=Math.cos(p)*c,u+=Math.sin(p)*c}var m=this.options,y=m.curve,g=m.parts;t.aquireComponent(y,s.Curve,this.timeframe).path=this.path;var b=1-this.attract*Math.pow(.9,15*e.deltaTime);for(h=0;h<g.length;h++){f=(h+1)/g.length;var _=t.aquireComponent(g[h],o.Transform2D,this.timeframe);this.pathGradient(f,_.localPosition),_.localRotation=a.lerpAngle(_.localRotation,this.angleGradient(f),f<1?b:1),_.lastFrame=-1,f<1&&(_.localPosition[1]=Math.max(_.localPosition[1],50+50*h))}}},t.prototype.reset=function(){this.pathGradient=this.angleGradient=null,this.options=null},t}(o.Behaviour);t.SoulEater=c},function(e,t,r){"use strict";var i=this&&this.__rest||function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r};Object.defineProperty(t,"__esModule",{value:!0}),t.HTMLNode=void 0,t.HTMLNode=function(e,t,r,n){var a=t.style,o=t.dataset,s=i(t,["style","dataset"]),c=document.createElement(e);if(Object.assign(c,s),Object.assign(c.style,a),Object.assign(c.dataset,o),r&&r.forEach((function(e){return c.appendChild(e)})),n)for(var l in n)c.addEventListener(l,n[l]);return c}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CameraRegion=void 0;var a=r(1),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aabb=a.AABB(),t.view=a.vec2(),t.lockX=null,t.lockY=null,t}return n(t,e),t.prototype.setup=function(e){a.AABB.copy(e.bounds,this.aabb),a.vec2.copy(e.view,this.view),this.lockX=e.lockX,this.lockY=e.lockY},t.prototype.reset=function(){},t}(r(3).ReusableComponent);t.CameraRegion=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat2=void 0,t.mat2=function(){return t.mat2.identity(new Float32Array(4))},t.mat2.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t},t.mat2.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=1,e},t.mat2.multiply=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=t[0],c=t[1],l=t[2],u=t[3];return r[0]=i*s+a*c,r[1]=n*s+o*c,r[2]=i*l+a*u,r[3]=n*l+o*u,r},t.mat2.transform=function(e,t,r){var i=e[0],n=e[1];return r[0]=t[0]*i+t[2]*n,r[1]=t[1]*i+t[3]*n,r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.expoInOut=t.expoOut=t.expoIn=t.backOut=t.backIn=t.elasticIn=t.elasticOut=t.circInOut=t.circIn=t.circOut=t.sineInOut=t.sineIn=t.sineOut=t.bounceOut=t.quintInOut=t.quartInOut=t.cubicInOut=t.quadInOut=t.quintOut=t.quartOut=t.cubicOut=t.quadOut=t.quintIn=t.quartIn=t.cubicIn=t.quadIn=t.slideInOut=t.slideIn=t.slideOut=t.plato=t.wave=t.fade=t.linear=t.constant=void 0;var i=function(e){return function(t){return Math.pow(t,e)}},n=function(e){return Math.sin(.5*e*Math.PI)},a=function(e){return Math.sqrt(1- --e*e)},o=function(e){return e?Math.pow(2,10*--e):0},s=function(e){return function(t){return(1+e)*t/(t+e)}},c=function(e,t,r){return function(i){return i<e?e*t(i/e):e+(1-e)*r((i-e)/(1-e))}},l=function(e){return function(t){return 1-e(1-t)}},u=function(e,t){void 0===e&&(e=1),void 0===t&&(t=.5),t/=Math.min(1,e),e=Math.max(1,e);var r=t/(2*Math.PI)*Math.asin(1/e)||0,i=2*Math.PI/t;return function(t){return e*Math.pow(2,-10*t)*Math.sin((t-r)*i)+1}},p=function(e){return function(t){return t*t*(t*(e+1)-e)}};p.v2p=function(e){var t=(e=Math.min(1,-e)/4)*Math.sqrt(1/4-e),r=-27*e*e*e+9*e*e-e/2;return 3*(Math.pow(r+t,1/3)+Math.pow(r-t,1/3)-3*e)},p.p2v=function(e){return-4*e*e*e/(27*(e+1)*(e+1))},t.constant=function(){return 1},t.linear=function(e){return e},t.fade=function(e){return 4*e*(1-e)},t.wave=function(e){return.5+.5*Math.cos(2*Math.PI*e-Math.PI)},t.plato=function(e){return.5-.5*Math.cos(Math.sin(e*=2*Math.PI)+e)},t.slideOut=s(.5),t.slideIn=l(s(.5)),t.slideInOut=c(.5,l(s(.5)),s(.5)),t.quadIn=i(2),t.cubicIn=i(3),t.quartIn=i(4),t.quintIn=i(5),t.quadOut=l(i(2)),t.cubicOut=l(i(3)),t.quartOut=l(i(4)),t.quintOut=l(i(5)),t.quadInOut=c(.5,i(2),l(i(2))),t.cubicInOut=c(.5,i(3),l(i(3))),t.quartInOut=c(.5,i(4),l(i(4))),t.quintInOut=c(.5,i(5),l(i(5))),t.bounceOut=function(e,t){void 0===t&&(t=1);for(var r=Array(e),i=0;i<r.length;i++)r[i]=Math.pow(.5,i);var n=r.reduce((function(e,t){return e+t}),1),a=1,o=a/n,s=1/Math.pow(o,2),c=[[a,s,0,0]];for(i=0;i<r.length;i++){var l=r[i];o=(a+=l)/n;var u=a-.5*l,p=1-(s*=t)*Math.pow(o-u/n,2);c.push([a,s,u,p])}return new Function("x",c.map((function(e){var t=e[0],r=e[1],i=e[2],a=e[3];return(t==n?"":"if(x < "+t+" / "+n+")")+"{ return "+r+" * "+(i?"(x -= "+i+" / "+n+") * x + "+a:"x * x")+"; }"})).join("else "))}(3,1),t.sineOut=n,t.sineIn=l(n),t.sineInOut=c(.5,l(n),n),t.circOut=a,t.circIn=l(a),t.circInOut=c(.5,l(a),a),t.elasticOut=u(),t.elasticIn=l(u()),t.backIn=p(p.v2p(.1)),t.backOut=l(p(p.v2p(.1))),t.expoIn=o,t.expoOut=l(o),t.expoInOut=c(.5,o,l(o))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Manager=void 0;var i=function(){function e(){this.cachePrefix="$0-"+e.INDEX++,this.systems=[]}return e.prototype.registerSystem=function(e,t){if(Object.hasOwnProperty.call(e,this.cachePrefix))throw new RangeError("Duplicate Declaration!");var r=this.systems.length++;return Object.defineProperty(e,this.cachePrefix,{value:r}),this.systems[r]=new e(this,t),this},e.prototype.resolveSystem=function(e){if(!Object.hasOwnProperty.call(e,this.cachePrefix))throw new RangeError("Missing Declaration!");var t=e[this.cachePrefix];return this.systems[t]},e.INDEX=0,e}();t.Manager=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.UpdateLoop=void 0;var a=r(5),o=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.frame=0,r.deltaTime=0,r.elapsedTime=0,r.timeScale=1,r.prevTimestamp=0,r.requestId=null,r.update=function(e){r.deltaTime=r.timeScale*a.clamp(.001*(e-r.prevTimestamp),0,t.MAX_FRAME_DURATION),r.elapsedTime+=r.deltaTime,r.frame++,r.prevTimestamp=e,r.dispatch(r),r.requestId=requestAnimationFrame(r.update)},r}return n(t,e),t.prototype.stop=function(){return cancelAnimationFrame(this.requestId),this.requestId=null,this},t.prototype.start=function(){return null!=this.requestId||this.update(this.prevTimestamp=performance.now()),this},t.MAX_FRAME_DURATION=2/60,t}(r(31).Stream);t.UpdateLoop=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DataView=void 0;var i=function(){function e(e,t){this.storage=e,this.segment=t,this.lastFrame=-1}return Object.defineProperty(e.prototype,"data",{get:function(){return this.storage.data[this.segment-1]},enumerable:!1,configurable:!0}),e.prototype.lookupIndex=function(e,t){var r=this.storage.lookupIndex(0,e);return!r||r>t?0:this.storage.lookupIndex(this.segment,e)},e.prototype.updateIndex=function(e,t){this.storage.updateIndex(this.segment,e,t)},e.prototype.update=function(e){-1==this.lastFrame&&(this.data.update(this.segment,this.storage),this.lastFrame=e)},e}();t.DataView=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StorageMatrix=void 0;var i=r(32),n=function(){function e(){this.data=[],this.pool=[],this.pointers=new Uint32Array,this.segments=1,this.capacity=1,this.units=0,this.index=0}return Object.defineProperty(e.prototype,"total",{get:function(){return this.units},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"lastIndex",{get:function(){return this.index},enumerable:!1,configurable:!0}),e.prototype.nextSegment=function(e){void 0===e&&(e=i.DataArray.allocate());var t=this.data.push(e);return t>=this.segments&&this.reallocate(t+1,this.capacity),t},e.prototype.nextUnit=function(){var e=this.pool.pop()||(++this.units>this.capacity&&this.reallocate(this.segments,this.units),this.units);return this.updateIndex(0,e,++this.index),e},e.prototype.recycleUnit=function(e){var t=this.segments*(e-1);this.pointers[t]&&(this.pointers[t]=0,this.pool.push(e))},e.prototype.reallocate=function(e,t){for(var r=this.segments,i=this.capacity,n=this.pointers;this.segments<e;)this.segments*=2;for(;this.capacity<t;)this.capacity*=2;if(this.capacity*this.segments!==n.length)if(this.pointers=new Uint32Array(this.segments*this.capacity),r===this.segments)this.pointers.set(n,0);else for(var a=Math.min(i,this.units)-1;a>=0;a--)for(var o=r-1;o>=0;o--)this.pointers[a*this.segments+o]=n[a*r+o]},e.prototype.updateIndex=function(e,t,r){t&&(this.pointers[e+this.segments*--t]=r)},e.prototype.lookupIndex=function(e,t){return t?this.pointers[e+this.segments*--t]:0},e.prototype.getData=function(e,t,r){if(r){var i=this.lookupIndex(0,t);if(!i||i>r)return}var n=this.lookupIndex(e,t);return n?this.data[--e].get(n):void 0},e.prototype.insertData=function(e,t,r){var i=e+this.segments*(t-1);if(this.pointers[i])throw new Error("Address "+e+"x"+t+" in use.");this.pointers[i]=this.data[e-1].insert(r,e,t,this)},e.prototype.removeData=function(e,t){var r=e+this.segments*(t-1),i=this.pointers[r];return this.pointers[r]=0,i?this.data[e-1].remove(i,e,t,this):void 0},e}();t.StorageMatrix=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EntityGroup=void 0;var i=r(31),n=function(){function e(e,t){this.storage=e,this.segments=t,this.entities=[],this.mountEvent=new i.Stream,this.unmountEvent=new i.Stream}return Object.defineProperty(e.prototype,"length",{get:function(){return this.entities.length},enumerable:!1,configurable:!0}),e.prototype.matchEntity=function(e){for(var t=this.segments.length-1;t>=0;t--)if(!this.storage.lookupIndex(this.segments[t],e))return!1;return!0},e.prototype.insertEntity=function(e){~this.entities.indexOf(e)||(this.entities.push(e),this.mountEvent.dispatch(e))},e.prototype.removeEntity=function(e){var t=this.entities.indexOf(e);~t&&(this.entities.splice(t,1),this.unmountEvent.dispatch(e))},e}();t.EntityGroup=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Camera2D=void 0;var a=r(0),o=r(9),s=r(6),c=r(43),l=r(17),u=r(32);var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.viewMatrix=c.mat3(),t.invViewMatrix=s.mat3x2(),t.lastFrame=-1,t.origin=a.vec2(0,0),t.viewport=a.vec2(0,0),t.range=a.vec2(-1/0,1/0),t.preserveAspectRatio=!1,t.bounds=o.AABB(),t.renderTarget=null,t.targetViewport=a.vec2(0,0),t}return n(t,e),t.allocate=function(){var e=u.OrderedDataArray.allocate();return e.comparator=function(e,t){return e.order-t.order},e},t.prototype.setup=function(e){this.lastFrame=-1,this.order=e.order||0,a.vec2.copy(e.origin||a.vec2.ZERO,this.origin),a.vec2.copy(e.viewport||a.vec2.ZERO,this.viewport),this.preserveAspectRatio=e.preserveAspectRatio||!1,this.postEffects=e.postEffects||[],a.vec2.copy(e.range||[-1/0,1/0],this.range)},t.prototype.calculateViewMatrix=function(e,r){if(e&&this.lastFrame<e.lastFrame&&(this.lastFrame=-1),this.renderTarget.width==this.targetViewport[0]&&this.renderTarget.height==this.targetViewport[1]||(a.vec2.fromValues(this.renderTarget.width,this.renderTarget.height,this.targetViewport),this.lastFrame=-1),-1==this.lastFrame){this.lastFrame=r;var i=this.viewport[0],n=this.viewport[1],l=i*-this.origin[0],u=l+i,p=n*-this.origin[1],h=p+n;if(s.mat3x2.orthogonal(l,u,h,p,t.projectionViewMatrix),o.AABB.fromValues(l,p,u,h,this.bounds),this.adjustRenderTarget(i,n,this.renderTarget),e){var f=e.globalTransform;!function(e,t,r){var i=t[0],n=t[1],a=t[2],o=t[3],s=t[4],c=t[5],l=i*e[0]+a*e[1]+s,u=n*e[0]+o*e[1]+c,p=i*e[2]+a*e[3]+s,h=n*e[2]+o*e[3]+c;r[0]=Math.min(l,p),r[1]=Math.min(u,h),r[2]=Math.max(l,p),r[3]=Math.max(u,h)}(this.bounds,f,this.bounds),s.mat3x2.invert(f,t.inverseTransform),s.mat3x2.multiply(t.projectionViewMatrix,t.inverseTransform,t.projectionViewMatrix)}c.mat3.fromMat3x2(t.projectionViewMatrix,this.viewMatrix),s.mat3x2.invert(t.projectionViewMatrix,this.invViewMatrix)}},t.prototype.cull=function(e){return o.AABB.overlap(this.bounds,e)},t.prototype.adjustRenderTarget=function(e,t,r){var i=this.targetViewport[0],n=this.targetViewport[1],o=0,s=0;if(this.preserveAspectRatio){var c=e/t,l=a.vec2.ZERO;i/n>c?o=l[0]*(i-(i=n*c)):s=l[1]*(n-(n=i/c))}r.viewbox(o,s,i,n)},t.prototype.reset=function(){this.renderTarget=null,a.vec2.copy(a.vec2.ZERO,this.targetViewport)},t.projectionViewMatrix=s.mat3x2(),t.inverseTransform=s.mat3x2(),t}(l.ReusableComponent);t.Camera2D=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BillboardParticle=void 0;var i=r(0),n=r(14),a=function(){function e(){this.position=i.vec2(0,0),this.velocity=i.vec2(0,0),this.rotation=0,this.angularVelocity=0,this.acceleration=i.vec2(0,0),this.lifetime=0,this.life=0,this.friction=1,this.color=n.rgba(255,255,255,255),this.originalScale=i.vec2(1,1),this.scale=i.vec2(1,1)}return e.prototype.reset=function(){return this.position[0]=this.position[1]=0,this.velocity[0]=this.velocity[1]=0,this.acceleration[0]=this.acceleration[1]=0,this.originalScale[0]=this.originalScale[1]=1,this.scale[0]=this.scale[1]=1,n.rgba.copy(n.rgba.WHITE,this.color),this.rotation=this.angularVelocity=0,this.lifetime=this.life=0,this.friction=1,this},e.bindProperty=function(e,t,r){return function(i){return e(i,t.call(i,1-i.life,r))}},e.set={position:function(e,t){return i.vec2.copy(t,e.position)},velocity:function(e,t){return i.vec2.copy(t,e.velocity)},acceleration:function(e,t){return i.vec2.copy(t,e.acceleration)},scale:function(e,t){return i.vec2.copy(t,e.scale)},opacity:function(e,t){return e.color[3]=255*t},originalSize:function(e,t){return i.vec2.fromValues(t,t,e.originalScale)},size:function(e,t){return i.vec2.scale(e.originalScale,t,e.scale)},rotation:function(e,t){return e.rotation=t},angularVelocity:function(e,t){return e.angularVelocity=t},life:function(e,t){return e.lifetime=t},color:function(e,t){return n.rgb.copy(t,e.color)},friction:function(e,t){return e.friction=t}},e}();t.BillboardParticle=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterController=void 0;var a=r(1),o=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.inputOptions={movementSpeed:540,accelerationGrounded:.06,accelerationAirborne:.02,jumpHeight:160},t}return n(t,e),t.prototype.processInput=function(e,t){var r=Math.sqrt(2*this.gravity*this.inputOptions.jumpHeight),i=Math.pow(this.flags.below?this.inputOptions.accelerationGrounded:this.inputOptions.accelerationAirborne,2*t);this.velocity[0]=a.lerp(e[0]*this.inputOptions.movementSpeed,this.velocity[0],i),e[1]<0&&this.flags.below&&this.slopeAngle*this.direction[0]>=0&&(this.velocity[1]=-r,this.flags.below=null)},t}(r(118).RaycastController);t.CharacterController=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testBodyType=t.testAABB=t.testBoundingRadius=t.Broadphase=void 0;var i=r(0),n=r(9),a=r(73),o=r(49),s=function(){function e(){var e=this;this.ignoredPairs=new o.Int16TupleMap,this.filter=function(r,i){return t.testBodyType(r,i)&&a.testSleepState(r,i)&&t.testAABB(r,i)&&!e.ignoredPairs.get(r.identifier,i.identifier)}}return e.prototype.remove=function(e){this.ignoredPairs.clear(e.identifier)},e.prototype.raycast=function(e,t){this.queryAABB(e.aabb,t)},e}();t.Broadphase=s,t.testBoundingRadius=function(e,t){return i.vec2.distanceSquared(e.position,t.position)<=Math.pow(e.boundingRadius+t.boundingRadius,2)},t.testAABB=function(e,t){return n.AABB.overlap(e.aabb,t.aabb)},t.testBodyType=function(e,t){return(0!==e.type||0!==t.type)&&(!(2===e.type&&0===t.type||2===t.type&&0===e.type)&&(2!==e.type||2!==t.type))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Sleep=t.testSleepState=void 0;var i=r(0);t.testSleepState=function(e,t){return(1!==e.sleepState||1!==t.sleepState)&&!(1===e.sleepState&&0===t.type||1===t.sleepState&&0===e.type)};var n=function(){function e(){this.speedThreshold=.2,this.idleTimeThreshold=1,this.islandSplit=!1,this.frame=0,this.islandLastFrame=[]}return e.prototype.handleContact=function(e,t){this.updateAfterCollision(e,t),this.updateAfterCollision(t,e)},e.prototype.updateAfterCollision=function(e,t){e.allowSleep&&1===e.type&&1===e.sleepState&&0===t.sleepState&&0!==t.type&&(i.vec2.magnitudeSquared(t.velocity)+Math.pow(t.angularVelocity,2)<2*this.speedThreshold*this.speedThreshold||(e.sleepState=0,e.idleTime=0))},e.prototype.update=function(e,t){this.frame++;for(var r=e.length-1;r>=0;r--){if((n=e[r]).allowSleep&&1!==n.sleepState)i.vec2.magnitudeSquared(n.velocity)+Math.pow(n.angularVelocity,2)>=this.speedThreshold*this.speedThreshold?(n.sleepState=0,n.idleTime=0,this.islandSplit&&n.islandIndex&&(this.islandLastFrame[n.islandIndex]=this.frame)):(n.idleTime+=t,n.sleepState=2,this.islandSplit&&n.islandIndex?n.idleTime<=this.idleTimeThreshold&&(this.islandLastFrame[n.islandIndex]=this.frame):n.idleTime>this.idleTimeThreshold&&this.fallAsleep(n))}if(this.islandSplit)for(r=e.length-1;r>=0;r--){var n;(n=e[r]).islandIndex&&this.islandLastFrame[n.islandIndex]<this.frame&&this.fallAsleep(n)}},e.prototype.fallAsleep=function(e){e.sleepState=1,e.angularVelocity=0,e.angularForce=0,i.vec2.copy(i.vec2.ZERO,e.velocity),i.vec2.copy(i.vec2.ZERO,e.force),e.updateInvMass()},e.prototype.wakeUp=function(e){e.sleepState=0,e.idleTime=0,e.updateInvMass()},e}();t.Sleep=n},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(119),t),n(r(120),t),n(r(121),t),n(r(75),t),n(r(122),t),n(r(123),t),n(r(124),t),n(r(125),t),n(r(126),t),n(r(127),t),n(r(128),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ContactManifold=void 0;var i=r(0),n=function(){function e(){this.bodyA=null,this.bodyB=null,this.shapeA=null,this.shapeB=null,this.contacts=0,this.normalA=[],this.contactPointA=[],this.contactPointB=[]}return e.prototype.registerContact=function(e,t,r,n,a,o,s){this.contacts||(this.bodyA=e,this.bodyB=r,this.shapeA=t,this.shapeB=n),this.normalA.length==this.contacts&&(this.normalA.push(i.vec2()),this.contactPointA.push(i.vec2()),this.contactPointB.push(i.vec2())),i.vec2.copy(a,this.normalA[this.contacts]),i.vec2.subtract(o,e.position,this.contactPointA[this.contacts]),i.vec2.subtract(s,r.position,this.contactPointB[this.contacts]),this.contacts++},e}();t.ContactManifold=n},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(77),t),n(r(129),t),n(r(130),t),n(r(131),t),n(r(132),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testRayBoundingRadius=t.testRayAABB=t.Ray=void 0;var i=r(0),n=r(9),a=function(){function e(){this.origin=i.vec2(),this.target=i.vec2(),this.direction=i.vec2(),this.length=0,this.aabb=n.AABB()}return e.prototype.set=function(e,t){i.vec2.copy(e,this.origin),i.vec2.copy(t,this.target),i.vec2.subtract(t,e,this.direction),this.length=i.vec2.magnitude(this.direction),i.vec2.scale(this.direction,this.direction&&1/this.length,this.direction),n.AABB.fromValues(Math.min(e[0],t[0]),Math.min(e[1],t[1]),Math.max(e[0],t[0]),Math.max(e[1],t[1]),this.aabb)},e}();t.Ray=a,t.testRayAABB=function(e,t){var r=1/e.direction[0],i=1/e.direction[1],n=(t[0]-e.origin[0])*r,a=(t[2]-e.origin[0])*r,o=(t[1]-e.origin[1])*i,s=(t[3]-e.origin[1])*i,c=Math.max(Math.min(n,a),Math.min(o,s)),l=Math.min(Math.max(n,a),Math.max(o,s));return l<0?-1:c>l?-1/0:e.length?Math.max(0,c)/e.length:0},t.testRayBoundingRadius=function(e,t,r){var n=i.vec2.subtract(t,e.origin,i.vec2.temp),a=i.vec2.dot(n,e.direction);return i.vec2.scale(e.direction,a,n),i.vec2.add(e.origin,n,n),i.vec2.distanceSquared(t,n)<=r*r}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RigidBody=void 0;var a=r(0),o=r(9),s=r(133),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastFrame=-1,t.identifier=-1,t.index=-1,t.islandIndex=-1,t.shapes=[],t.mass=0,t.inertia=0,t.invInertia=0,t.invMass=a.vec2(),t.position=a.vec2(),t.angle=0,t.velocity=a.vec2(),t.angularVelocity=0,t.previousPosition=a.vec2(),t.previousAngle=0,t.vlambda=a.vec2(),t.wlambda=0,t.force=a.vec2(),t.angularForce=0,t.linearDamping=.1,t.angularDamping=.1,t.type=t.mass?1:0,t.boundingRadius=0,t.allowSleep=!0,t.sleepState=0,t.idleTime=0,t.fixedRotation=!1,t.fixedX=!1,t.fixedY=!1,t.collisionResponse=!0,t.cachedAABB=o.AABB(),t.dirtyFlag=!0,t}return n(t,e),t.prototype.setup=function(e){this.type=e.type||0,this.mass=e.mass||0;for(var t=0;t<e.shapes.length;t++)this.shapes.push(e.shapes[t].recalculateStaticProperties());this.recalculateStaticProperties()},t.prototype.reset=function(){this.shapes.length=0},Object.defineProperty(t.prototype,"aabb",{get:function(){return this.dirtyFlag?(this.dirtyFlag=!1,this.computeAABB(this.cachedAABB)):this.cachedAABB},enumerable:!1,configurable:!0}),t.prototype.computeAABB=function(e){for(var r=this.shapes.length,i=0;i<r;i++){var n=this.shapes[i],s=this.angle+n.angle,c=a.vec2.rotate(n.position,this.angle,t.temp);a.vec2.add(this.position,c,c);var l=n.computeAABB(c,s,t.tempAABB);i?o.AABB.merge(l,e,e):o.AABB.copy(l,e)}return e},t.prototype.computeBoundingRadius=function(){for(var e=0,t=this.shapes.length-1;t>=0;t--){var r=this.shapes[t],i=a.vec2.magnitudeSquared(r.position)+Math.pow(r.boundingRadius,2);i>e&&(e=i)}return Math.sqrt(e)},t.prototype.recalculateStaticProperties=function(){this.boundingRadius=this.computeBoundingRadius(),this.updateMass(),this.updateInvMass(),this.dirtyFlag=!0,this.lastFrame=-1},t.prototype.updateInvMass=function(){if(1!==this.type||1===this.sleepState)this.invMass[0]=0,this.invMass[1]=0,this.invInertia=0;else{var e=1/this.mass;this.invMass[0]=this.fixedX?0:e,this.invMass[1]=this.fixedY?0:e,this.invInertia=this.fixedRotation?0:Math.max(0,1/this.inertia)}},t.prototype.updateMass=function(){if(1===this.type){this.inertia=0;for(var e=this.shapes.length-1;e>=0;e--){var t=this.shapes[e],r=a.vec2.magnitudeSquared(t.position);this.inertia+=r+t.inertia}}else this.mass=this.inertia=1/0},Object.defineProperty(t.prototype,"density",{get:function(){return this.mass/this.area},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"area",{get:function(){for(var e=0,t=this.shapes.length-1;t>=0;t--)e+=this.shapes[t].area;return e},enumerable:!1,configurable:!0}),t.allocate=function(){return new s.IndexedDataArray},t.temp=a.vec2(),t.tempAABB=o.AABB(),t}(r(3).ReusableComponent);t.RigidBody=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.MaterialCollection=t.ContactMaterial=void 0;var a=r(49),o=function(){this.friction=.3,this.restitution=0,this.stiffness=1e6,this.relaxation=4,this.frictionStiffness=1e6,this.frictionRelaxation=4,this.surfaceVelocity=0,this.contactSkinSize=.005,this.frictionGravity=9.78};t.ContactMaterial=o;var s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.defaultMaterial=new o,t}return n(t,e),t.prototype.findContactMaterial=function(e,t){return this.get(e,t)||this.defaultMaterial},t}(a.Int16TupleMap);t.MaterialCollection=s},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GaussSeidelSolver=void 0;var i=r(0),n=function(){function e(){this.iterations=8,this.tolerance=1e-7,this.frictionIterations=0}return e.prototype.solve=function(e,t,r){if(e.length){for(var n=0;n<e.length;n++){(o=e[n]).lambda=0,o.update(r),o.B=o.computeB(o.a,o.b,r),o.invC=o.computeInvC(o.epsilon),o.maxForceDt=o.maxForce*r,o.minForceDt=o.minForce*r}for(n=0;n<t.length;n++){(l=t[n]).wlambda=0,i.vec2.copy(i.vec2.ZERO,l.vlambda)}if(this.frictionIterations){this.iterate(e,this.frictionIterations,r);for(var a=0;a<e.length;a++){var o;if((o=e[a]).contactEquations){for(var s=0,c=o.contactEquations.length-1;c>=0;c--)s+=o.contactEquations[c].multiplier;s*=o.frictionCoefficient/o.contactEquations.length,o.maxForce=s,o.minForce=-s,o.maxForceDt=s*r,o.minForceDt=-s*r}}}this.iterate(e,this.iterations,r);for(n=t.length-1;n>=0;n--){var l;(l=t[n]).angularVelocity+=l.wlambda,i.vec2.add(l.vlambda,l.velocity,l.velocity)}}},e.prototype.iterate=function(e,t,r){for(var i=Math.pow(this.tolerance*e.length,2),n=e.length,a=t;a>0;a--){for(var o=0,s=0;s<n;s++){var c=e[s],l=this.computeEquation(c);o+=Math.abs(l)}if(o*o<=i)break}var u=1/r;for(a=e.length-1;a>=0;a--){(c=e[a]).multiplier=c.lambda*u}},e.prototype.computeEquation=function(e){var t=e.B,r=e.epsilon,i=e.invC,n=e.lambda,a=e.maxForceDt,o=e.minForceDt,s=i*(t-e.computeGWlambda()-r*n),c=n+s;return c<o?s=o-n:c>a&&(s=a-n),e.lambda+=s,e.updateWlambda(s),s},e}();t.GaussSeidelSolver=n},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicsSystem=void 0;var a=r(0),o=r(78),s=r(73),c=r(145),l=r(5),u=r(22),p=function(e){function t(t,r){var i=e.call(this,t)||this;i.sleepManager=new s.Sleep,i.equationFactory=new c.EquationFactory,i.timeRemaining=0,i.maxSteps=4,i.fixedDeltaTime=1/60,i.constraints=[],i.forces=[],Object.assign(i,r),i.bodies=t.aquireDataView(o.RigidBody);var n=i.bodies.data,a=n.insertEvent,l=n.removeEvent;return a.subscribe(i.broadphase.insert.bind(i.broadphase)),l.subscribe(i.broadphase.remove.bind(i.broadphase)),l.subscribe((function(e){i.equationFactory.collisions.clear(e.identifier)})),i.generateContacts=[function(e){return function(){return i.broadphase.queryCollisionPairs(e)}},function(e){return function(t,r){i.narrowphase.detectCollision(t,r,!1,e)}},function(e){return function(e){return i.equationFactory.processContactManifold(e,i.materials)}}].reverse().reduce((function(e,t){return t(e)}),null),i}return n(t,e),t.prototype.execute=function(e){for(var t=this.bodies.data.internal,r=this.update(t,e.deltaTime,e.frame),i=void 0,n=0;i=t[n];n++){var o=this.manager.aquireComponent(i.entity,u.Transform2D);o&&(-1==o.lastFrame||-1==i.lastFrame?(a.vec2.copy(o.localPosition,i.position),a.vec2.copy(o.localPosition,i.previousPosition),i.angle=i.previousAngle=o.localRotation,i.lastFrame=e.frame,i.dirtyFlag=!0):o.lastFrame<i.lastFrame&&(a.vec2.lerp(i.previousPosition,i.position,r,o.localPosition),o.localRotation=l.lerp(i.previousAngle,i.angle,r),o.lastFrame=-1))}},t.prototype.update=function(e,t,r){var i=this.maxSteps,n=this.fixedDeltaTime;this.timeRemaining+=t;for(var a=0;this.timeRemaining>=n&&a<i;a++,this.timeRemaining-=n)this.step(e,n,r);return this.timeRemaining%n/n},t.prototype.step=function(e,t,r){for(var i=this.forces.length-1;i>=0;i--)this.forces[i].apply(e,t);for(i=e.length-1;i>=0;i--){1===(s=e[i]).type&&1!==s.sleepState&&(a.vec2.scale(s.velocity,Math.pow(1-s.linearDamping,t),s.velocity),s.angularVelocity*=Math.pow(1-s.angularDamping,t))}this.equationFactory.clear(),this.broadphase.update(),this.generateContacts(),this.equationFactory.loadEquations(this.equationFactory.contactEquations);for(i=this.equationFactory.equations.length-1;i>=0;i--){var n=this.equationFactory.equations[i];this.sleepManager.handleContact(n.bodyA,n.bodyB)}this.equationFactory.loadEquations(this.equationFactory.frictionEquations);for(i=this.constraints.length-1;i>=0;i--){var o=this.constraints[i];o.update(),this.equationFactory.loadEquations(o.equations)}this.solver.solve(this.equationFactory.equations,e,t);for(i=e.length-1;i>=0;i--){var s;0!==(s=e[i]).type&&1!==s.sleepState&&(this.integrate(s,t),-1!==s.lastFrame&&(s.lastFrame=r)),a.vec2.copy(a.vec2.ZERO,s.force),s.angularForce=0}this.sleepManager.update(e,t)},t.prototype.integrate=function(e,t){a.vec2.copy(e.position,e.previousPosition),e.previousAngle=e.angle,e.angularVelocity+=e.angularForce*e.invInertia*t,e.velocity[0]+=e.force[0]*e.invMass[0]*t,e.velocity[1]+=e.force[1]*e.invMass[1]*t,this.ccd&&this.ccd.integrateToImpact(e,t)||(e.angle+=e.angularVelocity*t,e.position[0]+=e.velocity[0]*t,e.position[1]+=e.velocity[1]*t,e.dirtyFlag=!0)},t.prototype.raycast=function(e){var t=this.broadphase,r=this.raycaster,i=Object.create(r);Object.assign(i,e);var n=r.raycast.bind(i);return function(e,r){return i.reset(),i.ray.set(e,r),t.raycast(i.ray,n),i}},t}(r(3).ProcedureSystem);t.PhysicsSystem=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Equation=void 0;var i=r(0),n=function(){function e(e,t){this.bodyA=e,this.bodyB=t,this.minForce=-Number.MAX_VALUE,this.maxForce=Number.MAX_VALUE,this.maxBias=Number.MAX_VALUE,this.stiffness=1e6,this.relaxation=4,this.G=new Float32Array(6),this.a=0,this.b=0,this.epsilon=0,this.multiplier=0,this.lambda=0,this.B=0,this.invC=0,this.minForceDt=0,this.maxForceDt=0,this.timeStep=1/60,this.offset=0,this.relativeVelocity=0,this.dirtyFlag=!0,this.enabled=!0}return e.prototype.update=function(e){if(this.timeStep!==e||this.dirtyFlag){this.timeStep=e,this.dirtyFlag=!1;var t=this.stiffness,r=this.relaxation,i=this.timeStep;this.a=4/(i*(1+4*r)),this.b=4*r/(1+4*r),this.epsilon=4/(i*i*t*(1+4*r))}},e.prototype.multiplyJacobian=function(e,t,r,i,n){return e[0]*t[0]+e[1]*t[1]+e[2]*r+e[3]*i[0]+e[4]*i[1]+e[5]*n},e.prototype.computeB=function(e,t,r){var i=this.computeGW(),n=this.computeGq();return Math.abs(n)>this.maxBias&&(n=n>0?this.maxBias:-this.maxBias),-n*e-i*t-this.computeGiMf()*r},e.prototype.computeGq=function(){return this.multiplyJacobian(this.G,i.vec2.ZERO,this.bodyA.angle,i.vec2.ZERO,this.bodyB.angle)+this.offset},e.prototype.computeGW=function(){return this.multiplyJacobian(this.G,this.bodyA.velocity,this.bodyA.angularVelocity,this.bodyB.velocity,this.bodyB.angularVelocity)+this.relativeVelocity},e.prototype.computeGWlambda=function(){return this.multiplyJacobian(this.G,this.bodyA.vlambda,this.bodyA.wlambda,this.bodyB.vlambda,this.bodyB.wlambda)},e.prototype.computeGiMf=function(){var t=this.bodyA,r=this.bodyB;return this.multiplyJacobian(this.G,i.vec2.multiply(t.force,t.invMass,e.temp0),t.angularForce*t.invInertia,i.vec2.multiply(r.force,r.invMass,e.temp1),r.angularForce*r.invInertia)},e.prototype.computeGiMGt=function(){var e=this.G,t=this.bodyA,r=this.bodyB;return e[0]*e[0]*t.invMass[0]+e[1]*e[1]*t.invMass[1]+e[2]*e[2]*t.invInertia+e[3]*e[3]*r.invMass[0]+e[4]*e[4]*r.invMass[1]+e[5]*e[5]*r.invInertia},e.prototype.computeInvC=function(e){return 1/(this.computeGiMGt()+e)},e.prototype.updateWlambda=function(e){var t=this.G,r=this.bodyA,i=this.bodyB;r.vlambda[0]+=e*t[0]*r.invMass[0],r.vlambda[1]+=e*t[1]*r.invMass[1],r.wlambda+=e*t[2]*r.invInertia,i.vlambda[0]+=e*t[3]*i.invMass[0],i.vlambda[1]+=e*t[4]*i.invMass[1],i.wlambda+=e*t[5]*i.invInertia},e.temp0=i.vec2(),e.temp1=i.vec2(),e}();t.Equation=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.debounce=void 0,t.debounce=function(e,t){void 0===t&&(t=0);var r=null;return function(){var i=this,n=arguments;window.clearTimeout(r),r=window.setTimeout((function(){e.apply(i,n)}),t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderTargetPool=t.RenderTarget=void 0;var i=r(16),n=r(5),a=r(85),o=r(34),s=function(){function e(e,t){this.gl=e,this.fbo=t,this.viewport=i.vec4(0,0,0,0),this.normalizedView=i.vec4(0,0,0,0),this.scissor=null,this.color=null,this.lastFrame=-1}return Object.defineProperty(e.prototype,"width",{get:function(){return this.fbo?this.fbo.width:this.gl.drawingBufferWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.fbo?this.fbo.height:this.gl.drawingBufferHeight},enumerable:!1,configurable:!0}),e.prototype.viewbox=function(e,t,r,n){i.vec4.fromValues(e,this.fbo?t:this.height-n-t,r,n,this.viewport),this.normalizedView[0]=(this.viewport[0]+.5)/this.width,this.normalizedView[1]=(this.viewport[1]+.5)/this.height,this.normalizedView[2]=(this.viewport[2]-1)/this.width,this.normalizedView[3]=(this.viewport[3]-1)/this.height},e.prototype.bind=function(){this.fbo?this.fbo.bind():this.gl.bindFramebuffer(36160,null),this.gl.viewport(this.viewport[0],this.viewport[1],this.viewport[2],this.viewport[3]),this.scissor?(this.gl.enable(3089),this.gl.scissor(this.scissor[0],this.scissor[1],this.scissor[2],this.scissor[3])):this.gl.disable(3089)},e.prototype.clear=function(e){!this.color||e<=this.lastFrame||(this.lastFrame=e,this.gl.clearColor(this.color[0],this.color[1],this.color[2],this.color[3]),this.gl.clear(16384))},e}();t.RenderTarget=s;var c=function(){function e(e){this.gl=e,this.pool=Object.create(null)}return e.prototype.aquire=function(e,t,r){r&&(e=n.int32pow2Ceil(e),t=n.int32pow2Ceil(t));var i=e+"x"+t;return(this.pool[i]||(this.pool[i]=[])).pop()||this.createRenderTarget(e,t)},e.prototype.createRenderTarget=function(e,t){var r=new a.FrameBufferObject(this.gl);r.attach(o.Texture.ColorTexture(this.gl,e,t));var n=new s(this.gl,r);return n.color=i.vec4.ZERO,n},e.prototype.recycle=function(e){var t=e.width+"x"+e.height;e.lastFrame=-1,this.pool[t].push(e)},e}();t.RenderTargetPool=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameBufferObject=void 0;var i=r(34),n=r(86),a=function(){function e(e){this.gl=e,this.attachments=[],this.framebuffer=e.createFramebuffer()}return e.prototype.bind=function(){this.gl.bindFramebuffer(36160,this.framebuffer)},Object.defineProperty(e.prototype,"width",{get:function(){return this.attachments[0]?this.attachments[0].width:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"height",{get:function(){return this.attachments[0]?this.attachments[0].height:0},enumerable:!1,configurable:!0}),e.prototype.deriveAttachment=function(e){switch(e){case 33189:case 6402:return 36096;case 34041:return 33306;case 32854:case 6408:return 36064}},e.prototype.attach=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this.bind();for(var r=0,a=0;a<e.length;a++){var o=this.attachments[a]=e[a],s=this.deriveAttachment(o.internalFormat);36064===s&&(s+=r++),o.bind(),o instanceof i.Texture?this.gl.framebufferTexture2D(36160,s,3553,o.texture,0):o instanceof n.RenderBufferObject&&this.gl.framebufferRenderbuffer(36160,s,36161,o.renderbuffer)}if(36053!=this.gl.checkFramebufferStatus(36160))throw new Error("Invalid framebuffer attachments!")},e.prototype.delete=function(){this.attachments.length=0,this.gl.deleteFramebuffer(this.framebuffer)},e}();t.FrameBufferObject=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RenderBufferObject=void 0;var i=function(){function e(e,t,r,i){void 0===i&&(i=32854),this.gl=e,this.width=t,this.height=r,this.internalFormat=i,this.renderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,this.renderbuffer),e.renderbufferStorage(36161,i,t,r)}return e.ColorBuffer=function(t,r,i){return new e(t,r,i,32854)},e.DepthBuffer=function(t,r,i){return new e(t,r,i,33189)},e.DepthStencilBuffer=function(t,r,i){return new e(t,r,i,34041)},e.prototype.bind=function(){this.gl.bindRenderbuffer(36161,this.renderbuffer)},e.prototype.delete=function(){this.gl.deleteRenderbuffer(this.renderbuffer)},e}();t.RenderBufferObject=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BufferObject=void 0;var i=function(){function e(e,t,r){void 0===r&&(r=35044),this.gl=e,this.type=t,this.drawType=r,this.byteLength=0,this.buffer=e.createBuffer()}return e.prototype.bind=function(){this.gl.bindBuffer(this.type,this.buffer)},e.prototype.delete=function(){this.gl.deleteBuffer(this.buffer)},e.prototype.upload=function(e,t){if(void 0===t&&(t=0),this.bind(),e){this.byteLength!==this.data.byteLength&&this.gl.bufferData(this.type,this.byteLength=this.data.byteLength,this.drawType);var r=e.BYTES_PER_ELEMENT||1;this.gl.bufferSubData(this.type,r*t,e)}else this.gl.bufferData(this.type,this.data,this.drawType)},e}();t.BufferObject=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Shader=void 0;var i=r(30),n=r(157),a=function(e,t){return"precision "+t+"p float;"+e.replace(/precision[a-z\s]+float\s+;?/i,"")},o=function(){function e(e,t,r,o){this.gl=e,this.attributes=Object.create(null),this.uniforms=Object.create(null),t=a(t,e.VERT_PRECISION),r=a(r,e.FRAG_PRECISION),this.program=e.createProgram();var s=e.createShader(35633),c=e.createShader(35632);for(var l in e.shaderSource(s,t),e.compileShader(s),e.shaderSource(c,r),e.compileShader(c),e.attachShader(this.program,s),e.attachShader(this.program,c),o)e.bindAttribLocation(this.program,o[l],l);if(e.linkProgram(this.program),!e.getProgramParameter(this.program,35714))throw new Error([e.getProgramInfoLog(this.program),e.getShaderInfoLog(s),e.getShaderInfoLog(c)].join("\n"));e.deleteShader(s),e.deleteShader(c);for(var u=e.getProgramParameter(this.program,35721)-1;u>=0;u--){var p=e.getActiveAttrib(this.program,u),h=e.getAttribLocation(this.program,p.name);this.attributes[p.name]={location:h,type:p.type,size:i.GL_SIZE[p.type]}}for(u=e.getProgramParameter(this.program,35718)-1;u>=0;u--){var f=e.getActiveUniform(this.program,u),d=e.getUniformLocation(this.program,f.name),v=f.name.replace(/\[(\d+)\]/g,".$1").replace(/\.0$/,"");this.uniforms[v]={location:d,type:f.type,size:i.GL_SIZE[f.type],length:f.size}}this.uao=new n.UniformAccessObject(e,this.uniforms)}return e.prototype.bind=function(){this.gl.useProgram(this.program),this.uao.upload()},e.prototype.delete=function(){this.gl.deleteProgram(this.program)},e}();t.Shader=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Curve=void 0;var a=r(0),o=r(5),s=r(45),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertices=new Float32Array(0),t.uvs=new Uint32Array(0),t.indices=new Uint16Array(0),t.lastTextureIndex=-1,t.lastFrame=-1,t.uvArray=new Float32Array(0),t.smoothness=1,t.curve=[],t.uvOffset=a.vec2(0,0),t.uvScale=a.vec2(1,1),t.width=0,t}return n(t,e),Object.defineProperty(t.prototype,"thickness",{set:function(e){this.envelope=e?o.linearGradient(o.lerp)(e):null,this.lastFrame=-1},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{set:function(e){var t=e.length-1,r=e.length*this.smoothness|0;if(this.curve.length=r,this.smoothness>1)for(var i=0;i<r;i++){var n=t*i/(r-1),o=0|n;this.curve[i]=s.cubicInterpolation(e[Math.max(o-1,0)],e[o],e[Math.min(o+1,t)],e[Math.min(o+2,t)],n-o,1,this.curve[i]||a.vec2())}else for(i=0;i<r;i++)this.curve[i]=a.vec2.copy(e[i],this.curve[i]||a.vec2());this.lastFrame=this.lastTextureIndex=-1},enumerable:!1,configurable:!0}),t.prototype.setup=function(e){this.lastTextureIndex=-1,this.lastFrame=-1,this.order=e.order,a.vec2.copy(e.uvOffset||a.vec2.ZERO,this.uvOffset),a.vec2.copy(e.uvScale||[1,1],this.uvScale),this.thickness=e.thickness,this.path=e.path||[]},t.prototype.reallocate=function(){var e=4*this.curve.length,t=this.curve.length-1;if(this.vertices.length!==e){this.uvArray=new Float32Array(e),this.vertices=new Float32Array(e),this.uvs=new Uint32Array(e/2),this.indices=new Uint16Array(6*t);for(var r=0;r<t;r++)this.indices[6*r+0]=2*r+0,this.indices[6*r+1]=2*r+1,this.indices[6*r+2]=2*r+2,this.indices[6*r+3]=2*r+2,this.indices[6*r+4]=2*r+1,this.indices[6*r+5]=2*r+3;this.lastFrame=this.lastTextureIndex=-1}},t.prototype.calculateVertexData=function(e,t,r){-1==this.lastFrame&&this.reallocate(),this.lastTextureIndex!=t.diffuse.index&&(this.lastTextureIndex=t.diffuse.index,-1==this.lastFrame&&this.updateUVs(this.uvArray),this.recalculateUVs(this.uvArray,t.diffuse.uvTransform,this.uvs),this.width!=t.diffuse.height&&(this.width=t.diffuse.height,this.lastFrame=-1)),e&&this.lastFrame<e.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame&&(this.lastFrame=r,this.updateVertices(this.width,this.vertices),e&&this.recalculateVertices(this.vertices,e.globalTransform,this.vertices),this.recalculateBoundingBox())},t.prototype.updateUVs=function(e){for(var t=this.curve,r=this.uvOffset[0],i=this.uvOffset[1],n=this.uvScale[0],a=this.uvScale[1],s=o.clamp(i,0,1),c=o.clamp(a+i,0,1),l=t.length,u=0;u<l;u++){var p=u/(l-1);e[4*u+0]=e[4*u+2]=o.clamp(n*p+r,0,1),e[4*u+1]=s,e[4*u+3]=c}},t.prototype.updateVertices=function(e,r){var i=this.curve,n=t.temp0,o=t.temp1;a.vec2.copy(a.vec2.ZERO,n);for(var s=i.length,c=0;c<s;c++){var l=i[c],u=i[c+1]||l;a.vec2.subtract(u,l,o),a.vec2.normalize(o,o),a.vec2.add(n,o,n),a.vec2.normalize(n,n),a.vec2.rotate90cw(n,n),a.vec2.scale(n,.5*(this.envelope?this.envelope(c/(s-1)):1)*e,n),r[4*c+0]=l[0]+n[0],r[4*c+1]=l[1]+n[1],r[4*c+2]=l[0]-n[0],r[4*c+3]=l[1]-n[1],a.vec2.copy(o,n)}},t.prototype.reset=function(){},t.temp0=a.vec2(),t.temp1=a.vec2(),t}(r(19).Geometry2D);t.Curve=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DecodeAudio=void 0;var i=r(18),n=r(11),a=r(39);t.DecodeAudio=function(e){if(e.type===n.DATA_TYPE.AUDIO){for(var r=e.data.split(","),o=(r[0],r[1]),s=atob(o),c=new Uint8Array(s.length),l=0;l<c.length;c[l]=s.charCodeAt(l++));var u=this.manager.resolveSystem(a.AudioSystem).context;return(new i.Deferred).from((function(e,t){u.decodeAudioData(c.buffer,e,t)})).then((function(r){e.data={index:++t.DecodeAudio.index,buffer:r,offset:0,loop:0,duration:r.duration},e.type="sound"}))}},t.DecodeAudio.index=0},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialAudio=void 0;var a=r(1),o=r(17),s=r(22),c=r(39),l=r(26),u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.offset=a.vec3(0,0,0),t}return n(t,e),t.prototype.setup=function(e,t){this.lastFrame=-1,a.vec3.copy(e.offset||a.vec3.ZERO,this.offset);var r=t.resolveSystem(c.AudioSystem).context;this.panner=r.createPanner(),Object.assign(this.panner,{panningModel:"HRTF",distanceModel:"inverse",refDistance:e.radius,maxDistance:1e4,rolloffFactor:1,coneInnerAngle:360,coneOuterAngle:0,coneOuterGain:0});var i=t.aquireComponent(this.entity,l.AudioChannel);i.output.disconnect(),i.output.connect(this.input),this.output.connect(i.resolveDestination(t))},Object.defineProperty(t.prototype,"output",{get:function(){return this.panner},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"input",{get:function(){return this.panner},enumerable:!1,configurable:!0}),t.prototype.update=function(e,r,i){var n=r.context,o=r.listener,c=e.aquireComponent(this.entity,s.Transform2D,this.timeframe);if(c&&this.lastFrame<c.lastFrame&&(this.lastFrame=-1),this.lastFrame<o.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame){this.lastFrame=i;var l=t.position,u=t.orientation;a.vec3.copy(this.offset,l),c?(a.mat3x2.transform(l,c.globalTransform,l),a.vec3.subtract(o.position,l,u),a.vec3.normalize(u,u)):a.vec3.copy(a.vec3.AXIS_Y,u),this.panner.positionX.setValueAtTime(l[0],n.currentTime),this.panner.positionY.setValueAtTime(l[1],n.currentTime),this.panner.positionZ.setValueAtTime(l[2],n.currentTime),this.panner.orientationX.setValueAtTime(u[0],n.currentTime),this.panner.orientationY.setValueAtTime(u[1],n.currentTime),this.panner.orientationZ.setValueAtTime(u[2],n.currentTime)}},t.prototype.reset=function(){this.panner.disconnect(),this.panner=null},t.position=a.vec3(),t.orientation=a.vec3(),t}(o.ReusableComponent);t.SpatialAudio=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ListenerTransform=void 0;var i=r(42),n=function(){function e(e){this.context=e,this.tempPosition=i.vec3(0,0,0),this.tempForward=i.vec3(0,0,-1),this.tempUp=i.vec3(0,1,0),this.lastFrame=-1}return Object.defineProperty(e.prototype,"position",{get:function(){return this.tempPosition},set:function(e){this.lastFrame=-1,i.vec3.copy(e,this.tempPosition),this.context.listener.positionX.setValueAtTime(e[0],this.context.currentTime),this.context.listener.positionY.setValueAtTime(e[1],this.context.currentTime),this.context.listener.positionZ.setValueAtTime(e[2],this.context.currentTime)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"forward",{get:function(){return this.tempForward},set:function(e){this.lastFrame=-1,i.vec3.copy(e,this.tempForward),this.context.listener.forwardX.setValueAtTime(e[0],this.context.currentTime),this.context.listener.forwardY.setValueAtTime(e[1],this.context.currentTime),this.context.listener.forwardZ.setValueAtTime(e[2],this.context.currentTime)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"up",{get:function(){return this.tempUp},set:function(e){this.lastFrame=-1,i.vec3.copy(e,this.tempUp),this.context.listener.upX.setValueAtTime(e[0],this.context.currentTime),this.context.listener.upY.setValueAtTime(e[1],this.context.currentTime),this.context.listener.upZ.setValueAtTime(e[2],this.context.currentTime)},enumerable:!1,configurable:!0}),e}();t.ListenerTransform=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.DisjointSet=void 0;var i=function(){function e(){this.indices=[],this.weights=[]}return e.prototype.allocate=function(e){for(var t=0;t<e;t++)this.indices[t]=t,this.weights[t]=1;return this},e.prototype.join=function(e,t){var r=this.find(e),i=this.find(t);r!==i&&(this.weights[r]<this.weights[i]?(this.indices[r]=i,this.weights[i]+=this.weights[r]):(this.indices[i]=r,this.weights[r]+=this.weights[i]))},e.prototype.find=function(e){for(var t=this.indices;e!==t[e];)e=t[e]=t[t[e]];return e},e}();t.DisjointSet=i},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Tree=void 0;var a=r(1),o=r(3),s=r(7),c=function(e,t,r,i,n){this.step=e,this.parent=t,this.prevLength=r,this.prevAngle=i,this.prevWidth=n,this.position=a.vec2(),this.offset=s.rng(),this.length=this.prevLength,this.angle=this.prevAngle,this.width=this.prevWidth},l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.prevGrowth=0,t.growth=0,t.lastFrame=-1,t}return n(t,e),t.prototype.setup=function(e){this.lastFrame=-1,this.prevGrowth=this.growth=0;this.nodes=this.generateNodes(e.iterations,{branch:function(t,r){return function(t,r){return 1-(1-a.lerp(0,e.branchingFactor,t))*Math.pow(r,2)}(t,r)>s.rng()},angle:function(e,t,r){var i=Math.PI*a.lerp(.2,.5,t),n=r+a.randomFloat(-i,i,s.rng);return n=a.lerpAngle(0,n,4*(1-e)*e)},length:function(t){return e.length*a.lerp(.2,1,t)},width:function(t){return e.width*a.lerp(.5,1.6,a.ease.quadIn(t))}})},t.prototype.generateNodes=function(e,t){for(var r=[],i=1/e,n=[new c(1,-1,0,0,t.width(1))];n.length;){var a=n.pop(),o=r.push(a)-1;if(!(a.step<=0))for(var s=0;t.branch(a.step,s);s++){var l=t.angle(a.step,s,a.angle),u=t.length(a.step),p=a.step-i,h=t.width(p);n.push(new c(p,o,u,l,h))}}return r},t.prototype.calculateVertexData=function(){for(var e=new Float32Array(2*this.nodes.length*2),t=new Float32Array(2*this.nodes.length*2),r=new Uint16Array(6*(this.nodes.length-1)),i=0,n=0;n<this.nodes.length;n++){var a=this.nodes[n],o=a.step,s=a.parent;t[4*n+0]=t[4*n+2]=1-o,t[4*n+1]=0,t[4*n+3]=1,-1!=s&&(r[i++]=2*n+0,r[i++]=2*n+1,r[i++]=2*s+1,r[i++]=2*s+1,r[i++]=2*s+0,r[i++]=2*n+0)}return this.updateVertices(e),{vertices:e,uvs:t,indices:r}},t.prototype.updateVertices=function(e){for(var r=0;r<this.nodes.length;r++){var i=this.nodes[r],n=i.position,o=i.angle,s=i.parent,c=i.length,l=i.width;a.vec2.rotate(t.UP,o,n);var u=a.vec2.rotate90cw(n,t.temp);a.vec2.scale(n,c,n),a.vec2.add(s>=0?this.nodes[s].position:a.vec2.ZERO,n,n),a.vec2.scale(u,.5*l,u),e[4*r+0]=n[0]+u[0],e[4*r+1]=n[1]+u[1],e[4*r+2]=n[0]-u[0],e[4*r+3]=n[1]-u[1]}},t.prototype.update=function(e){if(this.growth!==this.prevGrowth||this.growth||-1==this.lastFrame){this.lastFrame=e.frame,this.prevGrowth+=.2*Math.sign(this.growth-this.prevGrowth)*e.deltaTime;for(var t=this.nodes.length,r=0;r<t;r++){var i=this.nodes[r],n=a.lerp(.2,1,i.step),o=a.clamp((this.prevGrowth-(1-n))/n,0,1),s=a.lerp(0,.3,1-i.step)*Math.sin(2*Math.PI*i.offset+e.elapsedTime);i.angle=i.prevAngle*a.ease.quadOut(o)+s,i.width=i.prevWidth*a.ease.sineOut(o),i.length=i.prevLength*a.ease.quartOut(o)}}},t.prototype.reset=function(){this.nodes.length=0},t.temp=a.vec2(),t.UP=a.vec2(0,-1),t}(o.ReusableComponent);t.Tree=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Plant=void 0;var a=r(1),o=r(3),s=r(2),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.aabb=a.AABB(),t}return n(t,e),t.prototype.setup=function(e,t){this.options=e,this.reaction=0,this.radiusSquared=this.options.radius*this.options.radius},t.prototype.update=function(e,t,r){var i=r.globalTransform[4],n=r.globalTransform[5],o=i-.5*(this.aabb[0]+this.aabb[2]),c=n-(.5*(this.aabb[1]+this.aabb[3])-.5*this.options.radius),l=o*o+c*c<this.radiusSquared;if(l||this.reaction){var u=this.options.timeScale*(l?2*t.deltaTime:-t.deltaTime);this.reaction=a.clamp(this.reaction+u,0,1);var p=e.aquireComponent(this.options.element,s.Transform2D,this.timeframe);p.localScale[1]=a.lerp(1,0,a.ease.backIn(this.reaction)),p.localScale[0]=a.lerp(1,0,a.ease.cubicIn(this.reaction)),p.lastFrame=-1}},t.prototype.reset=function(){this.options=null},t}(o.ReusableComponent);t.Plant=c},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),r(97);var n=r(13),a=r(28),o=r(56),s=r(55),c=r(208),l=r(12),u=r(212),p=r(41);i(r(215)).default({manifest:r(248),keybindings:{up:["ArrowUp","KeyW"],down:["ArrowDown","KeyS"],right:["ArrowRight","KeyD"],left:["ArrowLeft","KeyA"],action:["Space"],guide:["KeyH"]},width:800,height:600,initialize:function(e){console.log("%cApp: %O","color:#0873a8;text-shadow:0px 0px 1px #000;font-weight:bold",window.app=e);var t=r(249);e.registerSystem(l.SoundscapeSystem,null),e.registerSystem(a.CharacterSystem,null),e.registerSystem(n.CameraSystem,t.camera),e.registerSystem(o.TerrainSystem,t.terrain),e.registerSystem(s.PuzzleSystem,t.puzzle),e.registerSystem(c.SoulSystem,null),e.registerSystem(u.ParallaxSystem,null),e.registerSystem(p.RevealSystem,t.blocks)}}).then((function(e){return console.log("%cInitialization Complete.","color:#0873a8;text-shadow:0px 0px 1px #000;font-weight:bold")}),(function(e){return console.error(e)}))},function(e,t,r){},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mat4=void 0,t.mat4=function(){return t.mat4.identity(new Float32Array(16))},t.mat4.identity=function(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e},t.mat4.multiply=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=e[4],c=e[5],l=e[6],u=e[7],p=e[8],h=e[9],f=e[10],d=e[11],v=e[12],m=e[13],y=e[14],g=e[15],b=t[0],_=t[1],P=t[2],S=t[3];return r[0]=b*i+_*s+P*p+S*v,r[1]=b*n+_*c+P*h+S*m,r[2]=b*a+_*l+P*f+S*y,r[3]=b*o+_*u+P*d+S*g,b=t[4],_=t[5],P=t[6],S=t[7],r[4]=b*i+_*s+P*p+S*v,r[5]=b*n+_*c+P*h+S*m,r[6]=b*a+_*l+P*f+S*y,r[7]=b*o+_*u+P*d+S*g,b=t[8],_=t[9],P=t[10],S=t[11],r[8]=b*i+_*s+P*p+S*v,r[9]=b*n+_*c+P*h+S*m,r[10]=b*a+_*l+P*f+S*y,r[11]=b*o+_*u+P*d+S*g,b=t[12],_=t[13],P=t[14],S=t[15],r[12]=b*i+_*s+P*p+S*v,r[13]=b*n+_*c+P*h+S*m,r[14]=b*a+_*l+P*f+S*y,r[15]=b*o+_*u+P*d+S*g,r},t.mat4.fromEulerRotation=function(e,t,r,i){var n=Math.sin(e),a=Math.sin(t),o=Math.sin(r),s=Math.cos(e),c=Math.cos(t),l=Math.cos(r);return i[0]=c*l,i[1]=c*o,i[2]=-a,i[3]=0,i[4]=n*a*l-s*o,i[5]=n*a*o+s*l,i[6]=n*c,i[7]=0,i[8]=s*a*l+n*o,i[9]=s*a*o-n*l,i[10]=s*c,i[11]=0,i[12]=0,i[13]=0,i[14]=0,i[15]=1,i},t.mat4.perspective=function(e,t,r,i,n){var a=1/Math.tan(e/2),o=1/(r-i);return n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(i+r)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*i*r*o,n[15]=0,n},t.mat4.transform=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3];return r[0]=t[0]*i+t[4]*n+t[8]*a+t[12]*o,r[1]=t[1]*i+t[5]*n+t[9]*a+t[13]*o,r[2]=t[2]*i+t[6]*n+t[10]*a+t[14]*o,r[3]=t[3]*i+t[7]*n+t[11]*a+t[15]*o,r},t.mat4.transpose=function(e,t){var r=e[1],i=e[2],n=e[3],a=e[6],o=e[7],s=e[11];return t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=r,t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=i,t[9]=a,t[10]=e[10],t[11]=e[14],t[12]=n,t[13]=o,t[14]=s,t[15]=e[15],t},t.mat4.invert=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=e[8],p=e[9],h=e[10],f=e[11],d=e[12],v=e[13],m=e[14],y=e[15],g=r*s-i*o,b=r*c-n*o,_=r*l-a*o,P=i*c-n*s,S=i*l-a*s,x=n*l-a*c,A=u*v-p*d,O=u*m-h*d,w=u*y-f*d,M=p*m-h*v,T=p*y-f*v,E=h*y-f*m,C=g*E-b*T+_*M+P*w-S*O+x*A,B=C?1/C:0;return t[0]=B*(s*E-c*T+l*M),t[1]=B*(n*T-i*E-a*M),t[2]=B*(v*x-m*S+y*P),t[3]=B*(h*S-p*x-f*P),t[4]=B*(c*w-o*E-l*O),t[5]=B*(r*E-n*w+a*O),t[6]=B*(m*_-d*x-y*b),t[7]=B*(u*x-h*_+f*b),t[8]=B*(o*T-s*w+l*A),t[9]=B*(i*w-r*T-a*A),t[10]=B*(d*S-v*_+y*g),t[11]=B*(p*_-u*S-f*g),t[12]=B*(s*O-o*M-c*A),t[13]=B*(r*M-i*O+n*A),t[14]=B*(v*b-d*P-m*g),t[15]=B*(u*P-p*b+h*g),t},t.mat4.perspective=function(e,t,r,i,n){var a=1/Math.tan(e/2),o=1/(r-i);return n[0]=a/t,n[1]=0,n[2]=0,n[3]=0,n[4]=0,n[5]=a,n[6]=0,n[7]=0,n[8]=0,n[9]=0,n[10]=(i+r)*o,n[11]=-1,n[12]=0,n[13]=0,n[14]=2*i*r*o,n[15]=0,n},t.mat4.orthogonal=function(e,t,r,i,n,a,o){var s=1/(e-t),c=1/(r-i),l=1/(n-a);return o[0]=-2*s,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*c,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*l,o[11]=0,o[12]=(e+t)*s,o[13]=(i+r)*c,o[14]=(a+n)*l,o[15]=1,o},t.mat4.translate=function(e,t,r){var i=t[0],n=t[1],a=t[2];return r[12]=e[0]*i+e[4]*n+e[8]*a+e[12],r[13]=e[1]*i+e[5]*n+e[9]*a+e[13],r[14]=e[2]*i+e[6]*n+e[10]*a+e[14],r[15]=e[3]*i+e[7]*n+e[11]*a+e[15],r!==e&&(r[0]=e[0],r[1]=e[1],r[2]=e[2],r[3]=e[3],r[4]=e[4],r[5]=e[5],r[6]=e[6],r[7]=e[7],r[8]=e[8],r[9]=e[9],r[10]=e[10],r[11]=e[11]),r},t.mat4.scale=function(e,t,r){var i=t[0],n=t[1],a=t[2];return r[0]=e[0]*i,r[1]=e[1]*i,r[2]=e[2]*i,r[3]=e[3]*i,r[4]=e[4]*n,r[5]=e[5]*n,r[6]=e[6]*n,r[7]=e[7]*n,r[8]=e[8]*a,r[9]=e[9]*a,r[10]=e[10]*a,r[11]=e[11]*a,r[12]=e[12],r[13]=e[13],r[14]=e[14],r[15]=e[15],r},t.mat4.rotate=function(e,t,r,i){var n=r[0],a=r[1],o=r[2],s=Math.sin(t),c=Math.cos(t),l=1-c,u=e[0],p=e[1],h=e[2],f=e[3],d=e[4],v=e[5],m=e[6],y=e[7],g=e[8],b=e[9],_=e[10],P=e[11],S=n*n*l+c,x=a*n*l+o*s,A=o*n*l-a*s,O=n*a*l-o*s,w=a*a*l+c,M=o*a*l+n*s,T=n*o*l+a*s,E=a*o*l-n*s,C=o*o*l+c;return i[0]=u*S+d*x+g*A,i[1]=p*S+v*x+b*A,i[2]=h*S+m*x+_*A,i[3]=f*S+y*x+P*A,i[4]=u*O+d*w+g*M,i[5]=p*O+v*w+b*M,i[6]=h*O+m*w+_*M,i[7]=f*O+y*w+P*M,i[8]=u*T+d*E+g*C,i[9]=p*T+v*E+b*C,i[10]=h*T+m*E+_*C,i[11]=f*T+y*E+P*C,i[12]=e[12],i[13]=e[13],i[14]=e[14],i[15]=e[15],i},t.mat4.fromRotationTranslationScale=function(e,t,r,i){var n=e[0],a=e[1],o=e[2],s=e[3],c=n+n,l=a+a,u=o+o,p=n*c,h=n*l,f=n*u,d=a*l,v=a*u,m=o*u,y=s*c,g=s*l,b=s*u,_=r[0],P=r[1],S=r[2];return i[0]=(1-(d+m))*_,i[1]=(h+b)*_,i[2]=(f-g)*_,i[3]=0,i[4]=(h-b)*P,i[5]=(1-(p+m))*P,i[6]=(v+y)*P,i[7]=0,i[8]=(f+g)*S,i[9]=(v-y)*S,i[10]=(1-(p+d))*S,i[11]=0,i[12]=t[0],i[13]=t[1],i[14]=t[2],i[15]=1,i},t.mat4.lookAt=function(e,t,r,i){var n=e[0],a=e[1],o=e[2],s=t[0],c=t[1],l=t[2],u=r[0],p=r[1],h=r[2],f=n-s,d=a-c,v=o-l,m=Math.sqrt(f*f+d*d+v*v),y=m?1/m:0,g=p*(v*=y)-h*(d*=y),b=h*(f*=y)-u*v,_=u*d-p*f,P=d*(_*=y=(m=Math.sqrt(g*g+b*b+_*_))?1/m:0)-v*(b*=y),S=v*(g*=y)-f*_,x=f*b-d*g;return P*=y=(m=Math.sqrt(P*P+S*S+x*x))?1/m:0,S*=y,x*=y,i[0]=g,i[1]=P,i[2]=f,i[3]=0,i[4]=b,i[5]=S,i[6]=d,i[7]=0,i[8]=_,i[9]=x,i[10]=v,i[11]=0,i[12]=-(g*n+b*a+_*o),i[13]=-(P*n+S*a+x*o),i[14]=-(f*n+d*a+v*o),i[15]=1,i},t.mat4.targetTo=function(e,t,r,i){var n=e[0],a=e[1],o=e[2],s=r[0],c=r[1],l=r[2],u=n-t[0],p=a-t[1],h=o-t[2],f=Math.sqrt(u*u+p*p+h*h),d=f?1/f:1,v=c*(h*=d)-l*(p*=d),m=l*(u*=d)-s*h,y=s*p-c*u;return v*=d=(f=Math.sqrt(v*v+m*m+y*y))?1/f:1,m*=d,y*=d,i[0]=v,i[1]=m,i[2]=y,i[3]=0,i[4]=p*y-h*m,i[5]=h*v-u*y,i[6]=u*m-p*v,i[7]=0,i[8]=u,i[9]=p,i[10]=h,i[11]=0,i[12]=n,i[13]=a,i[14]=o,i[15]=1,i},t.mat4.fromDualquat=function(e,t){var r=e[0],i=e[1],n=e[2],a=e[3],o=e[4],s=e[5],c=e[6],l=e[7],u=2*r*r,p=2*i*i,h=2*n*n,f=2*r*i,d=2*r*n,v=2*r*a,m=2*i*n,y=2*i*a,g=2*n*a;return t[0]=1-p-h,t[1]=f+g,t[2]=d-y,t[3]=0,t[4]=f-g,t[5]=1-u-h,t[6]=m+v,t[7]=0,t[8]=d+y,t[9]=m-v,t[10]=1-u-p,t[11]=0,t[12]=2*(-l*r+o*a-s*n+c*i),t[13]=2*(-l*i+o*n+s*a-c*r),t[14]=2*(-l*n-o*i+s*r+c*a),t[15]=1,t},t.mat4.IDENTITY=t.mat4()},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.quat=void 0;var i=r(16);t.quat=function(){return i.vec4(0,0,0,1)},t.quat.copy=i.vec4.copy,t.quat.normalize=i.vec4.normalize,t.quat.multiply=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=t[0],c=t[1],l=t[2],u=t[3];return r[0]=i*u+o*s+n*l-a*c,r[1]=n*u+o*c+a*s-i*l,r[2]=a*u+o*l+i*c-n*s,r[3]=o*u-i*s-n*c-a*l,r},t.quat.transformVec4=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=t[0],s=t[1],c=t[2],l=t[3],u=l*i+s*a-c*n,p=l*n+c*i-o*a,h=l*a+o*n-s*i,f=-o*i-s*n-c*a;return r[0]=u*l+f*-o+p*-c-h*-s,r[1]=p*l+f*-s+h*-o-u*-c,r[2]=h*l+f*-c+u*-s-p*-o,r[3]=null==e[3]?1:e[3],r},t.quat.fromAxisAngle=function(e,t,r){var i=Math.sin(t*=.5);return r[0]=i*e[0],r[1]=i*e[1],r[2]=i*e[2],r[3]=Math.cos(t),r},t.quat.slerp=function(e,t,r,i){var n=e[0],a=e[1],o=e[2],s=e[3],c=t[0],l=t[1],u=t[2],p=t[3];return n*c+a*l+o*u+s*p<0?(i[0]=r*(c+n)-n,i[1]=r*(l+a)-a,i[2]=r*(u+o)-o,i[3]=r*(p+s)-s):(i[0]=n+r*(c-n),i[1]=a+r*(l-a),i[2]=o+r*(u-o),i[3]=s+r*(p-s)),i}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.dualquat=void 0,t.dualquat=function(){return t.dualquat.fromValues(0,0,0,1,0,0,0,0,new Float32Array(8))},t.dualquat.fromValues=function(e,t,r,i,n,a,o,s,c){return c[0]=e,c[1]=t,c[2]=r,c[3]=i,c[4]=n,c[5]=a,c[6]=o,c[7]=s,c},t.dualquat.copy=function(e,t){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t},t.dualquat.slerp=function(e,t,r,i){var n=e[0],a=e[1],o=e[2],s=e[3],c=t[0],l=t[1],u=t[2],p=t[3],h=e[4],f=e[5],d=e[6],v=e[7];return n*c+a*l+o*u+s*p<0?(i[0]=r*(c+n)-n,i[1]=r*(l+a)-a,i[2]=r*(u+o)-o,i[3]=r*(p+s)-s,i[4]=-h+r*(t[4]+h),i[5]=-f+r*(t[5]+f),i[6]=-d+r*(t[6]+d),i[7]=-v+r*(t[7]+v)):(i[0]=n+r*(c-n),i[1]=a+r*(l-a),i[2]=o+r*(u-o),i[3]=s+r*(p-s),i[4]=h+r*(t[4]-h),i[5]=f+r*(t[5]-f),i[6]=d+r*(t[6]-d),i[7]=v+r*(t[7]-v)),i},t.dualquat.fromRotationTranslation=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=.5*t[0],c=.5*t[1],l=.5*t[2];return r[0]=i,r[1]=n,r[2]=a,r[3]=o,r[4]=+s*o+c*a-l*n,r[5]=-s*a+c*o+l*i,r[6]=+s*n-c*i+l*o,r[7]=-s*i-c*n-l*a,r},t.dualquat.multiply=function(e,t,r){var i=e[0],n=e[1],a=e[2],o=e[3],s=t[4],c=t[5],l=t[6],u=t[7],p=e[4],h=e[5],f=e[6],d=e[7],v=t[0],m=t[1],y=t[2],g=t[3];return r[0]=i*g+o*v+n*y-a*m,r[1]=n*g+o*m+a*v-i*y,r[2]=a*g+o*y+i*m-n*v,r[3]=o*g-i*v-n*m-a*y,r[4]=i*u+o*s+n*l-a*c+p*g+d*v+h*y-f*m,r[5]=n*u+o*c+a*s-i*l+h*g+d*m+f*v-p*y,r[6]=a*u+o*l+i*c-n*s+f*g+d*y+p*m-h*v,r[7]=o*u-i*s-n*c-a*l+d*g-p*v-h*m-f*y,r}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProcedureUpdateSystem=t.ProcedureSystem=void 0;var i=r(46),n=r(65),a=function(){function e(e){this.manager=e}return e.prioritySort=function(e,t){return(e.priority||0)-(t.priority||0)},e}();t.ProcedureSystem=a;var o=function(){function e(e){this.manager=e,this.loop=new n.UpdateLoop}return e.prototype.start=function(){var e=this,t=this.manager.systems.filter((function(e){return e instanceof a})).sort(a.prioritySort);this.loop.subscribe((function(e){for(var r=void 0,i=0;r=t[i];i++)r.execute(e)})).start(),i.addVisibilityEventListener((function(t){return t?e.loop.start():e.loop.stop()}))},e}();t.ProcedureUpdateSystem=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TagComponent=void 0;var i=r(27);t.TagComponent=function(){return Object.create(t.TagComponent)},t.TagComponent.create=i.True,t.TagComponent.delete=i.Void,t.TagComponent.staticData={length:1,get:i.True,insert:i.One,remove:i.True},t.TagComponent.allocate=function(){return t.TagComponent.staticData}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EntityManager=void 0;var a=r(64),o=r(67),s=r(66),c=r(68),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.storage=new o.StorageMatrix,t.components=[],t.views=[],t.groups=Object.create(null),t}return n(t,e),t.prototype.createEntity=function(){return this.storage.nextUnit()},t.prototype.removeEntity=function(e){if(this.storage.lookupIndex(0,e)){for(var t=this.components.length-1;t>0;t--)this.storage.lookupIndex(t,e)&&this.removeComponent(e,this.components[t]);this.storage.recycleUnit(e)}},t.prototype.createComponent=function(e,t,r){var i=this.indexComponent(t);if(this.storage.lookupIndex(i,e))throw new Error("Duplicate Entry: ["+i+","+e+"]");var n=t.create(r,e,this.storage.lastIndex,this);for(var a in this.storage.insertData(i,e,n),this.groups){var o=this.groups[a];~o.segments.indexOf(i)&&(o.matchEntity(e)&&o.insertEntity(e))}return n},t.prototype.removeComponent=function(e,t){var r=this.indexComponent(t);if(!this.storage.lookupIndex(r,e))throw new Error("Missing entry: ["+r+","+e+"].");for(var i in this.groups){var n=this.groups[i];~n.segments.indexOf(r)&&(n.matchEntity(e)&&n.removeEntity(e))}var a=this.storage.removeData(r,e);t.delete(a)},t.prototype.aquireComponent=function(e,t,r){var i=this.indexComponent(t);return this.storage.getData(i,e,r)},t.prototype.indexComponent=function(e){if(e=e.delegate||e,!Object.hasOwnProperty.call(e,this.cachePrefix)){var t=this.storage.nextSegment(e.allocate&&e.allocate());this.components[e[this.cachePrefix]=t]=e}return e[this.cachePrefix]},t.prototype.queryEntityGroup=function(e){var t=e.map(this.indexComponent,this).sort(),r=t.join("-");if(!this.groups[r])for(var i=this.groups[r]=new c.EntityGroup(this.storage,t),n=this.storage.total;n>0;n--)i.matchEntity(n)&&i.insertEntity(n);return this.groups[r]},t.prototype.aquireDataView=function(e){var t=this.indexComponent(e);return this.views[t]||(this.views[t]=new s.DataView(this.storage,t)),this.views[t]},t.prototype.linkEntity=function(e,t,r){for(var i=0,n=t.length,a=0;a<n;a++){i&&(t[a-i]=t[a]);var o=this.storage.lookupIndex(0,t[a]);o&&o<=r||i++}return t.length-=i,t.push(e),this.storage.lookupIndex(0,e)},t}(a.Manager);t.EntityManager=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CameraSystem=void 0;var a=r(1),o=r(3),s=r(2),c=r(116),l=r(28),u=r(61);function p(e,t,r){var i=.5*(e[0]+e[2]),n=.5*(e[1]+e[3]),o=.5*(e[2]-e[0]),s=.5*(e[3]-e[1]);return 1-Math.max(a.smoothstep(o-r,o,Math.abs(i-t[0])),a.smoothstep(s-r,s,Math.abs(n-t[1])))}var h=function(e){function t(t,r){var i=r.regions,n=e.call(this,t)||this;n.priority=-32,n.tree=new c.QuadTree(a.AABB(),{capacity:1,depthLimit:4}),n.enabled=!0,n.regions=n.manager.aquireDataView(u.CameraRegion),n.character=n.manager.resolveSystem(l.CharacterSystem).character,n.camera=n.manager.createEntity(),n.manager.createComponent(n.camera,s.Transform2D,{position:[0,0]}),n.manager.createComponent(n.camera,s.Camera2D,{viewport:[1024,768],origin:[.5,.5],range:[-4096,4096]});for(var o=0;o<i.length;o++)a.AABB.merge(i[o][0],n.tree.root.bounds,n.tree.root.bounds);for(o=0;o<i.length;o++){var p=i[o],h=p[0],f=p[1],d=p[2],v=p[3],m=p[4],y=n.manager.createEntity(),g=n.manager.createComponent(y,u.CameraRegion,{bounds:h,view:[f,d],lockX:v,lockY:m});n.tree.insert(g)}return n}return n(t,e),t.prototype.execute=function(e){if(this.character&&this.enabled){for(var r=this.manager.aquireComponent(this.camera,s.Transform2D),i=this.manager.aquireComponent(this.camera,s.Camera2D),n=this.manager.aquireComponent(this.character,s.Transform2D).localPosition,o=this.tree.query(a.AABB.fromValues(n[0]-200,n[1]-200,n[0]+200,n[1]+200,t.tempAABB),t.tempList),c=a.vec2.copy(i.viewport,a.vec2()),l=a.vec2.copy(n,a.vec2()),u=0,h=0;h<o.length;h++){var f=o[h],d=p(f.aabb,n,800);d&&(u+=d,a.vec2.lerp(c,f.view,d/u,c),l[0]=a.lerp(l[0],null==f.lockX?l[0]:f.lockX,d/u),l[1]=a.lerp(l[1],null==f.lockY?l[1]:f.lockY,d/u))}o.length=0;var v=Math.max(0,1-u);a.vec2.lerp(l,n,v/1,l);var m=1-Math.pow(.9,30*e.deltaTime);i.viewport[0]===c[0]&&i.viewport[1]===c[1]||(a.vec2.lerp(i.viewport,c,m,i.viewport),i.lastFrame=-1),r.localPosition[0]===l[0]&&r.localPosition[1]===l[1]||(a.vec2.lerp(r.localPosition,l,m,r.localPosition),r.localPosition[0]=a.clamp(r.localPosition[0],n[0]-.5*i.viewport[0],n[0]+.5*i.viewport[0]),r.localPosition[1]=a.clamp(r.localPosition[1],n[1]-.5*i.viewport[1],n[1]+.5*i.viewport[1]),r.lastFrame=-1)}},t.tempAABB=a.AABB(),t.tempList=[],t}(o.ProcedureSystem);t.CameraSystem=h},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TransformUpdateSystem=void 0;var a=r(3),o=r(48),s=function(e){function t(t){var r=e.call(this,t)||this;return r.transforms=t.aquireDataView(o.Transform),r}return n(t,e),t.prototype.execute=function(e){for(var t=e.frame,r=this.transforms.data,i=void 0,n=0;i=r[n];n++)if(i.lastFrame!==t){var a=this.transforms.lookupIndex(i.parent,i.timeframe);if(a>n)r[n]=r[a-1],r[a-1]=i,this.transforms.updateIndex(i.entity,a),this.transforms.updateIndex(i.parent,n+1),n--;else{var o=a?r[a-1]:null;i.calculateTransform(o,t)}}},t}(a.ProcedureSystem);t.TransformUpdateSystem=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Behaviour=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.delegate=t,t}(r(3).ReusableComponent);t.Behaviour=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SceneUpdateSystem=void 0;var a=function(e){function t(t,r){var i=e.call(this,t)||this;return i.deferred=[],i.views=r.map((function(e){return t.aquireDataView(e)})),i}return n(t,e),t.prototype.execute=function(e){for(var t=0;t<this.views.length;t++)for(var r=this.views[t].data,i=0;i<r.length;i++)r[i].update(e,this.manager,this.deferred);var n=this.deferred.length;for(t=0;t<n;t++)this.deferred[t].call(this);this.deferred.length=0},t}(r(3).ProcedureSystem);t.SceneUpdateSystem=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.GroupComponent=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.references=[],t}return n(t,e),t.setup=function(t,r,i,n){t.manager=n,e.setup.call(this,t,r,i,n)},t.reset=function(t){for(var r=t.references.length-1;r>=0;r--)t.manager.removeEntity(t.references[r]);t.references.length=0,t.manager=null,e.reset.call(this,t)},t.prototype.createEntity=function(){var e=this.manager.createEntity();return this.references.push(e),e},t}(r(3).ReusableComponent);t.GroupComponent=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.TargetComponent=void 0;var a=r(0),o=r(6),s=r(17),c=r(22),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.relativePosition=a.vec2(),t}return n(t,e),t.prototype.setup=function(e,t){this.manager=t,this.target=e},t.prototype.calculatePosition=function(){var e=a.vec2.copy(a.vec2.ZERO,this.relativePosition),r=this.manager.aquireComponent(this.entity,c.Transform2D),i=this.manager.aquireComponent(this.target,c.Transform2D,this.timeframe);return i&&o.mat3x2.transform(e,i.globalTransform,e),r&&o.mat3x2.transform(e,o.mat3x2.invert(r.globalTransform,t.inverseTransform),e),e},t.prototype.reset=function(){this.manager=null,this.target=-1},t.inverseTransform=o.mat3x2(),t}(s.ReusableComponent);t.TargetComponent=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FrameSampler=t.KeyframeSampler=t.TweenSampler=t.StaticSampler=void 0;var i=r(5);t.StaticSampler=function(e){return function(){return e}},t.TweenSampler=function(e){return function(t,r,i){return function(n,a){return e(t,r,n=i?i(n):n,a)}}},t.KeyframeSampler=function(e){return function(t){t.sort((function(e,t){return e.time-t.time}));var r=t.length-1,i=0;return Object.assign((function(n,a){for(;i>=0&&i<r;)if(t[i].time>n)i--;else{if(!(t[i+1].time<n))break;i++}if(i<0)return t[0].value;if(i>=r)return t[r].value;var o=t[i],s=t[i+1],c=(n-o.time)/(s.time-o.time);return e(o.value,s.value,s.ease?s.ease(c):c,a)}),{duration:t[r].time,loop:!0})}},t.FrameSampler=function(e,t){return Object.assign((function(r,n){return e[i.clamp(r*t|0,0,e.length-1)]}),{duration:t&&e.length/t,loop:!0})}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationMixer=t.AnimationTrack=void 0;var a=r(21),o=r(27),s=r(5),c=r(3),l=function(e,t,r){return e===t?r<e?0:1:s.clamp((r-e)/(t-e),0,1)},u=function(){function e(){this.fadeIn=o.One,this.fadeOut=o.Zero,this.intensity=1,this.timeScale=1}return e.prototype.start=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.endTime=-1,this.elapsedTime=-e,this.fadeIn=l.bind(this,0,t),this.fadeOut=o.Zero,this},e.prototype.end=function(e,t){return void 0===e&&(e=0),void 0===t&&(t=0),this.alive?(this.endTime=this.elapsedTime+e,this.fadeOut=l.bind(this,this.endTime-t,this.endTime),this):this},Object.defineProperty(e.prototype,"alive",{get:function(){return-1==this.endTime||this.endTime>=this.elapsedTime},enumerable:!1,configurable:!0}),e}();t.AnimationTrack=u;var p=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transition=0,t.tracks=[],t}return n(t,e),t.prototype.setup=function(e){this.timelines=e,this.animations=Object.create(null);for(var t=0;t<this.timelines.length;t++){var r=this.timelines[t].samplers;for(var i in r){var n=this.animations[i]=this.animations[i]||{duration:0};n.duration=Math.max(n.duration,r[i].duration||0)}}},t.prototype.reset=function(){this.tracks.length=0,this.animations=this.timelines=null},t.prototype.createAnimation=function(e,r){var i=this.animations[e].duration,n=t.trackPool.aquire();return n.key=e,n.duration=i,n.intensity=1,n.start(0,this.transition),this.tracks.push(n),r&&n.end(i,this.transition),n},t.prototype.update=function(e,r,i){if(this.tracks.length){for(var n=this.tracks.length-1;n>=0;n--){var a=this.tracks[n];a.alive?(a.elapsedTime+=a.timeScale*e.deltaTime,a.weight=a.intensity*a.fadeIn(a.elapsedTime)*(1-a.fadeOut(a.elapsedTime))):(this.tracks.splice(n,1),a.callback&&(a.callback=void i.push(a.callback)),t.trackPool.recycle(a))}for(n=0;n<this.timelines.length;n++){for(var o=this.timelines[n],c=o.interpolate,l=o.samplers,u=o.initial,p=o.prev,h=o.next,f=null,d=0,v=0;v<this.tracks.length;v++){var m=this.tracks[v],y=m.key,g=m.elapsedTime,b=m.weight,_=l[y];if(_&&b){var P=_.loop?s.mod(Math.max(0,g),_.duration||0):g;d+=b,f=null==f?_.call(o,P,p):c(f,_.call(o,P,h),b/d,p)}}d?d<1&&(f=c(u,f,d,p)):f=u,o.set(f)}}},t.trackPool=new a.ObjectPool((function(e){return new u})),t}(c.ReusableComponent);t.AnimationMixer=p},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AreaSampler=void 0;var i=r(0),n=r(44),a=r(5),o=n.LCG(Date.now()),s=i.vec2();t.AreaSampler={static:function(e){return function(){return e}},range:function(e,t){return function(r,i){return function(){return e(r,i,a.randomFloat(0,1,o),t)}}},points:function(e){return function(){return e[a.randomInt(0,e.length-1,o)]}},aabb:function(e){return function(){return s[0]=a.randomFloat(e[0],e[2],o),s[1]=a.randomFloat(e[1],e[3],o),s}},circle:function(e,t,r){return function(){var i=r?a.randomFloat(r[0],r[1],o):a.randomFloat(0,2*Math.PI,o),n=a.randomFloat(t[0],t[1],o);return s[0]=e[0]+n*Math.cos(i),s[1]=e[1]+n*Math.sin(i),s}},closedPath:function(e){return function(){var t=a.randomInt(0,e.length-1,o),r=a.randomFloat(0,1,o),n=e[(t||e.length)-1],c=e[t];return i.vec2.lerp(n,c,r,s)}},compound:function(e){return function(){return e[a.randomInt(0,e.length-1,o)].call(this)}},targeted:function(e,t){return function(){i.vec2.copy(e.call(this),s),i.vec2.subtract(s,this.position,s);var r=i.vec2.rotation(s),n=a.randomFloat(t[0],t[1],o);return s[0]=n*Math.cos(r),s[1]=n*Math.sin(r),s}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.velocityRotation=t.verletIntegration=t.checkBounds=t.wrapParticle=t.clampParticle=void 0;var i=r(0),n=r(9),a=r(5);t.clampParticle=function(e){return function(t){var r=t.position;r[0]=a.clamp(r[0],e[0],e[2]),r[1]=a.clamp(r[1],e[1],e[3])}},t.wrapParticle=function(e){return function(t){var r=t.position;r[0]=a.mod(r[0]-e[0],e[2]-e[0])+e[0],r[1]=a.mod(r[1]-e[1],e[3]-e[1])+e[1]}},t.checkBounds=function(e){return function(t){n.AABB.includes(e,t.position)||(t.life=0)}},t.verletIntegration=function(e,t){e.rotation+=e.angularVelocity*t,e.velocity[0]+=e.acceleration[0]*t,e.velocity[1]+=e.acceleration[1]*t,e.friction&&i.vec2.scale(e.velocity,Math.min(1,Math.pow(e.friction,t)),e.velocity),e.position[0]+=e.velocity[0]*t,e.position[1]+=e.velocity[1]*t},t.velocityRotation=function(e){e.rotation=Math.atan2(e.velocity[1],e.velocity[0])}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ParticleEmitter=void 0;var a=r(21),o=r(3),s=r(70),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.particles=[],t.remainingTime=0,t}return n(t,e),t.prototype.setup=function(e){this.options=e,this.remainingTime=0},t.prototype.reset=function(){for(var e=this.particles.length-1;e>=0;e--)t.pool.recycle(this.particles[e]);this.particles.length=0,this.options=null},t.prototype.update=function(e,r){for(var i=this.options,n=i.updaters,a=i.timeScale,o=i.spawnRate,s=i.spawnAmount,c=e.deltaTime*a,l=0,u=this.particles.length,p=0;p<u;p++){var h=this.particles[p];h.life-=c/h.lifetime;for(var f=0;f<n.length&&h.life>0;f++)n[f](h,c);l&&(this.particles[p-l]=h),h.life>0||(t.pool.recycle(h.reset()),l++)}if(this.particles.length-=l,o>0)for(this.remainingTime-=c;this.remainingTime<-o;)this.remainingTime+=o,this.emitParticles(s,-this.remainingTime)},t.prototype.emitParticles=function(e,r){void 0===e&&(e=this.options.spawnAmount),void 0===r&&(r=0);for(var i=this.options,n=i.spawners,a=i.updaters,o=e;o>0;o--){for(var s=t.pool.aquire(),c=0;c<n.length;c++)n[c](s);s.life=1-r/s.lifetime;for(c=0;c<a.length&&s.life>0;c++)a[c](s,r);s.life>0?this.particles.push(s):t.pool.recycle(s.reset())}},t.delegate=t,t.pool=new a.ObjectPool((function(e){return new s.BillboardParticle})),t}(o.ReusableComponent);t.ParticleEmitter=c},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.QuadTree=void 0;var n=r(9),a=function(){function e(e,t){this.nodes=[],this.items=[],this.visited=[],this.count=0,this.options=i({capacity:8,depthLimit:4},t),this.stack=new Uint16Array(3*this.options.depthLimit),this.allocateNode(e[0],e[1],e[2],e[3],0)}return Object.defineProperty(e.prototype,"root",{get:function(){return this.nodes[0]},enumerable:!1,configurable:!0}),e.prototype.insert=function(e){var t=this.items.push(e)-1,r=0;for(this.stack[r++]=0;r;){var i=this.nodes[this.stack[--r]];if(-1==i.pointer){if(i.indices.length<this.options.capacity||i.depth>=this.options.depthLimit){i.indices.push(t);continue}this.split(i)}var n=this.computeQuadrant(i,e.aabb);8&n&&(this.stack[r++]=i.pointer+3),4&n&&(this.stack[r++]=i.pointer+2),2&n&&(this.stack[r++]=i.pointer+1),1&n&&(this.stack[r++]=i.pointer+0)}},e.prototype.remove=function(e){var t=this.items.indexOf(e);if(!~t){this.items.splice(t,1);for(var r=this.count-1;r>=0;r--){var i=this.nodes[r],n=i.pointer,a=i.indices;if(-1==n)for(var o=a.length-1;o>=0;o--)a[o]===t?a.splice(o,1):a[o]>t&&a[o]--}}},e.prototype.query=function(e,t){void 0===t&&(t=[]),this.visited.length=Math.max(this.visited.length,this.items.length);var r=0;for(this.stack[r++]=0;r;){var i=this.nodes[this.stack[--r]];if(-1==i.pointer)for(var a=i.indices.length-1;a>=0;a--){var o=i.indices[a];this.visited[o]||n.AABB.overlap(this.items[o].aabb,e)&&(this.visited[o]=!0,t.push(o))}else{var s=this.computeQuadrant(i,e);8&s&&(this.stack[r++]=i.pointer+3),4&s&&(this.stack[r++]=i.pointer+2),2&s&&(this.stack[r++]=i.pointer+1),1&s&&(this.stack[r++]=i.pointer+0)}}for(a=t.length-1;a>=0;a--){o=t[a];this.visited[o]=!1,t[a]=this.items[o]}return t},e.prototype.clear=function(){this.count=1,this.nodes[0].pointer=-1,this.items.length=0},e.prototype.allocateNode=function(e,t,r,i,a){if(this.nodes.length<=this.count)this.nodes.push({indices:[],pointer:-1,depth:a,bounds:n.AABB(e,t,r,i)});else{var o=this.nodes[this.count];n.AABB.fromValues(e,t,r,i,o.bounds),o.pointer=-1,o.depth=a,o.indices.length=0}return this.count++},e.prototype.split=function(e){var t=e.bounds[0],r=e.bounds[2],i=e.bounds[1],n=e.bounds[3],a=.5*(t+r),o=.5*(i+n),s=e.depth+1,c=e.pointer=this.allocateNode(a,i,r,o,s);this.allocateNode(t,i,a,o,s),this.allocateNode(a,o,r,n,s),this.allocateNode(t,o,a,n,s);for(var l=e.indices.length-1;l>=0;l--){var u=e.indices[l],p=this.items[u],h=this.computeQuadrant(e,p.aabb);1&h&&this.nodes[c+0].indices.push(u),2&h&&this.nodes[c+1].indices.push(u),4&h&&this.nodes[c+2].indices.push(u),8&h&&this.nodes[c+3].indices.push(u)}e.indices.length=0},e.prototype.computeQuadrant=function(e,t){var r=.5*(e.bounds[0]+e.bounds[2]),i=.5*(e.bounds[1]+e.bounds[3]),n=t[0]<=r?10:0,a=t[1]<=i?3:0,o=t[2]>r?5:0,s=t[3]>i?12:0;return o&a|n&a|o&s|n&s},e}();t.QuadTree=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RaycastController=void 0;var a=r(0),o=r(5),s=r(3),c=r(24),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.flags={left:null,right:null,below:null,pass:null,ground:null},t.slopeAngle=0,t.prevSlopeAngle=0,t.direction=a.vec2(1,-1),t.input=a.vec2(),t.offset=a.vec2(),t.center=a.vec2(),t.velocity=a.vec2(),t.prevVelocity=a.vec2(),t.tempVelocity=a.vec2(),t.threshold=.1,t.padding=.001,t.maxAscendAngle=.5*Math.PI,t.maxDescendAngle=.5*Math.PI,t.gravity=0,t.passGroup=!1,t}return n(t,e),t.prototype.setup=function(e,t){this.raycast=t.resolveSystem(c.PhysicsSystem).raycast({skipBackFaces:!0,skipNonColliders:!0,bailEarly:!1,collisionGroup:-1,collisionMask:e.collisionMask}),this.padding=e.padding,this.threshold=e.threshold,this.maxAscendAngle=e.maxAscendAngle,this.maxDescendAngle=e.maxDescendAngle,this.gravity=e.gravity,this.passGroup=e.passGroup,a.vec2.copy(e.offset||a.vec2.ZERO,this.offset),a.vec2.copy(a.vec2.ZERO,this.input)},t.prototype.update=function(e,r){var i=r.aquireComponent(this.entity,c.RigidBody);if(i){this.processInput(this.input,e.deltaTime),Math.abs(this.velocity[0])<t.epsilon&&(this.velocity[0]=0),this.velocity[1]+=e.deltaTime*this.gravity,a.vec2.scale(this.velocity,e.deltaTime,this.prevVelocity);for(var n=o.clamp(Math.ceil(Math.abs(this.prevVelocity[0])/this.threshold),1,8),s=n;s>0;s--){var l=a.vec2.scale(this.prevVelocity,1/n,this.tempVelocity),u=!!this.flags.below;this.flags.below=this.flags.left=this.flags.right=this.flags.ground=null,this.prevSlopeAngle=this.slopeAngle,this.slopeAngle=0,a.vec2.add(this.offset,i.position,this.center),this.resolveCollisions(l,u),a.vec2.add(i.position,l,i.position),a.vec2.copy(i.position,i.previousPosition)}i.dirtyFlag=!0,i.lastFrame=e.frame;var p=this.flags.below;p&&(this.velocity[1]=0),a.vec2.copy(p?this.flags.ground.velocity:a.vec2.ZERO,i.velocity)}},t.prototype.reset=function(){this.raycast=null},t.prototype.resolveCollisions=function(e,r){r&&Math.sin(this.prevSlopeAngle)*e[0]>0&&(e[1]+=Math.sin(this.prevSlopeAngle)*e[0],e[0]=Math.cos(this.prevSlopeAngle)*e[0]);var i=Math.sign(e[0])||this.direction[0],n=Math.sign(e[1])||this.direction[1];a.vec2.fromValues(i,n,this.direction);var o=t.origin,s=t.target,c=t.AXIS_Y;if(o[0]=this.center[0]-i*this.padding,o[1]=this.center[1],s[0]=o[0]+e[0]+2*i*this.padding,s[1]=o[1],(d=this.raycast(o,s)).body){var l=d.computeHitDistance(),u=a.vec2.angle(d.normal,c)*Math.sign(d.normal[0]);if(Math.abs(u)<=this.maxAscendAngle){var p=0;u!=this.prevSlopeAngle&&(p=l-2*this.padding,e[0]-=p*i);var h=Math.sin(u)*e[0];if(e[1]<h||h>0||(e[1]=h,e[0]=Math.cos(u)*e[0],this.flags.below=d.shape,this.flags.ground=d.body,this.slopeAngle=u),e[0]+=p*i,s[0]=o[0]+e[0]+2*i*this.padding,o[1]=s[1]=this.center[1]+e[1],(d=this.raycast(o,s)).body&&!(Math.abs(Math.abs(u)-a.vec2.angle(d.normal,c))<.001)){var f=d.computeHitDistance();Math.abs(e[0])>Math.abs(f-2*this.padding)&&(e[0]=(f-2*this.padding)*i)}}else e[0]=(l-2*this.padding)*i,-1==i?this.flags.left=d.shape:this.flags.right=d.shape}if(o[0]=this.center[0]+e[0]+i*this.padding,o[1]=this.center[1],s[0]=o[0]-2*i*this.padding,s[1]=o[1],(d=this.raycast(o,s)).body){l=d.computeHitDistance();e[0]+=(2*this.padding-l)*i,-1!=i?this.flags.left=d.shape:this.flags.right=d.shape}this.flags.pass&&(this.flags.pass.collisionResponse=!0);e:{var d;if(Math.abs(this.prevSlopeAngle)>this.maxDescendAngle&&(i=-Math.sign(this.prevSlopeAngle)),o[0]=this.center[0]+e[0],o[1]=this.center[1]-this.padding,s[0]=o[0],s[1]=o[1]+1e6,(d=this.raycast(o,s)).body){l=d.computeHitDistance(),u=a.vec2.angle(d.normal,c)*Math.sign(d.normal[0]);var v=l-2*this.padding;if(e[1]>v){if(n<0)break e;if(this.slopeAngle=u,e[1]=l-2*this.padding,Math.abs(u)>this.maxDescendAngle)break e;this.flags.below=d.shape,this.flags.ground=d.body}else if(r&&v-e[1]<this.threshold){if(this.flags.ground&&e[1]<0)break e;if(Math.abs(u)>this.maxDescendAngle)break e;this.slopeAngle=u,e[1]=l-2*this.padding,this.flags.below=d.shape,this.flags.ground=d.body}}}if(this.flags.pass&&this.flags.below===this.flags.pass?this.flags.pass.collisionResponse=!1:this.flags.below&&this.input[1]>0&&!this.flags.pass?(this.flags.pass=this.flags.below,this.flags.pass.collisionResponse=!1):this.flags.pass&&(this.flags.pass=null),this.flags.pass)if(!(d=this.raycast(o,s)).body||this.passGroup&&d.body===this.flags.ground||d.shape&&4!=d.shape.type)this.flags.pass.collisionResponse=!0,this.flags.pass=null;else{l=d.computeHitDistance(),u=a.vec2.angle(d.normal,c)*Math.sign(d.normal[0]);(v=l-2*this.padding)-Math.abs(e[1])<4*this.threshold&&Math.abs(u)<=this.maxDescendAngle?(e[1]=(l-2*this.padding)*n,this.flags.below=d.shape,this.flags.ground=d.body,this.slopeAngle=u):(this.flags.pass.collisionResponse=!0,this.flags.pass=null)}},t.delegate=t,t.epsilon=1e-4,t.origin=a.vec2(),t.target=a.vec2(),t.AXIS_Y=a.vec2(0,-1),t}(s.ReusableComponent);t.RaycastController=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hitTestBox=void 0,t.hitTestBox=function(e,t){return Math.abs(t[0])<.5*e.width&&Math.abs(t[1])<.5*e.height}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hitTestCircle=void 0;var i=r(0);t.hitTestCircle=function(e,t){return i.vec2.magnitude(t)<=e.radius*e.radius}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.hitTestConvex=void 0;var i=r(0),n=r(50);t.hitTestConvex=function(e,t){for(var r=0,a=0,o=e.vertices.length-1;o>=0;a=o--){var s=e.vertices[o],c=e.vertices[a],l=i.vec2.cross(i.vec2.subtract(s,t,n.Convex.temp0),i.vec2.subtract(c,t,n.Convex.temp1));if(r*l<0)return!1;r+=l}return!0}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Narrowphase=void 0;var i=r(0),n=r(75),a=function(){function e(e){this.detectors=e,this.worldPositionA=i.vec2(),this.worldPositionB=i.vec2(),this.normalA=i.vec2(),this.contactPointA=i.vec2(),this.contactPointB=i.vec2(),this.contactManifold=new n.ContactManifold}return e.prototype.registerContactManifold=function(e,t,r,i){this.contactManifold.registerContact(e,t,r,i,this.normalA,this.contactPointA,this.contactPointB)},e.prototype.detectCollision=function(e,t,r,n){void 0===r&&(r=!1);for(var a=this.worldPositionA,o=this.worldPositionB,s=0,c=0;c<e.shapes.length;c++)for(var l=e.shapes[c],u=0;u<t.shapes.length;u++){var p=t.shapes[u];if(l.collisionGroup&p.collisionMask&&p.collisionGroup&l.collisionMask&&(i.vec2.rotate(l.position,e.angle,a),i.vec2.add(a,e.position,a),i.vec2.rotate(p.position,t.angle,o),i.vec2.add(o,t.position,o),!(i.vec2.distanceSquared(a,o)>Math.pow(l.boundingRadius+p.boundingRadius,2)))){var h=l.angle+e.angle,f=p.angle+t.angle,d=l.sensor||p.sensor,v=this.detectors[l.type|p.type];if(v){this.contactManifold.contacts=0;var m=l.type>p.type?v.call(this,t,p,o,f,e,l,a,h,r||d):v.call(this,e,l,a,h,t,p,o,f,r||d);if(m&&r)return 1;if(s+=m,m&&!d&&n&&0==n(this.contactManifold))return s}}}return s},e}();t.Narrowphase=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testCircleVsCircle=void 0;var i=r(0);t.testCircleVsCircle=function(e,t,r,n,a,o,s,c,l){var u=this.contactPointA,p=this.contactPointB,h=this.normalA,f=t.radius,d=o.radius;return i.vec2.subtract(s,r,h),i.vec2.magnitudeSquared(h)>Math.pow(f+d,2)?0:(l||(i.vec2.normalize(h,h),i.vec2.scale(h,f,u),i.vec2.add(r,u,u),i.vec2.scale(h,-d,p),i.vec2.add(s,p,p),this.registerContactManifold(e,t,a,o)),1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testCircleVsConvex=void 0;var i=r(0),n=i.vec2(),a=i.vec2(),o=i.vec2(),s=i.vec2();t.testCircleVsConvex=function(e,t,r,c,l,u,p,h,f){var d=this.contactPointA,v=this.contactPointB,m=this.normalA,y=t.radius+0,g=i.vec2.subtract(r,p,n);i.vec2.rotate(g,-h,g);for(var b,_=-1/0,P=u.vertices.length-1;P>=0;P--){var S=i.vec2.subtract(g,u.vertices[P],a),x=i.vec2.dot(u.normals[P],S);if(x>y)return 0;x<=_||(_=x,b=P)}var A=u.normals[b],O=u.vertices[b++],w=u.vertices[b%u.vertices.length];if(!(_<0)){var M=i.vec2.subtract(g,O,a),T=i.vec2.subtract(g,w,o),E=i.vec2.subtract(w,O,s),C=i.vec2.dot(M,E),B=-i.vec2.dot(T,E);if(!(C>0&&B>0))return C<=0&&i.vec2.magnitudeSquared(M)>y*y||B<=0&&i.vec2.magnitudeSquared(T)>y*y?0:(f||(i.vec2.rotate(C<=0?O:w,h,v),i.vec2.add(p,v,v),i.vec2.subtract(v,r,m),i.vec2.normalize(m,m),i.vec2.scale(m,t.radius,d),i.vec2.add(r,d,d),this.registerContactManifold(e,t,l,u)),1)}if(f)return 1;var I=i.vec2.scale(A,-t.radius,a);i.vec2.add(g,I,I),i.vec2.subtract(O,I,I);var j=i.vec2.dot(A,I);return i.vec2.scale(A,-1,m),i.vec2.rotate(m,h,m),i.vec2.scale(m,t.radius,d),i.vec2.add(r,d,d),i.vec2.scale(m,-j,v),i.vec2.add(d,v,v),this.registerContactManifold(e,t,l,u),1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testCircleVsLine=void 0;var i=r(0),n=i.vec2(),a=i.vec2(0,-1);t.testCircleVsLine=function(e,t,r,o,s,c,l,u,p){var h=this.contactPointA,f=this.contactPointB,d=this.normalA,v=i.vec2.subtract(r,l,n);i.vec2.rotate(v,-u,v);var m=.5*c.length,y=t.radius+c.radius,g=i.vec2.dot(v,a);if(Math.abs(g)>=y)return 0;var b=i.vec2.dot(v,i.vec2.AXIS_X);if(Math.abs(b)>=y+m)return 0;if(Math.abs(b)<m)return p||(i.vec2.rotate(a,u,d),g>=0&&i.vec2.scale(d,-1,d),i.vec2.scale(d,t.radius,h),i.vec2.add(r,h,h),i.vec2.scale(d,Math.abs(g)-c.radius,f),i.vec2.add(r,f,f),this.registerContactManifold(e,t,s,c)),1;i.vec2.fromValues(b>0?m:-m,0,d),i.vec2.subtract(d,v,d);var _=i.vec2.magnitudeSquared(d);return _>y*y?0:(p||(i.vec2.rotate(d,u,d),i.vec2.normalize(d,d),i.vec2.scale(d,t.radius,h),i.vec2.add(r,h,h),i.vec2.scale(d,Math.sqrt(_)-c.radius,f),i.vec2.add(r,f,f),this.registerContactManifold(e,t,s,c)),1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testConvexVsConvex=void 0;var i=r(0),n=r(62),a=r(6),o=function(e,t,r,i,n){var a=Math.cos(-i),o=Math.sin(-i),s=t-i,c=Math.cos(s),l=Math.sin(s),u=e[0]-r[0],p=e[1]-r[1];return n[0]=c,n[1]=l,n[2]=-l,n[3]=c,n[4]=a*u-o*p,n[5]=o*u+a*p,n};function s(e,t,r,n){var a=0,o=i.vec2.dot(t,e[0])-r,s=i.vec2.dot(t,e[1])-r;if(o<=0&&i.vec2.copy(e[0],n[a++]),s<=0&&i.vec2.copy(e[1],n[a++]),o*s<0){var c=n[a++];i.vec2.subtract(e[1],e[0],c),i.vec2.scale(c,o/(o-s),c),i.vec2.add(e[0],c,c)}return a}var c=[i.vec2(),i.vec2()],l=[i.vec2(),i.vec2()],u=a.mat3x2(),p=a.mat3x2(),h=i.vec2(),f=i.vec2(),d=i.vec2(),v=i.vec2(),m=i.vec2();function y(e,t,r,o,s){for(var c,l=-1/0,u=e.length-1;u>=0;u--){for(var p=n.mat2.transform(t[u],r,d),h=a.mat3x2.transform(e[u],r,v),f=1/0,y=o.length-1;y>=0;y--){var g=i.vec2.subtract(o[y],h,m),b=i.vec2.dot(g,p);b<f&&(f=b)}f<=l||(l=f,c=u)}return i.vec2.fromValues(c,l,s)}t.testConvexVsConvex=function(e,t,r,g,b,_,P,S,x){var A=0,O=o(r,g,P,S,u),w=y(t.vertices,t.normals,O,_.vertices,h);if(w[1]>A)return 0;var M=o(P,S,r,g,p),T=y(_.vertices,_.normals,M,t.vertices,f);if(T[1]>A)return 0;T[1]>w[1]&&(e=arguments[4],t=arguments[5],r=arguments[6],g=arguments[7],b=arguments[0],_=arguments[1],P=arguments[2],S=arguments[3],w=T,O=M);for(var E=n.mat2.transform(t.normals[w[0]],O,d),C=void 0,B=1/0,I=_.vertices.length-1;I>=0;I--){(z=i.vec2.dot(E,_.normals[I]))>=B||(B=z,C=I)}i.vec2.copy(_.vertices[C++],c[0]),i.vec2.copy(_.vertices[C%_.vertices.length],c[1]);var j=i.vec2.copy(_.normals[w[0]],d),D=t.vertices[w[0]++],q=t.vertices[w[0]%t.vertices.length];n.mat2.transform(j,O,j);var F=i.vec2.rotate90ccw(j,v);a.mat3x2.transform(D,O,m);var R=i.vec2.dot(j,m),k=-i.vec2.dot(F,m)+A;a.mat3x2.transform(q,O,m);var V=i.vec2.dot(F,m)+A,L=i.vec2.scale(F,-1,m);if(s(c,L,k,l)<2)return 0;if(s(l,F,V,c)<2)return 0;var N=0;for(I=0;I<2;I++){var z;if(!((z=i.vec2.dot(j,c[I])-R)>A)){if(x)return 1;N++;var G=this,K=G.contactPointA,U=G.contactPointB;E=G.normalA;i.vec2.rotate(j,S,E),i.vec2.rotate(c[I],S,U),i.vec2.add(P,U,U),i.vec2.scale(E,-z,K),i.vec2.add(U,K,K),this.registerContactManifold(e,t,b,_)}}return N}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testParticleVsCircle=void 0;var i=r(0);t.testParticleVsCircle=function(e,t,r,n,a,o,s,c,l){var u=this.contactPointA,p=this.contactPointB,h=this.normalA,f=o.radius+0;return i.vec2.subtract(s,r,h),i.vec2.magnitudeSquared(h)>f*f?0:(l||(i.vec2.normalize(h,h),i.vec2.copy(r,u),i.vec2.scale(h,-f,p),i.vec2.add(s,p,p),this.registerContactManifold(e,t,a,o)),1)}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testParticleVsConvex=void 0;var i=r(0),n=i.vec2(),a=i.vec2();t.testParticleVsConvex=function(e,t,r,o,s,c,l,u,p){var h=this.contactPointA,f=this.contactPointB,d=this.normalA,v=i.vec2.subtract(r,l,n);i.vec2.rotate(v,-u,v);for(var m,y=-1/0,g=c.vertices.length-1;g>=0;g--){var b=i.vec2.subtract(v,c.vertices[g],a),_=i.vec2.dot(c.normals[g],b);if(_>0)return 0;_<=y||(y=_,m=g)}return p||(i.vec2.scale(c.normals[m],-1,d),i.vec2.rotate(d,u,d),i.vec2.copy(r,h),i.vec2.scale(d,y,f),i.vec2.add(h,f,f),this.registerContactManifold(e,t,s,c)),1}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Raycaster=void 0;var i=r(0),n=r(77),a=function(){function e(e){this.detectors=e,this.intersectionPoint=i.vec2(),this.intersectionNormal=i.vec2(),this.fraction=-1,this.ray=new n.Ray,this.skipBackFaces=!0,this.skipNonColliders=!0,this.bailEarly=!1,this.collisionGroup=-1,this.collisionMask=-1,this.body=null,this.shape=null,this.normal=i.vec2()}return e.prototype.reportIntersection=function(e,t,r,n){return!(this.skipBackFaces&&i.vec2.dot(this.intersectionNormal,this.ray.direction)>0)&&(!(this.fraction>=0&&this.fraction<r)&&(!(this.consumer&&!this.consumer(e,t))&&(this.fraction=r,this.body=e,this.shape=t,i.vec2.copy(this.intersectionNormal,this.normal),this.bailEarly)))},e.prototype.raycast=function(t,r){this.consumer=r;var a=n.testRayAABB(this.ray,t.aabb);if(!(a<0||a>1)&&(!this.skipNonColliders||t.collisionResponse)){for(var o=t.shapes.length,s=0;s<o;s++){var c=t.shapes[s];if((!this.skipNonColliders||c.collisionResponse)&&this.collisionGroup&c.collisionMask|c.collisionGroup&this.collisionMask){var l=i.vec2.rotate(c.position,t.angle,e.temp0);i.vec2.add(t.position,l,l);var u=t.angle+c.angle;if(n.testRayBoundingRadius(this.ray,l,c.boundingRadius)){var p=this.detectors[c.type];if(p&&p.call(this,this.ray,t,c,l,u),this.fraction>=0&&this.bailEarly)return 0}}}return this.fraction}},e.prototype.reset=function(){this.fraction=-1,this.body=null,this.shape=null},e.prototype.computeHitDistance=function(){return this.ray.length*this.fraction},e.prototype.computeHitPoint=function(e){return i.vec2.lerp(this.ray.origin,this.ray.target,this.fraction,e)},e.temp0=i.vec2(),e}();t.Raycaster=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testRayCircle=void 0;var i=r(0);t.testRayCircle=function(e,t,r,n,a){var o=e.origin,s=e.target,c=s[0]-o[0],l=s[1]-o[1],u=o[0]-n[0],p=o[1]-n[1],h=c*c+l*l,f=2*(c*u+l*p),d=f*f-4*h*(u*u+p*p-r.radius*r.radius);if(!(d<0)){if(0==d)return i.vec2.lerp(o,s,d,this.intersectionPoint),i.vec2.subtract(this.intersectionPoint,n,this.intersectionNormal),i.vec2.normalize(this.intersectionNormal,this.intersectionNormal),void this.reportIntersection(t,r,d,-1);var v=Math.sqrt(d),m=1/(2*h),y=(-f-v)*m,g=(-f+v)*m;y>=0&&y<=1&&(i.vec2.lerp(o,s,y,this.intersectionPoint),i.vec2.subtract(this.intersectionPoint,n,this.intersectionNormal),i.vec2.normalize(this.intersectionNormal,this.intersectionNormal),this.reportIntersection(t,r,y,-1))||g>=0&&g<=1&&(i.vec2.lerp(o,s,g,this.intersectionPoint),i.vec2.subtract(this.intersectionPoint,n,this.intersectionNormal),i.vec2.normalize(this.intersectionNormal,this.intersectionNormal),this.reportIntersection(t,r,g,-1))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testRayConvex=void 0;var i=r(0),n=r(20),a=i.vec2(),o=i.vec2();t.testRayConvex=function(e,t,r,s,c){var l=i.vec2.subtract(e.origin,s,a),u=i.vec2.subtract(e.target,s,o);i.vec2.rotate(l,-c,l),i.vec2.rotate(u,-c,u);for(var p=0,h=r.vertices.length-1;h>=0;p=h--){var f=r.vertices[h],d=r.vertices[p],v=n.lineIntersectionFraction(l,u,f,d);if(!(v<0)&&(i.vec2.rotate(r.normals[h],c,this.intersectionNormal),this.reportIntersection(t,r,v,h)))return}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.testRayLine=void 0;var i=r(0),n=r(20),a=i.vec2(),o=i.vec2();t.testRayLine=function(e,t,r,s,c){var l=e.origin,u=e.target,p=.5*r.length,h=Math.cos(c),f=Math.sin(c);a[0]=-h*p+s[0],a[1]=-f*p+s[1],o[0]=h*p+s[0],o[1]=f*p+s[1];var d=n.lineIntersectionFraction(l,u,a,o);d<0||(i.vec2.rotate(i.vec2.AXIS_Y,c,this.intersectionNormal),this.reportIntersection(t,r,d,-1))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IndexedDataArray=void 0;var i=r(31),n=function(){function e(){this.insertEvent=new i.Stream,this.removeEvent=new i.Stream,this.pool=[],this.sparseIndex=0,this.internal=[]}return Object.defineProperty(e.prototype,"length",{get:function(){return this.internal.length},enumerable:!1,configurable:!0}),e.prototype.get=function(e){return this.internal[e-1]},e.prototype.insert=function(e,t,r,i){var n=this.internal.push(e);return e.index=n-1,e.identifier=this.pool.pop()||++this.sparseIndex,this.insertEvent.dispatch(e),n},e.prototype.remove=function(e,t,r,i){var n=this.internal[e-1];if(e===this.internal.length)this.internal.length--;else{var a=this.internal.pop();this.internal[e-1]=a,a.index=e-1;var o=a.entity;o&&(i.pointers[t+i.segments*--o]=e)}return this.removeEvent.dispatch(n),n.index=-1,this.pool.push(n.identifier),n.identifier=-1,n},e}();t.IndexedDataArray=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Constraint=void 0;var i=function(e,t){this.bodyA=e,this.bodyB=t,this.equations=[],this.collideConnected=!0};t.Constraint=i},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(29),t),n(r(136),t),n(r(137),t),n(r(138),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Gravity=void 0;var a=r(0),o=function(e){function t(t){void 0===t&&(t=a.vec2(0,-9.78));var r=e.call(this)||this;return r.gravity=t,r.frictionGravity=a.vec2.magnitude(r.gravity),r}return n(t,e),t.prototype.apply=function(e,r){for(var i=t.temp,n=e.length-1;n>=0;n--){var o=e[n];1===o.type&&1!==o.sleepState&&(a.vec2.scale(this.gravity,o.mass,i),a.vec2.add(i,o.force,o.force))}},t.temp=a.vec2(),t}(r(29).ForceGenerator);t.Gravity=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.LinearSpring=void 0;var a=r(0),o=function(e){function t(t,r){var i=e.call(this)||this;return i.bodyA=t,i.bodyB=r,i.stiffness=100,i.damping=1,i.restingLength=0,i.localAnchorA=a.vec2(),i.localAnchorB=a.vec2(),i.worldAnchorA=a.vec2(),i.worldAnchorB=a.vec2(),i.orientedAnchorA=a.vec2(),i.orientedAnchorB=a.vec2(),i.computeWorldAnchors(),i.restingLength=a.vec2.distance(i.worldAnchorA,i.worldAnchorB),i}return n(t,e),t.prototype.computeWorldAnchors=function(){a.vec2.rotate(this.localAnchorA,this.bodyA.angle,this.orientedAnchorA),a.vec2.rotate(this.localAnchorB,this.bodyB.angle,this.orientedAnchorB),a.vec2.add(this.orientedAnchorA,this.bodyA.position,this.worldAnchorA),a.vec2.add(this.orientedAnchorB,this.bodyB.position,this.worldAnchorB)},t.prototype.apply=function(){var e=t.difference,r=t.direction,i=t.relativeVelocity,n=t.force,o=t.temp,s=this.stiffness,c=this.damping,l=this.restingLength;this.computeWorldAnchors(),a.vec2.subtract(this.worldAnchorB,this.worldAnchorA,e);a.vec2.magnitude(e);a.vec2.normalize(e,r),a.vec2.subtract(this.bodyB.velocity,this.bodyA.velocity,i),a.vec2.rotate(this.orientedAnchorB,.5*Math.PI,o),a.vec2.scale(o,this.bodyB.angularVelocity,o),a.vec2.add(i,o,i),a.vec2.rotate(this.orientedAnchorA,.5*Math.PI,o),a.vec2.scale(o,this.bodyA.angularVelocity,o),a.vec2.subtract(i,o,i),a.vec2.scale(r,-s*(length-l)-c*a.vec2.dot(i,r),n),a.vec2.subtract(this.bodyA.force,n,this.bodyA.force),a.vec2.add(this.bodyB.force,n,this.bodyB.force),this.bodyA.angularForce-=a.vec2.cross(this.orientedAnchorA,n),this.bodyB.angularForce+=a.vec2.cross(this.orientedAnchorB,n)},t.difference=a.vec2(),t.direction=a.vec2(),t.temp=a.vec2(),t.relativeVelocity=a.vec2(),t.force=a.vec2(),t}(r(29).ForceGenerator);t.LinearSpring=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RotationalSpring=void 0;var a=function(e){function t(t,r){var i=e.call(this)||this;return i.bodyA=t,i.bodyB=r,i.stiffness=100,i.damping=1,i.restingAngle=0,i.restingAngle=i.bodyB.angle-i.bodyA.angle,i}return n(t,e),t.prototype.apply=function(){var e=this.stiffness,t=this.damping,r=this.restingAngle,i=this.bodyB.angularVelocity-this.bodyA.angularVelocity,n=-e*(this.bodyB.angle-this.bodyA.angle-r)-t*i;this.bodyA.angularForce-=n,this.bodyB.angularForce+=n},t}(r(29).ForceGenerator);t.RotationalSpring=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(25),t),n(r(141),t),n(r(142),t),n(r(143),t),n(r(144),t),n(r(50),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Particle=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.computeMomentOfInertia=function(){return 0},t.prototype.computeBoundingRadius=function(){return 0},t.prototype.computeArea=function(){return 0},t.prototype.computeAABB=function(e,t,r){return r[0]=r[2]=e[0],r[1]=r[3]=e[1],r},t}(r(25).Shape);t.Particle=a,a.prototype.type=1},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Line=void 0;var a=function(e){function t(t,r,i,n){void 0===i&&(i=0);var a=e.call(this,t,r,n)||this;return a.length=i,a.radius=0,a}return n(t,e),t.prototype.computeMomentOfInertia=function(){return this.length*this.length/12},t.prototype.computeBoundingRadius=function(){return.5*this.length},t.prototype.computeArea=function(){return 0},t.prototype.computeAABB=function(e,t,r){var i=.5*this.length,n=i*Math.abs(Math.cos(t)),a=i*Math.abs(Math.sin(t));return r[0]=e[0]-n-this.radius,r[1]=e[1]-a-this.radius,r[2]=e[0]+n+this.radius,r[3]=e[1]+a+this.radius,r},t}(r(25).Shape);t.Line=a,a.prototype.type=4},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Circle=void 0;var a=function(e){function t(t,r,i,n){void 0===i&&(i=0);var a=e.call(this,t,r,n)||this;return a.radius=i,a}return n(t,e),t.prototype.computeMomentOfInertia=function(){return.5*this.radius*this.radius},t.prototype.computeBoundingRadius=function(){return this.radius},t.prototype.computeArea=function(){return Math.PI*this.radius*this.radius},t.prototype.computeAABB=function(e,t,r){var i=this.radius;return r[0]=e[0]-i,r[1]=e[1]-i,r[2]=e[0]+i,r[3]=e[1]+i,r},t}(r(25).Shape);t.Circle=a,a.prototype.type=2},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Box=void 0;var a=r(0),o=function(e){function t(r,i,n,o,s){var c=e.call(this,r,i,s)||this;c.width=n,c.height=o,c.vertices=[a.vec2(),a.vec2(),a.vec2(),a.vec2()],c.normals=t.QUAD_NORMALS;var l=.5*n,u=.5*o;return a.vec2.fromValues(-l,-u,c.vertices[0]),a.vec2.fromValues(+l,-u,c.vertices[1]),a.vec2.fromValues(+l,+u,c.vertices[2]),a.vec2.fromValues(-l,+u,c.vertices[3]),c}return n(t,e),t.prototype.computeMomentOfInertia=function(){return(this.width*this.width+this.height*this.height)/12},t.prototype.computeBoundingRadius=function(){return.5*Math.sqrt(this.width*this.width+this.height*this.height)},t.prototype.computeArea=function(){return this.width*this.height},t.prototype.computeAABB=function(e,t,r){var i=Math.abs(Math.cos(t)),n=Math.abs(Math.sin(t)),a=.5*this.width,o=.5*this.height,s=a*i+o*n,c=a*n+o*i;return r[0]=e[0]-s,r[1]=e[1]-c,r[2]=e[0]+s,r[3]=e[1]+c,r},t.QUAD_NORMALS=[a.vec2(0,-1),a.vec2(1,0),a.vec2(0,1),a.vec2(-1,0)],t}(r(25).Shape);t.Box=o,o.prototype.type=8},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EquationFactory=void 0;var i=r(0),n=r(21),a=r(49),o=r(146),s=r(147),c=function(){function e(){this.contactEquationPool=new n.ObjectPool((function(e){return new o.ContactEquation(null,null)})),this.frictionEquationPool=new n.ObjectPool((function(e){return new s.FrictionEquation(null,null)})),this.collisions=new a.Int16TupleMap,this.contactEquations=[],this.frictionEquations=[],this.frictionApproximation=!0,this.equations=[]}return e.prototype.loadEquations=function(e){for(var t=e.length,r=0;r<t;r++){var i=e[r];i.enabled&&this.equations.push(i)}},e.prototype.processContactManifold=function(e,t){for(var r=e.bodyA,n=e.shapeA,a=e.bodyB,o=e.shapeB,s=e.contacts,c=e.normalA,l=e.contactPointA,u=e.contactPointB,p=t.findContactMaterial(n.material,o.material),h=0;h<s;h++){var f=this.createContactEquation(r,n,a,o,p);i.vec2.copy(c[h],f.normalA),i.vec2.copy(l[h],f.contactPointA),i.vec2.copy(u[h],f.contactPointB),this.contactEquations.push(f)}if(this.frictionApproximation)this.frictionEquations.push(this.createFrictionEquation(0,s,1,p));else for(var d=0;d<s;d++)this.frictionEquations.push(this.createFrictionEquation(d,1,s,p))},e.prototype.clear=function(){this.collisions.clear();for(var e=this.frictionEquations.length-1;e>=0;e--)this.frictionEquationPool.recycle(this.frictionEquations[e]);for(e=this.contactEquations.length-1;e>=0;e--){var t=this.contactEquations[e];t.enabled&&this.collisions.set(t.bodyA.identifier,t.bodyB.identifier,!0),this.contactEquationPool.recycle(t)}this.frictionEquations.length=0,this.contactEquations.length=0,this.equations.length=0},e.prototype.createContactEquation=function(e,t,r,i,n){var a=this.contactEquationPool.aquire();return a.bodyA=e,a.bodyB=r,a.shapeA=t,a.shapeB=i,a.enabled=e.collisionResponse&&r.collisionResponse&&t.collisionResponse&&i.collisionResponse,a.firstImpact=!this.collisions.get(e.identifier,r.identifier),a.restitution=n.restitution,a.stiffness=n.stiffness,a.relaxation=n.relaxation,a.offset=n.contactSkinSize,a.dirtyFlag=!0,a},e.prototype.createFrictionEquation=function(e,t,r,n){var a=this.contactEquations.length-1-e,o=this.contactEquations[a],s=o.bodyA,c=o.bodyB,l=o.shapeA,u=o.shapeB,p=this.frictionEquationPool.aquire();p.bodyA=s,p.bodyB=c,p.enabled=s.collisionResponse&&c.collisionResponse&&l.collisionResponse&&u.collisionResponse,p.frictionCoefficient=n.friction,p.relativeVelocity=n.surfaceVelocity,p.stiffness=n.frictionStiffness,p.relaxation=n.frictionRelaxation,p.dirtyFlag=!0;var h=1===s.type&&1===c.type?s.mass*c.mass/(s.mass+c.mass):Math.min(s.mass,c.mass);p.slipForce=n.friction*h*n.frictionGravity/r;var f=p.contactPointA,d=p.contactPointB,v=p.tangent;if(p.contactEquations.length=0,p.contactEquations.push(o),i.vec2.copy(o.normalA,v),i.vec2.copy(o.contactPointA,f),i.vec2.copy(o.contactPointB,d),1==t)return i.vec2.rotate90cw(v,v),p;for(var m=1;m<t;m++)o=this.contactEquations[--a],p.contactEquations.push(o),i.vec2.add(o.normalA,v,v),i.vec2.add(o.contactPointA,f,f),i.vec2.add(o.contactPointB,d,d);return i.vec2.normalize(v,v),i.vec2.rotate90cw(v,v),i.vec2.scale(f,1/t,f),i.vec2.scale(d,1/t,d),p},e}();t.EquationFactory=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ContactEquation=void 0;var a=r(0),o=function(e){function t(t,r){var i=e.call(this,t,r)||this;return i.contactPointA=a.vec2(),i.contactPointB=a.vec2(),i.penetration=a.vec2(),i.normalA=a.vec2(),i.restitution=0,i.firstImpact=!1,i.shapeA=null,i.shapeB=null,i.minForce=0,i}return n(t,e),t.prototype.computeB=function(e,t,r){var i=this.G,n=this.normalA,o=this.contactPointA,s=this.contactPointB;i[0]=-n[0],i[1]=-n[1],i[2]=-a.vec2.cross(o,n),i[3]=n[0],i[4]=n[1],i[5]=a.vec2.cross(s,n);var c=0,l=this.computeGW();if(this.firstImpact&&0!==this.restitution)l*=(1+this.restitution)/t;else{var u=this.bodyA.position,p=this.bodyB.position;this.penetration[0]=p[0]+s[0]-u[0]-o[0],this.penetration[1]=p[1]+s[1]-u[1]-o[1],c=a.vec2.dot(n,this.penetration)+this.offset}return-c*e-l*t-this.computeGiMf()*r},t}(r(82).Equation);t.ContactEquation=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.FrictionEquation=void 0;var a=r(0),o=function(e){function t(t,r,i){var n=e.call(this,t,r)||this;return n.contactPointA=a.vec2(),n.contactPointB=a.vec2(),n.tangent=a.vec2(),n.contactEquations=[],n.frictionCoefficient=.3,Object.assign(n,i),n}return n(t,e),Object.defineProperty(t.prototype,"slipForce",{get:function(){return this.maxForce},set:function(e){this.maxForce=e,this.minForce=-e},enumerable:!1,configurable:!0}),t.prototype.computeB=function(e,t,r){var i=this.G,n=this.contactPointA,o=this.contactPointB,s=this.tangent;return i[0]=-s[0],i[1]=-s[1],i[2]=-a.vec2.cross(n,s),i[3]=s[0],i[4]=s[1],i[5]=a.vec2.cross(o,s),-this.computeGW()*t-this.computeGiMf()*r},t}(r(82).Equation);t.FrictionEquation=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.CharacterSystem=void 0;var o=r(1),s=r(3),c=r(2),l=r(15),u=r(4),p=r(24),h=r(8),f=r(54),d=r(37),v=r(71),m=r(7),y=r(181),g=r(55),b=r(12),_=r(207),P=function(e){function t(t){var r=e.call(this,t)||this;r.priority=-32,r.hold=!1,r.sounds={steps:null,land:null},r.character=r.manager.createEntity(),r.manager.createComponent(r.character,c.Transform2D,{position:[0,0]}),r.manager.createComponent(r.character,u.Material,{program:0,color:o.rgba.WHITE,blend:1,texture:"satellite/frame0000.png"}),r.manager.createComponent(r.character,u.Sprite2D,{order:2,origin:[.5,.5]}),r.manager.createComponent(r.character,p.RigidBody,{mass:1,type:2,shapes:[new p.Box(o.vec2(0,0),0,80,200,{collisionGroup:2})]}),r.sounds.steps=r.manager.createEntity(),r.manager.createComponent(r.sounds.steps,c.Transform2D,{parent:r.character}),r.manager.createComponent(r.sounds.steps,h.AudioSource,{clip:"sfx/steps.mp3",loop:!0,volume:1,rate:1,channel:r.manager.resolveSystem(b.SoundscapeSystem).sfx}),r.manager.createComponent(r.sounds.steps,h.SpatialAudio,{offset:o.vec3(0,0,0),radius:256}),r.sounds.land=r.manager.createEntity(),r.manager.createComponent(r.sounds.land,c.Transform2D,{parent:r.character}),r.manager.createComponent(r.sounds.land,h.AudioSource,{clip:"sfx/land.mp3",loop:!1,volume:1,rate:1,channel:r.manager.resolveSystem(b.SoundscapeSystem).sfx}),r.manager.createComponent(r.sounds.land,h.SpatialAudio,{offset:o.vec3(0,0,0),radius:256});var i=r.manager.resolveSystem(d.Store);return r.manager.createComponent(r.character,l.AnimationMixer,[m.bindAnimationProperty(r.manager,r.character,m.AnimationProperty.diffuse,Object.keys(y.spritesheetAnimation).reduce((function(e,t){var r;return a(a({},e),((r={})[t]=l.FrameSampler(y.spritesheetAnimation[t].map((function(e){return i.requestSync(e)})),16),r))}),{}))]),r.manager.createComponent(r.character,v.CharacterController,{collisionMask:1,padding:.5,threshold:8,offset:[0,100],maxAscendAngle:1,maxDescendAngle:1,gravity:978}),r.floorDust=_.createFloorDust(r.manager),r}return n(t,e),t.prototype.execute=function(e){var t=this.manager.resolveSystem(f.KeyboardSystem),r=+t.keyDown("left"),i=+t.keyDown("right"),n=+t.keyDown("up"),a=+t.keyDown("down"),s=t.keyDown("action"),u=t.keyDown("guide"),p=!this.hold&&s;this.hold=s;var d=this.manager.aquireComponent(this.character,v.CharacterController);d.input[0]=i-r,d.input[1]=a-n;var m=this.manager.aquireComponent(this.character,l.AnimationMixer),y=m.tracks[m.tracks.length-1],b=y?y.key:null;switch(b){case null:d.velocity[0]=0;break;case"run":case"jump":case"jump-fall":case"fall":d.direction[0]*d.input[0]<0&&(d.input[0]=0);break;case"land":d.velocity[0]=0;default:o.vec2.copy(o.vec2.ZERO,d.input)}d.update(e,this.manager);var _=d.flags.below?0==d.input[0]||d.flags.left||d.flags.right?null:"run":d.direction[1]<0?"jump":"fall",P=this.manager.aquireComponent(this.character,c.Transform2D);P.localScale[0]=d.direction[0];var S=this.manager.resolveSystem(g.PuzzleSystem);S.showSolutionGuide(u);var x=S.updatePuzzle(P.globalTransform,120,null===b&&p);if(null===b&&p&&(_=x?"action":"fidget"),"fidget"!==b&&"action"!==b||(_=b),"land"===b||"run-idle"===b?b=null:"jump-fall"===b&&(b="fall"),b!==_){"fall"!==b&&"run"===_?this.manager.aquireComponent(this.sounds.steps,h.AudioSource).play():this.manager.aquireComponent(this.sounds.steps,h.AudioSource).stop();for(var A=m.tracks.length-1;A>=0;A--)m.tracks[A].end(0,0);if("run"===b&&null==_)y.elapsedTime>.36&&m.createAnimation("run-idle",!0);else if("jump"===b&&"fall"===_){var O=m.createAnimation("jump-fall",!0).duration;m.createAnimation("fall").start(O,0)}else"fall"!==b||null!=_&&"run"!==_?"action"===_||"fidget"===_?m.createAnimation(_,!0):_&&m.createAnimation(_):(this.floorDust(P.globalTransform),this.manager.aquireComponent(this.sounds.land,h.AudioSource).play(),y.elapsedTime>.36&&m.createAnimation("land",!0))}},t}(s.ProcedureSystem);t.CharacterSystem=P},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i,n,a;Object.defineProperty(t,"__esModule",{value:!0}),t.GL_TYPED_ARRAY=t.GL_BYTE_SIZE=t.GL_SIZE=void 0,t.GL_SIZE=((i={})[5124]=1,i[5126]=1,i[35664]=2,i[35665]=3,i[35666]=4,i[35674]=4,i[35675]=9,i[35676]=16,i[35678]=1,i),t.GL_BYTE_SIZE=((n={})[5126]=4,n[5125]=4,n[5123]=2,n[5121]=1,n),t.GL_TYPED_ARRAY=((a={})[5126]=Float32Array,a[35664]=Float32Array,a[35665]=Float32Array,a[35666]=Float32Array,a[35674]=Float32Array,a[35675]=Float32Array,a[35676]=Float32Array,a[5124]=Int32Array,a[35678]=Int32Array,a[5121]=Uint8Array,a[5123]=Uint16Array,a[5125]=Uint32Array,a)},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.GLContext=void 0;var n=function(){function e(e){var t,r;for(var i in this.gl=e,this.extensions={instanced_arrays:this.gl.getExtension("ANGLE_instanced_arrays"),blend_minmax:this.gl.getExtension("EXT_blend_minmax"),vertex_array_object:this.gl.getExtension("OES_vertex_array_object")||this.gl.getExtension("MOZ_OES_vertex_array_object")||this.gl.getExtension("WEBKIT_OES_vertex_array_object"),depth_texture:this.gl.getExtension("WEBGL_depth_texture")||this.gl.getExtension("WEBKIT_WEBGL_depth_texture"),texture_float:this.gl.getExtension("OES_texture_float"),texture_float_linear:this.gl.getExtension("OES_texture_float_linear"),texture_half_float:this.gl.getExtension("OES_texture_half_float"),texture_half_float_linear:this.gl.getExtension("OES_texture_half_float_linear"),standard_derivatives:this.gl.getExtension("OES_standard_derivatives"),shader_texture_lod:this.gl.getExtension("EXT_shader_texture_lod"),draw_buffers:this.gl.getExtension("WEBGL_draw_buffers"),color_buffer_float:this.gl.getExtension("WEBGL_color_buffer_float"),element_index_uint:this.gl.getExtension("OES_element_index_uint"),color_buffer_half_float:this.gl.getExtension("EXT_color_buffer_half_float"),frag_depth:this.gl.getExtension("EXT_frag_depth")},this.MAX_ATTRIBUTES=this.gl.getParameter(34921),this.MAX_VERT_UNIFORM=this.gl.getParameter(36347),this.MAX_FRAG_UNIFORM=this.gl.getParameter(36349),this.MAX_VARYINGS=this.gl.getParameter(36348),this.MAX_VIEWPORT=this.gl.getParameter(3386),this.MAX_TEXTURE=this.gl.getParameter(3379),this.MAX_TEXTURES=this.gl.getParameter(34930),this.MAX_VERT_TEXTURES=this.gl.getParameter(35660),this.MAX_FRAMEBUFFER=this.gl.getParameter(34024),this.MAX_DRAW_BUFFERS=this.extensions.draw_buffers?this.gl.getParameter(this.extensions.draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1,this.MAX_COLOR_ATTACHMENTS=this.extensions.draw_buffers?this.gl.getParameter(this.extensions.draw_buffers.MAX_COLOR_ATTACHMENTS_WEBGL):1,this.FRAG_PRECISION=this.gl.getShaderPrecisionFormat(35632,36338).precision?"high":"medium",this.VERT_PRECISION=this.gl.getShaderPrecisionFormat(35633,36338).precision?"high":"medium",this.MAX_COLOR_BUFFERS=this.extensions.draw_buffers?this.gl.getParameter(this.extensions.draw_buffers.MAX_DRAW_BUFFERS_WEBGL):1,this.state=((t={})[34964]=null,t.vertexArray=((r={})[34229]=null,r[34965]=null,r.attributes=Array(this.MAX_ATTRIBUTES).fill(null).map((function(){return{enabled:!1,size:0,type:5126,normalized:!1,stride:0,offset:0,buffer:null}})),r),t[34016]=33984,t.textures=Array(this.MAX_TEXTURES).fill(null),t[35725]=null,t[36006]=null,t[36007]=null,t[2932]=513,t[2929]=!1,t[2930]=!0,t[3042]=!1,t[32969]=1,t[32968]=0,t[32971]=1,t[32970]=0,t[32777]=32774,t[34877]=32774,t[2884]=!1,t[2885]=1029,t[3089]=!1,t[3088]=new Int32Array(4),t[2978]=new Int32Array(4),t[3106]=new Float32Array(4),t[3107]=[!0,!0,!0,!0],t),this.defaultVertexArray=this.state.vertexArray,this.SHADER_PREAMBLE=[this.extensions.shader_texture_lod?"#extension GL_EXT_shader_texture_lod : enable\n":"",this.extensions.standard_derivatives?"#extension GL_OES_standard_derivatives : enable\n":"","#line 1\n"].join(""),WebGLRenderingContext.prototype){var n=e[i];"function"==typeof n&&(this[i]||(this[i]=n.bind(e)))}}return e.createContext=function(t,r){var n=i({alpha:!1,antialias:!1,depth:!1,desynchronized:!1,failIfMajorPerformanceCaveat:!1,powerPreference:"default",premultipliedAlpha:!1,preserveDrawingBuffer:!1,stencil:!1},r);return new e(t.getContext("webgl",n)||t.getContext("experimental-webgl",n))},Object.defineProperty(e.prototype,"drawingBufferWidth",{get:function(){return this.gl.drawingBufferWidth},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"drawingBufferHeight",{get:function(){return this.gl.drawingBufferHeight},enumerable:!1,configurable:!0}),e.prototype.enable=function(e){this.state[e]||(this.state[e]=!0,this.gl.enable(e))},e.prototype.disable=function(e){this.state[e]&&(this.state[e]=!1,this.gl.disable(e))},e.prototype.bindBuffer=function(e,t){switch(e){case 34962:if(this.state[34964]===t)return;this.state[34964]=t;break;case 34963:if(this.state.vertexArray[34965]===t)return;this.state.vertexArray[34965]=t}this.gl.bindBuffer(e,t)},e.prototype.useProgram=function(e){this.state[35725]!==e&&(this.state[35725]=e,this.gl.useProgram(e))},e.prototype.activeTexture=function(e){this.state[34016]!==e&&(this.state[34016]=e,this.gl.activeTexture(e))},e.prototype.bindTexture=function(e,t){this.state.textures[this.state[34016]]!==t&&(this.state.textures[this.state[34016]]=t,this.gl.bindTexture(e,t))},e.prototype.bindFramebuffer=function(e,t){this.state[36006]!==t&&(this.state[36006]=t,this.gl.bindFramebuffer(e,t))},e.prototype.bindRenderbuffer=function(e,t){this.state[36007]!==t&&(this.state[36007]=t,this.gl.bindRenderbuffer(e,t))},e.prototype.viewport=function(e,t,r,i){this.state[2978][0]===e&&this.state[2978][1]===t&&this.state[2978][2]===r&&this.state[2978][3]===i||(this.state[2978][0]=e,this.state[2978][1]=t,this.state[2978][2]=r,this.state[2978][3]=i,this.gl.viewport(e,t,r,i))},e.prototype.scissor=function(e,t,r,i){this.state[3088][0]===e&&this.state[3088][1]===t&&this.state[3088][2]===r&&this.state[3088][3]===i||(this.state[3088][0]=e,this.state[3088][1]=t,this.state[3088][2]=r,this.state[3088][3]=i,this.gl.scissor(e,t,r,i))},e.prototype.clearColor=function(e,t,r,i){this.state[3106][0]===e&&this.state[3106][1]===t&&this.state[3106][2]===r&&this.state[3106][3]===i||(this.state[3106][0]=e,this.state[3106][1]=t,this.state[3106][2]=r,this.state[3106][3]=i,this.gl.clearColor(e,t,r,i))},e.prototype.colorMask=function(e,t,r,i){this.state[3107][0]===e&&this.state[3107][1]===t&&this.state[3107][2]===r&&this.state[3107][3]===i||(this.state[3107][0]=e,this.state[3107][1]=t,this.state[3107][2]=r,this.state[3107][3]=i,this.gl.colorMask(e,t,r,i))},e.prototype.blendFuncSeparate=function(e,t,r,i){this.state[32969]===e&&this.state[32968]===t&&this.state[32971]===r&&this.state[32970]===i||(this.state[32969]=e,this.state[32968]=t,this.state[32971]=r,this.state[32970]=i,this.gl.blendFuncSeparate(e,t,r,i))},e.prototype.blendFunc=function(e,t){this.blendFuncSeparate(e,t,e,t)},e.prototype.blendEquationSeparate=function(e,t){this.state[32777]===e&&this.state[34877]===t||(this.state[32777]=e,this.state[34877]=t,this.gl.blendEquationSeparate(e,t))},e.prototype.blendEquation=function(e){this.blendEquationSeparate(e,e)},e.prototype.cullFace=function(e){this.state[2885]!==e&&(this.state[2885]=e,this.gl.cullFace(e))},e.prototype.drawElements=function(e,t,r,i){this.gl.drawElements(e,t,r,i)},e.prototype.drawArrays=function(e,t,r){this.gl.drawArrays(e,t,r)},e.prototype.vertexAttribPointer=function(e,t,r,i,n,a){var o=this.state.vertexArray.attributes[e];o.size=t,o.type=r,o.normalized=i,o.stride=n,o.offset=a,o.buffer=this.state[34964],this.gl.vertexAttribPointer(e,t,r,i,n,a)},e.prototype.enableVertexAttribArray=function(e){this.state.vertexArray.attributes[e].enabled||(this.state.vertexArray.attributes[e].enabled=!0,this.gl.enableVertexAttribArray(e))},e.prototype.disableVertexAttribArray=function(e){this.state.vertexArray.attributes[e].enabled&&(this.state.vertexArray.attributes[e].enabled=!1,this.gl.disableVertexAttribArray(e))},e.prototype.createVertexArray=function(){var e;return(e={})[34229]=this.extensions.vertex_array_object.createVertexArrayOES(),e[34963]=null,e.attributes=Array(this.MAX_ATTRIBUTES).fill(null).map((function(){return{enabled:!1,size:0,type:5126,normalized:!1,stride:0,offset:0,buffer:null}})),e},e.prototype.bindVertexArray=function(e){var t=e;e=t[34229],this.state.vertexArray[34229]!==e&&(this.state.vertexArray=t||this.defaultVertexArray,this.extensions.vertex_array_object.bindVertexArrayOES(e))},e.prototype.deleteVertexArray=function(e){e=e[34229],this.extensions.vertex_array_object.deleteVertexArrayOES(e)},e.prototype.isVertexArray=function(e){return e=e[34229],this.extensions.vertex_array_object.isVertexArrayOES(e)},e.prototype.drawBuffers=function(e){this.extensions.draw_buffers.drawBuffersWEBGL(e)},e.prototype.drawArraysInstanced=function(e,t,r,i){this.extensions.instanced_arrays.drawArraysInstancedANGLE(e,t,r,i)},e.prototype.drawElementsInstanced=function(e,t,r,i,n){this.extensions.instanced_arrays.drawElementsInstancedANGLE(e,t,r,i,n)},e.prototype.vertexAttribDivisor=function(e,t){this.extensions.instanced_arrays.vertexAttribDivisorANGLE(e,t)},e.prototype.shaderSource=function(e,t){this.gl.shaderSource(e,this.SHADER_PREAMBLE+t)},e}();t.GLContext=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FilterProgram=void 0;var i=r(52),n=r(35),a=r(53),o=function(){function e(e,t){this.manager=e,this.gl=t,this.vertexBuffer=new i.VertexBufferObject(this.gl,32,35044),this.vertexBuffer.upload(new Float32Array([-1,1,-1,-1,1,-1,1,1])),this.vao=new i.VertexArrayObject(this.gl),this.vao.bindVertexAttribute(this.vertexBuffer,{location:0,size:2}),this.defaultShader=new i.Shader(this.gl,a.ShaderMaterial.vertexSource,a.ShaderMaterial.fragmentSource,{aPosition:0})}return e.prototype.applyFilter=function(e,t,r,i,o){var s=this.gl,c=this.vao,l=e?e.shader:this.defaultShader;l.uao.uSampler=0,l.uao.uViewMatrix=t.viewMatrix,l.uao.uInvViewMatrix=t.invViewMatrix,l.uao.uViewport=i.normalizedView,e&&a.ShaderMaterial.synchronize(e.attributes,l),l.bind(),n.applyBlendMode[e?e.blend:0](s,!1),o.viewbox(0,0,i.viewport[2],i.viewport[3]),o.bind(),o.clear(r.frame),i.fbo.attachments[0].bind(0),c.bind(),c.render(6,4,0)},e}();t.FilterProgram=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexDataFormat=void 0;var i=r(30);t.VertexDataFormat=function(e){for(var t=0,r=[],n=0;n<e.length;n++){var a=e[n],o=a.name,s=a.size,c=a.type,l=a.normalized,u=s*i.GL_BYTE_SIZE[c];r.push({name:o,size:s,type:c,normalized:l,offset:t}),t+=u}return{stride:t,attributes:r}}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VertexBufferObject=void 0;var a=r(30),o=function(e){function t(t,r,i){var n=e.call(this,t,34962,i)||this;return n.views=Object.create(null),n.data=new ArrayBuffer(r),n}return n(t,e),t.prototype.upload=function(t,r,i){if(void 0===r&&(r=0),!i)return e.prototype.upload.call(this,t,r);var n=this.dataView(5126).subarray(r,r+i);if(n.length<i)throw new Error("Insufficient buffer size.");e.prototype.upload.call(this,n,r)},t.prototype.dataView=function(e){return this.views[e]||(this.views[e]=new a.GL_TYPED_ARRAY[e](this.data)),this.views[e]},t}(r(87).BufferObject);t.VertexBufferObject=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.IndexBufferObject=void 0;var a=r(30),o=function(e){function t(t,r,i,n){void 0===i&&(i=5123);var o=e.call(this,t,34963,n)||this;return o.dataType=i,5125!==o.dataType||t.extensions.element_index_uint||(o.dataType=5123),o.data=new a.GL_TYPED_ARRAY[o.dataType](r),o}return n(t,e),t.prototype.upload=function(t,r,i){if(void 0===r&&(r=0),!i)return e.prototype.upload.call(this,t,r);var n=this.data.subarray(r,r+i);if(n.length<i)throw new Error("Insufficient buffer size.");e.prototype.upload.call(this,n,r)},t}(r(87).BufferObject);t.IndexBufferObject=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VertexArrayObject=void 0;var i=function(){function e(e){this.gl=e,this.vao=e.createVertexArray()}return e.prototype.bind=function(){this.gl.bindVertexArray(this.vao)},e.prototype.bindIndexBuffer=function(e){return this.bind(),e?e.bind():this.gl.bindBuffer(34963,null),this.indexBuffer=e,this},e.prototype.bindVertexBuffer=function(e,t,r){for(var i=void 0,n=0;i=t.attributes[n];n++){var a=i.name,o=i.type,s=i.normalized,c=i.offset;r[a]&&this.bindVertexAttribute(e,r[a],o,s,t.stride,c)}return this},e.prototype.bindVertexAttribute=function(e,t,r,i,n,a){return void 0===r&&(r=5126),void 0===i&&(i=!1),void 0===n&&(n=0),void 0===a&&(a=0),this.bind(),e?(e.bind(),this.gl.enableVertexAttribArray(t.location),this.gl.vertexAttribPointer(t.location,t.size,r,i,n,a)):this.gl.disableVertexAttribArray(t.location),this},e.prototype.render=function(e,t,r){void 0===r&&(r=0),this.indexBuffer?this.gl.drawElements(e||4,t||this.indexBuffer.data.length,this.indexBuffer.dataType,r*this.indexBuffer.data.BYTES_PER_ELEMENT):this.gl.drawArrays(e||4,r,t)},e.prototype.delete=function(){this.gl.deleteVertexArray(this.vao)},e}();t.VertexArrayObject=i},function(e,t,r){"use strict";function i(e){this.dirty|=+(this.value!==e),this.value=e}function n(e){for(var t=this.value,r=t.length-1;r>=0;r--)this.dirty|=+(t[r]!==e[r]),t[r]=e[r]}Object.defineProperty(t,"__esModule",{value:!0}),t.UniformAccessObject=void 0;var a=function(){function e(e,t){for(var r in this.gl=e,this.uniforms=[],t){var i=t[r],n=this.createUniformData(i);Object.defineProperty(this,r,{set:n.set.bind(n)}),this.uniforms.push(n)}}return e.prototype.createUniformData=function(e){var t=e.location,r=e.type,a=e.size,o=e.length,s=this.gl;switch(r){case 5124:case 35678:return o>1?{value:new Int32Array(o*a),upload:s.uniform1iv.bind(s,t),set:n}:{value:0,upload:s.uniform1i.bind(s,t),set:i};case 5126:return o>1?{value:new Float32Array(o*a),upload:s.uniform1fv.bind(s,t),set:n}:{value:0,upload:s.uniform1f.bind(s,t),set:i};case 35664:return{value:new Float32Array(o*a),upload:s.uniform2fv.bind(s,t),set:n};case 35665:return{value:new Float32Array(o*a),upload:s.uniform3fv.bind(s,t),set:n};case 35666:return{value:new Float32Array(o*a),upload:s.uniform4fv.bind(s,t),set:n};case 35674:return{value:new Float32Array(o*a),upload:s.uniformMatrix2fv.bind(s,t,!1),set:n};case 35675:return{value:new Float32Array(o*a),upload:s.uniformMatrix3fv.bind(s,t,!1),set:n};case 35676:return{value:new Float32Array(o*a),upload:s.uniformMatrix4fv.bind(s,t,!1),set:n}}},e.prototype.upload=function(){for(var e=void 0,t=0;e=this.uniforms[t];t++)e.dirty&&(e.dirty=0,e.upload(e.value))},e}();t.UniformAccessObject=a},function(e,t){e.exports="attribute vec2 aPosition;\n\nuniform mat3 uViewMatrix;\nuniform mat3 uInvViewMatrix;\nuniform vec4 uViewport;\n\nvarying vec2 vUV;\nvarying vec2 vScreenPosition;\nvarying vec2 vWorldPosition;\n\nvoid main(void){\n    vScreenPosition = (0.5 + 0.5 * aPosition);\n    vUV = vScreenPosition * uViewport.zw + uViewport.xy;\n    vWorldPosition = (uInvViewMatrix * vec3(aPosition, 1.0)).xy;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n}"},function(e,t){e.exports="varying vec2 vUV;\nvarying vec2 vScreenPosition;\nvarying vec2 vWorldPosition;\n\nuniform sampler2D uSampler;\n\nvoid main(void){\n    gl_FragColor = texture2D(uSampler, vUV);\n}"},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(19),t),n(r(161),t),n(r(162),t),n(r(89),t),n(r(164),t),n(r(165),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Sprite2D=void 0;var a=r(19),o=r(0),s=r(6),c=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.vertices=new Float32Array(8),r.uvs=new Uint32Array(4),r.indices=t.QUAD_INDICES,r.lastTextureIndex=-1,r.lastFrame=-1,r.origin=o.vec2(0,0),r}return n(t,e),t.prototype.setup=function(e){this.lastTextureIndex=-1,this.lastFrame=-1,this.order=e.order,o.vec2.copy(e.origin||o.vec2.ZERO,this.origin)},t.prototype.calculateVertexData=function(e,r,i){this.lastTextureIndex!=r.diffuse.index&&(this.lastTextureIndex=r.diffuse.index,this.recalculateUVs(t.QUAD_UVS,r.diffuse.uvTransform,this.uvs),this.lastFrame=-1),e&&this.lastFrame<e.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame&&(this.lastFrame=i,this.recalculateVertices(null,e?e.globalTransform:s.mat3x2.IDENTITY,this.vertices,0,r.diffuse),this.recalculateBoundingBox())},t.prototype.recalculateBoundingBox=function(){var e=this.aabb,t=this.vertices;e[0]=Math.min(t[0],t[2],t[4],t[6]),e[1]=Math.min(t[1],t[3],t[5],t[7]),e[2]=Math.max(t[0],t[2],t[4],t[6]),e[3]=Math.max(t[1],t[3],t[5],t[7])},t.prototype.recalculateVertices=function(e,t,r,i,n){var a=t[0],o=t[1],s=t[2],c=t[3],l=t[4],u=t[5],p=n.width,h=n.height,f=n.frame,d=f[0]-this.origin[0]*p,v=d+f[2],m=f[1]-this.origin[1]*h,y=m+f[3];r[0]=a*d+s*m+l,r[1]=c*m+o*d+u,r[2]=a*v+s*m+l,r[3]=c*m+o*v+u,r[4]=a*v+s*y+l,r[5]=c*y+o*v+u,r[6]=a*d+s*y+l,r[7]=c*y+o*d+u},t.prototype.reset=function(){},t.CENTER=o.vec2(.5,.5),t.QUAD_INDICES=new Uint8Array([0,1,2,0,2,3]),t.QUAD_UVS=new Float32Array([0,0,1,0,1,1,0,1]),t}(a.Geometry2D);t.Sprite2D=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.VectorGraphics=void 0;var a=r(0),o=r(6),s=r(45),c=r(14),l=r(5),u=r(19),p=r(163),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertices=new Float32Array(0),t.uvs=new Uint32Array(0),t.indices=new Uint16Array(0),t.colors=new Uint32Array(0),t.lastTextureIndex=-1,t.lastFrame=-1,t.arraybuffer=new ArrayBuffer(0),t.vertexArray=[],t.indexArray=[],t.colorArray=[],t.uvArray=[],t.path=new p.VectorPath,t}return n(t,e),t.prototype.setup=function(e){this.lastTextureIndex=-1,this.lastFrame=-1,this.order=e.order||0,Object.assign(this.path.style,e.style)},t.prototype.reallocate=function(){var e=this.vertexArray.length/2,t=this.indexArray.length,r=this.indices.BYTES_PER_ELEMENT*t+2*this.vertices.BYTES_PER_ELEMENT*e+this.uvs.BYTES_PER_ELEMENT*e+this.colors.BYTES_PER_ELEMENT*e;if(this.arraybuffer.byteLength<r)this.arraybuffer=new ArrayBuffer(r);else if(this.indices.length===t&&this.vertices.length===2*e)return;var i=0;this.vertices=new Float32Array(this.arraybuffer,i,2*e),i+=this.vertices.BYTES_PER_ELEMENT*this.vertices.length,this.uvs=new Uint32Array(this.arraybuffer,i,e),i+=this.uvs.BYTES_PER_ELEMENT*this.uvs.length,this.colors=new Uint32Array(this.arraybuffer,i,e),i+=this.colors.BYTES_PER_ELEMENT*this.colors.length,this.indices=new Uint16Array(this.arraybuffer,i,t),this.lastFrame=this.lastTextureIndex=-1},t.prototype.calculateVertexData=function(e,t,r){if(-1==this.lastFrame&&this.reallocate(),this.lastTextureIndex!=t.diffuse.index&&(this.lastTextureIndex=t.diffuse.index,this.recalculateUVs(this.uvArray,t.diffuse.uvTransform,this.uvs),this.lastFrame=-1),e&&this.lastFrame<e.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame){this.lastFrame=r;for(var i=c.rgba(),n=0;n<this.colors.length;n++)i[0]=this.colorArray[4*n+0],i[1]=this.colorArray[4*n+1],i[2]=this.colorArray[4*n+2],i[3]=this.colorArray[4*n+3],c.rgba.multiply(i,t.color,i),this.colors[n]=c.rgba.uint8Hex(i,t.premultiply?i[3]/255:1);this.indices.set(this.indexArray),this.recalculateVertices(this.vertexArray,e?e.globalTransform:o.mat3x2.IDENTITY,this.vertices),this.recalculateBoundingBox()}},t.prototype.setTransform=function(e){return o.mat3x2.copy(e,this.path.transform),this},t.prototype.beginPath=function(e,t){return this.path.beginPath(e,t),this},t.prototype.lineTo=function(e,t){return this.path.lineTo(e,t),this},t.prototype.quadraticCurveTo=function(e,r,i,n){for(var a=this.path.last[0],o=this.path.last[1],c=s.quadraticBezierLength(a,o,e,r,i,n),u=l.clamp(Math.ceil(.1*c),4,1024),p=t.temp,h=1;h<=u;h++){var f=h/u;s.quadraticBezier(a,o,e,r,i,n,f,p),this.lineTo(p[0],p[1])}return this},t.prototype.bezierCurveTo=function(e,r,i,n,a,o){for(var c=this.path.last[0],u=this.path.last[1],p=s.cubicBezierLength(c,u,e,r,i,n,a,o),h=l.clamp(Math.ceil(.1*p),4,1024),f=t.temp,d=1;d<=h;d++){var v=d/h;s.cubicBezier(c,u,e,r,i,n,a,o,v,f),this.lineTo(f[0],f[1])}return this},t.prototype.arcTo=function(e,t,r,i,n){var a=this.path.last[0],o=this.path.last[1],s=o-t,c=a-e,l=i-t,u=r-e,p=Math.abs(s*u-c*l);if(p<1e-8||0===n)return a===e&&o===t||this.lineTo(e,t),this;var h=s*s+c*c,f=l*l+u*u,d=s*l+c*u,v=n*Math.sqrt(h)/p,m=n*Math.sqrt(f)/p,y=v*d/h,g=m*d/f,b=v*u+m*c,_=v*l+m*s,P=c*(m+y),S=s*(m+y),x=u*(v+g),A=l*(v+g);return this.arc(b+e,_+t,n,Math.atan2(S-_,P-b),Math.atan2(A-_,x-b),c*l>u*s)},t.prototype.arc=function(e,t,r,i,n,a){void 0===a&&(a=!1),!a&&n<=i?n+=2*Math.PI:a&&i<=n&&(i+=2*Math.PI);for(var o=n-i,s=Math.abs(o*r),c=l.clamp(Math.ceil(.1*s),4,1024),u=o/(c-1),p=0;p<c;p++){var h=p*u+i,f=Math.cos(h)*r+e,d=Math.sin(h)*r+t;this.lineTo(f,d)}return this},t.prototype.closePath=function(){return this.path.closePath(),this},t.prototype.stroke=function(e,t){void 0===e&&(e=c.rgba.WHITE),null!=t&&(this.path.style.width=t);for(var r=this.path.batchStroke(this.vertexArray,this.indexArray),i=0;i<r;i++)this.colorArray.push(e[0],e[1],e[2],e[3]),this.uvArray.push((i>>>1)/(r>>>1),i%2);return this.lastFrame=-1,this},t.prototype.fill=function(e){void 0===e&&(e=c.rgba.WHITE);for(var t=this.path.batchPolygon(this.vertexArray,this.indexArray),r=0;r<t;r++)this.colorArray.push(e[0],e[1],e[2],e[3]),this.uvArray.push(0,0);return this.lastFrame=-1,this},t.prototype.clear=function(){return this.vertexArray.length=0,this.indexArray.length=0,this.colorArray.length=0,this.uvArray.length=0,this.lastFrame=-1,this},t.prototype.reset=function(){this.clear()},t.temp=a.vec2(),t}(u.Geometry2D);t.VectorGraphics=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.VectorPath=void 0;var i=r(0),n=r(6),a=r(20),o=function(){function e(){this.path=[i.vec2()],this.transform=n.mat3x2(),this.length=0,this.style={width:1,miterLimit:1,alignment:.5,cap:0,join:0}}return Object.defineProperty(e.prototype,"last",{get:function(){return this.path[this.length]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"first",{get:function(){return this.path[0]},enumerable:!1,configurable:!0}),e.prototype.push=function(){return++this.length==this.path.length&&this.path.push(i.vec2()),this.path[this.length]},e.prototype.beginPath=function(e,t){this.length=0,i.vec2.fromValues(e,t,this.last),n.mat3x2.transform(this.last,this.transform,this.last)},e.prototype.lineTo=function(e,t){var r=this.last;i.vec2.fromValues(e,t,this.push()),n.mat3x2.transform(this.last,this.transform,this.last),this.last[0]==r[0]&&this.last[1]==r[1]&&this.length--},e.prototype.closePath=function(){var e=this.last;i.vec2.copy(this.first,this.push()),this.last[0]==e[0]&&this.last[1]==e[1]&&this.length--},e.prototype.batchPolygon=function(e,t){var r=this.path,i=this.length,n=(this.style,a.signedPolygonArea(r,0,i)>0),o=a.triangulate(r,0,i,n,[]);if(!o.length)return 0;for(var s=e.length/2,c=0;c<o.length;c++)t.push(o[c]+s);for(c=0;c<i;c++)e.push(r[c][0],r[c][1]);return i},e.prototype.batchStroke=function(t,r){var n=this,a=n.path,o=n.length,c=n.first,l=n.last,u=n.style;if(!o)return 0;var p=c[0]===l[0]&&c[1]===l[1];p&&(c=i.vec2.add(a[1],l,this.push()),i.vec2.scale(c,.5,c),o=this.length--);var h=2*(1-u.alignment),f=2*u.alignment,d=.5*u.width,v=d*d,m=u.miterLimit*u.miterLimit,y=t.length/2,g=c[0],b=c[1],_=a[1][0],P=a[1][1],S=P-b,x=g-_,A=d/Math.sqrt(S*S+x*x);S*=A,x*=A,p||(1===u.cap?s(g-.5*S*(h-f),b-.5*x*(h-f),g-S*h,b-x*h,g+S*f,b+x*f,!0,t):2===u.cap&&t.push(_-S*h+x,P-x*h-S,_+S*f+x,P+x*f-S)),t.push(g-S*h,b-x*h,g+S*f,b+x*f);for(var O=1;O<o;O++){var w=a[O+1][0],M=(W=a[O+1][1])-P,T=_-w,E=d/Math.sqrt(M*M+T*T);M*=E,T*=E;var C=_-g,B=b-P,I=_-w,j=W-P,D=B*I-j*C,q=D<0;if(Math.abs(D)<e.epsilon)t.push(_-S*h,P-x*h,_+S*f,P+x*f);else{var F=(g-S)*(P-x)-(_-S)*(b-x),R=(w-M)*(P-T)-(_-M)*(W-T),k=(C*R-I*F)/D-_,V=(j*F-B*R)/D-P,L=_+k*h,N=P+V*h,z=_-k*f,G=P-V*f;1===u.join||(k*k+V*V)/v>m?q?t.push(L,N,_+S*f,P+x*f,L,N,_+M*f,P+T*f):t.push(_-S*h,P-x*h,z,G,_-M*h,P-T*h,z,G):2===u.join?q?(t.push(L,N),t.push(_+S*f,P+x*f),s(_,P,_+S*f,P+x*f,_+M*f,P+T*f,!0,t),t.push(L,N),t.push(_+M*f,P+T*f)):(t.push(_-S*h,P-x*h),t.push(z,G),s(_,P,_-S*h,P-x*h,_-M*h,P-T*h,!1,t),t.push(_-M*h,P-T*h),t.push(z,G)):t.push(L,N,z,G)}g=_,b=P,_=w,P=W,S=M,x=T}t.push(_-S*h,P-x*h,_+S*f,P+x*f),p||(1===u.cap?s(_-.5*S*(h-f),P-.5*x*(h-f),_-S*h,P-x*h,_+S*f,P+x*f,!1,t):2===u.cap&&t.push(_-S*h-x,P-x*h+S,_+S*f-x,P+x*f+S));var K=e.epsilon*e.epsilon,U=t.length/2-y;g=t[2*y+0],b=t[2*y+1],_=t[2*y+2],P=t[2*y+3];O=y+2;for(var H=y+U;O<H;O++){w=t[2*O];var W,X=g*(P-(W=t[2*O+1]))+_*(W-b)+w*(b-P);g=_,b=P,_=w,P=W,Math.abs(X)<K||(X<0?r.push(O-2,O-1,O):r.push(O-2,O,O-1))}return U},e.epsilon=.001,e}();function s(e,t,r,i,n,a,o,s){var c=r-e,l=i-t,u=Math.atan2(c,l),p=Math.atan2(n-e,a-t);o&&u<p?u+=2*Math.PI:!o&&u>p&&(p+=2*Math.PI);var h=u,f=p-u,d=Math.abs(f),v=Math.sqrt(c*c+l*l),m=1+(15*d*Math.sqrt(v)/Math.PI>>0),y=f/m;if(h+=y,o){s.push(e,t),s.push(r,i);for(var g=1,b=h;g<m;g++,b+=y)s.push(e,t,e+Math.sin(b)*v,t+Math.cos(b)*v);s.push(e,t),s.push(n,a)}else{s.push(r,i),s.push(e,t);for(g=1,b=h;g<m;g++,b+=y)s.push(e+Math.sin(b)*v,t+Math.cos(b)*v,e,t);s.push(n,a),s.push(e,t)}return 2*m}t.VectorPath=o},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Mesh2D=void 0;var a=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lastTextureIndex=-1,t.lastFrame=-1,t}return n(t,e),t.prototype.setup=function(e){if(this.lastTextureIndex=-1,this.lastFrame=-1,this.order=e.order,this.uvArray=e.uvs,this.vertices=new Float32Array(e.vertices),this.uvs=new Uint32Array(this.uvArray.length/2),e.indices)this.indices=new Uint16Array(e.indices);else{var r=t.quadIndices,i=this.vertices.length/8;this.indices=new Uint16Array(r.length*i);for(var n=0;n<this.indices.length;n++)this.indices[n]=4*Math.floor(n/r.length)+r[n%r.length]}},t.prototype.calculateVertexData=function(e,t,r){this.lastTextureIndex!=t.diffuse.index&&(this.lastTextureIndex=t.diffuse.index,-1==this.lastFrame&&this.updateUVs(this.uvArray),this.recalculateUVs(this.uvArray,t.diffuse.uvTransform,this.uvs)),e&&this.lastFrame<e.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame&&(this.lastFrame=r,this.updateVertices(this.vertices),e&&this.recalculateVertices(this.vertices,e.globalTransform,this.vertices),this.recalculateBoundingBox())},t.prototype.updateUVs=function(e){},t.prototype.updateVertices=function(e){},t.prototype.reset=function(){},t.quadIndices=[0,1,2,0,2,3],t}(r(19).Geometry2D);t.Mesh2D=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.BillboardBatch=void 0;var a=r(6),o=r(14),s=r(5),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.vertices=new Float32Array(0),t.uvs=new Uint32Array(0),t.indices=new Uint16Array(0),t.colors=new Uint32Array(0),t.lastFrame=-1,t.vertexBuffer=new Float32Array(0),t.uvBuffer=new Uint32Array(0),t.indexBuffer=new Uint16Array(0),t.colorBuffer=new Uint32Array(0),t}return n(t,e),t.prototype.setup=function(e){this.order=e.order||0,this.billboards=e.billboards},t.prototype.reallocate=function(e){var t=4*e,r=6*e;if(this.indices.length!=r){if(this.indexBuffer.length<r){var i=s.int32pow2Ceil(e);this.indexBuffer=new Uint16Array(6*i);for(var n=0;n<i;n++)this.indexBuffer[6*n+0]=4*n+0,this.indexBuffer[6*n+1]=4*n+1,this.indexBuffer[6*n+2]=4*n+2,this.indexBuffer[6*n+3]=4*n+0,this.indexBuffer[6*n+4]=4*n+2,this.indexBuffer[6*n+5]=4*n+3;this.vertexBuffer=new Float32Array(8*i),this.uvBuffer=new Uint32Array(4*i),this.colorBuffer=new Uint32Array(4*i)}this.vertices=this.vertexBuffer.subarray(0,2*t),this.uvs=this.uvBuffer.subarray(0,t),this.colors=this.colorBuffer.subarray(0,t),this.indices=this.indexBuffer.subarray(0,r),this.lastFrame=-1}},t.prototype.calculateVertexData=function(e,t,r){(this.billboards.length||this.indices.length)&&(this.lastFrame=-1,-1==this.lastFrame&&this.reallocate(this.billboards.length),e&&this.lastFrame<e.lastFrame&&(this.lastFrame=-1),-1==this.lastFrame&&(this.lastFrame=r,this.loadBatch(this.billboards,t),e&&this.recalculateVertices(this.vertices,e.globalTransform,this.vertices),this.recalculateBoundingBox()))},t.prototype.loadBatch=function(e,r){for(var i=this.vertices,n=this.uvs,s=this.colors,c=r.diffuse,l=c.frame[0]/c.width-.5,u=l+c.frame[2]/c.width,p=c.frame[1]/c.height-.5,h=p+c.frame[3]/c.height,f=0;f<e.length;f++){var d=e[f],v=d.position,m=d.rotation,y=d.scale,g=d.color,b=o.rgba.uint8Hex(g,r.premultiply?g[3]/255:1),_=4*f;s[_+0]=s[_+1]=s[_+2]=s[_+3]=b,this.recalculateUVs(t.QUAD_UVS,c.uvTransform||a.mat3x2.IDENTITY,n,_);var P=Math.sin(m),S=Math.cos(m),x=v[0],A=v[1],O=S*y[0]*-l,w=P*y[0]*u,M=-P*y[1]*-p,T=S*y[1]*h;i[2*_+0]=-O-M+x,i[2*_+1]=-w-T+A,i[2*_+2]=O-M+x,i[2*_+3]=w-T+A,i[2*_+4]=O+M+x,i[2*_+5]=w+T+A,i[2*_+6]=-O+M+x,i[2*_+7]=-w+T+A}},t.prototype.reset=function(){this.billboards=null},t.QUAD_UVS=[0,0,1,0,1,1,0,1],t}(r(19).Geometry2D);t.BillboardBatch=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SpritesheetMaterial=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(t,r){e.prototype.setup.call(this,t,r)},t}(r(36).Material);t.SpritesheetMaterial=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseTextureAtlas=void 0;var i=r(11),n=r(16),a=r(6),o=r(38),s=function(e,t,r,i){return i[0]=e.width/t,i[1]=0,i[2]=0,i[3]=e.height/r,i[4]=e.x/t,i[5]=e.y/r,i};t.ParseTextureAtlas=function(e){var t=this;if(e.type===i.DATA_TYPE.JSON&&e.data.frames){var r=e.data,c=r.frames,l=r.meta,u=l.image,p=l.size,h=""+e.url.replace(/[^\/]*$/i,"")+u;return this.request(h).then((function(e){var r=e.data;return t.load(Object.keys(c).map((function(e){var t=c[e],i=t.frame,l=t.spriteSourceSize,u=t.sourceSize;return{url:e,type:"subtexture",data:{index:++o.UploadTexture.index,texture:r.texture,uvTransform:s({x:i.x,y:i.y,width:i.w,height:i.h},p.w,p.h,a.mat3x2()),frame:n.vec4(l.x,l.y,l.w,l.h),width:u.w,height:u.h}}})))}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.unlockAudio=void 0;var i=r(18),n=r(46);t.unlockAudio=function(e){return(new i.Deferred).from((function(t){switch(e.state){case"running":return t();case"suspended":default:var r=["touchend","mousedown","keydown"],i=function(){return e.resume().then((function(){r.forEach((function(e){return document.removeEventListener(e,i)})),n.addVisibilityEventListener((function(t){return t?e.resume():e.suspend()})),t()}))};r.forEach((function(e){return document.addEventListener(e,i)}))}}))}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseAudioClip=void 0;var i=r(11),n=r(90);t.ParseAudioClip=function(e){var t=this;if(e.type===i.DATA_TYPE.JSON&&e.data.clips){var r=e.data,a=r.clips,o=r.filename,s=""+e.url.replace(/[^\/]*$/i,"")+o;return this.request(s).then((function(e){return t.load(Object.keys(a).map((function(t){var r=a[t],i=r[0],o=r[1],s=r[2];return{url:t,type:"soundclip",data:{index:++n.DecodeAudio.index,buffer:e.data.buffer,offset:.001*i,duration:.001*o,loop:.001*s}}})))}))}}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(26),t),n(r(171),t),n(r(172),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioCompressor=void 0;var a=r(26),o=r(40),s=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(t,r){e.prototype.setup.call(this,t,r),this.compressor=this.context.createDynamicsCompressor(),o.scheduleAudioParameter(this.context,this.compressor.threshold,t.compressor.threshold),o.scheduleAudioParameter(this.context,this.compressor.knee,t.compressor.knee),o.scheduleAudioParameter(this.context,this.compressor.ratio,t.compressor.ratio),o.scheduleAudioParameter(this.context,this.compressor.attack,t.compressor.attack),o.scheduleAudioParameter(this.context,this.compressor.release,t.compressor.release),this.compressor.connect(this.gain)},Object.defineProperty(t.prototype,"input",{get:function(){return this.compressor},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.compressor.disconnect(),this.compressor=null,e.prototype.reset.call(this)},t}(a.AudioChannel);t.AudioCompressor=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Reverb=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(t,r){e.prototype.setup.call(this,t,r),this.convolver=this.context.createConvolver(),this.gain.connect(this.convolver),this.output.connect(this.resolveDestination(r))},Object.defineProperty(t.prototype,"output",{get:function(){return this.convolver},enumerable:!1,configurable:!0}),t.prototype.update=function(){for(var e=this.context.sampleRate,t=e*this.options.duration,r=this.options.decay,i=this.context.createBuffer(2,t,e),n=i.getChannelData(0),a=i.getChannelData(1),o=0;o<t;o++)n[o]=(2*Math.random()-1)*Math.pow(1-o/t,r),a[o]=(2*Math.random()-1)*Math.pow(1-o/t,r);this.convolver.buffer=i},t.prototype.reset=function(){this.convolver.disconnect(),this.convolver=null,e.prototype.reset.call(this)},t}(r(26).AudioChannel);t.Reverb=a},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(92),t),n(r(91),t)},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(175),t),n(r(176),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioSource=void 0;var a=r(37),o=r(26),s=r(40),c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(t,r){e.prototype.setup.call(this,t,r),this.resource=r.resolveSystem(a.Store).requestSync(t.clip)},t.prototype.play=function(e,t){var r=this;void 0===e&&(e=0),void 0===t&&(t=0),this.source||(this.source=this.context.createBufferSource(),this.source.buffer=this.resource.buffer,this.source.loop=this.options.loop,this.source.loopStart=this.resource.loop,this.source.loopEnd=this.resource.loop+this.resource.duration,s.scheduleAudioParameter(this.context,this.source.playbackRate,this.options.rate),this.source.connect(this.input),this.source.onended=function(){r.source=null,r.handleSourceEnd()},this.source.start(this.context.currentTime+e,this.resource.offset,this.options.loop?void 0:this.resource.duration),t&&e&&s.scheduleAudioParameter(this.context,this.gain.gain,0,e),t&&s.scheduleAudioParameter(this.context,this.gain.gain,this.options.volume,e+t,"linear"))},t.prototype.stop=function(e,t){void 0===e&&(e=0),void 0===t&&(t=0),this.source&&(this.source.stop(this.context.currentTime+e+t),t&&e&&s.scheduleAudioParameter(this.context,this.gain.gain,this.options.volume,e),t&&s.scheduleAudioParameter(this.context,this.gain.gain,0,e+t,"linear"))},Object.defineProperty(t.prototype,"rate",{get:function(){return this.options.rate},set:function(e){this.options.rate=e,this.source&&s.scheduleAudioParameter(this.context,this.source.playbackRate,this.options.rate)},enumerable:!1,configurable:!0}),t.prototype.reset=function(){this.source&&this.source.disconnect(),this.source=null,e.prototype.reset.call(this)},t.prototype.handleSourceEnd=function(){var e=this.callback;this.callback=null,e&&e()},t}(o.AudioChannel);t.AudioSource=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.WhiteNoise=void 0;var a=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(t,r){e.prototype.setup.call(this,t,r);this.buffer=this.context.createBuffer(2,4096,this.context.sampleRate);for(var i=0;i<4096;i++)for(var n=2*Math.random()-1,a=0;a<2;a++)this.buffer.getChannelData(a)[i]=n},t.prototype.play=function(){var e=this;this.source||(this.source=this.context.createBufferSource(),this.source.buffer=this.buffer,this.source.loop=!0,this.source.onended=function(){return e.source=null},this.source.connect(this.input),this.source.start(0))},t.prototype.stop=function(){this.source&&this.source.stop()},t.prototype.reset=function(){this.source&&this.source.disconnect(),this.source=null,e.prototype.reset.call(this)},t}(r(26).AudioChannel);t.WhiteNoise=a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KeyboardSystem=void 0;var i=function(){function e(e,t){var r=this;this.manager=e,this.keys=Object.create(null),this.state=Object.create(null),this.lookup=Object.create(null),this.keybindings=t.keybindings;var i=function(e){var t=n.keybindings[e];n.state[e]=0,Array.prototype.concat.apply([],t).forEach((function(t){var i=r.lookup[t]=r.lookup[t]||[];~i.indexOf(e)||i.push(e)}))},n=this;for(var a in this.keybindings)i(a);window.addEventListener("keydown",(function(e){if(!r.keys[e.code]){r.keys[e.code]=!0;var t=r.lookup[e.code];if(t)for(var i=0;i<t.length;i++)r.evaluateKeyState(t[i])}})),window.addEventListener("keyup",(function(e){r.keys[e.code]=!1;var t=r.lookup[e.code];if(t)for(var i=0;i<t.length;i++)r.evaluateKeyState(t[i])}))}return e.prototype.evaluateKeyState=function(e){var t=this,r=this.keybindings[e].reduce((function(e,r){return e+Number(Array.isArray(r)?r.every((function(e){return t.keys[e]})):!!t.keys[r])}),0);this.state[e]=r},e.prototype.keyDown=function(e){return!!this.state[e]},e}();t.KeyboardSystem=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PointerDeviceSystem=void 0;var i=r(0),n=r(6),a=r(33),o=function(){function e(e){var t=this;this.manager=e,this.pointers=[i.vec2()],this.pressure=[!1],this.scroll=i.vec2(),this.displayTransform=n.mat3x2(),this.handleTouchStart=function(e){e.preventDefault();for(var r=e.changedTouches.length-1;r>=0;r--){var n=e.changedTouches[r],a=n.clientX,o=n.clientY,s=n.identifier;t.pressure[s]=!0,t.pointers[s]||(t.pointers[s]=i.vec2()),t.computeCoordinates(a,o,t.pointers[s])}},this.handleTouchMove=function(e){e.preventDefault();for(var r=e.changedTouches.length-1;r>=0;r--){var i=e.changedTouches[r],n=i.clientX,a=i.clientY,o=i.identifier;t.computeCoordinates(n,a,t.pointers[o])}},this.handleTouchEnd=function(e){e.preventDefault();for(var r=e.changedTouches.length-1;r>=0;r--){var i=e.changedTouches[r],n=i.clientX,a=i.clientY,o=i.identifier;t.pressure[o]=!1,t.computeCoordinates(n,a,t.pointers[o])}},this.handleMouseDown=function(e){e.preventDefault();var r=e.clientX,i=e.clientY;t.pressure[0]=!0,t.computeCoordinates(r,i,t.pointers[0])},this.handleMouseMove=function(e){e.preventDefault();var r=e.clientX,i=e.clientY;t.computeCoordinates(r,i,t.pointers[0])},this.handleMouseUp=function(e){e.preventDefault();var r=e.clientX,i=e.clientY;t.pressure[0]=!1,t.computeCoordinates(r,i,t.pointers[0])},this.handleMouseWheel=function(e){e.preventDefault();var r=e.deltaX,i=e.deltaY,n=e.deltaMode;t.scroll[0]+=.01*r*[1,40,800][n],t.scroll[1]+=.01*i*[1,40,800][n]},this.handleAltMouse=function(e){e.preventDefault(),e.stopPropagation()},this.display=e.resolveSystem(a.Display);var r=this.targetElement=this.display.canvas;r.addEventListener("touchstart",this.handleTouchStart),r.addEventListener("touchmove",this.handleTouchMove),r.addEventListener("touchend",this.handleTouchEnd),r.addEventListener("touchcancel",this.handleTouchEnd),r.addEventListener("mousedown",this.handleMouseDown),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp),r.addEventListener("wheel",this.handleMouseWheel),window.addEventListener("contextmenu",this.handleAltMouse)}return e.prototype.delete=function(){var e=this.targetElement;e.removeEventListener("touchstart",this.handleTouchStart),e.removeEventListener("touchmove",this.handleTouchMove),e.removeEventListener("touchend",this.handleTouchEnd),e.removeEventListener("touchcancel",this.handleTouchEnd),e.removeEventListener("mousedown",this.handleMouseDown),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp),e.removeEventListener("wheel",this.handleMouseWheel),window.removeEventListener("contextmenu",this.handleAltMouse)},e.prototype.computeCoordinates=function(e,t,r){if(this.viewport!==this.display.viewport){this.viewport=this.display.viewport;var i=this.viewport,a=i.left,o=i.top,s=i.width,c=i.height;n.mat3x2.orthogonal(a,a+s,o+c,o,this.displayTransform)}r[0]=e,r[1]=t,n.mat3x2.transform(r,this.displayTransform,r)},e}();t.PointerDeviceSystem=o},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AnimationProperty=void 0;var i=r(1),n=r(2),a=r(4);t.AnimationProperty={x:{component:n.Transform2D,interpolate:i.lerp,initial:function(e){return e.localPosition[0]},set:function(e,t){e.localPosition[0]!==t&&(e.localPosition[0]=t,e.lastFrame=-1)}},y:{component:n.Transform2D,interpolate:i.lerp,initial:function(e){return e.localPosition[1]},set:function(e,t){e.localPosition[1]!==t&&(e.localPosition[1]=t,e.lastFrame=-1)}},rotation:{component:n.Transform2D,interpolate:i.lerpAngle,initial:function(e){return e.localRotation},set:function(e,t){e.localRotation!==t&&(e.localRotation=t,e.lastFrame=-1)}},scaleX:{component:n.Transform2D,interpolate:i.lerp,initial:function(e){return e.localScale[0]},set:function(e,t){e.localScale[0]!==t&&(e.localScale[0]=t,e.lastFrame=-1)}},scaleY:{component:n.Transform2D,interpolate:i.lerp,initial:function(e){return e.localScale[1]},set:function(e,t){e.localScale[1]!==t&&(e.localScale[1]=t,e.lastFrame=-1)}},position:{component:n.Transform2D,interpolate:i.vec2.lerp,prev:i.vec2(),next:i.vec2(),initial:function(e){return i.vec2.copy(e.localPosition,i.vec2())},set:function(e,t){e.localPosition[0]===t[0]&&e.localPosition[1]===t[1]||(i.vec2.copy(t,e.localPosition),e.lastFrame=-1)}},scale:{component:n.Transform2D,interpolate:i.vec2.lerp,prev:i.vec2(),next:i.vec2(),initial:function(e){return i.vec2.copy(e.localScale,i.vec2())},set:function(e,t){e.localScale[0]===t[0]&&e.localScale[1]===t[1]||(i.vec2.copy(t,e.localScale),e.lastFrame=-1)}},originX:{component:a.Sprite2D,interpolate:i.lerp,initial:function(e){return e.origin[0]},set:function(e,t){e.origin[0]!==t&&(e.origin[0]=t,e.lastFrame=-1)}},originY:{component:a.Sprite2D,interpolate:i.lerp,initial:function(e){return e.origin[1]},set:function(e,t){e.origin[1]!==t&&(e.origin[1]=t,e.lastFrame=-1)}},opacity:{component:a.Material,interpolate:i.lerp,initial:function(e){return e.color[3]/255},set:function(e,t){e.color[3]=255*t}},color:{component:a.Material,interpolate:i.rgba.lerp,prev:i.rgba(),next:i.rgba(),initial:function(e){return i.rgba.copy(e.color,i.rgba())},set:function(e,t){i.rgba.copy(t,e.color)}},tint:{component:a.Material,interpolate:i.rgb.lerp,prev:i.rgb(),next:i.rgb(),initial:function(e){return i.rgb.copy(e.tint,i.rgb())},set:function(e,t){i.rgb.copy(t,e.tint)}},diffuse:{component:a.Material,interpolate:i.step,initial:function(e){return e.diffuse},set:function(e,t){e.diffuse=t}},spawnAmount:{component:n.ParticleEmitter,interpolate:i.lerp,initial:function(e){return e.options.spawnAmount},set:function(e,t){e.options.spawnAmount=Math.round(t)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.bindAnimationTrigger=t.bindAnimationProperty=void 0,t.bindAnimationProperty=function(e,t,r,i,n){var a=r.component,o=r.initial,s=r.prev,c=r.next,l=r.set,u=r.interpolate,p=e.aquireComponent(t,a);return{context:n,interpolate:u,prev:s,next:c,initial:o.call(e,p),set:l.bind(e,p),samplers:i}},t.bindAnimationTrigger=function(e,t,r){var i=0;return{interpolate:function(e,t,r){return e+t},initial:0,set:function(e){for(var r=i;r<e;r++)t();i=e},samplers:r}}},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.spritesheetAnimation=void 0,t.spritesheetAnimation=((i={}).run=["satellite/frame0003.png","satellite/frame0004.png","satellite/frame0005.png","satellite/frame0006.png","satellite/frame0007.png","satellite/frame0008.png","satellite/frame0009.png","satellite/frame0010.png","satellite/frame0011.png","satellite/frame0012.png","satellite/frame0013.png","satellite/frame0014.png"],i["run-idle"]=["satellite/frame0016.png","satellite/frame0017.png","satellite/frame0018.png","satellite/frame0019.png","satellite/frame0020.png","satellite/frame0021.png","satellite/frame0022.png"],i.jump=["satellite/frame0026.png","satellite/frame0027.png","satellite/frame0028.png","satellite/frame0029.png","satellite/frame0030.png","satellite/frame0029.png","satellite/frame0028.png","satellite/frame0027.png"],i["jump-fall"]=["satellite/frame0031.png","satellite/frame0032.png","satellite/frame0033.png","satellite/frame0034.png"],i.fall=["satellite/frame0035.png","satellite/frame0036.png","satellite/frame0037.png","satellite/frame0038.png","satellite/frame0039.png","satellite/frame0038.png","satellite/frame0037.png","satellite/frame0036.png"],i.land=["satellite/frame0040.png","satellite/frame0041.png","satellite/frame0042.png","satellite/frame0043.png","satellite/frame0043.png","satellite/frame0045.png","satellite/frame0046.png","satellite/frame0047.png","satellite/frame0048.png","satellite/frame0049.png","satellite/frame0050.png","satellite/frame0051.png"],i.action=["satellite/frame0053.png","satellite/frame0054.png","satellite/frame0055.png","satellite/frame0056.png","satellite/frame0057.png","satellite/frame0057.png","satellite/frame0058.png","satellite/frame0059.png","satellite/frame0060.png","satellite/frame0060.png","satellite/frame0060.png","satellite/frame0060.png","satellite/frame0060.png","satellite/frame0062.png","satellite/frame0063.png","satellite/frame0064.png","satellite/frame0065.png"],i.fidget=["satellite/frame0069.png","satellite/frame0070.png","satellite/frame0071.png","satellite/frame0072.png","satellite/frame0072.png","satellite/frame0072.png","satellite/frame0072.png","satellite/frame0072.png","satellite/frame0072.png","satellite/frame0071.png","satellite/frame0070.png","satellite/frame0078.png"],i)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PuzzleSystem=void 0;var a=r(184),o=r(1),s=r(3),c=r(2),l=r(4),u=r(8),p=r(56),h=r(41),f=r(57),d=r(199),v=r(58),m=r(200),y=r(202),g=r(203),b=r(204),_=r(41),P=r(206),S=function(e){function t(t,r){var i=r.knots,n=r.wires,s=e.call(this,t)||this;s.priority=-32,s.knots=s.manager.aquireDataView(f.PuzzleKnot),s.wires=s.manager.aquireDataView(v.PuzzleWire),s.enableKnotEvent=new a.Stream,s.hover=null,s.toggle_guide=!1;var h=y.activateParticles(s.manager),m=g.activateSoundEffect(s.manager),b=_.createShockwave(s.manager),S=_.createGlitch(s.manager);s.enableKnotEvent.subscribe((function(e){if(0==e.type){var t=s.manager.aquireComponent(e.entity,c.Transform2D);b(t.localPosition)}})),s.enableKnotEvent.subscribe((function(e){e.tree&&(s.manager.aquireComponent(e.tree,p.Tree).growth=1,S(2),s.manager.aquireComponent(e.particles,c.ParticleEmitter).options.spawnAmount=1,s.manager.aquireComponent(e.tree,u.AudioSource).play())}));for(var x=i.length,A=(new a.DisjointSet).allocate(x),O=s.knots.data,w=0;w<i.length;w++){var M=i[w],T=M[0],E=M[1],C=M[2],B=M[3],I=M[4],j=d.createPuzzleKnot(s.manager,T,E,C+o.lerp(200,0,B),B,h,m),D=s.manager.aquireComponent(j,f.PuzzleKnot);if(I){var q=P.createTree(s.manager,E,C),F=q.tree,R=q.particles;D.tree=F,D.particles=R}}s.pairs=new Uint16Array(x*x);for(w=0;w<n.length;w++){var k=n[w],V=k[0],L=k[1];j=s.manager.createEntity();if(!O[V]||!O[L])throw new Error("Failed to connect ["+V+","+L+"]");0!==O[V].type&&A.join(V,L);var N=s.manager.createComponent(j,v.PuzzleWire,{entities:[O[V].entity,O[L].entity],indices:[V,L]});s.manager.createComponent(j,l.Material,{program:0,blend:1,texture:"knot/wire.png",color:o.rgba(127,127,127,255)}),s.manager.createComponent(j,l.Curve,{order:-8,smoothness:1,path:[]});var z=s.wires.lookupIndex(j,N.timeframe);s.pairs[V*x+L]=s.pairs[L*x+V]=z}for(w=0;w<x;w++)O[w].group=A.find(w);return O[0].setState(1),O.filter((function(e){return 0===e.type}))[11].setState(1),s}return n(t,e),t.prototype.execute=function(e){this.updateWires(e.deltaTime,e.frame)},t.prototype.updateWires=function(e,r){for(var i=this.knots.data,n=this.wires.data,a=void 0,s=0;a=n[s];s++){var u=a.pair[0],p=a.pair[1],h=this.manager.aquireComponent(u,c.Transform2D,a.timeframe),f=this.manager.aquireComponent(p,c.Transform2D,a.timeframe);if(h&&f){var d=this.manager.aquireComponent(a.entity,l.Curve),v=Math.max(h.lastFrame,f.lastFrame),m=i[a.indices[0]].state,y=i[a.indices[1]].state,g=1===m||1===y?1:0,b=!a.amplitude&&!g;if(a.amplitude=o.lerp(a.amplitude,g,.1),a.lastFrame<v){a.lastFrame=v;var _=a.updatePath(h.globalTransform,f.globalTransform,t.segmentLength),P=this.manager.aquireComponent(a.entity,l.Material);d.uvScale[0]=Math.min(1,_/P.diffuse.width),d.lastTextureIndex=-1}else if(d.lastRenderFrame>0&&d.lastRenderFrame!==r-1||b)continue;var S=a.animatePath(e);d.path=S}}},t.prototype.updatePuzzle=function(e,t,r){for(var i,n=this,a=t*t,o=this.knots.data,s=void 0,l=0;s=o[l];l++)if(1===s.state||0===s.type&&0===s.state){var u=this.manager.aquireComponent(s.entity,c.Transform2D),f=e[4]-u.globalTransform[4],d=e[5]-u.globalTransform[5],v=f*f+d*d;v>=a||(a=v,i=l)}if(this.hover!==i&&(null!=this.hover&&this.toggleHighlight(this.hover,!1),null!=i&&this.toggleHighlight(i,!0),this.hover=i),null==i)return!1;if(!r)return!1;var y=o.map((function(e){return e.state})),_=0!==o[i].state;_?this.advance(i,o,this.pairs,y):this.retreat(i,o,this.pairs,y);for(l=0;l<o.length;l++){var P=this.pairs[i+l*o.length];if(_)if(0!==o[l].state&&0===y[l]&&(this.enableKnotEvent.dispatch(o[l]),0===o[l].type&&(b.drawGlyph(this.manager,o[l]),this.manager.resolveSystem(h.RevealSystem).toggleBlock(o[l].group,!0))),l===i){o[l].setState(y[l],0);u=this.manager.aquireComponent(o[l].entity,c.Transform2D);g.wireSoundEffect(this.manager,u.localPosition)}else if(P){var S=this.wires.data.get(P);m.animateWire(this.manager,S,S.pair[0]!==o[l].entity),o[l].setState(y[l],1)}else 0===y[l]?o[l].setState(y[l],1):(o[l].setState(y[l],2),o[l].tree&&(this.manager.aquireComponent(o[l].tree,p.Tree).growth=0),o[l].particles&&(this.manager.aquireComponent(o[l].particles,c.ParticleEmitter).options.spawnAmount=0));else o[l].setState(y[l],0),l===i&&this.enableKnotEvent.dispatch(o[l]),-1===y[l]&&(o[l].references.forEach((function(e){return n.manager.removeEntity(e)})),o[l].references.length=0,o[l].tree&&(this.manager.aquireComponent(o[l].tree,p.Tree).growth=0),o[l].particles&&(this.manager.aquireComponent(o[l].particles,c.ParticleEmitter).options.spawnAmount=0),0===o[l].type&&this.manager.resolveSystem(h.RevealSystem).toggleBlock(o[l].group,!1))}return!0},t.prototype.toggleHighlight=function(e,t){var r=this.knots.data,i=r[e],n=this.manager.aquireComponent(i.entity,c.AnimationMixer);if(t){if(1!==i.state)return;n.createAnimation("highlight").start(0,.2);for(var a=0;a<r.length;a++){if(h=this.pairs[e+a*r.length]){var s=this.wires.data.get(h),u=this.manager.aquireComponent(s.entity,l.Material);o.rgb.copy([54,0,0],u.tint)}}}else{var p=n.tracks.find((function(e){return"highlight"===e.key}));p&&p.end(.2,.2);for(a=0;a<r.length;a++){var h;if(h=this.pairs[this.hover+a*r.length]){s=this.wires.data.get(h),u=this.manager.aquireComponent(s.entity,l.Material);o.rgb.copy(o.rgb.BLACK,u.tint)}}}},t.prototype.retreat=function(e,t,r,i){for(var n=0;n<t.length;n++){var a=r[e+n*t.length];t[n].group>t[e].group&&(i[n]=a?1:-1)}},t.prototype.advance=function(e,t,r,i){var n=t.length;if(1===i[e]){i[e]=3===t[e].type?-1:0;for(var a=0;a<n;a++){var o=r[e+a*n];switch(t[a].type){case 0:case 1:if(0===i[a])continue;i[a]=o?1:-1;break;case 2:if(0===i[a])continue;if(a===e&&(i[a]=-1),!o)continue;i[a]=1;break;case 3:if(!o)continue;-1===i[a]?i[a]=1:1===i[a]&&(i[a]=-1)}}var s=i.slice();for(a=0;a<n;a++)if(2===t[a].type&&!r[e+a*n])for(var c=0;c<n;c++)if(r[a+c*n]&&-1===s[c]){i[a]=-1;break}e:for(a=0;a<n;a++)if(2===t[a].type){for(c=0;c<n;c++)if(r[a+c*n]&&-1===s[c])continue e;-1!==i[a]&&(i[a]=0)}var l=Array(n).fill(!0);for(a=0;a<n;a++){var u=t[a].group,p=0===i[a]||1===i[a]&&3===t[a].type;l[u]=l[u]&&p}for(a=0;a<n;a++){if(3===t[a].type)l[u=t[a].group]&&(i[a]=0)}111===e&&(i[114]=1)}},t.prototype.showSolutionGuide=function(e){var t=!this.toggle_guide&&e;if(this.toggle_guide=e,t){var r=this.solve();if(r)for(var i=this.knots.data,n=0;n<r.length;n++){var a=i[r[n]];this.manager.aquireComponent(a.entity,c.AnimationMixer).createAnimation("highlight").start(.5*n,.2).end(.5*n+.5,.2)}}},t.prototype.solve=function(e){void 0===e&&(e=1e3);for(var t=this.knots.data,r=1/0,i=t.length-1;i>=0;i--)0===t[i].type&&0!=t[i].state&&(r=Math.min(r,t[i].group));if(isFinite(r)){for(var n=t.map((function(e,t){return{group:0,global_group:e.group,state:e.state,type:e.type,index:t}})).filter((function(e){return e.global_group===r})),a=new Uint16Array(n.length*n.length),o=0;o<n.length;o++)for(var s=0;s<n.length;s++)a[o+s*n.length]=this.pairs[n[o].index+n[s].index*t.length];var c=function(e){return e.reduce((function(e,t,r){return e+(t+3)%3*Math.pow(3,r)}),0)};console.log("%csolving "+r+") /"+n.length,"color:#f5dd42;text-decoration:underline");var l=Object.create(null),u=[],p=[n.map((function(e){return e.state}))],h=[-1];l[c(p[0])]=-1;for(var f=0,d=0;f<e;f++)for(var v=p.length;d<v;d++){var m=p[d];for(i=0;i<m.length;i++)if(1===m[i]){var y=m.slice();this.advance(i,n,a,y);var g=c(y);if(null!=l[g])continue;0===g?u.push([i,d]):(l[g]=d,p.push(y),h.push(i))}}if(!u.length)return[];var b=u.find((function(e){var t=e[0];e[1];return 0===n[t].type}))||u[0],_=[b[0]];for(d=b[1];d>=0;d=l[c(p[d])])_.push(h[d]);return _.reverse().slice(1).map((function(e){return n[e].index}))}},t.segmentLength=20,t}(s.ProcedureSystem);t.PuzzleSystem=S},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(18),t),n(r(31),t),n(r(83),t),n(r(46),t),n(r(21),t),n(r(33),t),n(r(27),t),n(r(47),t),n(r(93),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.TerrainSystem=void 0;var o=r(1),s=r(3),c=r(24),l=r(2),u=r(4),p=r(187),h=r(188),f=r(189),d=r(95),v=r(94),m=r(28),y=r(13),g=function(e){function t(t,r){var i=e.call(this,t)||this;i.priority=-32,i.geometries=i.manager.aquireDataView(u.Geometry2D),i.plants=i.manager.aquireDataView(d.Plant),i.trees=i.manager.aquireDataView(v.Tree),i.manager.resolveSystem(c.PhysicsSystem).forces.push(new c.Gravity(o.vec2(0,978)));for(var n=o.AABB(),s=0;s<r.length;s++){var m=r[s],y=m.center,g=m.path,b=m.biome,_=m.aabb;o.AABB.merge(n,_,n);var P=i.manager.createEntity();i.manager.createComponent(P,l.Transform2D,{position:y}),i.manager.createComponent(P,c.RigidBody,{mass:0,type:0,shapes:g.map((function(e){if(2===e.length){var t=e[0],r=e[1],i=o.vec2.subtract(r,t,o.vec2()),n=o.vec2.add(t,r,o.vec2());return o.vec2.scale(n,.5,n),new c.Line(n,o.vec2.rotation(i),o.vec2.magnitude(i))}}))}),i.manager.createComponent(P,u.Material,{program:0,blend:1,color:o.rgba(175,175,175,255),texture:"terrain/floor_"+["a","b","c"][b]+".png"}),i.manager.createComponent(P,u.Mesh2D,a({order:-1024},h.createTerrainMesh(g,i.manager.aquireComponent(P,u.Material).diffuse)));var S=i.manager.createEntity();i.manager.createComponent(S,l.Transform2D,{position:y}),i.manager.createComponent(S,u.Material,{program:0,blend:1,color:o.rgba(175,175,175,255),texture:"terrain/wall_a.png"}),i.manager.createComponent(S,u.Mesh2D,a({order:-1028},h.createWallMesh(g,i.manager.aquireComponent(S,u.Material).diffuse))),f.createPlants(i.manager,g,b,y)}i.grid=new p.SpatialGrid(n,1e3);var x=i.plants.data;for(s=x.length-1;s>=0;s--){var A=x[s],O=i.manager.aquireComponent(A.entity,l.Transform2D).localPosition;o.AABB.fromValues(O[0],O[1],O[0],O[1],A.aabb),i.grid.insert(A)}return i}return n(t,e),t.prototype.execute=function(e){for(var t=this.manager.resolveSystem(m.CharacterSystem).character,r=this.manager.aquireComponent(t,l.Transform2D),i=this.manager.resolveSystem(y.CameraSystem).camera,n=this.manager.aquireComponent(i,l.Camera2D).bounds,a=this.grid.query(n),o=0;o<a;o++){var s=this.grid.queryOutput[o];this.grid.items[s].update(this.manager,e,r)}var c=this.trees.data;for(o=c.length-1;o>=0;o--){var p=c[o],h=p.prevGrowth!==p.growth;if(p.update(e),p.lastFrame==e.frame){var f=this.manager.aquireComponent(p.entity,u.Mesh2D);f.lastRenderFrame>0&&f.lastRenderFrame<e.frame-1&&!h||(p.updateVertices(f.vertices),f.lastFrame=-1)}}},t}(s.ProcedureSystem);t.TerrainSystem=g},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SpatialGrid=void 0;var i=r(5),n=function(){function e(e,t){this.indexPool=[],this.items=[],this.visited=[],this.queryOutput=[],this.pointers=[],this.pointerTail=0,this.invCellWidth=1/t,this.invCellHeight=1/t,this.columns=Math.ceil((e[2]-e[0])*this.invCellWidth),this.rows=Math.ceil((e[3]-e[1])*this.invCellHeight),this.columnOffset=Math.ceil(e[0]*this.invCellWidth),this.rowOffset=Math.ceil(e[1]*this.invCellHeight),this.grid=new Uint16Array(this.columns*this.rows)}return e.prototype.insert=function(e){var t=this.indexPool.pop()||this.items.length+1;this.items[t-1]=e;for(var r=i.clamp((e.aabb[0]*this.invCellWidth|0)-this.columnOffset,0,this.columns-1),n=i.clamp((e.aabb[2]*this.invCellWidth|0)-this.columnOffset,0,this.columns-1),a=i.clamp((e.aabb[1]*this.invCellHeight|0)-this.rowOffset,0,this.rows-1),o=i.clamp((e.aabb[3]*this.invCellHeight|0)-this.rowOffset,0,this.rows-1),s=a;s<=o;s++)for(var c=r;c<=n;c++){var l=s*this.columns+c,u=this.grid[l],p=this.pointerTail;p?(this.pointerTail=this.pointers[p],this.pointers[p-1]=t,this.pointers[p]=u,this.grid[l]=p):this.grid[l]=this.pointers.push(t,u)-1}},e.prototype.remove=function(e){var t=this.items.indexOf(e)+1;if(t){this.indexPool.push(t),this.items[t-1]=null;for(var r=i.clamp((e.aabb[0]*this.invCellWidth|0)-this.columnOffset,0,this.columns-1),n=i.clamp((e.aabb[2]*this.invCellWidth|0)-this.columnOffset,0,this.columns-1),a=i.clamp((e.aabb[1]*this.invCellHeight|0)-this.rowOffset,0,this.rows-1),o=i.clamp((e.aabb[3]*this.invCellHeight|0)-this.rowOffset,0,this.rows-1),s=a;s<=o;s++)for(var c=r;c<=n;c++)for(var l=s*this.columns+c,u=0,p=this.grid[l];p;u=p,p=this.pointers[p])if(this.pointers[p-1]===t){u?this.pointers[u]=this.pointers[p]:this.grid[l]=this.pointers[p],this.pointers[p-1]=0,this.pointers[p]=this.pointerTail,this.pointerTail=p;break}}},e.prototype.query=function(e,t){void 0===t&&(t=!1),this.visited.length=Math.max(this.visited.length,this.items.length);var r=0,n=i.clamp((e[0]*this.invCellWidth|0)-this.columnOffset,0,this.columns-1),a=i.clamp((e[2]*this.invCellWidth|0)-this.columnOffset,0,this.columns-1),o=i.clamp((e[1]*this.invCellHeight|0)-this.rowOffset,0,this.rows-1),s=i.clamp((e[3]*this.invCellHeight|0)-this.rowOffset,0,this.rows-1);t&&console.log(n,a,o,s);for(var c=o;c<=s;c++)for(var l=n;l<=a;l++)for(var u=c*this.columns+l,p=this.grid[u];p;p=this.pointers[p]){var h=this.pointers[p-1];h&&!this.visited[h-1]&&(this.visited[h-1]=!0,this.queryOutput[r++]=h-1)}for(var f=r-1;f>=0;f--)this.visited[this.queryOutput[f]]=!1;return r},e.prototype.clear=function(){this.items.length=0;for(var e=this.grid.length-1;e>=0;e--)this.grid[e]=0;this.pointerTail=Math.max(0,this.pointers.length-1);var t=0;for(e=this.pointers.length-1;e>0;t=e,e-=2)this.pointers[e-1]=0,this.pointers[e]=t},e}();t.SpatialGrid=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createWallMesh=t.createTerrainMesh=void 0;var i=r(1);t.createTerrainMesh=function(e,t){var r=2*t.width,n=2*t.height,a=[],o=[],s=i.vec2();e.sort((function(e,t){return Math.min(e[0][1],e[1][1])-Math.min(t[0][1],t[1][1])}));for(var c=0,l=0;l<e.length;l++){var u=e[l],p=u[0],h=u[1];i.vec2.subtract(h,p,s);var f=i.vec2.rotation(s);if(!(Math.abs(s[0])<1e-6))for(var d=i.vec2.magnitude(s),v=-n*Math.sin(f),m=1+i.mod((p[0]+p[1]*Math.sqrt(2))/r,1),y=m+d/r,g=m-v/r,b=y-v/r,_=Math.min(m,g),P=Math.max(y,b);_<P;){var S=Math.min(P,_+(1-i.mod(_,1))),x=i.clamp((_-m)/(y-m),0,1),A=i.clamp((S-m)/(y-m),0,1),O=i.clamp((_-g)/(b-g),0,1),w=i.clamp((S-g)/(b-g),0,1);a[c+0]=i.lerp(p[0],h[0],x),a[c+1]=i.lerp(p[1],h[1],x),a[c+2]=i.lerp(p[0],h[0],A),a[c+3]=i.lerp(p[1],h[1],A),a[c+4]=i.lerp(p[0],h[0],w),a[c+5]=i.lerp(p[1],h[1],w)+n,a[c+6]=i.lerp(p[0],h[0],O),a[c+7]=i.lerp(p[1],h[1],O)+n;var M=i.lerp(m,y,x),T=i.lerp(m,y,A),E=i.lerp(g,b,O),C=i.lerp(g,b,w),B=Math.max(Math.floor(M),Math.floor(E));o[c+0]=i.clamp(M-B,0,1),o[c+2]=i.clamp(T-B,0,1),o[c+4]=i.clamp(C-B,0,1),o[c+6]=i.clamp(E-B,0,1),o[c+1]=0,o[c+3]=0,o[c+5]=1,o[c+7]=1,c+=8,_=S}}return{vertices:a,uvs:o}},t.createWallMesh=function(e,t){for(var r=t.width,n=t.height,a=[],o=[],s=0,c=0;c<e.length;c++){var l=e[c],u=l[0],p=l[1];if(!(Math.abs(u[0]-p[0])>1e-6))for(var h=Math.min(u[1],p[1]),f=Math.max(u[1],p[1])+2*n,d=f-h,v=p[1]>u[1]?n:-n,m=i.mod(u[1],1),y=m+d/r,g=m;g<y;){var b=Math.min(y,g+(1-i.mod(g,1))),_=i.clamp((g-m)/(y-m),0,1),P=i.clamp((b-m)/(y-m),0,1);a[s+0]=a[s+2]=u[0]-v,a[s+1]=a[s+7]=i.lerp(h,f,_),a[s+3]=a[s+5]=i.lerp(h,f,P),a[s+4]=a[s+6]=u[0]+v,o[s+0]=o[s+6]=_,o[s+1]=o[s+3]=0,o[s+2]=o[s+4]=P,o[s+5]=o[s+7]=1,s+=8,g=b}}return{vertices:a,uvs:o}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createPlants=void 0;var i=r(1),n=r(2),a=r(4),o=r(7),s=r(95);t.createPlants=function(e,t,r,c){for(var l=i.vec2(.5,.86),u=i.rgba(138,138,138,255),p=[0,0,1,1,1,1,2,2,3,4,5],h=0;h<t.length;h++){var f=t[h],d=f[0],v=f[1],m=Math.abs(d[0]-v[0]);if(!(m<1e-6))for(var y=Math.floor(m*(1/400))*p[i.randomInt(0,p.length-1,o.rng)];y>0;y--){var g=["a","b","c"][r],b=i.vec2.lerp(d,v,i.randomFloat(0,1,o.rng),i.vec2());i.vec2.add(b,c,b);var _=i.randomFloat(-.16,.16,o.rng),P=i.vec2(i.randomFloat(.8,2,o.rng)),S=e.createEntity();e.createComponent(S,n.Transform2D,{position:b,rotation:_,scale:P}),e.createComponent(S,a.Sprite2D,{origin:l,order:-1032}),e.createComponent(S,a.Material,{program:0,blend:1,color:u,texture:"terrain/root_"+g+".png"});var x=e.createEntity();e.createComponent(x,n.Transform2D,{parent:S}),e.createComponent(x,a.Sprite2D,{origin:l,order:-1034}),e.createComponent(x,a.Material,{program:0,blend:1,color:u,texture:"terrain/stem_"+g+"_"+i.randomInt(0,3,o.rng)+".png"}),e.createComponent(S,s.Plant,{radius:250,timeScale:2,element:x})}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createShockwave=void 0;var i=r(1),n=r(4),a=r(2),o=r(15),s=r(8),c=r(13),l=r(12),u=r(192),p=r(193);t.createShockwave=function(e){return function(t){var r,h,f=e.resolveSystem(c.CameraSystem).camera,d=e.createEntity(),v=e.createComponent(d,n.ShaderMaterial,{blend:0,vertexSource:u,fragmentSource:p,attributes:{uRadius:0,uAmplitude:0,uCenter:i.vec2(0,0)}}),m=e.createComponent(d,o.AnimationMixer,[{initial:0,interpolate:i.lerp,set:function(e){v.attributes.uRadius=e},samplers:(r={},r.play=o.KeyframeSampler(i.lerp)([{time:0,value:0},{time:.5,value:800,ease:i.ease.sineIn},{time:.8,value:200,ease:i.ease.quadOut},{time:2,value:1200,ease:i.ease.sineOut}]),r)},{initial:0,interpolate:i.lerp,set:function(e){v.attributes.uAmplitude=e},samplers:(h={},h.play=o.KeyframeSampler(i.lerp)([{time:0,value:0},{time:.5,value:-.5,ease:i.ease.sineIn},{time:.8,value:.3,ease:i.ease.sineIn},{time:2,value:0,ease:i.ease.sineOut}]),h)}]);e.createComponent(d,s.AudioSource,{clip:"sfx/shockwave.mp3",loop:!1,volume:1,rate:1,channel:e.resolveSystem(l.SoundscapeSystem).sfx}),e.createComponent(d,s.SpatialAudio,{offset:i.vec3(t[0],t[1],0),radius:512});var y=e.aquireComponent(f,a.Camera2D);y.timeframe=e.linkEntity(d,y.postEffects,y.timeframe),v.attributes.uCenter=t;m.createAnimation("play",!0);var g=e.aquireComponent(d,s.AudioSource);g.callback=e.removeEntity.bind(e,d),g.play()}}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SoundscapeSystem=void 0;var a=r(1),o=r(3),s=r(22),c=r(8),l=r(13),u=function(e){function t(t){var r=e.call(this,t)||this;return r.priority=-32,r.position=a.vec3(),r.music=r.manager.createEntity(),r.sfx=r.manager.createEntity(),r.manager.createComponent(r.music,c.AudioChannel,{volume:.5}),r.manager.createComponent(r.sfx,c.AudioCompressor,{volume:.5,compressor:{threshold:-24,knee:30,ratio:12,attack:.003,release:.25}}),r}return n(t,e),t.prototype.execute=function(e){this.theme||(this.theme=this.manager.createEntity(),this.manager.createComponent(this.theme,c.AudioSource,{clip:"music/theme-a.mp3",loop:!0,volume:1,rate:1,channel:this.music}),this.manager.aquireComponent(this.theme,c.AudioSource).play(1,1));var t=this.manager.resolveSystem(l.CameraSystem).camera,r=this.manager.resolveSystem(c.AudioSystem).listener,i=this.manager.aquireComponent(t,s.Transform2D);i.lastFrame>0&&i.lastFrame<=r.lastFrame||(a.vec3.copy(a.vec3.ZERO,this.position),a.mat3x2.transform(this.position,i.globalTransform,this.position),r.position=this.position)},t}(o.ProcedureSystem);t.SoundscapeSystem=u},function(e,t){e.exports="attribute vec2 aPosition;\n\nuniform mat3 uViewMatrix;\nuniform mat3 uInvViewMatrix;\nuniform vec4 uViewport;\n\nuniform vec2 uCenter;\nuniform float uRadius;\n\nvarying vec2 vUV;\nvarying vec2 vDirection;\nvarying vec2 vCenter;\n\nvoid main(void){\n    vUV = (0.5 + 0.5 * aPosition) * uViewport.zw + uViewport.xy;\n    gl_Position = vec4(aPosition, 0.0, 1.0);\n    \n    vec3 worldPosition = uInvViewMatrix * vec3(aPosition, 1.0);\n    vDirection = (worldPosition.xy - uCenter) / uRadius;\n    vCenter = (0.5 + 0.5 * (uViewMatrix * vec3(uCenter, 1.0)).xy) * uViewport.zw + uViewport.xy;\n}"},function(e,t){e.exports="varying vec2 vUV;\nvarying vec2 vDirection;\nvarying vec2 vCenter;\n\nuniform sampler2D uSampler;\nuniform vec4 uViewport;\n\nuniform float uAmplitude;\n\nfloat bulge(in float distance){\n    return distance*distance*distance*distance*(3.0 - 2.0 * distance*distance);\n}\n\nfloat pinch(in float distance){\n    return mix(1.0, pow(distance, uAmplitude), 1.0 - distance);\n}\n\nvoid main(){\n    float distance = clamp(length(vDirection),-1.0,1.0);\n\n    float displacement = (\n        mix(1.0, bulge(distance), uAmplitude * step(0.0, uAmplitude)) *\n        mix(1.0, pinch(distance), -uAmplitude * step(0.0, -uAmplitude))\n    );\n\n    vec2 uv = vUV - vCenter;\n    uv *= displacement;\n    uv += vCenter;\n    uv = clamp(uv, uViewport.xy, uViewport.xy + uViewport.zw);\n\n    vec4 color = texture2D(uSampler, uv);\n    gl_FragColor = mix(color, color * vec4(0.6,1.4,1.6,1.0), max(-0.36, 1.0 - displacement));  \n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createGlitch=void 0;var i=r(1),n=r(4),a=r(2),o=r(15),s=r(8),c=r(13),l=r(12),u=r(195);t.createGlitch=function(e){return function(t){var r,p;void 0===t&&(t=1);var h=e.resolveSystem(c.CameraSystem).camera,f=e.createEntity(),d=e.createComponent(f,n.ShaderMaterial,{blend:0,fragmentSource:u,attributes:{uTime:0,uIntensity:0}}),v=e.createComponent(f,o.AnimationMixer,[{initial:0,interpolate:i.lerp,set:function(e){d.attributes.uTime=e},samplers:(r={},r.play=function(e){return e},r)},{initial:0,interpolate:i.lerp,set:function(e){d.attributes.uIntensity=e},samplers:(p={},p.play=o.KeyframeSampler(i.lerp)([{time:0,value:0},{time:.5*t,value:1,ease:i.ease.quadOut},{time:t,value:0,ease:i.ease.quadIn}]),p)}]);e.createComponent(f,s.AudioSource,{clip:"sfx/glitch.mp3",loop:!1,volume:1,rate:1,channel:e.resolveSystem(l.SoundscapeSystem).sfx});var m=e.aquireComponent(h,a.Camera2D);m.timeframe=e.linkEntity(f,m.postEffects,m.timeframe),e.aquireComponent(f,s.AudioSource).play(),v.createAnimation("play",!0).callback=e.removeEntity.bind(e,f)}}},function(e,t){e.exports="precision highp float;\nvarying vec2 vUV;\nvarying vec2 vScreenPosition;\nvarying vec2 vWorldPosition;\n\nuniform sampler2D uSampler;\n\nuniform float uTime;\nuniform float uIntensity;\n//uniform float uChromaticAberration;\n\nfloat rand(float n){return fract(sin(n) * 43758.5453123);}\nfloat rand(vec2 n){return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);}\nfloat noise(float p){\n\tfloat fl = floor(p);\n    float fc = fract(p);\n\treturn mix(rand(fl), rand(fl + 1.0), fc);\n}\nfloat noise(vec2 n){\n\tconst vec2 d = vec2(0.0, 1.0);\n    vec2 b = floor(n), f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n}\n\nfloat blockNoise(float p, float threshold, float seed){\n    float n = noise(128.0 * vec2(p, p));\n    float i = floor(n * 24.0);\n    i = noise(i + seed) - 0.5;\n    return i * step(abs(i), threshold);\n}\n\nvoid main(void){\n    vec2 uv = vUV;\n\n    float noiseOffset = floor(uTime + sin(13.0 * uTime) + sin(uTime)) * 0.64;\n\n    float displaceIntesnsity = uIntensity * (0.2 + 0.3 * pow(sin(uTime * 1.2), 5.0));\n    float displace = blockNoise(uv.y / 25.0 + noiseOffset, displaceIntesnsity, 131.79);\n    displace *= blockNoise(2.0 * uv.x / 111.0 + noiseOffset, displaceIntesnsity, 11.89);\n    \n    uv.x += displace;\n    \n    float rgbIntesnsity = uIntensity * (0.1 + 0.1 * sin(uTime * 5.2));\n    vec2 uvOffset = 0.1 * vec2(blockNoise(uv.y / 65.0 + noiseOffset, rgbIntesnsity, 893.32), 0.0);\n    \n    float red = texture2D(uSampler, uv-uvOffset).r;\n\tfloat green = texture2D(uSampler, uv).g;\n    float blue = texture2D(uSampler, uv+uvOffset).b;\n\n    vec3 mask = vec3(1.0, 1.0, 1.0);\n    \n    float dropoutIntensity = uIntensity * 0.2;\n    float dropout = blockNoise(uv.y / 23.0 + noiseOffset, dropoutIntensity, uTime) * blockNoise(uv.x / 31.0 + noiseOffset, dropoutIntensity, uTime);\n    mask *= (1.0 - 8.0 * dropout);\n    \n    gl_FragColor = vec4(mask * vec3(red, green, blue), 1.0);\n}"},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.RevealSystem=void 0;var a=r(1),o=r(3),s=r(2),c=r(24),l=r(4),u=r(7),p=function(e){function t(t,i){var n,o=e.call(this,t)||this;o.globalAttributes={uTime:0},o.blocks=[];for(var p=0;p<i.length;p++){var h=i[p],f=h[0],d=h[1],v=t.createEntity();t.createComponent(v,s.Transform2D,{position:a.vec2(.5*(f[0]+f[2]),.5*(f[1]+f[3])),scale:a.vec2(f[2]-f[0],f[3]-f[1])}),t.createComponent(v,c.RigidBody,{mass:0,type:0,shapes:[new c.Box(a.vec2.ZERO,0,f[2]-f[0],f[3]-f[1])]}),t.createComponent(v,l.Sprite2D,{order:2176,origin:l.Sprite2D.CENTER}),t.createComponent(v,l.ShaderMaterial,{program:1,blend:1,vertexSource:r(197),fragmentSource:r(198),attributes:o.globalAttributes}),t.createComponent(v,s.AnimationMixer,[u.bindAnimationProperty(t,v,u.AnimationProperty.color,(n={},n[0]=s.StaticSampler(a.rgba(255,255,255,0)),n))]),o.blocks[d]=o.blocks[d]||[],o.blocks[d].push(v)}return o}return n(t,e),t.prototype.toggleBlock=function(e,t){var r=this.blocks[e];if(r)for(var i=0;i<r.length;i++){var n=r[i];t?(this.manager.aquireComponent(n,c.RigidBody).collisionResponse=!1,this.manager.aquireComponent(n,s.AnimationMixer).createAnimation("0").start(2,2)):(this.manager.aquireComponent(n,c.RigidBody).collisionResponse=!0,this.manager.aquireComponent(n,s.AnimationMixer).tracks.forEach((function(e){return e.end(.5,.5)})))}},t.prototype.execute=function(e){this.globalAttributes.uTime+=e.deltaTime},t}(o.ProcedureSystem);t.RevealSystem=p},function(e,t){e.exports="attribute vec2 aPosition;\nattribute vec2 aUV;\nattribute vec4 aColor;\n\nuniform mat3 uProjectionMatrix;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec2 vWorldPosition;\n\nvoid main(void){\n    vWorldPosition = aPosition;\n    vec2 position = (uProjectionMatrix * vec3(aPosition, 1.0)).xy;\n    gl_Position = vec4(position, 0.0, 1.0);\n    vUV = aUV;\n    vColor = aColor;\n}"},function(e,t){e.exports="precision highp float;\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec2 vWorldPosition;\n\nuniform float uTime;\n\nmat2 rotationMat2(in float theta){float c = cos(theta);float s = sin(theta);return mat2(c,-s,s,c);}\nfloat rand(float n){return fract(sin(n) * 43758.5453123);}\nfloat rand(vec2 n){return fract(sin(dot(n, vec2(12.9898, 4.1414))) * 43758.5453);}\nfloat rand(ivec2 n){return rand(vec2(n));}\n\nfloat noise(float p){\n\tfloat fl = floor(p);\n    float fc = fract(p);\n\treturn mix(rand(fl), rand(fl + 1.0), fc);\n}\n\nfloat noise(vec2 n){\n\tconst ivec2 d = ivec2(0.0, 1.0);\n    ivec2 b = ivec2(floor(n)); \n    vec2 f = smoothstep(vec2(0.0), vec2(1.0), fract(n));\n\treturn mix(mix(rand(b), rand(b + d.yx), f.x), mix(rand(b + d.xy), rand(b + d.yy), f.x), f.y);\n}\n\nfloat fbm(in vec2 p, in float time, in int octaves, in float lacunarity, in float gain){\n\tfloat z=2.0;\n    float rz=0.0;\n    float n = noise(p * 0.5 + vec2(0.0, time));\n    mat2 rm = rotationMat2(-0.64);\n\tfor(int i=1;i<4;i++){\n        p += vec2(n,time*0.5);\n\n        n = noise(p + n - time / z);\n        rz += (sin(n*5.0)*0.5+0.5) / z;\n\t\t\t\t\n\t\tz *= gain;\n        p *= rm * lacunarity;\n\t}\n\treturn rz;\t\n}\n\nfloat frame(in vec2 uv, in float width, in vec2 offset){\n    vec2 rect = abs(uv - 0.5) + offset;\n    return smoothstep(0.5, 0.5 - width, max(rect.x, rect.y));\n}\n\nvoid main(void){\n    vec2 uv = vWorldPosition * 0.016;\n    float n0 = fbm(uv, uTime, 4, 2.0, 1.2);\n    float border = 0.1;\n    float fr = frame(vUV, border, vec2(border * n0));\n    float rz = n0 * smoothstep(.0,.5,fr);\n\n    vec3 color = vec3(1.0 - rz);\n    color = mix(color, vec3(0.6,0.1,0.2), smoothstep(0.8,0.2,rz*rz));\n    color = 0.8 * mix(color, vec3(0.8,0.6,0.6), smoothstep(0.2,0.0,rz*rz));\n\n    float width = 0.2;\n    float edge = mix(-width, 1.0, vColor.a * fr);\n    float fade = smoothstep(edge, edge + width, max(0.0, 1.0-rz));\n    color.gb *= smoothstep(0.8, 0.5, fade);\n\n    color.rgb = floor(color.rgb * 8. + .5) / 8.;\n    gl_FragColor = vec4(vColor.rgb * color, 1.0 - fade);\n}"},function(e,t,r){"use strict";var i,n,a,o,s,c,l,u,p,h,f,d,v,m,y,g,b,_,P,S,x,A,O,w,M,T,E,C,B,I,j,D,q,F,R,k,V,L,N,z,G,K,U,H,W,X,Y,Z,J,Q,$,ee,te,re,ie,ne,ae,oe,se,ce,le,ue,pe,he=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.createPuzzleKnot=void 0;var fe=r(27),de=r(1),ve=r(2),me=r(15),ye=r(4),ge=r(7),be=r(57),_e=r(28),Pe=((i={})[0]=[{target:"eye",property:ge.AnimationProperty.position,animations:(n={},n.opened=function(e,t){var r=this.context.manager.aquireComponent(this.context.entity,ve.Transform2D),i=this.context.manager.resolveSystem(_e.CharacterSystem).character,n=this.context.manager.aquireComponent(i,ve.Transform2D);de.vec2.fromValues(n.globalTransform[4]-r.globalTransform[4],n.globalTransform[5]-r.globalTransform[5],t);var a=de.vec2.magnitude(t),o=Math.min(1,a/600);return o=de.ease.quadOut(o),de.vec2.scale(t,30*o*1/a,t),t},n)},{target:"2l",property:ge.AnimationProperty.originX,animations:(a={},a.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.7,ease:de.ease.cubicIn}]),a.opened=me.StaticSampler(.7),a.close=me.KeyframeSampler(de.lerp)([{time:0,value:.7},{time:1,value:.5,ease:de.ease.bounceOut}]),a.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.7},{time:.5,value:.5,ease:de.ease.quadOut},{time:1,value:.7,ease:de.ease.cubicIn}]),a.enabled=me.StaticSampler(.7),a)},{target:"2r",property:ge.AnimationProperty.originX,animations:(o={},o.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.3,ease:de.ease.cubicIn}]),o.opened=me.StaticSampler(.3),o.close=me.KeyframeSampler(de.lerp)([{time:0,value:.3},{time:1,value:.5,ease:de.ease.bounceOut}]),o.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.3},{time:.5,value:.5,ease:de.ease.quadOut},{time:1,value:.3,ease:de.ease.cubicIn}]),o.enabled=me.StaticSampler(.3),o)},{target:"2l",property:ge.AnimationProperty.opacity,animations:(s={},s.open=me.KeyframeSampler(de.lerp)([{time:0,value:1},{time:1,value:0,ease:de.ease.quintIn}]),s.opened=fe.Zero,s.close=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:1,ease:de.ease.quintOut}]),s.enable=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:.5,value:1,ease:de.ease.quintOut},{time:1,value:0,ease:de.ease.quintIn}]),s.enabled=fe.Zero,s)},{target:"2r",property:ge.AnimationProperty.opacity,animations:(c={},c.open=me.KeyframeSampler(de.lerp)([{time:0,value:1},{time:1,value:0,ease:de.ease.quintIn}]),c.opened=fe.Zero,c.close=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:1,ease:de.ease.quintOut}]),c.enable=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:.5,value:1,ease:de.ease.quintOut},{time:1,value:0,ease:de.ease.quintIn}]),c.enabled=fe.Zero,c)},{target:"2r",property:ge.AnimationProperty.rotation,animations:(l={},l.enable=me.StaticSampler(.5*Math.PI),l)},{target:"2l",property:ge.AnimationProperty.rotation,animations:(u={},u.enable=me.StaticSampler(.5*Math.PI),u)},{target:"0l",property:ge.AnimationProperty.rotation,animations:(p={},p.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:.6,value:.5*Math.PI,ease:de.ease.quadOut},{time:1,value:.5*Math.PI}]),p.opened=me.StaticSampler(.5*Math.PI),p.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.5*Math.PI},{time:1,value:0,ease:de.ease.cubicOut}]),p.close=me.KeyframeSampler(de.lerp)([{time:0,value:.5*Math.PI},{time:1,value:0,ease:de.ease.cubicInOut}]),p)},{target:"0r",property:ge.AnimationProperty.rotation,animations:(h={},h.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:.6,value:.5*Math.PI,ease:de.ease.quadOut},{time:1,value:.5*Math.PI}]),h.opened=me.StaticSampler(.5*Math.PI),h.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.5*Math.PI},{time:1,value:0,ease:de.ease.cubicOut}]),h.close=me.KeyframeSampler(de.lerp)([{time:0,value:.5*Math.PI},{time:1,value:0,ease:de.ease.cubicInOut}]),h)},{target:"0l",property:ge.AnimationProperty.originX,animations:(f={},f.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:.6,value:.55,ease:de.ease.quadOut},{time:1,value:.5,ease:de.ease.quadOut}]),f.opened=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:2,value:.53,ease:de.ease.cubicOut},{time:3,value:.5,ease:de.ease.cubicIn}]),f.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:.5,value:.56,ease:de.ease.sineIn},{time:1,value:.52,ease:de.ease.sineOut}]),f.enabled=me.StaticSampler(.52),f)},{target:"0r",property:ge.AnimationProperty.originX,animations:(d={},d.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:.6,value:.45,ease:de.ease.quadOut},{time:1,value:.5,ease:de.ease.quadOut}]),d.opened=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:2,value:.47,ease:de.ease.cubicOut},{time:3,value:.5,ease:de.ease.cubicIn}]),d.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:.5,value:.44,ease:de.ease.sineIn},{time:1,value:.48,ease:de.ease.sineOut}]),d.enabled=me.StaticSampler(.48),d)},{target:"1",property:ge.AnimationProperty.rotation,animations:(v={},v.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:2*Math.PI,ease:de.ease.cubicOut}]),v.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:5,value:-2*Math.PI}]),v.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:15,value:2*Math.PI}]),v)},{target:"3",property:ge.AnimationProperty.rotation,animations:(m={},m.opened=me.KeyframeSampler(de.lerpAngle)([{time:0,value:0},{time:2,value:.4*Math.PI,ease:de.ease.quadInOut},{time:4,value:1.2*Math.PI,ease:de.ease.quadInOut},{time:6,value:0,ease:de.ease.quadInOut}]),m.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:9,value:-2*Math.PI,ease:de.ease.linear}]),m.close=me.StaticSampler(.5*Math.PI),m)},{target:"eye",property:ge.AnimationProperty.scale,animations:(y={},y.open=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(.7,.7)},{time:1,value:de.vec2(1,1),ease:de.ease.sineIn}]),y.close=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(.8,.8),ease:de.ease.quartOut}]),y.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.3,1.3),ease:de.ease.sineOut}]),y.enabled=me.StaticSampler(de.vec2(1.3,1.3)),y)},{target:"eye",property:ge.AnimationProperty.tint,animations:(g={},g.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(63,127,255),ease:de.ease.sineOut}]),g.enabled=me.StaticSampler(de.rgb(63,127,255)),g)},{target:"eye",property:ge.AnimationProperty.color,animations:(b={},b.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(63,63,63,255)},{time:1,value:de.rgba.WHITE,ease:de.ease.cubicOut}]),b.close=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba.WHITE},{time:1,value:de.rgba(63,63,63,255),ease:de.ease.cubicIn}]),b.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba.WHITE},{time:1,value:de.rgba(63,127,255,255),ease:de.ease.linear}]),b.enabled=me.StaticSampler(de.rgba(63,127,255,255)),b)},{target:"glow",property:ge.AnimationProperty.tint,animations:(_={},_.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(63,127,255),ease:de.ease.sineOut}]),_.enabled=me.StaticSampler(de.rgb(63,127,255)),_)},{target:"glow",property:ge.AnimationProperty.color,animations:(P={},P.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba.WHITE,ease:de.ease.quadOut},{time:1,value:de.rgba(255,255,255,0),ease:de.ease.quadIn}]),P.opened=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:2,value:de.rgba(255,255,255,127),ease:de.ease.sineOut},{time:4,value:de.rgba(255,255,255,0),ease:de.ease.sineIn}]),P.enabled=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(63,127,255,0)},{time:4,value:de.rgba(63,127,255,127),ease:de.ease.sineOut},{time:8,value:de.rgba(63,127,255,0),ease:de.ease.sineIn}]),P.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba(63,127,255,255),ease:de.ease.quadOut},{time:1,value:de.rgba(63,127,255,0),ease:de.ease.quadIn}]),P)},{target:"glow",property:ge.AnimationProperty.scale,animations:(S={},S.open=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.4,1.4),ease:de.ease.quadOut}]),S.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.5,1.5),ease:de.ease.quadOut}]),S)},{target:"highlight",property:ge.AnimationProperty.color,animations:(x={},x.highlight=me.StaticSampler(de.rgba.WHITE),x)}],i[1]=[{target:"0l",property:ge.AnimationProperty.rotation,animations:(A={},A.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:-.5*Math.PI,ease:de.ease.sineInOut}]),A.opened=me.StaticSampler(-.5*Math.PI),A.close=me.KeyframeSampler(de.lerp)([{time:0,value:-.5*Math.PI},{time:1,value:0,ease:de.ease.sineOut}]),A.enable=me.KeyframeSampler(de.lerp)([{time:0,value:-.5*Math.PI},{time:1,value:-Math.PI}]),A.enabled=me.StaticSampler(-Math.PI),A)},{target:"0r",property:ge.AnimationProperty.rotation,animations:(O={},O.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:-.5*Math.PI,ease:de.ease.sineInOut}]),O.opened=me.StaticSampler(-.5*Math.PI),O.close=me.KeyframeSampler(de.lerp)([{time:0,value:-.5*Math.PI},{time:1,value:0,ease:de.ease.sineOut}]),O.enable=me.KeyframeSampler(de.lerp)([{time:0,value:-.5*Math.PI},{time:1,value:-Math.PI}]),O.enabled=me.StaticSampler(-Math.PI),O)},{target:"0l",property:ge.AnimationProperty.originY,animations:(w={},w.opened=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:3,value:.55,ease:de.ease.sineIn},{time:6,value:.5,ease:de.ease.sineOut}]),w.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.6,ease:de.ease.quadIn}]),w.enabled=me.StaticSampler(.6),w)},{target:"0r",property:ge.AnimationProperty.originY,animations:(M={},M.opened=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:3,value:.45,ease:de.ease.sineIn},{time:6,value:.5,ease:de.ease.sineOut}]),M.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.4,ease:de.ease.quadIn}]),M.enabled=me.StaticSampler(.4),M)},{target:"2l",property:ge.AnimationProperty.originY,animations:(T={},T.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.62,ease:de.ease.cubicInOut}]),T.opened=me.StaticSampler(.62),T.close=me.KeyframeSampler(de.lerp)([{time:0,value:.62},{time:1,value:.5,ease:de.ease.bounceOut}]),T.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.62},{time:.4,value:.5,ease:de.ease.quadOut},{time:1,value:.62,ease:de.ease.quadIn}]),T.enabled=me.StaticSampler(.62),T)},{target:"2r",property:ge.AnimationProperty.originY,animations:(E={},E.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.38,ease:de.ease.cubicInOut}]),E.opened=me.StaticSampler(.38),E.close=me.KeyframeSampler(de.lerp)([{time:0,value:.38},{time:1,value:.5,ease:de.ease.bounceOut}]),E.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.38},{time:.4,value:.5,ease:de.ease.quadOut},{time:1,value:.38,ease:de.ease.quadIn}]),E.enabled=me.StaticSampler(.38),E)},{target:"2l",property:ge.AnimationProperty.rotation,animations:(C={},C.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:5,value:-2*Math.PI,ease:de.ease.linear}]),C.enable=me.StaticSampler(.5*Math.PI),C.enabled=me.StaticSampler(.5*Math.PI),C)},{target:"2r",property:ge.AnimationProperty.rotation,animations:(B={},B.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:5,value:-2*Math.PI,ease:de.ease.linear}]),B.enable=me.StaticSampler(.5*Math.PI),B.enabled=me.StaticSampler(.5*Math.PI),B)},{target:"1",property:ge.AnimationProperty.rotation,animations:(I={},I.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:2,value:2*Math.PI,ease:de.ease.linear}]),I.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:8,value:-2*Math.PI,ease:de.ease.linear}]),I)},{target:"3",property:ge.AnimationProperty.rotation,animations:(j={},j.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:12,value:-2*Math.PI,ease:de.ease.linear}]),j.close=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:-4*Math.PI,ease:de.ease.quadIn}]),j.enable=me.StaticSampler(.5*Math.PI),j.enabled=me.StaticSampler(.5*Math.PI),j)},{target:"3",property:ge.AnimationProperty.opacity,animations:(D={},D.enable=me.KeyframeSampler(de.lerp)([{time:0,value:1},{time:1,value:0,ease:de.ease.sineOut}]),D.enabled=fe.Zero,D)},{target:"eye",property:ge.AnimationProperty.tint,animations:(q={},q.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(0,255,127),ease:de.ease.sineOut}]),q.enabled=me.StaticSampler(de.rgb(0,255,127)),q)},{target:"eye",property:ge.AnimationProperty.color,animations:(F={},F.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba.WHITE},{time:1,value:de.rgba(0,255,255,255),ease:de.ease.sineOut}]),F.enabled=me.StaticSampler(de.rgba(0,255,255,255)),F)},{target:"glow",property:ge.AnimationProperty.tint,animations:(R={},R.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(63,255,127),ease:de.ease.sineOut}]),R.enabled=me.StaticSampler(de.rgb(63,255,127)),R)},{target:"glow",property:ge.AnimationProperty.color,animations:(k={},k.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba.WHITE,ease:de.ease.quadOut},{time:1,value:de.rgba(255,255,255,0),ease:de.ease.quadIn}]),k.opened=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:2,value:de.rgba(255,255,255,127),ease:de.ease.sineOut},{time:4,value:de.rgba(255,255,255,0),ease:de.ease.sineIn}]),k.enabled=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(63,255,127,0)},{time:4,value:de.rgba(63,255,127,127),ease:de.ease.sineOut},{time:8,value:de.rgba(63,255,127,0),ease:de.ease.sineIn}]),k.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba(63,255,127,255),ease:de.ease.quadOut},{time:1,value:de.rgba(63,255,127,0),ease:de.ease.quadIn}]),k)},{target:"glow",property:ge.AnimationProperty.scale,animations:(V={},V.open=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.4,1.4),ease:de.ease.quadOut}]),V.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.5,1.5),ease:de.ease.quadOut}]),V)},{target:"highlight",property:ge.AnimationProperty.color,animations:(L={},L.highlight=me.StaticSampler(de.rgba.WHITE),L)}],i[2]=[{target:"0",property:ge.AnimationProperty.rotation,animations:(N={},N.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:-.5*Math.PI,ease:de.ease.cubicOut}]),N.opened=me.KeyframeSampler(de.lerp)([{time:0,value:-.5*Math.PI},{time:7,value:2*Math.PI-.5*Math.PI,ease:de.ease.linear}]),N.enable=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:2*Math.PI,ease:de.ease.sineOut}]),N.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:26,value:-2*Math.PI,ease:de.ease.linear}]),N)},{target:"2",property:ge.AnimationProperty.rotation,animations:(z={},z.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:.5*Math.PI,ease:de.ease.cubicOut}]),z.opened=me.KeyframeSampler(de.lerp)([{time:0,value:.5*Math.PI},{time:5,value:-2*Math.PI+.5*Math.PI,ease:de.ease.linear}]),z.enable=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:2*Math.PI,ease:de.ease.sineOut}]),z.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:26,value:-2*Math.PI,ease:de.ease.linear}]),z)},{target:"0",property:ge.AnimationProperty.scale,animations:(G={},G.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.2,1.2),ease:de.ease.sineInOut}]),G.enabled=me.StaticSampler(de.vec2(1.2,1.2)),G)},{target:"2",property:ge.AnimationProperty.scale,animations:(K={},K.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.2,1.2),ease:de.ease.sineInOut}]),K.enabled=me.StaticSampler(de.vec2(1.2,1.2)),K)},{target:"3",property:ge.AnimationProperty.rotation,animations:(U={},U.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:9,value:2*Math.PI,ease:de.ease.linear}]),U.enable=me.StaticSampler(.5*Math.PI),U.enabled=me.StaticSampler(.5*Math.PI),U)},{target:"1",property:ge.AnimationProperty.rotation,animations:(H={},H.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:.5*Math.PI,ease:de.ease.cubicOut}]),H.close=me.KeyframeSampler(de.lerp)([{time:0,value:.5*Math.PI},{time:1,value:0,ease:de.ease.cubicIn}]),H)},{target:"1",property:ge.AnimationProperty.scale,animations:(W={},W.open=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2.ZERO,ease:de.ease.quartIn}]),W.opened=me.StaticSampler(de.vec2.ZERO),W.close=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2.ZERO},{time:1,value:de.vec2(1,1),ease:de.ease.elasticOut}]),W.enable=me.StaticSampler(de.vec2.ZERO),W.enabled=me.StaticSampler(de.vec2.ZERO),W)},{target:"eye",property:ge.AnimationProperty.scale,animations:(X={},X.opened=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(.8,.8)},{time:1,value:de.vec2(1.2,1.2),ease:de.ease.cubicIn},{time:2,value:de.vec2(.8,.8),ease:de.ease.cubicOut}]),X.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.6,1.6),ease:de.ease.elasticOut}]),X.enabled=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1.6,1.6)},{time:3,value:de.vec2(1.3,1.3),ease:de.ease.cubicIn},{time:6,value:de.vec2(1.6,1.6),ease:de.ease.cubicOut}]),X)},{target:"eye",property:ge.AnimationProperty.color,animations:(Y={},Y.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(127,127,127,255)},{time:1,value:de.rgba.WHITE,ease:de.ease.cubicIn}]),Y.opened=me.StaticSampler(de.rgba.WHITE),Y.close=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba.WHITE},{time:1,value:de.rgba(127,127,127,255),ease:de.ease.cubicOut}]),Y.enable=me.StaticSampler(de.rgba.WHITE),Y.enabled=me.StaticSampler(de.rgba.WHITE),Y)},{target:"eye",property:ge.AnimationProperty.tint,animations:(Z={},Z.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(63,255,63),ease:de.ease.quadOut}]),Z.enabled=me.StaticSampler(de.rgb(63,255,63)),Z)},{target:"glow",property:ge.AnimationProperty.tint,animations:(J={},J.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(63,255,63),ease:de.ease.sineOut}]),J.enabled=me.StaticSampler(de.rgb(63,255,63)),J)},{target:"glow",property:ge.AnimationProperty.color,animations:(Q={},Q.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba.WHITE,ease:de.ease.quadOut},{time:1,value:de.rgba(255,255,255,0),ease:de.ease.quadIn}]),Q.opened=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:2,value:de.rgba(255,255,255,127),ease:de.ease.sineOut},{time:4,value:de.rgba(255,255,255,0),ease:de.ease.sineIn}]),Q.enabled=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(127,255,63,0)},{time:4,value:de.rgba(63,255,63,127),ease:de.ease.sineOut},{time:8,value:de.rgba(63,255,63,0),ease:de.ease.sineIn}]),Q.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba(63,255,63,255),ease:de.ease.quadOut},{time:1,value:de.rgba(63,255,63,0),ease:de.ease.quadIn}]),Q)},{target:"glow",property:ge.AnimationProperty.scale,animations:($={},$.open=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.4,1.4),ease:de.ease.quadOut}]),$.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.5,1.5),ease:de.ease.quadOut}]),$)},{target:"highlight",property:ge.AnimationProperty.color,animations:(ee={},ee.highlight=me.StaticSampler(de.rgba.WHITE),ee)}],i[3]=he([{target:"0",property:ge.AnimationProperty.rotation,animations:(te={},te.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:7,value:2*Math.PI,ease:de.ease.linear}]),te.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:16,value:-2*Math.PI,ease:de.ease.linear}]),te)},{target:"2",property:ge.AnimationProperty.rotation,animations:(re={},re.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:5,value:2*Math.PI,ease:de.ease.linear}]),re.enable=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:-2*Math.PI,ease:de.ease.quadOut}]),re.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:13,value:2*Math.PI,ease:de.ease.linear}]),re)},{target:"3",property:ge.AnimationProperty.rotation,animations:(ie={},ie.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:2,value:2*Math.PI,ease:de.ease.linear}]),ie.enable=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:2*Math.PI,ease:de.ease.quadOut}]),ie.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:7,value:-2*Math.PI,ease:de.ease.linear}]),ie)},{target:"4",property:ge.AnimationProperty.rotation,animations:(ne={},ne.opened=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:20,value:-2*Math.PI,ease:de.ease.linear}]),ne.open=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:1,value:2*Math.PI,ease:de.ease.cubicOut}]),ne.enabled=me.KeyframeSampler(de.lerp)([{time:0,value:0},{time:16,value:-2*Math.PI,ease:de.ease.linear}]),ne)}],de.range(6).map((function(e){var t;return{target:"1"+e,property:ge.AnimationProperty.originY,animations:(t={},t.open=me.KeyframeSampler(de.lerp)([{time:0,value:.5},{time:1,value:.62,ease:de.ease.cubicOut}]),t.opened=me.StaticSampler(.62),t.close=me.KeyframeSampler(de.lerp)([{time:0,value:.62},{time:1,value:.5,ease:de.ease.cubicOut}]),t.enable=me.KeyframeSampler(de.lerp)([{time:0,value:.62},{time:.3,value:.63,ease:de.ease.quadOut},{time:1,value:.56,ease:de.ease.elasticOut}]),t.enabled=me.StaticSampler(.56),t)}})),de.range(6).map((function(e){var t;return{target:"1"+e,property:ge.AnimationProperty.rotation,animations:(t={},t.opened=me.KeyframeSampler(de.lerp)([{time:0,value:2*e*Math.PI/6},{time:8,value:-2*Math.PI+2*e*Math.PI/6,ease:de.ease.linear}]),t)}})),[{target:"eye",property:ge.AnimationProperty.tint,animations:(ae={},ae.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(127,255,0),ease:de.ease.sineOut}]),ae.enabled=me.StaticSampler(de.rgb(127,255,0)),ae)},{target:"eye",property:ge.AnimationProperty.color,animations:(oe={},oe.opened=me.StaticSampler(de.rgba.WHITE),oe.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(127,127,127,255)},{time:1,value:de.rgba.WHITE,ease:de.ease.quadOut}]),oe.close=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba.WHITE},{time:1,value:de.rgba(127,127,127,255),ease:de.ease.quadIn}]),oe.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba.WHITE},{time:1,value:de.rgba(127,255,0,255),ease:de.ease.sineOut}]),oe.enabled=me.StaticSampler(de.rgba(127,255,0,255)),oe)},{target:"glow",property:ge.AnimationProperty.tint,animations:(se={},se.enable=me.KeyframeSampler(de.rgb.lerp)([{time:0,value:de.rgb.BLACK},{time:1,value:de.rgb(127,255,0),ease:de.ease.sineOut}]),se.enabled=me.StaticSampler(de.rgb(127,255,0)),se)},{target:"glow",property:ge.AnimationProperty.color,animations:(ce={},ce.open=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba.WHITE,ease:de.ease.quadOut},{time:1,value:de.rgba(255,255,255,0),ease:de.ease.quadIn}]),ce.opened=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:2,value:de.rgba(255,255,255,127),ease:de.ease.sineOut},{time:4,value:de.rgba(255,255,255,0),ease:de.ease.sineIn}]),ce.enabled=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(127,255,63,0)},{time:4,value:de.rgba(127,255,63,127),ease:de.ease.sineOut},{time:8,value:de.rgba(127,255,63,0),ease:de.ease.sineIn}]),ce.enable=me.KeyframeSampler(de.rgba.lerp)([{time:0,value:de.rgba(255,255,255,0)},{time:.4,value:de.rgba(127,255,63,255),ease:de.ease.quadOut},{time:1,value:de.rgba(127,255,63,0),ease:de.ease.quadIn}]),ce)},{target:"glow",property:ge.AnimationProperty.scale,animations:(le={},le.open=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.4,1.4),ease:de.ease.quadOut}]),le.enable=me.KeyframeSampler(de.vec2.lerp)([{time:0,value:de.vec2(1,1)},{time:1,value:de.vec2(1.5,1.5),ease:de.ease.quadOut}]),le)},{target:"highlight",property:ge.AnimationProperty.color,animations:(ue={},ue.highlight=me.StaticSampler(de.rgba.WHITE),ue)}]),i),Se=((pe={})[0]=[{key:"eye",order:0,texture:"knot/a_eye.png"},{key:"3",order:0,texture:"knot/a_3.png"},{key:"2r",order:0,texture:"knot/a_2r.png"},{key:"2l",order:0,texture:"knot/a_2l.png"},{key:"1",order:0,texture:"knot/a_1.png"},{key:"0r",order:0,texture:"knot/a_0r.png"},{key:"0l",order:0,texture:"knot/a_0l.png"},{key:"glow",order:2048,texture:"knot/a_glow.png",blend:2,color:de.rgba(255,255,255,0)}],pe[1]=[{key:"eye",order:0,texture:"knot/b_eye.png"},{key:"3",order:0,texture:"knot/b_3.png"},{key:"2r",order:0,texture:"knot/b_2r.png"},{key:"2l",order:0,texture:"knot/b_2l.png"},{key:"1",order:0,texture:"knot/b_1.png"},{key:"0r",order:0,texture:"knot/b_0r.png"},{key:"0l",order:0,texture:"knot/b_0l.png"},{key:"glow",order:2048,texture:"knot/b_glow.png",blend:2,color:de.rgba(255,255,255,0)}],pe[2]=[{key:"4",order:0,texture:"knot/c_4.png"},{key:"eye",order:0,texture:"knot/c_eye.png",color:de.rgba(127,127,127,255)},{key:"3",order:0,texture:"knot/c_3.png"},{key:"2",order:0,texture:"knot/c_2.png"},{key:"1",order:0,texture:"knot/c_1.png"},{key:"0",order:0,texture:"knot/c_0.png"},{key:"glow",order:2048,texture:"knot/c_glow.png",blend:2,color:de.rgba(255,255,255,0)}],pe[3]=he([{key:"eye",order:0,texture:"knot/d_eye.png",color:de.rgba(127,127,127,255)},{key:"4",order:0,texture:"knot/d_4.png"},{key:"3",order:0,texture:"knot/d_3.png"},{key:"2",order:0,texture:"knot/d_2.png"}],de.range(6).map((function(e){return{key:"1"+e,order:0,texture:"knot/d_1.png",rotation:2*e*Math.PI/6}})),[{key:"0",order:0,texture:"knot/d_0.png"},{key:"glow",order:2048,texture:"knot/d_glow.png",blend:2,color:de.rgba(255,255,255,0)}]),pe),xe=Object.create(null);t.createPuzzleKnot=function(e,t,r,i,n,a,o){var s,c,l,u,p=e.createEntity();e.createComponent(p,ve.Transform2D,{position:de.vec2(r,i),scale:de.vec2(0===t||1!=n?n:de.randomFloat(.86,1,ge.rng))}),e.createComponent(p,be.PuzzleKnot,t);var h=de.randomInt(0,3,ge.rng),f=e.createEntity();e.createComponent(f,ve.Transform2D,{parent:p,rotation:2!=h?de.randomFloat(0,2*Math.PI,ge.rng):0}),e.createComponent(f,ye.Material,{program:0,blend:1,texture:"knot/back_"+h+".png"}),e.createComponent(f,ye.Sprite2D,{origin:ye.Sprite2D.CENTER,order:-1032});var d=xe.highlight=e.createEntity();e.createComponent(d,ve.Transform2D,{parent:p}),e.createComponent(d,ye.Material,{program:0,blend:2,texture:"effects/highlight.png",color:de.rgba(255,255,255,0)}),e.createComponent(d,ye.Sprite2D,{origin:ye.Sprite2D.CENTER,order:2048}),Se[t].forEach((function(t){var r=t.key,i=t.order,n=t.texture,a=t.blend,o=void 0===a?1:a,s=t.color,c=t.rotation,l=void 0===c?0:c,u=xe[r]=e.createEntity();e.createComponent(u,ve.Transform2D,{parent:p,rotation:l}),e.createComponent(u,ye.Material,{program:0,blend:o,texture:n,color:s}),e.createComponent(u,ye.Sprite2D,{origin:ye.Sprite2D.CENTER,order:i})}));var v=e.aquireComponent(p,be.PuzzleKnot),m=Pe[t].map((function(t){var r=t.target,i=t.property,n=t.animations;return ge.bindAnimationProperty(e,xe[r],i,n,v)}));return m.push(ge.bindAnimationTrigger(e,(function(){return a(v)}),((s={}).enable=fe.One,s))),m.push(ge.bindAnimationTrigger(e,(function(){return o(v,"enable")}),((c={}).enable=fe.One,c))),m.push(ge.bindAnimationTrigger(e,(function(){return o(v,"close")}),((l={}).close=fe.One,l))),m.push(ge.bindAnimationTrigger(e,(function(){return o(v,"open")}),((u={}).open=fe.One,u))),e.createComponent(p,me.AnimationMixer,m),p}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.animateWire=void 0;var i=r(1),n=r(2),a=r(4),o=r(201),s=r(7),c=r(58);t.animateWire=function(e,t,r){var l,u,p=e.createEntity();e.createComponent(p,a.Material,{program:0,blend:2,texture:"knot/wire_glow.png"});var h=e.createComponent(p,o.FadeCurve,{order:-6,smoothness:1,path:[]});e.createComponent(p,n.AnimationMixer,[{initial:0,interpolate:i.lerp,set:function(e){h.fadeOffset=r?1-e:e,h.lastFrame=-1},samplers:(l={},l.flow=n.KeyframeSampler(i.lerp)([{time:0,value:0},{time:1.6,value:1,ease:i.ease.linear}]),l)},{interpolate:i.step,set:function(){var r=e.aquireComponent(t.entity,a.Curve);h.curve=r.curve,h.lastFrame=-1},samplers:{}},s.bindAnimationProperty(e,t.entity,{component:c.PuzzleWire,interpolate:i.lerp,initial:function(e){return e.tension},set:function(e,t){e.tension=t}},(u={},u.flow=n.KeyframeSampler(i.lerp)([{time:0,value:1},{time:.8,value:.2,ease:i.ease.sineOut},{time:1.6,value:1,ease:i.ease.sineIn}]),u))]).createAnimation("flow",!0).callback=e.removeEntity.bind(e,p)}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.FadeCurve=void 0;var a=r(14),o=r(63),s=r(5),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.colors=new Uint32Array(0),t.fadeOffset=0,t}return n(t,e),t.prototype.setup=function(t){e.prototype.setup.call(this,t),this.fadeOffset=0},t.prototype.reallocate=function(){e.prototype.reallocate.call(this);var t=2*this.curve.length;this.colors.length!==t&&(this.colors=new Uint32Array(t))},t.prototype.calculateVertexData=function(r,i,n){if(e.prototype.calculateVertexData.call(this,r,i,n),this.lastFrame==n)for(var c=this.colors.length>>>1,l=2*this.fadeOffset-1,u=t.color,p=0;p<c;p++){var h=p/(c-1);u[3]=255*o.fade(s.clamp(h+l,0,1)),this.colors[2*p+0]=this.colors[2*p+1]=a.rgba.uint8Hex(u,i.premultiply?u[3]/255:1)}},t.color=a.rgba(255,255,255,255),t}(r(89).Curve);t.FadeCurve=c},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.activateParticles=t.createEntryEmitter=void 0;var i=r(1),n=r(2),a=r(23),o=r(4),s=r(7);function c(e,t){var r=e.createEntity();e.createComponent(r,n.Transform2D,{parent:t.entity});var s=e.createComponent(r,a.ParticleEmitter,{spawners:[a.BillboardParticle.bindProperty(a.BillboardParticle.set.position,a.AreaSampler.circle(i.vec2.ZERO,i.vec2(60,100))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.velocity,a.AreaSampler.targeted(a.AreaSampler.static(i.vec2.ZERO),i.vec2(-150,-100))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.acceleration,a.AreaSampler.range(i.vec2.lerp,i.vec2())(i.vec2(0,-120),i.vec2(0,-70))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.life,a.AreaSampler.static(2)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.originalSize,a.AreaSampler.range(i.lerp)(10,40))],updaters:[a.verletIntegration,a.BillboardParticle.bindProperty(a.BillboardParticle.set.opacity,n.TweenSampler(i.lerp)(0,1,i.ease.quartOut)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.size,n.TweenSampler(i.lerp)(1,0,i.ease.quadIn))],spawnRate:.2,spawnAmount:1,timeScale:1});e.createComponent(r,o.BillboardBatch,{order:2048,billboards:s.particles}),e.createComponent(r,o.Material,{program:0,blend:2,tint:i.rgb(0,0,119),texture:"effects/particle_c.png"}),t.references.push(r)}t.createEntryEmitter=c,t.activateParticles=function(e){var t=Object.create(null),r=e.createEntity(),l=i.vec2(),u=e.createComponent(r,a.ParticleEmitter,{spawners:[a.BillboardParticle.bindProperty(a.BillboardParticle.set.position,a.AreaSampler.circle(l,i.vec2(80,120))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.rotation,(function(){return Math.atan2(this.position[1]-l[1],this.position[0]-l[0])})),a.BillboardParticle.bindProperty(a.BillboardParticle.set.life,a.AreaSampler.static(3)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.originalSize,a.AreaSampler.range(i.lerp)(20,100)),a.BillboardParticle.bindProperty((function(e,t){return e.speed=t}),a.AreaSampler.range(i.lerp)(80,160))],updaters:[function(e,t){e.position[0]+=t*e.speed*Math.cos(e.rotation),e.position[1]+=t*e.speed*Math.sin(e.rotation),e.rotation-=t*i.randomFloat(-20,20,s.rng),e.speed+=t*i.randomFloat(-30,30,s.rng)},a.BillboardParticle.bindProperty(a.BillboardParticle.set.opacity,n.TweenSampler(i.lerp)(0,1,i.ease.quadOut)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.size,n.TweenSampler(i.lerp)(1,0,i.ease.quadIn))],spawnRate:0,spawnAmount:16,timeScale:1});e.createComponent(r,o.BillboardBatch,{order:2048,billboards:u.particles}),e.createComponent(r,o.Material,{program:0,blend:2,texture:"effects/particle_c.png"}),t[0]={entity:r,emitter:u,targetPosition:l},r=e.createEntity();var p=i.vec2();u=e.createComponent(r,a.ParticleEmitter,{spawners:[a.BillboardParticle.bindProperty(a.BillboardParticle.set.position,a.AreaSampler.circle(p,i.vec2(80,120))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.velocity,a.AreaSampler.targeted(a.AreaSampler.static(p),i.vec2(-250,-80))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.life,a.AreaSampler.range(i.lerp)(1,2)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.size,a.AreaSampler.range(i.lerp)(20,50)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.friction,a.AreaSampler.static(.8))],updaters:[a.verletIntegration,a.BillboardParticle.bindProperty(a.BillboardParticle.set.opacity,n.TweenSampler(i.lerp)(0,1,i.ease.fade)),a.velocityRotation],spawnRate:0,spawnAmount:48,timeScale:1}),e.createComponent(r,o.BillboardBatch,{order:2048,billboards:u.particles}),e.createComponent(r,o.Material,{program:0,blend:2,texture:"effects/particle_b.png"}),t[1]={entity:r,emitter:u,targetPosition:p},r=e.createEntity();var h=i.vec2();return u=e.createComponent(r,a.ParticleEmitter,{spawners:[a.BillboardParticle.bindProperty(a.BillboardParticle.set.position,a.AreaSampler.circle(h,i.vec2(60,100))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.rotation,(function(){return Math.atan2(this.position[1]-h[1],this.position[0]-h[0])})),a.BillboardParticle.bindProperty(a.BillboardParticle.set.life,a.AreaSampler.static(2)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.size,a.AreaSampler.range(i.lerp)(10,70)),a.BillboardParticle.bindProperty((function(e,t){return e.speed=t}),a.AreaSampler.range(i.lerp)(80,160)),function(e){e.phase=i.randomFloat(0,2*Math.PI,s.rng),e.wavelength=e.lifetime*Math.PI*i.randomFloat(2,3,s.rng),e.amplitude=i.randomFloat(-4*Math.PI,4*Math.PI,s.rng)}],updaters:[function(e,t){var r=t*e.amplitude*Math.sin(e.phase+e.wavelength*i.ease.sineOut(1-e.life));e.rotation+=r},function(e,t){e.position[0]+=t*e.speed*Math.cos(e.rotation),e.position[1]+=t*e.speed*Math.sin(e.rotation),e.speed=Math.max(0,e.speed+50*t)},a.BillboardParticle.bindProperty(a.BillboardParticle.set.opacity,n.TweenSampler(i.lerp)(0,1,i.ease.fade)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.color,n.TweenSampler(i.rgb.lerp)(i.rgb(255,255,255),i.rgb(119,255,0),i.ease.sineOut),i.rgb())],spawnRate:0,spawnAmount:48,timeScale:1}),e.createComponent(r,o.BillboardBatch,{order:2048,billboards:u.particles}),e.createComponent(r,o.Material,{program:0,blend:2,texture:"effects/particle_d.png"}),t[2]={entity:r,emitter:u,targetPosition:h},r=e.createEntity(),p=i.vec2(),u=e.createComponent(r,a.ParticleEmitter,{spawners:[a.BillboardParticle.bindProperty(a.BillboardParticle.set.position,a.AreaSampler.circle(p,i.vec2(40,100))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.rotation,a.AreaSampler.range(i.lerp)(0,2*Math.PI)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.angularVelocity,a.AreaSampler.range(i.lerp)(-.2,.2)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.velocity,a.AreaSampler.targeted(a.AreaSampler.static(p),i.vec2(-150,-80))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.acceleration,a.AreaSampler.range(i.vec2.lerp,i.vec2())(i.vec2(0,-150),i.vec2(0,-50))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.life,a.AreaSampler.range(i.lerp)(1,3)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.originalSize,a.AreaSampler.range(i.lerp)(20,60)),function(e){e.phase=i.randomFloat(0,2*Math.PI,s.rng),e.wavelength=e.lifetime*Math.PI*i.randomFloat(1,3,s.rng),e.amplitude=i.randomFloat(400,700,s.rng)}],updaters:[function(e,t){var r=t*e.amplitude*Math.sin(e.phase+e.wavelength*i.ease.quadOut(1-e.life)),n=i.vec2.rotation(e.velocity)+.5*Math.PI;e.velocity[0]+=r*Math.cos(n),e.velocity[1]+=r*Math.sin(n)},a.verletIntegration,a.BillboardParticle.bindProperty(a.BillboardParticle.set.opacity,n.TweenSampler(i.lerp)(1,0,i.ease.quadIn)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.color,n.TweenSampler(i.rgb.lerp)(i.rgb(255,255,255),i.rgb(0,255,255),i.ease.sineIn),i.rgb()),a.BillboardParticle.bindProperty(a.BillboardParticle.set.size,n.TweenSampler(i.lerp)(0,1,i.ease.cubicOut))],spawnRate:0,spawnAmount:16,timeScale:1}),e.createComponent(r,o.BillboardBatch,{order:2048,billboards:u.particles}),e.createComponent(r,o.Material,{program:0,blend:2,texture:"effects/particle_a.png"}),t[3]={entity:r,emitter:u,targetPosition:p},function(r){var a=t[r.type],o=a.emitter,s=a.targetPosition,l=e.aquireComponent(r.entity,n.Transform2D);i.mat3x2.transform(i.vec2.ZERO,l.globalTransform,s),o.emitParticles(),0===r.type&&c(e,r)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.activateSoundEffect=t.wireSoundEffect=void 0;var i=r(8),n=r(2),a=r(12);t.wireSoundEffect=function(e,t){var r=e.createEntity();e.createComponent(r,n.Transform2D,{position:t});var o=e.createComponent(r,i.AudioSource,{clip:"sfx/wire.mp3",loop:!1,volume:1,rate:1,channel:e.resolveSystem(a.SoundscapeSystem).sfx});e.createComponent(r,i.SpatialAudio,{radius:128}),o.play(),o.callback=e.removeEntity.bind(e,r)},t.activateSoundEffect=function(e){var t,r,o,s,c,l=((t={})[0]=((r={}).enable="sfx/knot_a_enable.mp3",r.open="sfx/knot_a_open.mp3",r.close="sfx/knot_a_close.mp3",r),t[1]=((o={}).enable="sfx/knot_b_enable.mp3",o.open="sfx/knot_b_open.mp3",o.close="sfx/knot_b_close.mp3",o),t[2]=((s={}).enable="sfx/knot_c_enable.mp3",s.open="sfx/knot_c_open.mp3",s.close="sfx/knot_c_close.mp3",s),t[3]=((c={}).enable="sfx/knot_d_enable.mp3",c.open="sfx/knot_d_open.mp3",c.close="sfx/knot_d_close.mp3",c),t),u=e.resolveSystem(a.SoundscapeSystem);return function(t,r){var a=e.createEntity();e.createComponent(a,n.Transform2D,{parent:t.entity});var o=e.createComponent(a,i.AudioSource,{clip:l[t.type][r],loop:!1,volume:1,rate:1,channel:u.sfx});e.createComponent(a,i.SpatialAudio,{radius:128}),o.play(),o.callback=e.removeEntity.bind(e,a)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.drawGlyph=void 0;var i=r(1),n=r(2),a=r(4),o=r(7),s=r(205);function c(e){var t,r,n,a,s,c=[],l=[],u=(t=o.rng,r=[-1,0,1],n=2,a=i.range(r.length*n).map((function(e){return r[e%r.length]})),s=a.length-1,function(){s===a.length-1&&i.shuffle(a,t);var e=a[s--];return s=s||a.length-1,e}),p=i.range(0,e.angleSteps).map((function(t){return 2*t*Math.PI/e.angleSteps}));i.shuffle(p,o.rng);for(var h=p.slice(0,i.randomInt(4,6,o.rng)).map((function(e){return{path:[i.vec2(0,0)],start:0,cursor:0,angle:e}}));h.length;){var f=h.pop(),d=e.segmentLength*i.randomInt(1,4,o.rng),v=i.vec2(d,0);if(i.vec2.rotate(v,f.angle,v),i.vec2.add(v,f.path[f.path.length-1],v),f.path.push(v),f.cursor+=d/(e.segmentLength*e.segmentCount),f.cursor>=1)c.push(f.path),l.push([f.start*e.duration,f.cursor*e.duration]);else{f.angle+=2*u()*Math.PI/e.angleSteps;for(var m=i.randomFloat(0,1,o.rng)<i.lerp(.4,.2,f.cursor)?i.randomInt(1,2,o.rng):0;m>0;m--)h.push({path:[v],start:f.cursor,cursor:f.cursor,angle:f.angle+2*u()*Math.PI/e.angleSteps});h.push(f)}}return{paths:c,intervals:l}}t.drawGlyph=function(e,t){var r=e.createEntity();e.createComponent(r,n.Transform2D,{parent:t.entity}),e.createComponent(r,a.Material,{program:0,blend:1,tint:i.rgb(0,63,63),color:i.rgba(127,175,175,255),texture:"effects/line.png"}),e.createComponent(r,a.VectorGraphics,{order:-1152,style:{width:25}}),e.createComponent(r,s.Glyph,c({angleSteps:8,segmentLength:50,segmentCount:12,duration:3.4})),t.references.push(r)}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Glyph=void 0;var a=r(1),o=r(2),s=r(4),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.lengths=[],t}return n(t,e),t.prototype.setup=function(e){var r=e.paths,i=e.intervals;this.elapsedTime=0,this.paths=r,this.totalDuration=i.reduce((function(e,t){return Math.max(e,t[1])}),0),this.remappers=i.map((function(e){return function(r){return a.clamp(a.linearRemap(e,t.normalRange,r),0,1)}})),this.lengths=r.map((function(e){for(var t=[0],r=0,i=0;i<e.length-1;i++)t.push(r+=a.vec2.distance(e[i],e[i+1]));return t}))},t.prototype.reset=function(){},t.prototype.update=function(e,r,i){var n=r.aquireComponent(this.entity,s.VectorGraphics);if(n&&!(this.elapsedTime>=this.totalDuration)){this.elapsedTime+=e.deltaTime,n.clear();for(var o=this.paths.length-1;o>=0;o--){var c=this.paths[o],l=this.lengths[o],u=l[l.length-1],p=this.remappers[o](this.elapsedTime),h=a.ease.quadOut(p)*u,f=void 0;for(f=l.length-1;f>=0&&!(l[f]<=h);f--);for(var d=0;d<=f;d++){var v=c[d];d?n.lineTo(v[0],v[1]):n.beginPath(v[0],v[1])}if(p<1){var m=l[f],y=(h-m)/(l[f+1]-m);a.vec2.lerp(c[f],c[f+1],y,t.temp),n.lineTo(t.temp[0],t.temp[1])}n.stroke(a.rgba.WHITE)}}},t.temp=a.vec2(),t.normalRange=[0,1],t}(o.Behaviour);t.Glyph=c},function(e,t,r){"use strict";var i=this&&this.__assign||function(){return(i=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)};Object.defineProperty(t,"__esModule",{value:!0}),t.createTree=void 0;var n=r(1),a=r(2),o=r(4),s=r(23),c=r(8),l=r(12),u=r(56),p=r(7);t.createTree=function(e,t,r){var h=e.createEntity();e.createComponent(h,a.Transform2D,{position:n.vec2(t,r+200)}),e.createComponent(h,o.Material,{program:0,blend:1,texture:"terrain/branch.png"}),e.createComponent(h,u.Tree,{iterations:12,branchingFactor:.4,width:100,length:120}),e.createComponent(h,o.Mesh2D,i({order:-1028},e.aquireComponent(h,u.Tree).calculateVertexData()));var f=e.createEntity();e.createComponent(f,a.Transform2D,{parent:h});var d=e.createComponent(f,s.ParticleEmitter,{spawners:[s.BillboardParticle.bindProperty(s.BillboardParticle.set.position,s.AreaSampler.aabb(n.AABB(-160,-20,160,20))),s.BillboardParticle.bindProperty(s.BillboardParticle.set.acceleration,s.AreaSampler.range(n.vec2.lerp,n.vec2())(n.vec2(0,-500),n.vec2(0,-200))),s.BillboardParticle.bindProperty(s.BillboardParticle.set.rotation,s.AreaSampler.static(.5*Math.PI)),s.BillboardParticle.bindProperty(s.BillboardParticle.set.life,s.AreaSampler.static(2)),s.BillboardParticle.bindProperty((function(e,t){e.originalScale[1]=t,e.originalScale[0]=10*t}),s.AreaSampler.range(n.lerp)(5,50)),s.BillboardParticle.bindProperty(s.BillboardParticle.set.color,(function(e,t){return t[0]=255,t[1]=.5*(t[2]=n.randomInt(0,255,p.rng)),t}),n.rgb())],updaters:[s.verletIntegration,s.BillboardParticle.bindProperty(s.BillboardParticle.set.opacity,a.TweenSampler(n.lerp)(1,0,n.ease.quadIn)),s.BillboardParticle.bindProperty(s.BillboardParticle.set.size,a.TweenSampler(n.lerp)(0,1,n.ease.quadOut))],spawnRate:.4,spawnAmount:0,timeScale:2});return e.createComponent(f,o.BillboardBatch,{order:2048,billboards:d.particles}),e.createComponent(f,o.Material,{program:0,blend:2,texture:"effects/particle_f.png"}),e.createComponent(h,c.AudioSource,{clip:"sfx/tree_grow.mp3",loop:!1,volume:1,rate:1.5,channel:e.resolveSystem(l.SoundscapeSystem).sfx}),e.createComponent(h,c.SpatialAudio,{offset:n.vec3(0,0,0),radius:512}),{tree:h,particles:f}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.createFloorDust=void 0;var i=r(1),n=r(15),a=r(23),o=r(4);t.createFloorDust=function(e){var t=e.createEntity(),r=i.vec2(),s=i.vec2(0,100),c=e.createComponent(t,a.ParticleEmitter,{spawners:[a.BillboardParticle.bindProperty(a.BillboardParticle.set.velocity,a.AreaSampler.aabb(i.AABB(-100,-20,100,20))),a.BillboardParticle.bindProperty(a.BillboardParticle.set.position,a.AreaSampler.static(r)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.life,a.AreaSampler.range(i.lerp)(.6,1.4)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.rotation,a.AreaSampler.range(i.lerp)(0,2*Math.PI)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.angularVelocity,a.AreaSampler.range(i.lerp)(-.1,.1)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.originalSize,a.AreaSampler.range(i.lerp)(20,60))],updaters:[a.verletIntegration,a.BillboardParticle.bindProperty(a.BillboardParticle.set.opacity,n.TweenSampler(i.lerp)(0,1,i.ease.fade)),a.BillboardParticle.bindProperty(a.BillboardParticle.set.size,n.TweenSampler(i.lerp)(1,2,i.ease.quadOut))],spawnRate:0,spawnAmount:12,timeScale:1});return e.createComponent(t,o.BillboardBatch,{order:1024,billboards:c.particles}),e.createComponent(t,o.Material,{program:0,blend:1,texture:"effects/smoke.png"}),function(e){i.mat3x2.transform(s,e,r),c.emitParticles()}}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(59),t),n(r(209),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SoulSystem=void 0;var a=r(1),o=r(3),s=r(2),c=r(8),l=r(40),u=r(12),p=r(210),h=r(59),f=r(41),d=function(e){function t(t,r){var i=e.call(this,t)||this;return i.eater=p.createSoulEater(i.manager),i}return n(t,e),t.prototype.execute=function(e){this.manager.aquireComponent(this.eater,h.SoulEater);var t=this.manager.aquireComponent(this.eater,s.TargetComponent).calculatePosition(),r=a.vec2.magnitude(t),i=this.manager.aquireComponent(this.eater,s.AnimationMixer),n=i.tracks[i.tracks.length-1];switch(n?n.key:null){case"wake":case"awake":if(r<1600||-1!=n.endTime)break;for(var o=i.tracks.length-1;o>=0;o--)i.tracks[o].end(1,1);i.createAnimation("sleep",!0);var p=this.manager.resolveSystem(u.SoundscapeSystem).theme,d=this.manager.aquireComponent(p,c.AudioSource);l.scheduleAudioParameter(d.context,d.gain.gain,d.options.volume,3,"linear");break;case"consume":break;case null:if(r>1250||t[1]<=0)break;var v=i.createAnimation("wake",!0).duration;i.createAnimation("awake").start(v,0);p=this.manager.resolveSystem(u.SoundscapeSystem).theme,d=this.manager.aquireComponent(p,c.AudioSource);l.scheduleAudioParameter(d.context,d.gain.gain,0,0,"step",!0),f.createGlitch(this.manager)(4)}},t}(o.ProcedureSystem);t.SoulSystem=d},function(e,t,r){"use strict";var i=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.createSoulEater=void 0;var n=r(27),a=r(1),o=r(2),s=r(15),c=r(23),l=r(8),u=r(4),p=r(7),h=r(12),f=r(28),d=r(211),v=r(59);t.createSoulEater=function(e){var t,r,m,y,g,b,_,P,S,x=e.createEntity();e.createComponent(x,o.Transform2D,{position:[8500,-200]});var A=e.createEntity();e.createComponent(A,o.Transform2D,{parent:x,position:[0,-280]});var O=["e","d","c","glass","b","a"].map((function(t,r){var i=e.createEntity();return e.createComponent(i,o.Transform2D,{parent:A}),e.createComponent(i,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:4*r-24}),e.createComponent(i,u.Material,{program:0,blend:1,texture:"eater/hub_"+t+".png"}),i})),w=e.createEntity();e.createComponent(w,o.Transform2D,{parent:O[5]}),e.createComponent(w,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:2048}),e.createComponent(w,u.Material,{program:0,blend:2,texture:"eater/hub_glow.png",color:a.rgba(255,255,255,0)});var M=e.createEntity();e.createComponent(M,o.Transform2D,{parent:x}),e.createComponent(M,u.Material,{program:0,blend:1,texture:"eater/neck.png"}),e.createComponent(M,u.Curve,{order:-20,smoothness:1,path:[]});var T=a.range(3).map((function(t){var r=e.createEntity();e.createComponent(r,o.Transform2D,{parent:x});var i=e.createEntity();e.createComponent(i,o.Transform2D,{parent:r}),e.createComponent(i,u.Material,{program:0,blend:1,texture:"eater/ring_top.png"}),e.createComponent(i,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:-17});var n=e.createEntity();e.createComponent(n,o.Transform2D,{parent:r}),e.createComponent(n,u.Material,{program:0,blend:1,texture:"eater/ring_back.png"}),e.createComponent(n,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:-22});var s=e.createEntity();return e.createComponent(s,o.Transform2D,{parent:r}),e.createComponent(s,u.Material,{program:0,blend:2,texture:"eater/ring_glow.png",color:a.rgba(255,255,255,0)}),e.createComponent(s,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:2048}),{ring:r,top:i,back:n,glow:s}})),E=e.createEntity();e.createComponent(E,o.Transform2D,{parent:x});var C=e.createEntity();e.createComponent(C,o.Transform2D,{parent:E}),e.createComponent(C,u.Material,{program:0,blend:2,texture:"eater/head_glow.png",color:a.rgba(255,255,255,0)}),e.createComponent(C,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:2048});var B=e.createEntity();e.createComponent(B,o.Transform2D,{parent:E}),e.createComponent(B,u.Material,{program:0,blend:1,texture:"eater/head_top.png"}),e.createComponent(B,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:-18});var I=e.createEntity();e.createComponent(I,o.Transform2D,{parent:E}),e.createComponent(I,u.Material,{program:0,blend:1,texture:"eater/head_back.png"}),e.createComponent(I,u.Sprite2D,{origin:u.Sprite2D.CENTER,order:-20});var j=e.resolveSystem(f.CharacterSystem).character,D=(a.shuffle(a.range(36).map((function(e){return 2*e*Math.PI/36})),p.rng).slice(0,a.randomInt(4,12,p.rng)).map((function(t){var r=a.randomFloat(.8,1.2,p.rng),i=e.createEntity();e.createComponent(i,o.Transform2D,{parent:A,rotation:t}),e.createComponent(i,u.Material,{program:0,blend:1,texture:"eater/feeler.png"}),e.createComponent(i,u.Curve,{smoothness:1,thickness:[1.4*r],path:[],order:-16}),e.createComponent(i,o.TargetComponent,j),e.createComponent(i,d.Feeler,{length:10,spacing:100*r})})),a.range(6).map((function(t){var r=e.createEntity();e.createComponent(r,o.Transform2D,{parent:E,rotation:Math.PI*a.randomFloat(-.1,.1,p.rng),position:a.vec2(0,a.randomFloat(-50,50,p.rng))}),e.createComponent(r,u.Material,{program:0,blend:1,texture:"eater/feeler.png"}),e.createComponent(r,u.Curve,{smoothness:1,thickness:[.6],path:[],order:-19}),e.createComponent(r,o.TargetComponent,j),e.createComponent(r,d.Feeler,{length:6,spacing:75})})),e.createEntity());e.createComponent(D,o.Transform2D,{parent:A});var q=e.createComponent(D,c.ParticleEmitter,{spawners:[c.BillboardParticle.bindProperty(c.BillboardParticle.set.position,c.AreaSampler.circle(a.vec2.ZERO,a.vec2(150,200))),c.BillboardParticle.bindProperty(c.BillboardParticle.set.velocity,c.AreaSampler.targeted(c.AreaSampler.static(a.vec2.ZERO),a.vec2(-300,-200))),c.BillboardParticle.bindProperty(c.BillboardParticle.set.life,c.AreaSampler.range(a.lerp)(1,2)),c.BillboardParticle.bindProperty(c.BillboardParticle.set.originalSize,c.AreaSampler.range(a.lerp)(16,80)),c.BillboardParticle.bindProperty(c.BillboardParticle.set.friction,c.AreaSampler.static(.6))],updaters:[c.verletIntegration,c.BillboardParticle.bindProperty(c.BillboardParticle.set.opacity,s.TweenSampler(a.lerp)(1,0,a.ease.cubicIn)),c.BillboardParticle.bindProperty((function(e,t){return e.scale[0]=3*(e.scale[1]=e.originalScale[0]*t)}),s.TweenSampler(a.lerp)(0,1,a.ease.quadOut)),c.velocityRotation],spawnRate:0,spawnAmount:42,timeScale:1});e.createComponent(D,u.BillboardBatch,{order:2048,billboards:q.particles}),e.createComponent(D,u.Material,{program:0,blend:2,texture:"effects/particle_e.png"});var F=e.createEntity();e.createComponent(F,o.Transform2D,{parent:x});var R=e.createComponent(F,c.ParticleEmitter,{spawners:[function(t){var r=e.aquireComponent(E,o.Transform2D),i=t.position,n=t.velocity;a.vec2.fromValues(50,a.randomFloat(-20,20,p.rng),i),a.vec2.rotate(i,r.localRotation,i),a.vec2.add(i,r.localPosition,i),a.vec2.fromValues(200,0,n),a.vec2.rotate(n,r.localRotation,n)},c.BillboardParticle.bindProperty(c.BillboardParticle.set.acceleration,c.AreaSampler.static(a.vec2(0,1500))),c.BillboardParticle.bindProperty(c.BillboardParticle.set.life,c.AreaSampler.range(a.lerp)(.5,1)),c.BillboardParticle.bindProperty(c.BillboardParticle.set.originalSize,c.AreaSampler.range(a.lerp)(10,40))],updaters:[c.verletIntegration,c.BillboardParticle.bindProperty((function(e,t){return e.scale[0]=2*(e.scale[1]=e.originalScale[0]*t)}),s.TweenSampler(a.lerp)(0,1,a.ease.fade)),c.BillboardParticle.bindProperty(c.BillboardParticle.set.color,s.TweenSampler(a.rgb.lerp)(a.rgb(255,0,0),a.rgb.WHITE,a.ease.sineIn),a.rgb()),c.velocityRotation],spawnRate:.2,spawnAmount:0,timeScale:1});e.createComponent(F,u.BillboardBatch,{order:-19,billboards:R.particles}),e.createComponent(F,u.Material,{program:0,blend:1,texture:"effects/drop.png"});var k=e.createEntity();e.createComponent(k,o.Transform2D,{parent:x});var V=e.createComponent(k,l.AudioSource,{clip:"sfx/eater_enable.mp3",loop:!1,volume:1,rate:1,channel:e.resolveSystem(h.SoundscapeSystem).sfx});e.createComponent(k,l.SpatialAudio,{radius:256});var L=e.createEntity();e.createComponent(L,o.Transform2D,{parent:x});var N=e.createComponent(L,l.AudioSource,{clip:"sfx/eater_close.mp3",loop:!1,volume:1,rate:1,channel:e.resolveSystem(h.SoundscapeSystem).sfx});e.createComponent(L,l.SpatialAudio,{radius:256});var z=e.createEntity();e.createComponent(z,o.Transform2D,{parent:E});var G=e.createComponent(z,l.AudioSource,{clip:"sfx/eater_idle.mp3",loop:!0,volume:1,rate:1,channel:e.resolveSystem(h.SoundscapeSystem).sfx});return e.createComponent(z,l.SpatialAudio,{radius:128}),e.createComponent(x,o.TargetComponent,j),e.createComponent(x,v.SoulEater,{segments:24,curve:M,parts:i(T.map((function(e){return e.ring})),[E])}),e.createComponent(x,s.AnimationMixer,i([p.bindAnimationTrigger(e,(function(){N.play(),G.stop(1,1)}),(t={},t.sleep=Object.assign(s.StaticSampler(1),{duration:1}),t)),p.bindAnimationTrigger(e,(function(){q.emitParticles(),V.play(),G.play(1,1)}),(r={},r.wake=s.StaticSampler(1),r)),p.bindAnimationProperty(e,F,{component:c.ParticleEmitter,interpolate:a.lerp,initial:n.Zero,set:function(e,t){e.options.spawnAmount=t}},(m={},m.awake=s.StaticSampler(1),m)),p.bindAnimationProperty(e,O[5],p.AnimationProperty.rotation,(y={},y.wake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:1.4,value:-.2*Math.PI,ease:a.ease.quadOut},{time:2,value:0,ease:a.ease.sineIn}]),y.awake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:8,value:2*Math.PI,ease:a.ease.linear}]),y)),p.bindAnimationProperty(e,O[4],p.AnimationProperty.rotation,(g={},g.wake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:1.4,value:.4*Math.PI,ease:a.ease.quadOut},{time:2,value:0,ease:a.ease.sineIn}]),g.awake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:6,value:-2*Math.PI,ease:a.ease.linear}]),g)),p.bindAnimationProperty(e,O[1],p.AnimationProperty.rotation,(b={},b.awake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:2,value:2*Math.PI,ease:a.ease.linear}]),b)),p.bindAnimationProperty(e,w,p.AnimationProperty.opacity,(_={},_.wake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:.5,value:1,ease:a.ease.quadOut},{time:2,value:0,ease:a.ease.quadIn}]),_.awake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:3,value:.5,ease:a.ease.sineIn},{time:6,value:0,ease:a.ease.sineOut}]),_)),p.bindAnimationProperty(e,C,p.AnimationProperty.opacity,(P={},P.wake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:.5,value:1,ease:a.ease.quadOut},{time:2,value:0,ease:a.ease.quadIn}]),P.awake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:1,value:.75,ease:a.ease.sineOut},{time:3,value:0,ease:a.ease.sineIn}]),P))],T.map((function(t,r){var i,n=t.glow;return p.bindAnimationProperty(e,n,p.AnimationProperty.opacity,((i={}).wake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:.5,value:1,ease:a.ease.quadOut},{time:2,value:0,ease:a.ease.quadIn}]),i.awake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:0+.25*r,value:0},{time:.5+.25*r,value:.75,ease:a.ease.sineOut},{time:1+.25*r,value:0,ease:a.ease.sineIn},{time:1+.25*(T.length-1),value:0}]),i))})),[p.bindAnimationProperty(e,x,{component:v.SoulEater,interpolate:a.lerp,initial:function(e){return e.attract},set:function(e,t){e.attract!=t&&(e.lastFrame=-1),e.attract=t}},(S={},S.wake=s.KeyframeSampler(a.lerp)([{time:0,value:0},{time:2,value:1,ease:a.ease.sineInOut}]),S.awake=s.StaticSampler(1),S))])),x}},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.Feeler=void 0;var a=r(1),o=r(2),s=r(4),c=r(7),l=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n(t,e),t.prototype.setup=function(e){var t=e.length,r=e.spacing;this.spacing=r,this.angles=a.range(t).map((function(e){return a.randomFloat(-1,1,c.rng)})),this.phase=a.range(t).map((function(e){return a.randomFloat(0,2*Math.PI,c.rng)})),this.frequency=a.range(t).map((function(e){return a.randomFloat(1,5,c.rng)})),this.elapsedTime=0},t.prototype.update=function(e,t){var r=t.aquireComponent(this.entity,s.Curve);if(r&&!(r.lastRenderFrame>0&&r.lastRenderFrame!==e.frame-1)){this.elapsedTime+=e.deltaTime;var i=t.aquireComponent(this.entity,o.TargetComponent),n=i?i.calculatePosition():a.vec2.ZERO,c=this.spacing*this.angles.length,l=i?1-a.smoothstep(c,2*c,a.vec2.magnitude(n)):0,u=r.curve;u.length!=this.angles.length&&(r.path=Array(this.angles.length).fill(a.vec2.ZERO));for(var p=0,h=0,f=0,d=0,v=.2*.05*this.spacing/u.length,m=0;m<u.length;m++){a.vec2.fromValues(p,h,u[m]);var y=m/(u.length-1),g=this.angles[m]+a.lerp(2,6,y)*Math.sin(this.elapsedTime*this.frequency[m]+this.phase[m]);if(p+=Math.cos(f)*this.spacing,h+=Math.sin(f)*this.spacing,d+=v*g,f+=d*=a.lerp(1,.6,.1),f*=1-Math.pow(y,4),l){var b=Math.atan2(n[1]-h,n[0]-p),_=a.ease.cubicOut(1-Math.abs(a.shortestAngle(f,b))/Math.PI);f=a.lerpAngle(f,b,_*y*l)}}r.lastFrame=-1}},t.prototype.reset=function(){},t}(o.Behaviour);t.Feeler=l},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(213),t)},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__rest||function(e,t){var r={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var n=0;for(i=Object.getOwnPropertySymbols(e);n<i.length;n++)t.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(e,i[n])&&(r[i[n]]=e[i[n]])}return r},s=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.ParallaxSystem=void 0;var c=r(1),l=r(3),u=r(2),p=r(15),h=r(23),f=r(4),d=r(214),v=r(7),m=r(13);var y=function(e){return function(t,r,i){return c.vec2.fromValues(.5+.5*(1-2*function(e){var t=1e4*Math.sin(e);return t-Math.floor(t)}(t+e)),.5,i)}},g=s([{texture:"terrain/line_a.png",color:c.rgba(79,79,79,255),order:-2044,tileWidth:32,offset:.8,scale:1.6,randomize:y(1024)},{texture:"terrain/line_c.png",color:c.rgba(95,95,95,255),order:-2043,tileWidth:28,offset:.7,scale:1.26,randomize:y(2048)},{texture:"terrain/line_b.png",color:c.rgba(111,111,111,255),order:-2042,tileWidth:24,offset:.6,scale:.96,randomize:y(3072)},{texture:"terrain/pillar_a.png",color:c.rgba(143,143,143,255),order:-2034,tileWidth:12,offset:.5,scale:.72,randomize:y(4096)},{texture:"terrain/pillar_b.png",color:c.rgba(159,159,159,255),order:-2032,tileWidth:10,offset:.4,scale:.512,randomize:y(5120)}],[0,1,2].map((function(e){return{texture:"terrain/pillar_c_"+e+".png",color:c.rgba(175,175,175,255),order:-2028-e,tileWidth:8,offset:.3,scale:.324,padding:c.vec2(0,1==e?.5:0),randomize:1==e?function(e,t,r){return y(6144)(e,t,r),r[1]=1-.5*this.elapsedTime%1,r}:y(6144)}}))),b=function(e){function t(t){var r=e.call(this,t)||this;r.priority=-32,r.layers=r.manager.aquireDataView(d.ParallaxLayer),r.view=c.AABB(),r.paddedView=c.AABB(),r.sky=t.createEntity(),t.createComponent(r.sky,f.Material,{program:0,blend:1,texture:"terrain/sky.png",color:c.rgba.TRANSPARENT}),t.createComponent(r.sky,d.ParallaxLayer,{tileWidth:1,tileHeight:1,offset:.05,maxZoom:4,zoomRange:1/8}),t.createComponent(r.sky,f.BillboardBatch,{billboards:t.aquireComponent(r.sky,d.ParallaxLayer).tiles,order:-2048}),g.forEach((function(e){var r=e.texture,i=e.color,n=e.order,s=o(e,["texture","color","order"]),c=t.createEntity();t.createComponent(c,f.Material,{program:0,blend:1,texture:r,color:i}),t.createComponent(c,d.ParallaxLayer,a({tileWidth:1,tileHeight:1},s)),t.createComponent(c,f.BillboardBatch,{billboards:t.aquireComponent(c,d.ParallaxLayer).tiles,order:n})}));var i=t.createEntity();t.createComponent(i,u.Transform2D,{position:c.vec2.ZERO}),t.createComponent(i,f.Material,{program:0,blend:1,texture:"effects/fog.png"}),t.createComponent(i,h.ParticleEmitter,{spawners:[h.BillboardParticle.bindProperty(h.BillboardParticle.set.position,h.AreaSampler.aabb(r.paddedView)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.velocity,h.AreaSampler.aabb(c.AABB(-24,-24,24,24))),h.BillboardParticle.bindProperty(h.BillboardParticle.set.life,h.AreaSampler.range(c.lerp)(6,10)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.rotation,h.AreaSampler.range(c.lerp)(0,2*Math.PI)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.angularVelocity,h.AreaSampler.range(c.lerp)(-.4,.4)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.originalSize,h.AreaSampler.range(c.lerp)(500,1e3))],updaters:[h.verletIntegration,h.wrapParticle(r.paddedView),h.BillboardParticle.bindProperty(h.BillboardParticle.set.opacity,p.TweenSampler(c.lerp)(0,.5,c.ease.fade)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.size,p.TweenSampler(c.lerp)(1,2,c.ease.quadOut))],spawnRate:.8,spawnAmount:0,timeScale:1}),t.createComponent(i,f.BillboardBatch,{order:-1920,billboards:t.aquireComponent(i,h.ParticleEmitter).particles});var n=t.createEntity();return t.createComponent(n,u.Transform2D,{position:c.vec2.ZERO}),t.createComponent(n,f.Material,{program:0,blend:2,texture:"effects/particle_h.png",color:c.rgba.WHITE}),t.createComponent(n,h.ParticleEmitter,{spawners:[h.BillboardParticle.bindProperty(h.BillboardParticle.set.position,h.AreaSampler.aabb(r.view)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.life,h.AreaSampler.range(c.lerp)(2,5)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.color,h.AreaSampler.static(t.aquireComponent(n,f.Material).color)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.rotation,h.AreaSampler.range(c.lerp)(0,2*Math.PI)),h.BillboardParticle.bindProperty(h.BillboardParticle.set.originalSize,h.AreaSampler.range(c.lerp)(15,50)),h.BillboardParticle.bindProperty((function(e,t){return e.speed=t}),h.AreaSampler.range(c.lerp)(40,80))],updaters:[function(e,t){var r=e.scale[0]/30;e.position[0]+=t*r*e.speed*Math.cos(e.rotation),e.position[1]+=t*r*e.speed*Math.sin(e.rotation),e.rotation-=t*c.randomFloat(-30,30,v.rng)},h.wrapParticle(r.view),h.BillboardParticle.bindProperty(h.BillboardParticle.set.size,p.TweenSampler(c.lerp)(0,1,(function(e){return 2*Math.sqrt(e*(1-e))})))],spawnRate:1,spawnAmount:0,timeScale:1}),t.createComponent(n,f.BillboardBatch,{order:2044,billboards:t.aquireComponent(n,h.ParticleEmitter).particles}),t.createComponent(r.sky,p.AnimationMixer,[v.bindAnimationProperty(t,r.sky,v.AnimationProperty.color,[p.StaticSampler(c.rgba(8,0,0,255)),p.StaticSampler(c.rgba(175,42,42,255)),p.StaticSampler(c.rgba(14,255,158,255)),p.StaticSampler(c.rgba(12,110,20,255)),p.StaticSampler(c.rgba(58,31,76,255))]),v.bindAnimationProperty(t,i,v.AnimationProperty.spawnAmount,[p.StaticSampler(1),p.StaticSampler(1),p.StaticSampler(0),p.StaticSampler(0),p.StaticSampler(1)]),v.bindAnimationProperty(t,n,v.AnimationProperty.color,[p.StaticSampler(c.rgba.WHITE),p.StaticSampler(c.rgba(255,31,31,255)),p.StaticSampler(c.rgba(63,255,255,255)),p.StaticSampler(c.rgba(127,255,63,255)),p.StaticSampler(c.rgba.WHITE)]),v.bindAnimationProperty(t,n,v.AnimationProperty.spawnAmount,[p.StaticSampler(0),p.StaticSampler(2),p.StaticSampler(4),p.StaticSampler(6),p.StaticSampler(0)])]),r.regions=[{position:c.vec2(8500,400),radius:c.vec2(1024,2048)},{position:c.vec2(0,0),radius:c.vec2(2048,6e3)},{position:c.vec2(18e3,1700),radius:c.vec2(2048,8192)},{position:c.vec2(-8e3,2e3),radius:c.vec2(2048,8192)},{position:c.vec2(8e3,-6e3),radius:c.vec2(2048,4e3)}].map((function(e,i){return a(a({},e),{track:t.aquireComponent(r.sky,p.AnimationMixer).createAnimation(""+i,!1)})})),r}return n(t,e),t.prototype.execute=function(e){var r=this.manager.resolveSystem(m.CameraSystem).camera,i=this.manager.aquireComponent(r,u.Camera2D).bounds;c.AABB.padding(i,10,this.view),c.AABB.padding(i,1e3,this.paddedView);for(var n=c.vec2.fromValues(.5*(i[0]+i[2]),.5*(i[1]+i[3]),t.temp),a=this.regions.length-1;a>=0;a--){var o=this.regions[a],s=c.vec2.distance(o.position,n);o.track.intensity=c.smoothstep(o.radius[1],o.radius[0],s)}var l=this.layers.data;for(a=l.length-1;a>=0;a--)l[a].update(this.manager,e,i)},t.temp=c.vec2(),t}(l.ProcedureSystem);t.ParallaxSystem=b},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.ParallaxLayer=t.Tile=void 0;var a=r(21),o=r(1),s=r(3),c=r(4),l=function(){this.position=o.vec2(),this.rotation=0,this.scale=o.vec2(1,1),this.color=o.rgba(255,255,255,255)};t.Tile=l;var u=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.tiles=[],t.padding=o.vec2(0,0),t}return n(t,e),t.prototype.setup=function(e){this.options=e,o.vec2.copy(e.padding||o.vec2.ZERO,this.padding)},t.prototype.update=function(e,r,i){var n=e.aquireComponent(this.entity,c.Material),a=n.diffuse,s=a.width,l=a.height,u=s*this.options.tileWidth,p=l*this.options.tileHeight,h=this.parallaxRegion(i,u,p,t.region),f=Math.floor(h[0]/u-this.padding[0]),d=Math.ceil(h[2]/u+this.padding[0]),v=Math.floor(h[1]/p-this.padding[1]),m=Math.ceil(h[3]/p+this.padding[1]),y=(i[2]-i[0])/(h[2]-h[0]),g=(i[3]-i[1])/(h[3]-h[1]),b=i[0]-h[0]*y,_=i[1]-h[1]*g,P=0;e:for(var S=f;S<=d;S++)for(var x=v;x<=m;x++){this.tiles[P]||(this.tiles[P]=t.pool.aquire());var A=this.tiles[P++],O=this.options.randomize?this.options.randomize.call(r,S,x,t.temp):t.CENTER;if(A.position[0]=(S*u+O[0]*u)*y+b,A.position[1]=(x*p+O[1]*p)*g+_,A.scale[0]=s*y,A.scale[1]=l*g,o.rgba.copy(n.color,A.color),P>t.tileLimit)break e}for(;this.tiles.length>P;)t.pool.recycle(this.tiles.pop())},t.prototype.parallaxRegion=function(e,t,r,i){var n=this.options,a=n.offset,o=n.zoomRange,s=n.maxZoom,c=n.scale,l=.5*(e[0]+e[2])*a,u=.5*(e[1]+e[3])*a;if(c){var p=.5*(e[2]-e[0])*c,h=.5*(e[3]-e[1])*c;return i[0]=l-p,i[1]=u-h,i[2]=l+p,i[3]=u+h,i}var f=function(e,t){return function(r){return e-e/(t*r+1)}}(s,o)((e[2]-e[0])/t),d=.5*t*f,v=.5*r*f;return i[0]=l-d,i[1]=u-v,i[2]=l+d,i[3]=u+v,i},t.prototype.reset=function(){for(;this.tiles.length;)t.pool.recycle(this.tiles.pop())},t.temp=o.vec2(),t.CENTER=o.vec2(.5,.5),t.pool=new a.ObjectPool((function(e){return new l})),t.region=o.AABB(),t.tileLimit=512,t}(s.ReusableComponent);t.ParallaxLayer=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(216),n=r(2),a=r(4),o=r(224),s=r(227),c=r(8),l=r(81),u=r(79),p=r(228),h=r(74),f=r(76),d=r(80),v=r(229),m=r(54),y=r(33),g=r(3),b=r(230),_=r(245);t.default=function(e){var t,r,P=e.manifest,S=e.keybindings,x=e.width,A=e.height,O=e.initialize,w=(new g.EntityManager).registerSystem(g.ProcedureUpdateSystem,null).registerSystem(i.Store,[i.DetectType(),i.LoadImageElement,i.Throttle(4)(i.HttpRequest()),i.UnpackJsonBundle,i.ParseXML,c.DecodeAudio,c.ParseAudioClip,a.UploadTexture,a.ParseTextureAtlas]).registerSystem(y.Display,{width:x,height:A}).registerSystem(m.KeyboardSystem,{keybindings:S}).registerSystem(m.PointerDeviceSystem,null).registerSystem(b.EditorSystem,[b.PerformanceMonitor,b.CameraController,b.AudioSettings,b.GridLineLayer,b.PhysicsDebugSystem,b.EntitySelector]).registerSystem(l.PhysicsSystem,{broadphase:new p.SweepAndPrune,narrowphase:new h.Narrowphase((t={},t[2]=h.testCircleVsCircle,t[18]=h.testCircleVsConvex,t[10]=h.testCircleVsConvex,t[6]=h.testCircleVsLine,t[16]=h.testConvexVsConvex,t[8]=h.testConvexVsConvex,t[24]=h.testConvexVsConvex,t[3]=h.testParticleVsCircle,t[17]=h.testParticleVsConvex,t[9]=h.testParticleVsConvex,t)),raycaster:new f.Raycaster((r={},r[2]=f.testRayCircle,r[4]=f.testRayLine,r[8]=f.testRayConvex,r[16]=f.testRayConvex,r)),materials:new u.MaterialCollection,solver:new v.IslandSolver(new d.GaussSeidelSolver)}).registerSystem(n.SceneUpdateSystem,[n.Behaviour,n.AnimationMixer,n.ParticleEmitter]).registerSystem(n.TransformUpdateSystem,null).registerSystem(a.Renderer2DSystem,[new o.BatchRenderer,new s.ShaderRenderer(void 0,void 0,o.BatchRenderer.QUAD_INDICES)]).registerSystem(c.AudioSystem,null),M=new _.ProgressSpinner;return w.resolveSystem(i.Store).load(P,(function(e){return M.progress=e})).then((function(){return O(w),M.awaitGesture(),w.resolveSystem(c.AudioSystem).unlock()})).then((function(){return M.delete(),w.resolveSystem(g.ProcedureUpdateSystem).start(),w}))}},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(217),t),n(r(37),t),n(r(218),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(11),t),n(r(219),t),n(r(220),t),n(r(221),t),n(r(222),t),n(r(223),t)},function(e,t,r){"use strict";var i;Object.defineProperty(t,"__esModule",{value:!0}),t.HttpRequest=void 0;var n=r(18),a=r(11),o=((i={})[a.DATA_TYPE.JSON]="json",i[a.DATA_TYPE.IMAGE]="blob",i[a.DATA_TYPE.AUDIO]="arraybuffer",i[a.DATA_TYPE.XML]="document",i[a.DATA_TYPE.TEXT]="text",i);t.HttpRequest=function(e){return void 0===e&&(e=o),function(t,r){if(!t.data){var i=new n.Deferred,a=new XMLHttpRequest;return a.open("GET",encodeURI(t.url),!0),a.onprogress=function(e){return e.lengthComputable&&r(e.loaded/e.total)},a.onreadystatechange=function(){return a.readyState===XMLHttpRequest.DONE&&(r(1),200===a.status?i.resolve(t.data=a.response):i.reject(a.statusText))},a.responseType=e[t.type]||"text",a.send(),i}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UnpackJsonBundle=void 0;var i=r(11);t.UnpackJsonBundle=function(e,t){if(e.type===i.DATA_TYPE.JSON&&e.data){var r=e.data,n=(r.meta,r.resources);if(n)return e.shallow=!0,this.load(Object.keys(n).map((function(e){var t=n[e];if("string"!=typeof t)return{url:e,data:t};var r=t.split(","),a=r[0],o=r[1],s=a.replace("data:","").split(";"),c=s[0],l=(s[1],c.split("/")),u=l[0],p=l[1];switch(u){case"image":return{url:e,data:t,type:i.DATA_TYPE.IMAGE};case"audio":return{url:e,data:t,type:i.DATA_TYPE.AUDIO};case"text":return"html"===p||"xml"===p?{url:e,data:o,type:i.DATA_TYPE.XML}:{url:e,data:o,type:i.DATA_TYPE.TEXT};default:throw new Error('Unrecognized base64 type: "'+a+'".')}})),t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LoadAudioElement=t.LoadImageElement=void 0;var i=r(18),n=r(11);t.LoadImageElement=function(e){if(e.type===n.DATA_TYPE.IMAGE){var t=e.data||encodeURI(e.url);if(t instanceof Blob&&(t=URL.createObjectURL(t)),t&&"string"==typeof t)return(new i.Deferred).from((function(r,i){var n=e.data=new Image;n.crossOrigin="anonymous",n.addEventListener("error",i),n.addEventListener("load",r),n.src=t}))}},t.LoadAudioElement=function(e){if(e.type===n.DATA_TYPE.AUDIO){var t=e.data||encodeURI(e.url);if(t instanceof Blob&&(t=URL.createObjectURL(t)),t&&"string"==typeof t)return(new i.Deferred).from((function(r,i){var n=e.data=new Audio;n.crossOrigin="anonymous",n.addEventListener("error",i),n.addEventListener("load",r),n.addEventListener("canplaythrough",r),n.src=t}))}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Throttle=void 0;var i=r(18);t.Throttle=function(e){void 0===e&&(e=16);var t=[],r=[];function n(i){var n=r.indexOf(i);for(~n||r.splice(n,1);r.length<e&&t.length;)r.push(t.shift()())}return function(e){return function(r,a){var o=this,s=new i.Deferred;return t.push((function(){return(new i.Deferred).from(e.bind(o,r,a)).then((function(e){n(r),s.resolve(e)}),(function(e){n(r),s.reject(e)})),r})),n(null),s}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ParseXML=void 0;var i=r(11);t.ParseXML=function(e){e.type===i.DATA_TYPE.XML&&"string"==typeof e.data&&(e.data=(new DOMParser).parseFromString(e.data,"text/xml"))}},function(e,t,r){"use strict";var i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.BatchRenderer=void 0;var n=r(5),a=r(14),o=r(52),s=r(35),c=i(r(225)),l=function(){function e(e,t,r,i){void 0===e&&(e=4096),void 0===t&&(t=6144),void 0===r&&(r=null),void 0===i&&(i=!0),this.MAX_VERTICES=e,this.MAX_INDICES=t,this.FIXED_INDICES=r,this.PREMULTIPLY_ALPHA=i,this.vdf=o.VertexDataFormat([{name:"aPosition",size:2,type:5126,normalized:!1},{name:"aUV",size:2,type:5123,normalized:!0},{name:"aColor",size:4,type:5121,normalized:!0},{name:"aTint",size:3,type:5121,normalized:!0},{name:"aMaterial",size:1,type:5121,normalized:!1}]),this.vertexOffset=0,this.indexOffset=0,this.blending=0,this.textures=[]}return e.prototype.initialize=function(e){if(this.gl=e,this.shader=new o.Shader(e,r(226),c.default(e.MAX_TEXTURES,this.PREMULTIPLY_ALPHA)),this.shader.uao.uSamplers=n.range(e.MAX_TEXTURES),this.FIXED_INDICES){this.indexBuffer=new o.IndexBufferObject(e,this.MAX_INDICES,5125,35044);for(var t=this.indexBuffer.data,i=1+Math.max.apply(Math,this.FIXED_INDICES),a=0;a<t.length;a++)t[a]=this.FIXED_INDICES[a%this.FIXED_INDICES.length]+i*Math.floor(a/this.FIXED_INDICES.length);this.indexBuffer.upload(null)}else this.indexBuffer=new o.IndexBufferObject(e,this.MAX_INDICES,5125,35048);this.vertexBuffer=new o.VertexBufferObject(e,this.vdf.stride*this.MAX_VERTICES,35048),this.vao=new o.VertexArrayObject(e),this.vao.bindIndexBuffer(this.indexBuffer),this.vao.bindVertexBuffer(this.vertexBuffer,this.vdf,this.shader.attributes)},e.prototype.render=function(e,t,r){var i=t.vertices,n=t.uvs,o=t.indices,s=t.colors,c=r.diffuse,l=this.PREMULTIPLY_ALPHA&&2===r.blend?1:r.blend,u=o.length,p=i.length>>>1,h=this.textures.indexOf(c.texture);(this.blending!==l&&this.indexOffset>0||-1==h&&this.textures.length>=this.gl.MAX_TEXTURES||this.indexOffset+u>=this.MAX_INDICES||this.vertexOffset+p>=this.MAX_VERTICES)&&(this.flush(e),h=-1),-1==h&&(h=this.textures.push(c.texture)-1),this.blending=l;var f=a.rgba.uint8Hex(r.color,r.alpha),d=a.rgb.uint8Hex(r.tint,r.alpha)|h<<24,v=1===l&&2===r.blend?16777215:4294967295,m=this.indexBuffer.data,y=this.vertexBuffer.dataView(5126),g=this.vertexBuffer.dataView(5125);if(!this.FIXED_INDICES)for(var b=0;b<u;b++)m[this.indexOffset+b]=o[b]+this.vertexOffset;this.indexOffset+=u;for(var _=this.vdf.stride>>>2,P=(b=0,this.vertexOffset*_);b<p;b++,P+=_)y[P+0]=i[2*b+0],y[P+1]=i[2*b+1],g[P+2]=n[b],g[P+3]=(s?s[b]:f)&v,g[P+4]=d;this.vertexOffset+=p},e.prototype.flush=function(e){var t=this.gl,r=this.vertexOffset,i=this.indexOffset,n=this.textures;if(i){this.vao.bind(),this.FIXED_INDICES||this.indexBuffer.upload(null,0,i),this.vertexBuffer.upload(null,0,r*(this.vdf.stride>>>2));for(var a=0;a<t.MAX_TEXTURES;a++)n[a]?n[a].bind(a):e.defaultTexture.bind(a);this.shader.uao.uProjectionMatrix=e.viewMatrix,this.shader.bind(),s.applyBlendMode[this.blending](t,this.PREMULTIPLY_ALPHA),this.vao.render(4,i,0),this.vertexOffset=this.indexOffset=0,n.length=0}},e.prototype.delete=function(){this.vao.delete(),this.shader.delete(),this.indexBuffer.delete(),this.vertexBuffer.delete()},e.QUAD_INDICES=[0,1,2,0,2,3],e}();t.BatchRenderer=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=r(5);t.default=function(e,t){return"\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vTint;\nvarying float vMaterial;\n\nuniform sampler2D uSamplers["+e+"];\n\nvoid main(void){\n    int tex = int(vMaterial);\n    vec4 color;\n    "+i.range(e).map((function(e){return(e?"else ":"")+"if(tex == "+e+") color = texture2D(uSamplers["+e+"], vUV);"})).join("\n")+"\n    gl_FragColor = vColor * color + "+(t?"color.a * ":"")+"vec4(vTint, 0.0);\n}"}},function(e,t){e.exports="attribute vec2 aPosition;\nattribute vec2 aUV;\nattribute vec4 aColor;\nattribute vec3 aTint;\nattribute float aMaterial;\n\nuniform mat3 uProjectionMatrix;\n\nvarying vec2 vUV;\nvarying vec4 vColor;\nvarying vec3 vTint;\nvarying float vMaterial;\n\nvoid main(void){\n    vec2 position = (uProjectionMatrix * vec3(aPosition, 1.0)).xy;\n    gl_Position = vec4(position, 0.0, 1.0);\n    vUV = aUV;\n    vColor = aColor;\n    vTint = aTint;\n    vMaterial = aMaterial + .5;\n}"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ShaderRenderer=void 0;var i=r(14),n=r(52),a=r(35),o=r(53),s=function(){function e(e,t,r){void 0===e&&(e=4096),void 0===t&&(t=6144),void 0===r&&(r=null),this.MAX_VERTICES=e,this.MAX_INDICES=t,this.FIXED_INDICES=r,this.vdf=n.VertexDataFormat([{name:"aPosition",size:2,type:5126,normalized:!1},{name:"aUV",size:2,type:5123,normalized:!0},{name:"aColor",size:4,type:5121,normalized:!0}]),this.vertexOffset=0,this.indexOffset=0,this.blending=0}return e.prototype.initialize=function(e){if(this.gl=e,this.FIXED_INDICES){this.indexBuffer=new n.IndexBufferObject(e,this.MAX_INDICES,5125,35044);for(var t=this.indexBuffer.data,r=1+Math.max.apply(Math,this.FIXED_INDICES),i=0;i<t.length;i++)t[i]=this.FIXED_INDICES[i%this.FIXED_INDICES.length]+r*Math.floor(i/this.FIXED_INDICES.length);this.indexBuffer.upload(null)}else this.indexBuffer=new n.IndexBufferObject(e,this.MAX_INDICES,5125,35048);this.vertexBuffer=new n.VertexBufferObject(e,this.vdf.stride*this.MAX_VERTICES,35048),this.vao=new n.VertexArrayObject(e),this.vao.bindIndexBuffer(this.indexBuffer),this.vao.bindVertexBuffer(this.vertexBuffer,this.vdf,{aPosition:{location:0,size:2},aUV:{location:1,size:2},aColor:{location:2,size:4}})},e.prototype.render=function(e,t,r){var n=t.vertices,a=t.uvs,o=t.indices,s=t.colors,c=r.blend,l=r.shader,u=r.attributes,p=o.length,h=n.length>>>1;(this.blending!==c&&this.indexOffset>0||this.shader!=l||this.shaderAttributes!=u||this.indexOffset+p>=this.MAX_INDICES||this.vertexOffset+h>=this.MAX_VERTICES)&&this.flush(e),this.shader=l,this.shaderAttributes=u,this.blending=c;var f=i.rgba.uint8Hex(r.color,r.alpha),d=this.indexBuffer.data,v=this.vertexBuffer.dataView(5126),m=this.vertexBuffer.dataView(5125);if(!this.FIXED_INDICES)for(var y=0;y<p;y++)d[this.indexOffset+y]=o[y]+this.vertexOffset;this.indexOffset+=p;for(var g=this.vdf.stride>>>2,b=(y=0,this.vertexOffset*g);y<h;y++,b+=g)v[b+0]=n[2*y+0],v[b+1]=n[2*y+1],m[b+2]=a[y],m[b+3]=s?s[y]:f;this.vertexOffset+=h},e.prototype.flush=function(e){var t=this.gl,r=this.vertexOffset,i=this.indexOffset,n=this.shader;i&&(this.vao.bind(),this.FIXED_INDICES||this.indexBuffer.upload(null,0,i),this.vertexBuffer.upload(null,0,r*(this.vdf.stride>>>2)),n.uao.uProjectionMatrix=e.viewMatrix,o.ShaderMaterial.synchronize(this.shaderAttributes,n),n.bind(),a.applyBlendMode[this.blending](t,!1),this.vao.render(4,i,0),this.vertexOffset=this.indexOffset=0,this.shader=null)},e.prototype.delete=function(){this.vao.delete(),this.indexBuffer.delete(),this.vertexBuffer.delete()},e}();t.ShaderRenderer=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.SweepAndPrune=void 0;var a=r(9),o=r(47),s=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodies=[],t.axisIndex=0,t.axisSort=function(e,r){return e.aabb[t.axisIndex]-r.aabb[t.axisIndex]},t}return n(t,e),t.prototype.insert=function(e){this.bodies.push(e)},t.prototype.remove=function(t){var r=this.bodies.indexOf(t);~r||this.bodies.splice(r,1),e.prototype.remove.call(this,t)},t.prototype.update=function(){o.insertionSort(this.bodies,this.axisSort)},t.prototype.queryCollisionPairs=function(e){for(var t=this.bodies.length,r=0;r<t;r++)for(var i=this.bodies[r],n=r+1;n<t;n++){var a=this.bodies[n];if(a.aabb[this.axisIndex]>i.aabb[2+this.axisIndex])break;if(this.filter(i,a)&&0==e(i,a))return}},t.prototype.queryAABB=function(e,t){for(var r=this.bodies.length,i=0;i<r;i++){var n=this.bodies[i];if(n.aabb[this.axisIndex]>e[2+this.axisIndex])break;if(a.AABB.overlap(e,n.aabb)&&0==t(n))return}},t}(r(72).Broadphase);t.SweepAndPrune=s},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.IslandSolver=void 0;var a=r(93),o=function(e,t){return(e.bodyA.islandIndex||e.bodyB.islandIndex)-(t.bodyA.islandIndex||t.bodyB.islandIndex)||e.index-t.index},s=function(e){function t(t){var r=e.call(this)||this;return r.solver=t,r.tempEquations=[],r}return n(t,e),t.prototype.solve=function(e,t,r){this.allocate(t.length);for(var i=e.length-1;i>=0;i--){var n=e[i],a=n.bodyA,s=n.bodyB;e[i].index=i,1===a.type&&1===s.type&&this.join(a.index,s.index)}for(i=t.length-1;i>=0;i--){var c=t[i];c.islandIndex=1===c.type?1+this.find(c.index):0}e.sort(o),this.tempEquations.length=0;var l=e.length;for(i=0;i<l;i++){var u=e[i],p=e[i+1],h=u.bodyA.islandIndex||u.bodyB.islandIndex;this.tempEquations.push(u),p&&h===(p.bodyA.islandIndex||p.bodyB.islandIndex)||(this.solver.solve(this.tempEquations,t,r),this.tempEquations.length=0)}},t}(a.DisjointSet);t.IslandSolver=s},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(10),t),n(r(234),t),n(r(235),t),n(r(236),t),n(r(237),t),n(r(238),t),n(r(239),t),n(r(240),t),n(r(243),t),n(r(244),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EditorSubSystem=void 0;var i=r(1),n=r(4),a=function(){function e(e){this.manager=e,this.enabled=!1,this.menu=Object.create(null);var t=e.createEntity();e.createComponent(t,n.Material,{program:0,color:i.rgba.WHITE,blend:1}),this.graphics=e.createComponent(t,n.VectorGraphics,{order:0})}return e.gridSize=0,e}();t.EditorSubSystem=a},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.EditorSystem=void 0;var o=r(3),s=r(1),c=r(54),l=r(2),u=r(60);r(233);var p=function(e){function t(t,r){var i=e.call(this,t)||this;return i.enabled=/debug/.test(location.search),i.pressed=!1,i.prevZoom=0,i.updateContext={selectedEntity:0,camera:0,worldPosition:s.vec2(),pressed:!1,trigger:!1,release:!1,deltaZoom:0,pixelWidth:1,pixelHeight:1},i.enabled?(i.cameraGroup=i.manager.queryEntityGroup([l.Transform2D,l.Camera2D]),i.subsystems=r.map((function(e){return new e(i.manager)})),document.body.appendChild(i.buildMenu()),i):i}return n(t,e),t.prototype.buildMenu=function(){var e=this.subsystems;return u.HTMLNode("div",{className:"editor-panel vertical"},a([u.HTMLNode("div",{className:"horizontal",style:{width:"100%"}},e.map((function(t){return u.HTMLNode("div",{className:"editor-tab",innerText:t.key},null,{click:function(r){var i=!r.target.classList.contains("active");document.querySelectorAll(".editor-tab").forEach((function(e){return r.target===e&&i?e.classList.add("active"):e.classList.remove("active")})),document.querySelectorAll(".editor-menu").forEach((function(e){return e.dataset.key===t.key&&i?e.style.removeProperty("display"):e.style.setProperty("display","none")})),e.forEach((function(e){return e.enabled=e===t&&i}))}})})))],e.map((function(e){return u.HTMLNode("div",{className:"horizontal editor-menu",dataset:{key:e.key},style:{display:"none"}},e.buildMenu())}))))},t.prototype.execute=function(e){if(this.enabled){var t=this.manager.resolveSystem(c.PointerDeviceSystem),r=t.pressure[0],i=t.pointers[0],n=t.scroll[1];if(this.updateContext.trigger=!this.pressed&&r,this.updateContext.release=this.pressed&&!r,this.pressed=this.updateContext.pressed=r,this.updateContext.deltaZoom=n-this.prevZoom,this.prevZoom=n,this.cameraGroup.length){this.updateContext.camera=this.cameraGroup.entities[0];var a=this.manager.aquireComponent(this.cameraGroup.entities[0],l.Camera2D);s.mat3x2.transform(i,a.invViewMatrix,this.updateContext.worldPosition);var o=a.targetViewport;this.updateContext.pixelWidth=a.viewport[0]/o[0],this.updateContext.pixelHeight=a.viewport[1]/o[1];for(var u=0;u<this.subsystems.length;u++)this.subsystems[u].update(this.updateContext)}}},t}(o.ProcedureSystem);t.EditorSystem=p},function(e,t,r){},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PerformanceMonitor=void 0;var a=r(3),o=r(10),s=r(4),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="monitor",t.state={drawCalls:0,fps:0,elapsed:[]},t.timeElapsed=0,t}return n(t,e),t.prototype.update=function(e){this.enabled&&(this.attachListeners(),this.timeElapsed+=this.updateContext.deltaTime,this.state.fps++,this.timeElapsed>=1&&(this.timeElapsed-=1,this.menu.fps.innerText=""+this.state.fps,this.state.fps=0),this.menu.drawCalls.innerText=""+this.state.drawCalls,this.state.drawCalls=0,this.updateContext.frame%10==0&&(this.state.elapsed.sort((function(e,t){return t.value-e.value})),this.menu.elapsed.innerText=this.state.elapsed.slice(0,6).map((function(e){return(e.value/10).toFixed(2)})).join("|")+" - "+this.state.elapsed.slice(0,6).map((function(e){return e.name})).join("|"),this.state.elapsed.forEach((function(e){return e.value=0}))))},t.prototype.attachListeners=function(){var e=this;if(!this.updateContext){this.updateContext=this.manager.resolveSystem(a.ProcedureUpdateSystem).loop;var t,r,i=this.manager.resolveSystem(s.Renderer2DSystem).gl;i.drawElements=(t=i.drawElements,r=function(){return e.enabled&&e.state.drawCalls++},function(){return r(),t.apply(this,arguments)}),i.drawArrays=function(e,t){return function(){return t(),e.apply(this,arguments)}}(i.drawArrays,(function(){return e.enabled&&e.state.drawCalls++}));var n=this.manager.systems.filter((function(e){return e.execute}));this.state.elapsed=n.map((function(e){var t={value:0,name:e.constructor.name};return e.execute=function(e,t){return function(){var r=performance.now(),i=e.apply(this,arguments);return t(performance.now()-r),i}}(e.execute,(function(e){t.value+=e})),t}))}},t.prototype.buildMenu=function(){return this.menu.drawCalls=o.HTMLNode("div",{className:"horizontal",innerText:""}),this.menu.fps=o.HTMLNode("div",{className:"horizontal",innerText:""}),this.menu.elapsed=o.HTMLNode("div",{className:"horizontal",style:{whiteSpace:"nowrap"},innerText:""}),[o.HTMLNode("div",{className:"horizontal"},[o.HTMLNode("div",{className:"vertical"},[o.HTMLNode("div",{className:"horizontal",innerText:"DrawCalls: "},[this.menu.drawCalls]),o.HTMLNode("div",{className:"horizontal",innerText:"FPS: "},[this.menu.fps])]),o.HTMLNode("div",{className:"vertical"},[o.HTMLNode("div",{className:"horizontal",innerText:"Elapsed: "},[this.menu.elapsed])])])]},t}(o.EditorSubSystem);t.PerformanceMonitor=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.CameraController=void 0;var a=r(1),o=r(2),s=r(10),c=r(13),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.prevPosition=a.vec2(),t.key="view",t}return n(t,e),t.prototype.update=function(e){if(this.enabled&&e.camera){var t=this.manager.aquireComponent(e.camera,o.Camera2D),r=this.manager.aquireComponent(e.camera,o.Transform2D);e.deltaZoom&&(a.vec2.scale(t.viewport,Math.pow(1.2,e.deltaZoom),t.viewport),t.lastFrame=-1),e.trigger&&a.vec2.copy(e.worldPosition,this.prevPosition),e.pressed&&(a.vec2.add(r.localPosition,this.prevPosition,r.localPosition),a.vec2.subtract(r.localPosition,e.worldPosition,r.localPosition),r.lastFrame=-1),this.menu.cameraX.value=r.localPosition[0],this.menu.cameraY.value=r.localPosition[1],this.menu.cameraWidth.value=t.viewport[0],this.menu.cameraHeight.value=t.viewport[1]}},t.prototype.buildMenu=function(){var e=this;return this.menu.cameraX=s.HTMLNode("input",{type:"number",disabled:!0,value:0,min:-1e6,max:1e6}),this.menu.cameraY=s.HTMLNode("input",{type:"number",disabled:!0,value:0,min:-1e6,max:1e6}),this.menu.cameraWidth=s.HTMLNode("input",{type:"number",disabled:!0,value:0,min:-1e6,max:1e6}),this.menu.cameraHeight=s.HTMLNode("input",{type:"number",disabled:!0,value:0,min:-1e6,max:1e6}),[s.HTMLNode("div",{className:"vertical",style:{alignItems:"flex-end"}},[s.HTMLNode("div",{className:"horizontal",innerText:"Enable: "},[s.HTMLNode("input",{type:"checkbox",checked:!0},null,{change:function(t){return e.manager.resolveSystem(c.CameraSystem).enabled=t.target.checked}})]),s.HTMLNode("div",{className:"horizontal",innerText:"position: "},[this.menu.cameraX,this.menu.cameraY]),s.HTMLNode("div",{className:"horizontal",innerText:"viewport: "},[this.menu.cameraWidth,this.menu.cameraHeight])])]},t}(s.EditorSubSystem);t.CameraController=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.AudioSettings=void 0;var a=r(10),o=r(8),s=r(12),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.key="audio",t}return n(t,e),t.prototype.update=function(e){},t.prototype.buildMenu=function(){var e=this;return this.menu.sfx=a.HTMLNode("input",{type:"range",value:50,min:0,max:100},null,{change:function(t){var r=.01*parseFloat(t.target.value),i=e.manager.resolveSystem(s.SoundscapeSystem).sfx;e.manager.aquireComponent(i,o.AudioChannel).volume=r}}),this.menu.music=a.HTMLNode("input",{type:"range",value:50,min:0,max:100},null,{change:function(t){var r=.01*parseFloat(t.target.value),i=e.manager.resolveSystem(s.SoundscapeSystem).music;e.manager.aquireComponent(i,o.AudioChannel).volume=r}}),[a.HTMLNode("div",{className:"vertical",style:{alignItems:"flex-end"}},[a.HTMLNode("div",{className:"horizontal",innerText:"Sound Effects: "},[this.menu.sfx]),a.HTMLNode("div",{className:"horizontal",innerText:"Music: "},[this.menu.music])])]},t}(a.EditorSubSystem);t.AudioSettings=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.GridLineLayer=void 0;var a=r(1),o=r(2),s=r(10),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.gridSize=a.vec2(64,64),t.gridColor=a.rgba(127,127,127,255),t.visible=!1,t.key="grid",t}return n(t,e),t.prototype.update=function(e){if(!this.visible||!e.camera)return this.graphics.clear();var t=this.manager.aquireComponent(e.camera,o.Camera2D);if(!(this.graphics.lastFrame>t.lastFrame&&-1!=t.lastFrame)){var r=this.gridSize[0],i=this.gridSize[1];if(!r||!i)return this.graphics.clear();var n=Math.max(t.viewport[0]/r,t.viewport[1]/i),s=Math.max(1,n/32|0);r*=s,i*=s;var c=t.bounds[0],l=t.bounds[1],u=t.bounds[2],p=t.bounds[3],h=a.mod(c,r),f=a.mod(l,i);this.graphics.clear();for(var d=c-h;d<=u;d+=r)this.graphics.beginPath(d,l).lineTo(d,p).stroke(this.gridColor,e.pixelWidth);for(var v=l-f;v<=p;v+=i)this.graphics.beginPath(c,v).lineTo(u,v).stroke(this.gridColor,e.pixelHeight)}},t.prototype.buildMenu=function(){var e=this;return[s.HTMLNode("div",{className:"vertical",style:{alignItems:"flex-end"}},[s.HTMLNode("div",{className:"horizontal",innerText:"Show: "},[s.HTMLNode("input",{type:"checkbox",checked:this.visible},null,{change:function(t){e.visible=t.target.checked,e.graphics.lastFrame=-1}})]),s.HTMLNode("div",{className:"horizontal",innerText:"Grid: "},[s.HTMLNode("input",{type:"number",min:0,max:100,step:1,value:0},null,{change:function(t){var r=+t.target.value;s.EditorSubSystem.gridSize=r,a.vec2.fromValues(r,r,e.gridSize)}})])])]},t}(s.EditorSubSystem);t.GridLineLayer=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.PhysicsDebugSystem=void 0;var a=r(1),o=r(24),s=r(2),c=r(10),l=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.bodies=t.manager.aquireDataView(o.RigidBody),t.transforms=t.manager.aquireDataView(s.Transform2D),t.prevPosition=a.vec2(),t.visible=!1,t.showAABB=!1,t.lineColor=a.rgba(127,127,127,255),t.fillColor=a.rgba(63,63,63,127),t.aabbColor=a.rgba(127,0,0,255),t.key="physics",t}return n(t,e),t.prototype.update=function(e){if(this.graphics.clear(),this.visible&&this.renderShapes(e),this.enabled){var t=this.queryEntity(e.worldPosition);if(e.trigger){if(a.vec2.copy(e.worldPosition,this.prevPosition),e.selectedEntity=t,e.selectedEntity){var r=this.manager.aquireComponent(e.selectedEntity,s.Transform2D);a.vec2.subtract(this.prevPosition,r.localPosition,this.prevPosition)}}else if(e.pressed&&e.selectedEntity){r=this.manager.aquireComponent(e.selectedEntity,s.Transform2D);a.vec2.subtract(e.worldPosition,this.prevPosition,r.localPosition),c.EditorSubSystem.gridSize&&a.snapToGrid(r.localPosition,c.EditorSubSystem.gridSize,r.localPosition),r.lastFrame=-1}this.menu.entity.value=e.selectedEntity}},t.prototype.queryEntity=function(e){var r=this.manager.resolveSystem(o.PhysicsSystem),i=a.AABB.fromValues(e[0],e[1],e[0],e[1],t.tempAABB),n=null;return r.broadphase.queryAABB(i,(function(e){return n=e,!1})),n&&this.graphics.setTransform(a.mat3x2.IDENTITY).beginPath(n.aabb[0],n.aabb[1]).lineTo(n.aabb[2],n.aabb[1]).lineTo(n.aabb[2],n.aabb[3]).lineTo(n.aabb[0],n.aabb[3]).closePath().fill(a.rgba(255,255,255,63)),n?n.entity:0},t.prototype.renderShapes=function(e){for(var r=t.temp,i=t.shapeTransform,n=this.bodies.data.internal,o=0;o<n.length;o++){for(var s=n[o],c=0;c<s.shapes.length;c++){var l=s.shapes[c];switch(a.vec2.rotate(l.position,s.angle,t.temp),a.mat3x2.fromTransform(s.position[0]+r[0],s.position[1]+r[1],0,0,1,1,s.angle+l.angle,0,0,i),this.graphics.setTransform(i),l.type){case 4:var u=l;this.graphics.beginPath(-.5*u.length,0).lineTo(.5*u.length,0).stroke(this.lineColor,2*Math.max(e.pixelWidth,e.pixelHeight));break;case 1:this.graphics.beginPath(10,0).arc(0,0,2*Math.max(e.pixelWidth,e.pixelHeight),0,2*Math.PI).fill(this.lineColor);break;case 2:var p=l;this.graphics.beginPath(0,0).arc(0,0,p.radius,0,2*Math.PI).closePath().fill(this.fillColor).stroke(this.lineColor,Math.max(e.pixelWidth,e.pixelHeight));break;case 8:case 16:for(var h=l,f=0;f<h.vertices.length;f++)f?this.graphics.lineTo(h.vertices[f][0],h.vertices[f][1]):this.graphics.beginPath(h.vertices[f][0],h.vertices[f][1]);this.graphics.closePath().fill(this.fillColor).stroke(this.lineColor,Math.max(e.pixelWidth,e.pixelHeight))}}this.showAABB&&s.shapes.length&&this.graphics.setTransform(a.mat3x2.IDENTITY).beginPath(s.aabb[0],s.aabb[1]).lineTo(s.aabb[2],s.aabb[1]).lineTo(s.aabb[2],s.aabb[3]).lineTo(s.aabb[0],s.aabb[3]).closePath().stroke(this.aabbColor,Math.max(e.pixelWidth,e.pixelHeight))}},t.prototype.buildMenu=function(){var e=this;return this.menu.entity=c.HTMLNode("input",{type:"number",disabled:!0,min:0,max:1e6}),[c.HTMLNode("div",{className:"vertical"},[c.HTMLNode("div",{className:"horizontal",innerText:"Show: "},[c.HTMLNode("input",{type:"checkbox",checked:this.visible},null,{change:function(t){e.visible=t.target.checked}})]),c.HTMLNode("div",{className:"horizontal",innerText:"Entity: "},[this.menu.entity]),c.HTMLNode("div",{className:"horizontal",innerText:"AABB: "},[c.HTMLNode("input",{type:"checkbox",checked:this.showAABB},null,{change:function(t){e.showAABB=t.target.checked}})])])]},t.temp=a.vec2(),t.tempAABB=a.AABB(),t.shapeTransform=a.mat3x2(),t}(c.EditorSubSystem);t.PhysicsDebugSystem=l},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)});Object.defineProperty(t,"__esModule",{value:!0}),t.EntitySelector=void 0;var a=r(1),o=r(2),s=r(10),c=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.transforms=t.manager.aquireDataView(o.Transform2D),t.prevPosition=a.vec2(),t.key="select",t}return n(t,e),t.prototype.update=function(e){if(this.context=e,this.graphics.clear(),this.enabled){var t=this.queryEntity(e.worldPosition);if(e.trigger){if(a.vec2.copy(e.worldPosition,this.prevPosition),e.selectedEntity=t,e.selectedEntity){var r=this.manager.aquireComponent(e.selectedEntity,o.Transform2D);a.vec2.subtract(this.prevPosition,r.localPosition,this.prevPosition)}}else if(e.pressed&&e.selectedEntity){r=this.manager.aquireComponent(e.selectedEntity,o.Transform2D);a.vec2.subtract(e.worldPosition,this.prevPosition,r.localPosition),s.EditorSubSystem.gridSize&&a.snapToGrid(r.localPosition,s.EditorSubSystem.gridSize,r.localPosition),r.lastFrame=-1}this.menu.entity.value=e.selectedEntity}},t.prototype.queryEntity=function(e){for(var t,r,i=this.transforms.data,n=1/0,o=0;r=i[o];o++){var s=r.globalTransform[4],c=r.globalTransform[5],l=s-e[0],u=c-e[1],p=l*l+u*u;p>=n||(n=p,t=o)}var h=i[t];return h&&this.graphics.setTransform(h.globalTransform).beginPath(-1024,0).lineTo(1024,0).stroke(a.rgba(0,255,0,255),4).beginPath(0,-1024).lineTo(0,1024).stroke(a.rgba(0,255,0,255),4),h.entity},t.prototype.buildMenu=function(){this.menu.entity=s.HTMLNode("input",{type:"number",disabled:!0,min:0,max:1e6});var e=this.manager,t=this.context;return[s.HTMLNode("div",{className:"vertical"},[s.HTMLNode("div",{className:"horizontal",innerText:"Entity: "},[this.menu.entity]),s.HTMLNode("button",{innerText:"create"},null,{click:function(r){t.selectedEntity=e.createEntity()}}),s.HTMLNode("button",{innerText:"delete"},null,{click:function(r){t.selectedEntity&&(e.removeEntity(t.selectedEntity),t.selectedEntity=0)}})])]},t}(s.EditorSubSystem);t.EntitySelector=c},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__assign||function(){return(a=Object.assign||function(e){for(var t,r=1,i=arguments.length;r<i;r++)for(var n in t=arguments[r])Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}).apply(this,arguments)},o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.ShapeConstructor=void 0;var s=r(1),c=r(2),l=r(24),u=r(241),p=r(10),h=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.drawType=4,t.path=[],t.key="shape",t}return n(t,e),t.prototype.update=function(e){if(this.graphics.clear(),e.camera&&this.enabled){p.EditorSubSystem.gridSize&&s.snapToGrid(e.worldPosition,p.EditorSubSystem.gridSize,e.worldPosition);var t=e.selectedEntity;t||(t=e.selectedEntity=this.manager.createEntity(),this.manager.createComponent(t,c.Transform2D,{position:[0,0]}));var r=this.manager.aquireComponent(t,l.RigidBody);switch(r||(r=this.manager.createComponent(t,l.RigidBody,{mass:0,type:0,shapes:[]})),this.menu.entity.value=e.selectedEntity,this.drawType){case 4:return this.drawLine(e,r);case 16:return this.drawConvex(e,r);case 1:return this.drawParticle(e,r);case 2:return this.drawCircle(e,r)}}},t.prototype.drawLine=function(e,t){if(e.trigger)this.path.push(s.vec2.copy(e.worldPosition,s.vec2()),s.vec2.copy(e.worldPosition,s.vec2()));else if(e.release){var r=this.path[0],i=this.path[1],n=s.vec2.subtract(i,r,s.vec2()),a=s.vec2.magnitude(n);if(!(a<.001)){var o=s.vec2.add(r,i,s.vec2());s.vec2.scale(o,.5,o),s.vec2.subtract(o,t.position,o),s.vec2.rotate(o,-t.angle,o);var c=s.vec2.rotation(n),u=new l.Line(o,c-t.angle,a);t.shapes.push(u.recalculateStaticProperties()),t.recalculateStaticProperties()}this.path.length=0}else e.pressed&&s.vec2.copy(e.worldPosition,this.path[this.path.length-1]);for(var p=0;p<this.path.length;p++)p?this.graphics.lineTo(this.path[p][0],this.path[p][1]):this.graphics.beginPath(this.path[p][0],this.path[p][1]);this.path.length&&this.graphics.stroke(s.rgba(255,255,255,255),4)},t.prototype.drawConvex=function(e,t){if(e.trigger)this.path.push(s.vec2.copy(e.worldPosition,s.vec2())),1==this.path.length&&this.path.push(s.vec2.copy(e.worldPosition,s.vec2()));else if(e.release){if(!(s.vec2.distance(this.path[0],this.path[this.path.length-1])>.001)){this.path.pop();var r=u.fromConcavePath(this.path),i=r.shapes,n=r.center;i.forEach((function(e){s.vec2.add(e.position,n,e.position),s.vec2.subtract(e.position,t.position,e.position),s.vec2.rotate(e.position,-t.angle,e.position),e.angle-=t.angle,t.shapes.push(e.recalculateStaticProperties())})),t.recalculateStaticProperties(),this.path.length=0}}else e.pressed&&s.vec2.copy(e.worldPosition,this.path[this.path.length-1]);for(var a=0;a<this.path.length;a++)a?this.graphics.lineTo(this.path[a][0],this.path[a][1]):this.graphics.beginPath(this.path[a][0],this.path[a][1]);this.path.length&&this.graphics.stroke(s.rgba(255,255,255,255),4)},t.prototype.drawParticle=function(e,t){if(e.trigger)this.path.push(s.vec2.copy(e.worldPosition,s.vec2()));else if(e.release){var r=this.path[0];s.vec2.subtract(r,t.position,r),s.vec2.rotate(r,-t.angle,r);var i=new l.Particle(r,0);t.shapes.push(i.recalculateStaticProperties()),t.recalculateStaticProperties(),this.path.length=0}else e.pressed&&s.vec2.copy(e.worldPosition,this.path[this.path.length-1]);this.path.length&&this.graphics.beginPath(this.path[0][0]+10,this.path[0][1]).arc(this.path[0][0],this.path[0][1],10,0,2*Math.PI).fill(s.rgba(255,255,255,255))},t.prototype.drawCircle=function(e,t){if(e.trigger)this.path.push(s.vec2.copy(e.worldPosition,s.vec2()),s.vec2.copy(e.worldPosition,s.vec2()));else if(e.release){var r=s.vec2.distance(this.path[0],this.path[1]);if(!(r<.001)){var i=this.path[0];s.vec2.subtract(i,t.position,i),s.vec2.rotate(i,-t.angle,i);var n=new l.Circle(i,0,r);t.shapes.push(n.recalculateStaticProperties()),t.recalculateStaticProperties()}this.path.length=0}else e.pressed&&s.vec2.copy(e.worldPosition,this.path[this.path.length-1]);this.path.length&&this.graphics.beginPath(this.path[0][0],this.path[0][1]).arc(this.path[0][0],this.path[0][1],s.vec2.distance(this.path[0],this.path[1]),0,2*Math.PI).stroke(s.rgba(255,255,255,255),4)},t.prototype.buildMenu=function(){var e=this;return this.menu.entity=p.HTMLNode("input",{type:"number",disabled:!0,min:0,max:1e6}),[p.HTMLNode("div",{className:"vertical"},[p.HTMLNode("div",{className:"horizontal",innerText:"Entity: "},[this.menu.entity]),p.HTMLNode("div",{className:"horizontal",innerText:"Shape: "},[p.HTMLNode("select",{},[p.HTMLNode("option",{innerText:"Line",value:4}),p.HTMLNode("option",{innerText:"Convex",value:16}),p.HTMLNode("option",{innerText:"Particle",value:1}),p.HTMLNode("option",{innerText:"Circle",value:2})],{change:function(t){var r=t.target.value;e.drawType=+r}})])])]},t.prototype.print=function(){var e=[0,0,0,0,0,0,0,0,0,0,1,1,1,1,1,1,1,1,2,2,2,2,2,2,2,0],t=this.manager.aquireDataView(l.RigidBody).data.internal;return JSON.stringify(t.filter((function(e){return 0==e.type})).map((function(t,r){for(var i=s.vec2(),n=0;n<t.shapes.length;n++)s.vec2.add(i,t.shapes[n].position,i);return s.vec2.scale(i,1/t.shapes.length,i),p.EditorSubSystem.gridSize&&s.snapToGrid(i,p.EditorSubSystem.gridSize,i),{biome:e[r],aabb:[1/0,1/0,-1/0,-1/0],center:o(s.vec2.add(i,t.position,s.vec2())),path:t.shapes.map((function(e){var t=[];switch(e.type){case 4:var r=e;t.push([-.5*r.length,0],[.5*r.length,0])}return t.map((function(t){return s.vec2.rotate(t,e.angle,t),s.vec2.add(t,e.position,t),s.vec2.subtract(t,i,t),s.snapToGrid(t,.001,t)}))}))}})).map((function(e){return e.path.forEach((function(t){return t.forEach((function(t){e.aabb[0]=Math.min(e.aabb[0],t[0]+e.center[0]),e.aabb[1]=Math.min(e.aabb[1],t[1]+e.center[1]),e.aabb[2]=Math.max(e.aabb[2],t[0]+e.center[0]),e.aabb[3]=Math.max(e.aabb[3],t[1]+e.center[1])}))})),e})),null,0)},t.prototype.appendLast=function(e){var t=(e=JSON.parse(e).map((function(e){return a(a({},e),{path:e.path.map((function(t){return t.map((function(t){return s.vec2.add(t,e.center,t)}))}))})})))[e.length-1].path,r=!0;return JSON.stringify(e.slice(0,-1).map((function(e,i){var n=e.center,a=e.path;return r?!!a.some((function(e){var r=e[0],i=e[1];return t.some((function(e){var t=e[0],n=e[1];return s.vec2.distance(r,t)<1e-6&&s.vec2.distance(i,n)<1e-6}))}))&&(r=!1,{i:i,center:n,path:o(a.map((function(e){return e.map((function(e){return s.vec2.subtract(e,n,e)}))})),t.map((function(e){return e.map((function(e){return s.vec2.subtract(e,n,e)}))})))}):null})).find((function(e){return!!e})),null,0)},t.temp=s.vec2(),t}(p.EditorSubSystem);t.ShapeConstructor=h},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.decomposePolygon=t.simplifyPolygon=t.reorderCCW=t.fromConcavePath=void 0;var i=r(0),n=r(5),a=r(20),o=r(242),s=r(50);function c(e){for(var t=0,r=e.length-1;r>0;r--)(e[r][1]-e[t][1]||e[r][0]-e[t][0])<0&&(t=r);var i=n.mod(t-1,e.length),o=n.mod(t+1,e.length);a.triangleArea(e[i],e[t],e[o])>0||e.reverse()}function l(e,t){void 0===t&&(t=1e-6);for(var r=e.length-1;r>0;r--)for(var i=r-1;i>=0;i--)if(Math.abs(e[r][0]-e[i][0])+Math.abs(e[r][1]-e[i][1])<t){e.splice(r,1);break}for(var o=e.length-1;e.length>3&&o>=0;o--){var s=n.mod(o-1,e.length),c=n.mod(o+1,e.length);a.measureAngle(e[s],e[o],e[c])>t||e.splice(o,1)}}function u(e,t,r,s,c,l){if(e.length<3)return s;if(--c<0)throw new RangeError("Maximum recursion depth exceeded!");for(var p=[],h=[],f=i.vec2(),d=i.vec2(),v=i.vec2(),m=0;m<e.length;m++){var y=n.mod(m-1,e.length),g=n.mod(m+1,e.length);if(!(a.triangleArea(e[y],e[m],e[g])>=0)){t.push(e[m]);for(var b=1/0,_=1/0,P=0,S=0,x=void 0,A=0;A<e.length;A++){var O=n.mod(A-1,e.length),w=n.mod(A+1,e.length);a.triangleArea(e[y],e[m],e[A])>0&&a.triangleArea(e[y],e[m],e[O])<=0&&(a.lineIntersection(e[y],e[m],e[A],e[O],v),a.triangleArea(e[g],e[m],v)<0&&(x=i.vec2.distanceSquared(e[m],v))<_&&(_=x,i.vec2.copy(v,f),P=A)),a.triangleArea(e[g],e[m],e[w])>0&&a.triangleArea(e[g],e[m],e[A])<=0&&(a.lineIntersection(e[g],e[m],e[A],e[w],v),a.triangleArea(e[y],e[m],v)>0&&(x=i.vec2.distanceSquared(e[m],v))<b&&(b=x,i.vec2.copy(v,d),S=A))}if(P===n.mod(S+1,e.length))v[0]=.5*(f[0]+d[0]),v[1]=.5*(f[1]+d[1]),r.push(v),m<S?(o.appendList(p,e,m,S+1),p.push(v),h.push(v),0!==P&&o.appendList(h,e,P,e.length),o.appendList(h,e,0,m+1)):(0!==m&&o.appendList(p,e,m,e.length),o.appendList(p,e,0,S+1),p.push(v),h.push(v),o.appendList(h,e,P,m+1));else{P>S&&(S+=e.length);var M=1/0,T=0;var E=P;e:for(A=E;E<=S;A=n.mod(++E,e.length))if(a.triangleArea(e[y],e[m],e[A])>=0&&a.triangleArea(e[g],e[m],e[A])<=0){if((x=i.vec2.distanceSquared(e[m],e[A]))>=M)continue;for(var C=e.length-1,B=0;C>=0;B=C--)if(C!==m&&C!==A&&B!==m&&B!==A&&-1!=a.lineIntersectionFraction(e[m],e[A],e[C],e[B]))continue e;M=x,T=A}m<T?(o.appendList(p,e,m,T+1),0!==T&&o.appendList(h,e,T,e.length),o.appendList(h,e,0,m+1)):(0!==m&&o.appendList(p,e,m,e.length),o.appendList(p,e,0,T+1),o.appendList(h,e,T,m+1))}return p.length<h.length?(u(p,t,r,s,c,l),u(h,t,r,s,c,l)):(u(h,t,r,s,c,l),u(p,t,r,s,c,l)),s}}return s.push(e),s}t.fromConcavePath=function(e){c(e),l(e);for(var t=u(e,[],[],[],100,1e-6).map((function(e){return new s.Convex(void 0,void 0,e)})),r=i.vec2(),n=i.vec2(),a=0,o=t.length-1;o>=0;o--){var p=t[o],h=p.computeArea();i.vec2.add(p.center,p.position,p.position);for(var f=p.vertices.length-1;f>=0;f--)i.vec2.subtract(p.vertices[f],p.center,p.vertices[f]);a+=h,i.vec2.scale(p.position,h,n),i.vec2.add(n,r,r)}for(i.vec2.scale(r,1/a,r),o=t.length-1;o>=0;o--)i.vec2.subtract(t[o].position,r,t[o].position);return{center:r,shapes:t}},t.reorderCCW=c,t.simplifyPolygon=l,t.decomposePolygon=u},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.appendList=void 0,t.appendList=function(e,t,r,i,n){void 0===n&&(n=e.length),e.length+=i-r;for(var a=r;a<i;a++)e[n++]=t[a];return e}},function(e,t,r){"use strict";var i,n,a=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),o=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.PuzzleCreator=void 0;var s=r(1),c=r(2),l=r(10),u=r(55),p=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.visible=!1,r.key="puzzle",r.mode=t.MODES.ENTRY,r}return a(t,e),t.prototype.update=function(e){this.graphics.clear();var r=this.manager.resolveSystem(u.PuzzleSystem).knots.data,i=this.manager.resolveSystem(u.PuzzleSystem).wires.data;if(this.visible)for(var n=void 0,a=0;n=i[a];a++){var o=this.manager.aquireComponent(n.pair[0],c.Transform2D),p=this.manager.aquireComponent(n.pair[1],c.Transform2D);this.graphics.beginPath(o.localPosition[0],o.localPosition[1]).lineTo(p.localPosition[0],p.localPosition[1]).stroke(t.colors[4],8)}if(this.visible){var h=void 0;for(a=0;h=r[a];a++){var f=this.manager.aquireComponent(h.entity,c.Transform2D);this.graphics.beginPath(f.localPosition[0],f.localPosition[1]-64).lineTo(f.localPosition[0]+64,f.localPosition[1]).lineTo(f.localPosition[0],f.localPosition[1]+64).lineTo(f.localPosition[0]-64,f.localPosition[1]).closePath().fill(t.colors[h.type])}}if(e.camera&&this.enabled){if(e.selectedEntity){f=this.manager.aquireComponent(e.selectedEntity,c.Transform2D);this.graphics.beginPath(f.localPosition[0],f.localPosition[1]).lineTo(e.worldPosition[0],e.worldPosition[1]).stroke(s.rgba.WHITE,8)}var d,v=16384;for(h=void 0,a=0;h=r[a];a++){f=this.manager.aquireComponent(h.entity,c.Transform2D);var m=s.vec2.distanceSquared(f.localPosition,e.worldPosition);m>=v||(v=m,d=a)}switch(this.mode){case t.MODES.ENTRY:case t.MODES.SINGLE:case t.MODES.REGROW:case t.MODES.TOGGLE:if(e.trigger&&null!=d)r[d].type=this.mode;else if(e.trigger){l.EditorSubSystem.gridSize&&s.snapToGrid(e.worldPosition,l.EditorSubSystem.gridSize,e.worldPosition);h=this.manager.createEntity();this.manager.createComponent(h,c.Transform2D,{position:e.worldPosition}),this.manager.createComponent(h,u.PuzzleKnot,this.mode)}break;case t.MODES.WIRE:if(e.trigger&&null!=d)e.selectedEntity=r[d].entity;else if(e.release&&e.selectedEntity){if(null!=d&&e.selectedEntity!==r[d].entity&&i.every((function(t){return!(t.pair[0]===e.selectedEntity&&t.pair[1]===r[d].entity||t.pair[1]===e.selectedEntity&&t.pair[0]===r[d].entity)}))){n=this.manager.createEntity();this.manager.createComponent(n,u.PuzzleWire,[e.selectedEntity,r[d].entity])}e.selectedEntity=0}}this.menu.entity.value=e.selectedEntity}},t.prototype.buildMenu=function(){var e=this;return this.menu.entity=l.HTMLNode("input",{type:"number",disabled:!0,min:0,max:1e6}),[l.HTMLNode("div",{className:"vertical"},[l.HTMLNode("div",{className:"horizontal",innerText:"Show: "},[l.HTMLNode("input",{type:"checkbox",checked:this.visible},null,{change:function(t){e.visible=t.target.checked}})]),l.HTMLNode("div",{className:"horizontal",innerText:"Entity: "},[this.menu.entity]),l.HTMLNode("div",{className:"horizontal",innerText:"Shape: "},[l.HTMLNode("select",{},Object.keys(t.MODES).map((function(e){return l.HTMLNode("option",{innerText:e,value:t.MODES[e]})})),{change:function(t){var r=t.target.value;e.mode=+r}})])])]},t.prototype.print=function(){for(var e=this,t=this.manager.resolveSystem(u.PuzzleSystem),r=this.manager.resolveSystem(u.PuzzleSystem).knots.data,i=this.manager.resolveSystem(u.PuzzleSystem).wires.data,n=r.map((function(t,r){return{i:r,type:t.type,distance:null,entity:t.entity,position:e.manager.aquireComponent(t.entity,c.Transform2D).localPosition}})),a=0,s=0;s<n.length;s++)if(null==n[s].distance){n[s].distance=a;for(var l=[n[s]];l.length;)for(var p=l.pop(),h=0;h<n.length;h++)t.pairs[p.i+h*n.length]&&(null!=n[h].distance&&n[h].distance<=p.distance+1||(n[h].distance=p.distance+1,a=Math.max(a,p.distance+2),l.push(n[h])));s=Math.max(s,305)}return n.sort((function(e,t){return e.distance-t.distance})),console.log(n),JSON.stringify({knots:n.map((function(e){return o([e.type],e.position)})),wires:i.map((function(e){return[n.findIndex((function(t){return t.entity===e.pair[0]})),n.findIndex((function(t){return t.entity===e.pair[1]}))]})).sort((function(e,t){return e[0]-t[0]}))},null,0)},t.colors=((n={})[0]=s.rgba(120,210,180,100),n[1]=s.rgba(200,67,67,100),n[2]=s.rgba(20,180,80,100),n[3]=s.rgba(230,210,80,100),n[4]=s.rgba(30,20,180,100),n),t.MODES={ENTRY:0,SINGLE:1,REGROW:2,TOGGLE:3,WIRE:4},t}(l.EditorSubSystem);t.PuzzleCreator=p},function(e,t,r){"use strict";var i,n=this&&this.__extends||(i=function(e,t){return(i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)t.hasOwnProperty(r)&&(e[r]=t[r])})(e,t)},function(e,t){function r(){this.constructor=e}i(e,t),e.prototype=null===t?Object.create(t):(r.prototype=t.prototype,new r)}),a=this&&this.__spreadArrays||function(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var i=Array(e),n=0;for(t=0;t<r;t++)for(var a=arguments[t],o=0,s=a.length;o<s;o++,n++)i[n]=a[o];return i};Object.defineProperty(t,"__esModule",{value:!0}),t.RegionCreator=void 0;var o=r(1),s=r(10),c=r(13),l=function(e){function t(){var r=null!==e&&e.apply(this,arguments)||this;return r.currentRegion=null,r.visible=!1,r.mode=t.MODES.SELECT,r.key="region",r}return n(t,e),t.prototype.update=function(e){this.context=e,this.graphics.clear();var r=this.manager.resolveSystem(c.CameraSystem).regions.data;if(this.visible)for(var i,n=0;i=r[n];n++)this.graphics.beginPath(i.aabb[0],i.aabb[1]).lineTo(i.aabb[2],i.aabb[1]).lineTo(i.aabb[2],i.aabb[3]).lineTo(i.aabb[0],i.aabb[3]).closePath().stroke(t.colors.bounds,8);if(e.camera&&this.enabled){switch(this.mode){case t.MODES.SELECT:var a=this.queryEntity(e.worldPosition);e.trigger&&(e.selectedEntity=a);break;case t.MODES.DRAW:this.drawRegion(e)}var o=e.selectedEntity?this.manager.aquireComponent(e.selectedEntity,c.CameraRegion):null;o?(this.menu.viewWidth.disabled=!1,document.activeElement!==this.menu.viewWidth&&(this.menu.viewWidth.value=o.view[0]),this.menu.viewHeight.value=o.view[1],this.menu.lockX.value=o.lockX,this.menu.lockY.value=o.lockY):this.menu.viewWidth.disabled=!0}},t.prototype.queryEntity=function(e){for(var r,i=this.manager.resolveSystem(c.CameraSystem).regions.data,n=(o.vec2(),1/0),a=0;a<i.length;a++){var s=i[a].aabb,l=o.vec2.fromValues(.5*(s[0]+s[2]),.5*(s[1]+s[3]),t.temp),u=o.vec2.distanceSquared(l,e);u>=n||(n=u,r=a)}return null!=r?i[r].entity:0},t.prototype.drawRegion=function(e){if(s.EditorSubSystem.gridSize&&o.snapToGrid(e.worldPosition,s.EditorSubSystem.gridSize,e.worldPosition),e.trigger&&(this.currentRegion=o.AABB(e.worldPosition[0],e.worldPosition[1],e.worldPosition[0],e.worldPosition[1])),e.release){var r=o.AABB(Math.min(this.currentRegion[0],this.currentRegion[2]),Math.min(this.currentRegion[1],this.currentRegion[3]),Math.max(this.currentRegion[0],this.currentRegion[2]),Math.max(this.currentRegion[1],this.currentRegion[3])),i=this.manager.createEntity();this.manager.createComponent(i,c.CameraRegion,{view:o.vec2(),bounds:r}),this.currentRegion=null}if(this.currentRegion){this.currentRegion[2]=e.worldPosition[0],this.currentRegion[3]=e.worldPosition[1];var n=this.currentRegion;this.graphics.beginPath(n[0],n[1]).lineTo(n[2],n[1]).lineTo(n[2],n[3]).lineTo(n[0],n[3]).closePath().stroke(t.colors.bounds,8)}},t.prototype.buildMenu=function(){var e=this;return this.menu.viewWidth=s.HTMLNode("input",{type:"number",min:0,max:1e4},null,{change:function(t){var r=e.context.selectedEntity?e.manager.aquireComponent(e.context.selectedEntity,c.CameraRegion):null;if(r){var i=parseFloat(t.target.value),n=r.view[0]/r.view[1];r.view[0]=i,r.view[1]=Math.round(i/n)}}}),this.menu.viewHeight=s.HTMLNode("input",{type:"number",min:0,max:1e4,disabled:!0}),this.menu.lockX=s.HTMLNode("input",{type:"number",min:-1e4,max:1e4,disabled:!0}),this.menu.lockY=s.HTMLNode("input",{type:"number",min:-1e4,max:1e4,disabled:!0}),[s.HTMLNode("div",{className:"vertical"},[s.HTMLNode("div",{className:"horizontal",innerText:"Show: "},[s.HTMLNode("input",{type:"checkbox",checked:this.visible},null,{change:function(t){e.visible=t.target.checked}})]),s.HTMLNode("div",{className:"horizontal",innerText:"Mode: "},[s.HTMLNode("select",{},[s.HTMLNode("option",{innerText:"Select",value:t.MODES.SELECT}),s.HTMLNode("option",{innerText:"Draw",value:t.MODES.DRAW})],{change:function(t){return e.mode=t.target.value}})]),s.HTMLNode("div",{className:"horizontal",innerText:"Size:"},[this.menu.viewWidth,this.menu.viewHeight]),s.HTMLNode("div",{className:"horizontal",innerText:"Lock:"},[this.menu.lockX,this.menu.lockY])])]},t.prototype.print=function(){var e=this.manager.resolveSystem(c.CameraSystem).regions.data;return JSON.stringify(e.map((function(e){var t=e.aabb,r=e.view,i=e.lockX,n=e.lockY;return a([a(t)],r,[i,n])})),null,0)},t.temp=o.vec2(),t.colors={bounds:o.rgba(255,127,0,255),region:o.rgba(255,0,255,255)},t.MODES={SELECT:"select",DRAW:"draw"},t}(s.EditorSubSystem);t.RegionCreator=l},function(e,t,r){"use strict";var i=this&&this.__createBinding||(Object.create?function(e,t,r,i){void 0===i&&(i=r),Object.defineProperty(e,i,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,i){void 0===i&&(i=r),e[i]=t[r]}),n=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||i(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0}),n(r(246),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProgressSpinner=void 0;var i=r(5),n=r(60);r(247);var a=function(){function e(){this.segments=i.range(10).map((function(e){return n.HTMLNode("div",{className:"spinner-bar-segment-glow",style:{opacity:0}})})),this.icon=n.HTMLNode("div",{className:"spinner-play-icon"},[n.HTMLNode("div",{className:"spinner-play-triangle"})]),this.root=n.HTMLNode("div",{className:"spinner-overlay"},[n.HTMLNode("div",{className:"spinner-bar"},this.segments.map((function(e,t){return n.HTMLNode("div",{className:"spinner-bar-segment",style:{animationDelay:.1*t+"s"}},[e])}))),n.HTMLNode("div",{className:"spinner-controls"},[this.icon])]),document.body.appendChild(this.root)}return Object.defineProperty(e.prototype,"progress",{set:function(e){for(var t=e*this.segments.length,r=0;r<this.segments.length;r++)this.segments[r].style.opacity=i.clamp(t-r,0,1)},enumerable:!1,configurable:!0}),e.prototype.awaitGesture=function(){this.icon.classList.add("enabled")},e.prototype.delete=function(){this.root.parentNode.removeChild(this.root),this.root=this.icon=this.segments=null},e}();t.ProgressSpinner=a},function(e,t,r){},function(e){e.exports=JSON.parse('["spritesheet_0.png","spritesheet_1.png","spritesheet_2.png","bundle.json"]')},function(e){e.exports=JSON.parse('{"puzzle":{"knots":[[0,0,800,1,0],[1,800,800,1,0],[1,1600,1100,0.64,0],[1,1600,800,1,0],[1,800,200,0.64,0],[1,1600,200,1,0],[1,800,-100,1,1],[0,2400,200,1,0],[1,3200,800,1,0],[1,3200,200,1,0],[1,2400,-400,1,0],[1,3200,-400,1,0],[1,4000,-400,1,0],[1,4000,200,1,0],[0,4800,200,1,0],[1,4800,-400,1,0],[1,5200,-100,0.64,0],[1,5200,500,1,1],[1,5600,200,0.64,0],[1,5600,-400,1,0],[1,6400,200,1,0],[1,6000,-100,0.64,0],[1,6000,-700,1,0],[1,6400,-400,1,0],[0,6400,-1000,1,0],[1,6400,-1600,1,0],[1,7200,-1600,1,0],[1,7200,-1000,1,0],[1,6400,-2800,1,0],[1,7200,-2200,1,0],[1,8000,-1000,1,0],[1,8000,-1600,1,0],[1,7200,-2800,1,0],[1,8000,-2200,1,0],[0,8800,-1600,1,0],[1,8000,-2800,1,0],[1,9600,-2200,1,0],[1,8800,-2200,1,0],[1,8800,-2800,1,0],[1,9600,-2800,0.64,0],[1,10400,-2200,1,0],[1,10400,-2800,1,0],[1,9200,-3100,0.64,0],[1,10400,-3400,1,1],[1,9600,-3400,1,0],[1,8800,-3400,1,0],[1,9600,-4000,1,0],[1,8800,-4000,1,0],[0,8000,-4000,1,0],[1,8000,-3400,1,0],[1,7200,-3400,1,0],[1,7200,-4000,0.64,0],[1,7600,-4300,0.64,0],[1,8000,-4600,1,0],[1,7200,-4600,1,0],[1,6400,-4000,1,0],[1,7200,-5200,1,0],[1,8000,-5200,1,0],[0,8800,-4600,1,0],[1,6800,-4300,0.64,0],[1,6000,-4300,1,0],[1,6400,-4600,1,0],[1,6400,-5200,1,0],[1,9600,-4600,1,0],[1,9600,-5200,0.64,0],[1,8800,-5200,1,0],[1,9200,-5500,0.64,0],[1,10000,-5500,1,0],[1,10400,-5200,0.64,0],[1,10400,-4600,1,0],[1,10800,-5500,1,0],[1,9600,-5800,0.64,0],[1,8800,-5800,1,0],[1,11200,-4600,1,0],[1,11200,-5200,1,0],[1,10000,-6100,1,1],[1,9200,-6100,1,0],[0,8000,-6400,1,0],[1,8000,-5800,1,0],[1,7200,-6400,1,0],[1,8000,-7000,1,0],[1,7200,-5800,1,0],[1,7200,-7000,1,0],[1,6800,-6400,1,0],[1,6800,-7300,0.64,0],[1,7200,-7600,1,0],[1,6400,-7600,1,0],[1,6400,-7000,1,0],[1,5600,-7600,1,0],[0,6400,-8200,1,0],[1,7200,-8200,1,0],[1,8800,-8200,1,0],[1,7200,-8800,1,0],[1,8800,-8800,1,0],[1,8000,-7900,1,1],[1,8000,-9100,0.64,0],[1,7200,-9400,1,0],[1,8800,-9400,1,0],[0,9600,-8200,1,0],[1,8000,-9400,1,0],[1,8800,-7600,1,0],[1,9600,-7600,1,0],[1,10400,-7600,1,0],[1,10400,-8200,1,0],[1,10000,-8500,0.64,0],[1,9600,-8800,1,0],[1,9600,-7000,1,0],[1,11200,-7000,1,0],[1,11200,-7600,1,0],[1,10400,-8800,1,0],[1,11200,-8200,1,0],[0,12000,-8200,1,0],[1,12000,-7000,1,0],[1,12000,-7600,1,0],[0,12000,-2200,1,0],[2,12000,-1600,1,0],[2,11200,-1600,1,0],[2,12800,-1600,1,0],[2,12800,-1000,1,0],[2,12800,-400,1,0],[2,11200,-1000,1,0],[2,10400,-1000,1,0],[0,13600,-1000,1,0],[2,12000,-400,1,0],[2,11200,-400,1,0],[2,12000,200,1,0],[2,10400,200,1,0],[2,14400,-1000,1,0],[2,15200,-1600,1,0],[2,15200,-1000,0.64,0],[2,15200,-400,1,0],[2,14400,-1600,1,0],[2,14400,-400,1,0],[2,16000,-2200,1,0],[2,16000,-1000,1,0],[2,15200,-2200,1,0],[2,15200,200,1,0],[2,16000,200,1,0],[0,16800,-1600,1,0],[2,16000,-1600,1,0],[2,16000,-400,1,0],[2,17600,-1600,1,0],[2,18400,-1000,1,0],[2,18400,-2200,1,0],[2,17600,-1000,1,0],[2,18400,-1600,1,0],[2,19200,-400,1,0],[2,20000,-1000,1,0],[2,19200,200,1,0],[2,19200,-1000,1,0],[2,20000,-1600,1,0],[2,17600,-400,1,0],[2,19200,-2200,1,1],[0,20000,-400,1,0],[2,18400,200,0.64,0],[2,17600,200,1,0],[2,20000,-2200,1,0],[2,20000,200,1,0],[2,20000,800,1,0],[2,19200,800,1,0],[2,20800,1400,1,0],[2,20800,200,1,0],[2,20000,1400,1,0],[2,19200,2000,1,0],[2,21600,1400,1,0],[2,20000,2000,1,0],[2,21600,2600,1,0],[2,21600,800,1,0],[2,21600,2000,1,0],[0,19200,2600,1,0],[2,20000,2600,1,0],[2,22400,800,1,1],[2,22400,2000,0.64,0],[2,23200,2000,1,0],[2,23200,2600,1,0],[2,18400,2600,1,0],[2,18400,2000,1,0],[1,17600,2600,1,0],[2,18400,3200,1,0],[2,17600,2000,1,0],[2,16800,2600,1,0],[2,17600,3200,1,0],[2,16800,2000,1,0],[1,17600,3800,1,0],[2,18400,4400,1,0],[0,16000,3200,1,0],[2,16800,3200,1,0],[2,16800,4400,1,0],[2,15200,3200,1,0],[2,15200,3800,1,0],[2,14400,3200,1,0],[2,14400,3800,1,0],[2,14400,4400,1,0],[1,15200,2600,1,0],[2,12800,3200,1,0],[2,12800,4400,1,0],[1,13600,3800,1,1],[2,14400,2000,1,0],[2,14400,2600,1,0],[2,15200,2000,1,0],[0,12000,2600,1,0],[2,12800,2600,1,0],[2,13600,2600,1,0],[1,13600,2000,1,0],[2,11200,2600,1,0],[2,12800,2000,1,0],[2,10400,3200,1,0],[2,10400,2600,1,0],[2,10400,2000,1,0],[2,11200,2000,1,0],[2,11200,3200,1,0],[2,9600,3200,1,0],[2,9600,2600,1,0],[2,9600,2000,1,0],[1,10000,2300,0.64,0],[2,10400,1400,1,0],[1,10000,3500,0.64,0],[1,11200,1400,1,1],[2,8800,2600,1,0],[2,8800,2000,1,0],[2,8800,3200,1,0],[0,8000,2600,1,0],[1,7200,2600,1,0],[1,7200,2000,1,0],[1,7200,3200,1,0],[1,6400,2600,0.64,0],[1,6400,3200,1,0],[1,7200,1400,1,0],[0,4800,2600,1,0],[1,5600,3200,1,1],[1,5600,2000,1,0],[1,6400,1400,1,0],[1,6400,2000,1,0],[3,4000,2600,1,0],[3,3200,2600,1,0],[3,3200,2000,1,0],[3,4000,3200,1,0],[3,4000,2000,1,0],[0,2400,2600,1,0],[3,3200,3200,1,0],[3,1600,2600,1,0],[3,800,2000,1,0],[3,800,2600,1,0],[3,0,3800,1,1],[3,1600,2000,1,0],[3,1600,3200,1,0],[3,0,2600,1,0],[3,800,3800,1,0],[0,-800,2600,1,0],[3,-1600,2600,1,0],[3,-3200,2000,1,0],[3,-1600,3200,1,0],[3,-1600,2000,1,0],[3,-4000,2600,1,0],[3,-3200,2600,1,0],[3,-2400,2000,1,0],[3,-2400,3200,1,1],[0,-4800,2600,1,0],[3,-4000,3200,1,0],[3,-3200,3200,1,0],[3,-5600,2600,1,0],[3,-8000,2600,1,0],[3,-5600,1400,1,0],[3,-6400,3200,1,0],[3,-8000,1400,1,0],[3,-7200,2000,1,0],[3,-7200,1400,1,0],[3,-6400,800,1,0],[3,-6400,2000,1,0],[3,-7200,3200,1,1],[0,-8800,1400,1,0],[3,-7200,800,1,0],[3,-8800,800,1,0],[3,-9600,-400,1,0],[3,-8000,800,1,0],[3,-8800,200,1,0],[1,-9600,800,1,0],[1,-7200,200,1,0],[3,-8800,-1000,1,0],[3,-8000,-400,1,0],[3,-9600,-1000,1,0],[0,-8800,-1600,1,0],[3,-8000,-1600,1,0],[1,-7200,-2200,1,0],[3,-8000,-1000,1,0],[3,-7200,-1600,1,0],[1,-6400,-1600,0.64,0],[3,-6400,-2200,1,0],[3,-6400,-1000,1,0],[3,-7200,-400,1,1],[3,-5600,-1600,1,0],[1,-5600,-1000,1,0],[3,-4800,-2200,1,0],[3,-5600,-2800,1,0],[3,-4800,-1600,1,0],[0,-4800,-1000,1,0],[2,-4000,-1600,1,0],[2,-4000,-1000,1,0],[2,-4000,200,1,0],[3,-3200,-2200,1,0],[2,-2400,-1600,1,0],[1,-4000,-2800,1,0],[3,-3200,-400,1,1],[2,-2400,-1000,1,0],[2,-2400,200,1,0],[1,-2400,-2800,1,0],[3,-1600,-2200,1,0],[3,-1600,-400,1,0],[1,-1600,200,1,0],[0,-800,-2200,1,0]],"wires":[[0,1],[1,2],[1,3],[1,5],[1,4],[2,3],[3,4],[3,5],[4,6],[4,5],[5,7],[5,6],[7,8],[7,9],[7,10],[7,11],[8,9],[8,13],[9,10],[9,13],[9,11],[10,11],[11,12],[12,13],[13,14],[14,15],[14,16],[14,17],[15,16],[15,19],[16,17],[16,18],[16,19],[17,18],[18,20],[18,19],[18,21],[19,22],[19,23],[19,21],[20,21],[20,23],[21,23],[22,23],[23,24],[24,25],[24,27],[24,26],[25,28],[25,26],[26,27],[26,30],[26,31],[26,29],[27,30],[28,32],[29,32],[29,33],[30,31],[31,34],[31,33],[32,35],[32,33],[33,35],[34,36],[36,37],[36,40],[36,39],[36,41],[36,38],[37,38],[37,39],[38,42],[38,39],[38,45],[39,40],[39,41],[39,44],[39,42],[40,41],[41,43],[41,44],[42,45],[42,44],[43,44],[44,46],[44,47],[44,45],[45,48],[45,47],[46,47],[48,49],[48,51],[48,50],[48,52],[48,53],[49,50],[50,51],[50,55],[51,52],[51,55],[51,54],[52,54],[52,53],[53,58],[53,54],[53,56],[53,57],[54,59],[54,61],[54,62],[54,56],[54,57],[55,60],[55,61],[55,59],[56,57],[56,62],[58,63],[58,65],[58,64],[59,61],[60,61],[61,62],[63,64],[64,65],[64,68],[64,69],[64,71],[64,66],[64,67],[64,70],[65,66],[65,72],[66,67],[66,71],[66,72],[67,68],[67,71],[67,70],[67,75],[68,69],[68,73],[68,74],[68,70],[69,73],[70,75],[70,71],[70,74],[71,76],[71,72],[71,75],[72,77],[72,76],[73,74],[77,78],[77,79],[77,80],[78,81],[78,79],[79,80],[79,82],[79,83],[79,84],[79,81],[80,82],[82,83],[82,87],[82,85],[82,84],[83,84],[84,85],[84,87],[84,86],[85,86],[86,87],[86,88],[87,88],[88,89],[89,90],[90,91],[90,92],[90,93],[90,94],[91,95],[91,93],[91,94],[91,92],[91,98],[92,96],[92,93],[92,95],[93,94],[93,95],[93,97],[95,99],[96,99],[97,99],[98,100],[98,103],[98,101],[98,102],[98,105],[98,104],[100,106],[101,102],[101,103],[101,106],[102,107],[102,108],[102,103],[102,110],[102,106],[103,104],[103,110],[103,109],[103,105],[103,108],[104,105],[105,109],[107,112],[107,108],[108,110],[108,112],[108,113],[109,110],[110,111],[112,113],[114,116],[115,120],[114,115],[115,116],[116,121],[117,118],[117,124],[117,120],[117,123],[115,117],[118,119],[118,123],[115,118],[119,123],[119,125],[115,119],[120,121],[116,120],[121,126],[117,122],[118,122],[119,122],[123,124],[123,125],[120,123],[120,124],[124,126],[125,126],[127,131],[127,132],[122,127],[127,128],[128,131],[127,129],[130,137],[127,130],[130,132],[132,136],[133,139],[133,135],[128,133],[134,140],[128,134],[129,134],[130,134],[134,139],[135,139],[131,135],[136,137],[133,138],[134,138],[137,140],[136,140],[141,144],[141,145],[138,141],[142,145],[141,142],[142,144],[142,151],[143,152],[141,143],[143,145],[144,151],[144,145],[145,152],[146,149],[146,147],[142,146],[146,154],[146,148],[147,149],[143,147],[147,150],[144,148],[142,149],[149,150],[145,149],[149,152],[149,155],[145,150],[150,152],[150,156],[151,155],[152,156],[146,153],[147,153],[148,154],[151,154],[154,155],[157,161],[153,157],[158,167],[158,159],[158,160],[157,158],[158,161],[157,159],[160,168],[160,165],[160,166],[157,160],[160,161],[160,167],[161,167],[162,165],[162,166],[158,162],[159,162],[160,162],[163,170],[158,163],[159,163],[163,165],[160,164],[164,168],[164,172],[164,167],[164,171],[165,168],[165,166],[166,168],[166,173],[166,174],[167,171],[167,173],[168,172],[168,174],[169,176],[162,169],[163,169],[169,170],[164,170],[165,170],[166,170],[171,172],[168,171],[172,173],[173,174],[175,176],[175,178],[169,175],[175,177],[177,178],[177,179],[178,184],[176,179],[180,182],[177,180],[177,181],[181,183],[181,187],[181,184],[178,181],[179,182],[177,182],[178,183],[183,184],[185,189],[185,186],[180,185],[186,187],[180,186],[183,186],[181,186],[183,187],[184,187],[188,189],[188,193],[188,191],[185,188],[190,191],[190,193],[188,190],[190,198],[191,192],[189,191],[189,192],[193,199],[194,196],[194,202],[194,201],[190,194],[194,195],[195,196],[192,195],[191,196],[192,196],[197,198],[193,197],[197,199],[193,198],[194,200],[200,201],[201,202],[201,203],[201,205],[196,202],[202,203],[198,202],[197,203],[198,203],[204,209],[204,210],[200,204],[203,205],[206,207],[206,216],[204,206],[206,210],[207,208],[204,207],[208,215],[208,217],[204,208],[208,209],[209,217],[211,220],[211,212],[211,216],[206,211],[207,211],[212,213],[212,214],[206,212],[207,212],[213,219],[213,215],[213,214],[208,213],[207,214],[208,214],[215,217],[209,215],[218,220],[214,218],[211,218],[212,218],[213,218],[218,219],[215,219],[221,224],[218,221],[222,224],[222,223],[221,222],[223,227],[221,223],[225,226],[225,230],[225,229],[222,225],[223,225],[225,232],[224,226],[225,228],[228,229],[228,230],[229,230],[230,231],[230,232],[227,231],[227,232],[233,237],[233,236],[233,235],[228,233],[234,239],[234,236],[233,234],[234,235],[235,237],[234,238],[236,239],[240,244],[240,245],[238,240],[241,242],[240,241],[241,244],[242,247],[240,242],[242,244],[242,245],[240,243],[243,247],[245,247],[241,246],[242,246],[243,246],[246,248],[249,252],[249,251],[248,249],[249,250],[250,255],[253,258],[253,254],[250,253],[250,254],[254,258],[254,256],[254,259],[255,256],[252,255],[256,259],[251,256],[253,257],[258,259],[260,262],[260,263],[257,260],[261,266],[260,261],[261,269],[264,271],[264,267],[264,265],[261,264],[264,266],[261,265],[265,266],[265,267],[265,268],[262,266],[266,271],[266,268],[267,268],[262,267],[268,269],[262,268],[263,268],[263,269],[264,270],[267,271],[272,276],[272,274],[272,275],[272,277],[270,272],[273,276],[273,280],[273,277],[272,273],[273,275],[274,277],[274,275],[275,276],[275,277],[278,279],[273,278],[278,280],[277,279],[273,279],[274,279],[275,279],[275,280],[278,281],[281,282],[282,283],[282,284],[284,285],[282,285],[286,287],[286,288],[285,286],[283,286],[285,287],[288,289],[284,288],[284,289],[288,290],[290,292],[286,290],[286,291],[287,292],[292,293],[287,293],[290,294],[291,294],[292,294],[294,295],[296,303],[295,296],[296,297],[295,297],[297,298],[295,298],[298,304],[299,302],[299,306],[299,301],[299,300],[296,299],[297,300],[300,303],[296,300],[296,301],[302,304],[297,302],[298,302],[303,304],[301,305],[300,305],[305,306],[299,305],[306,307],[306,309],[302,307],[303,307],[307,308],[304,308]]},"terrain":[{"biome":0,"aabb":[-800,100,1700,1300],"center":[950,700],"path":[[[750,300],[-1750,300]],[[750,600],[250,600]],[[750,-300],[-350,-300]],[[50,-600],[-350,-600]],[[350,-300],[50,-600]],[[750,-300],[750,600]],[[250,600],[-50,300]],[[750,-300],[150,300]],[[-1750,300],[-1750,-600]]]},{"biome":0,"aabb":[1700,-200,4200,1000],"center":[3350,450],"path":[[[850,-50],[-1650,-50]],[[850,-650],[-1150,-650]],[[850,550],[-350,550]],[[-350,550],[-950,-50]],[[450,-50],[-150,-650]],[[850,-50],[850,550]]]},{"biome":0,"aabb":[4200,-800,7300,700],"center":[5600,100],"path":[[[1100,300],[0,300]],[[0,300],[-300,600]],[[-300,600],[-500,600]],[[-500,600],[-800,300]],[[-800,300],[-1400,300]],[[500,0],[-500,0]],[[800,300],[500,0]],[[-500,0],[-800,300]],[[1100,-300],[-900,-300]],[[600,-600],[300,-600]],[[300,-600],[0,-300]],[[0,0],[-300,-300]],[[1700,-900],[1100,-300]]]},{"biome":0,"aabb":[6300,-2600,8400,-800],"center":[7250,-1650],"path":[[[850,850],[-950,850]],[[850,-350],[-150,-350]],[[850,-950],[-950,-950]],[[-150,-350],[-750,-950]],[[850,250],[850,850]],[[-950,850],[-950,-950]],[[850,250],[250,850]],[[100,-350],[-500,250]],[[1150,250],[-950,250]]]},{"biome":0,"aabb":[8400,-4400,10500,-1400],"center":[9650,-2750],"path":[[[850,750],[-950,750]],[[850,150],[-950,150]],[[850,-450],[-1250,-450]],[[-50,750],[-750,1350]],[[-750,1350],[-1250,1350]],[[850,-450],[850,750]],[[400,750],[-200,150]],[[50,-1050],[-1250,-1050]],[[650,-450],[50,-1050]],[[350,150],[50,-150]],[[350,-450],[50,-150]],[[50,-150],[-950,-150]],[[850,-1650],[850,-450]]]},{"biome":0,"aabb":[5900,-5000,8400,-3200],"center":[6950,-4100],"path":[[[1450,900],[250,900]],[[1450,300],[-550,300]],[[250,900],[-350,300]],[[-550,300],[-850,0]],[[-850,0],[-1050,0]],[[1450,-300],[-550,-300]],[[-550,-300],[-850,0]],[[1150,-900],[-1050,-900]],[[-1050,0],[-1050,-900]],[[750,0],[-250,0]],[[1050,300],[750,0]],[[850,-300],[250,-900]]]},{"biome":0,"aabb":[8400,-6800,11300,-4400],"center":[10000,-5300],"path":[[[-300,-300],[-1600,-300]],[[0,0],[-300,-300]],[[-900,-600],[-1200,-300]],[[100,-600],[-900,-600]],[[-900,0],[-1200,300]],[[900,0],[-900,0]],[[700,0],[100,-600]],[[1300,300],[-1400,300]],[[1300,900],[-1600,900]],[[300,900],[-300,300]],[[1300,300],[1300,900]],[[1300,-1500],[1300,300]],[[1200,300],[900,0]]]},{"biome":0,"aabb":[5300,-9200,8600,-5600],"center":[6900,-6750],"path":[[[1700,1150],[1100,550]],[[1100,550],[-200,550]],[[1500,1150],[200,1150]],[[1200,-50],[-600,-50]],[[-600,-50],[-1200,-650]],[[-1200,-650],[-1600,-650]],[[1000,-50],[400,-650]],[[400,-650],[-1200,-650]],[[850,-50],[250,550]],[[200,1150],[200,550]],[[-200,550],[-200,-50]],[[300,-50],[0,-350]],[[0,-350],[-200,-350]],[[-1600,-650],[-1600,-2450]]]},{"biome":0,"aabb":[6000,-9200,8900,-7400],"center":[7850,-8300],"path":[[[350,600],[-50,600]],[[650,300],[350,600]],[[-50,600],[-350,300]],[[1050,300],[650,300]],[[-850,300],[-1450,900]],[[-350,300],[-1850,300]],[[250,-300],[-350,300]],[[1050,-300],[-750,-300]],[[350,-600],[-50,-600]],[[650,-300],[350,-600]],[[-50,-600],[-350,-900]],[[1050,-900],[-750,-900]]]},{"biome":0,"aabb":[8700,-8600,12100,-6800],"center":[10300,-7600],"path":[[[1800,-400],[-1400,-400]],[[1800,200],[-1600,200]],[[-1600,200],[-1600,-400]],[[1800,800],[800,800]],[[800,800],[200,200]],[[200,-1000],[-800,-1000]],[[800,-400],[200,-1000]],[[1800,-400],[1800,800]],[[-200,-700],[-400,-700]],[[-400,-700],[-700,-400]],[[1500,-400],[900,200]],[[-800,800],[-1400,200]],[[-700,200],[-1300,-400]],[[-400,200],[-400,800]],[[-400,800],[-800,800]]]},{"biome":1,"aabb":[10300,-2000,14000,400],"center":[12000,-700],"path":[[[2000,-100],[700,-100]],[[700,-100],[100,500]],[[900,500],[-900,500]],[[1500,-100],[900,-700]],[[900,-700],[-900,-700]],[[-100,-700],[-700,-100]],[[-700,-100],[-1700,-100]],[[-900,500],[-1500,1100]],[[100,1100],[-1700,1100]],[[100,500],[100,1100]],[[900,-100],[900,500]],[[-100,-1300],[-700,-700]],[[900,-1300],[-100,-1300]],[[-350,500],[-950,-100]]]},{"biome":1,"aabb":[13700,-2000,17200,400],"center":[15350,-750],"path":[[[750,1150],[-250,1150]],[[-250,1150],[-850,550]],[[-1050,550],[-1650,-50]],[[750,550],[-1050,550]],[[750,-50],[-1350,-50]],[[1350,-650],[750,-50]],[[1850,-650],[-1050,-650]],[[-250,-1250],[-850,-650]],[[750,-1250],[-250,-1250]],[[750,-50],[750,1150]],[[550,-50],[-50,550]],[[300,-50],[-300,-650]]]},{"biome":1,"aabb":[16900,-2000,20900,400],"center":[18700,-750],"path":[[[1400,-650],[-1500,-650]],[[-400,-1250],[-1000,-650]],[[1400,-1250],[-400,-1250]],[[1400,-50],[-1200,-50]],[[-1200,-50],[-1800,-650]],[[1400,550],[-1200,550]],[[2000,1150],[1400,550]],[[2200,1150],[-1200,1150]],[[-1200,1150],[-1200,-50]],[[1400,-1250],[1400,-50]],[[-150,550],[-750,1150]],[[500,-650],[-100,-50]],[[-400,550],[-1000,-50]]]},{"biome":1,"aabb":[18500,-100,23300,2800],"center":[21200,1750],"path":[[[2100,1050],[-2400,1050]],[[2100,450],[-2100,450]],[[1600,450],[1000,-150]],[[1000,-150],[-1300,-150]],[[-1300,-150],[-1900,450]],[[1300,-750],[-2100,-750]],[[300,-750],[-300,-1350]],[[2100,450],[2100,1050]],[[-2100,-750],[-2700,-1350]],[[-400,-750],[-1000,-150]],[[-600,1050],[-1200,450]],[[1200,450],[600,1050]],[[2100,-1850],[2100,450]]]},{"biome":1,"aabb":[16100,2200,19100,4600],"center":[17600,3500],"path":[[[1200,-700],[-900,-700]],[[-900,-700],[-1500,-100]],[[900,-100],[-1500,-100]],[[1500,-700],[900,-100]],[[600,-700],[0,-1300]],[[900,-1300],[-900,-1300]],[[-100,500],[-700,-100]],[[100,500],[-100,500]],[[700,1100],[100,500]],[[900,1100],[-900,1100]],[[900,-100],[900,1100]],[[-900,1100],[-900,-100]]]},{"biome":1,"aabb":[11900,2200,16100,4600],"center":[13800,3450],"path":[[[2100,-50],[1500,550]],[[1300,550],[700,1150]],[[-300,550],[-900,-50]],[[-1100,-50],[-1700,-650]],[[1500,550],[-300,550]],[[700,1150],[-1100,1150]],[[1500,-650],[-1900,-650]],[[1500,-1250],[-1100,-1250]],[[-900,-50],[-1100,-50]],[[2300,-50],[500,-50]],[[500,-50],[-100,-650]],[[-200,-1250],[-800,-650]],[[-1100,1150],[-1100,-50]]]},{"biome":1,"aabb":[8400,1600,11900,3700],"center":[10150,2800],"path":[[[1750,0],[-1750,0]],[[1150,600],[-1450,600]],[[1150,-600],[-1450,-600]],[[1150,-1200],[150,-1200]],[[150,-1200],[-450,-600]],[[-50,-300],[-250,-300]],[[-250,-300],[-550,0]],[[250,-600],[-50,-300]],[[250,600],[-50,900]],[[-50,900],[-250,900]],[[-250,900],[-550,600]],[[1750,0],[1150,600]],[[-1450,600],[-1450,0]],[[850,600],[250,0]],[[-750,600],[-1350,0]],[[1150,-1200],[1150,-600]]]},{"biome":1,"aabb":[4400,1600,8400,3400],"center":[6400,2600],"path":[[[2000,200],[-2000,200]],[[1500,200],[900,800]],[[-900,800],[-1500,200]],[[900,800],[-900,800]],[[900,-400],[-900,-400]],[[-100,-1000],[-700,-400]],[[900,-1000],[-100,-1000]],[[450,200],[-150,-400]]]},{"biome":2,"aabb":[2000,2200,4700,3400],"center":[3600,2850],"path":[[[800,-50],[-1600,-50]],[[-500,550],[-1100,-50]],[[500,550],[-500,550]],[[500,-50],[500,550]],[[1100,-50],[500,-650]],[[500,-650],[-500,-650]]]},{"biome":2,"aabb":[-1200,2200,2300,4000],"center":[650,3200],"path":[[[1350,-400],[-1850,-400]],[[850,200],[250,800]],[[250,800],[-750,800]],[[1650,-400],[1050,200]],[[1050,200],[850,200]],[[50,-1000],[-550,-400]],[[1050,-1000],[50,-1000]],[[-750,800],[-1350,200]],[[-1350,200],[-1850,200]]]},{"biome":2,"aabb":[-5200,2200,-900,3400],"center":[-2650,2800],"path":[[[1450,0],[950,0]],[[950,0],[350,600]],[[1450,600],[-1450,600]],[[150,-600],[-450,0]],[[1150,-600],[-650,-600]],[[-450,0],[-2550,0]],[[-1450,600],[-2050,0]],[[1750,0],[1150,-600]]]},{"biome":2,"aabb":[-9500,1000,-5200,3400],"center":[-7100,2250],"path":[[[1400,550],[800,1150]],[[800,1150],[-200,1150]],[[-200,1150],[-800,550]],[[1400,550],[800,-50]],[[1900,550],[1400,550]],[[-800,550],[-1000,550]],[[800,-50],[-200,-50]],[[-200,-50],[-800,-650]],[[-200,-50],[-800,550]],[[-1000,550],[-1000,-650]],[[1600,-650],[-1800,-650]],[[800,-1250],[-500,-1250]],[[1400,-650],[800,-1250]],[[-1800,-650],[-2400,-1250]]]},{"biome":2,"aabb":[-9700,-2600,-6500,1000],"center":[-8700,-200],"path":[[[1100,1200],[-1000,1200]],[[1600,600],[-200,600]],[[-200,600],[-800,0]],[[900,0],[-1000,0]],[[2200,1200],[1600,600]],[[800,600],[200,1200]],[[-200,-1200],[-800,-600]],[[600,0],[0,-600]],[[0,-600],[-1000,-600]],[[300,-1200],[-200,-1200]],[[-1000,1200],[-1000,-600]],[[-1000,-600],[-1000,-2400]]]},{"biome":2,"aabb":[-8700,-2600,-4700,-200],"center":[-6350,-1450],"path":[[[1650,50],[-2050,50]],[[-950,-550],[-1550,50]],[[1650,-550],[-950,-550]],[[650,-1150],[50,-550]],[[1650,-1150],[650,-1150]],[[1650,-1150],[1650,50]],[[1650,650],[-1750,650]],[[-1750,650],[-2350,50]],[[250,650],[-350,1250]],[[-350,1250],[-1450,1250]],[[400,50],[-200,-550]],[[1450,50],[850,650]]]},{"biome":2,"aabb":[-4700,-2600,-800,400],"center":[-2900,-1000],"path":[[[-1000,200],[-1800,200]],[[-400,800],[-1000,200]],[[1400,1400],[-1200,1400]],[[1400,800],[-400,800]],[[500,800],[-100,1400]],[[-1200,-400],[-1800,200]],[[600,-400],[-1200,-400]],[[1200,-1000],[600,-400]],[[2100,-1000],[-400,-1000]],[[-400,-1000],[-1000,-1600]],[[600,-1600],[-1200,-1600]],[[2100,1100],[2100,-1000]],[[1400,-1000],[1400,1400]],[[0,200],[-600,-400]],[[1400,200],[0,200]],[[-1200,1400],[-1200,200]]]},{"biome":0,"aabb":[6700,400,10300,1600],"center":[8250,1000],"path":[[[2050,-600],[1350,100]],[[-450,100],[-950,600]],[[-850,100],[-1550,-600]],[[1350,100],[-850,100]]]}],"camera":{"regions":[[[-1000,100,500,1200],1200,900,null,null],[[500,-500,2000,1400],1500,1125,1170,null],[[2000,-900,4400,1400],2124,1593,3210,190],[[4400,-700,6700,800],2124,1593,5572,-52],[[6100,-3100,8400,-700],3060,2295,7174,-1862],[[8400,-4200,10600,-1200],3672,2754,9715,-2800],[[5700,-5400,8400,-3100],3060,2295,7190,-4254],[[8400,-6400,11500,-4200],2548,1911,null,-5340],[[5200,-7600,8400,-5400],2124,1593,null,null],[[6900,-9700,9100,-7600],2124,1593,8000,null],[[9100,-8900,12300,-6700],3672,2754,10440,-7841],[[10600,-2900,13200,-1600],2000,1500,null,null],[[10100,-1600,13400,800],3672,2754,11954,-934],[[13400,-2600,16600,800],4400,3300,15270,-998],[[16600,-2600,20300,500],4400,3300,18815,-1042],[[18800,500,23500,3000],3672,2754,null,1596],[[16300,1500,18800,4800],2124,1593,17624,null],[[12300,1500,16300,4800],3672,2754,13632,3310],[[8300,1200,12300,3900],3672,2754,9676,2546],[[4600,1200,8300,3900],3060,2295,6134,2338],[[2700,1600,4600,3700],2124,1593,3596,2650],[[-500,1600,2700,4200],3060,2295,672,2905],[[-4500,1600,-500,4000],2124,1593,null,2678],[[-8200,600,-4500,3700],3672,2754,-6900,2082],[[-10000,-1300,-7000,1800],4400,3300,-8892,-22],[[-8200,-3100,-4500,-200],3672,2754,-6428,-1536],[[-4400,-3100,-400,-1300],5284,3963,-2784,-1265],[[-4500,-1300,-1000,500],5284,3963,-2784,-1265],[[7200,-100,9800,1600],2400,1800,null,100],[[12250,-8900,13750,-2900],1200,900,12600,null]]},"blocks":[[[2000,-900,4450,1200],0],[[6700,-1050,9650,1200],8],[[9650,-1950,13500,1150],101],[[12100,-9450,13800,-6700],101],[[13350,-2700,16600,800],114],[[4600,1100,7850,3850],204],[[7100,-9700,9000,-7700],78],[[16000,1200,18800,5100],158],[[17250,-2400,21100,600],127],[[12450,1400,15650,5050],175],[[8500,1200,11700,3900],188],[[2250,1350,4600,3950],222],[[-4500,1650,-900,4200],240],[[-8400,600,-5200,3700],249],[[-4200,-3150,-900,1650],282],[[-800,-3300,1600,-1500],296]]}')}]);